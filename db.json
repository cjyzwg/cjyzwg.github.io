{"meta":{"version":1,"warehouse":"4.0.2"},"models":{"Asset":[{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/next/source/css/noscript.styl","path":"css/noscript.styl","modified":0,"renderable":1},{"_id":"themes/next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/avatar.jpg","path":"images/avatar.jpg","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/logo-algolia-nebula-blue-full.svg","path":"images/logo-algolia-nebula-blue-full.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/logo.svg","path":"images/logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/js/bookmark.js","path":"js/bookmark.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/comments-buttons.js","path":"js/comments-buttons.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/comments.js","path":"js/comments.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/config.js","path":"js/config.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/motion.js","path":"js/motion.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/next-boot.js","path":"js/next-boot.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/pjax.js","path":"js/pjax.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/schedule.js","path":"js/schedule.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/schemes/muse.js","path":"js/schemes/muse.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/addtoany.js","path":"js/third-party/addtoany.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/fancybox.js","path":"js/third-party/fancybox.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/pace.js","path":"js/third-party/pace.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/quicklink.js","path":"js/third-party/quicklink.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/baidu-analytics.js","path":"js/third-party/analytics/baidu-analytics.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/google-analytics.js","path":"js/third-party/analytics/google-analytics.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/growingio.js","path":"js/third-party/analytics/growingio.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/matomo.js","path":"js/third-party/analytics/matomo.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/chat/chatra.js","path":"js/third-party/chat/chatra.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/chat/gitter.js","path":"js/third-party/chat/gitter.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/chat/tidio.js","path":"js/third-party/chat/tidio.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/changyan.js","path":"js/third-party/comments/changyan.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/disqus.js","path":"js/third-party/comments/disqus.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/disqusjs.js","path":"js/third-party/comments/disqusjs.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/gitalk.js","path":"js/third-party/comments/gitalk.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/isso.js","path":"js/third-party/comments/isso.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/livere.js","path":"js/third-party/comments/livere.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/utterances.js","path":"js/third-party/comments/utterances.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/math/katex.js","path":"js/third-party/math/katex.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/math/mathjax.js","path":"js/third-party/math/mathjax.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/search/algolia-search.js","path":"js/third-party/search/algolia-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/search/local-search.js","path":"js/third-party/search/local-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/statistics/firestore.js","path":"js/third-party/statistics/firestore.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/statistics/lean-analytics.js","path":"js/third-party/statistics/lean-analytics.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/tags/mermaid.js","path":"js/third-party/tags/mermaid.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/tags/pdf.js","path":"js/third-party/tags/pdf.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/tags/wavedrom.js","path":"js/third-party/tags/wavedrom.js","modified":0,"renderable":1}],"Cache":[{"_id":"source/tags/index.md","hash":"2dccf3a9e7f2c2c15737c829b79ed7f5a55e9642","modified":1686263344889},{"_id":"source/about/index.md","hash":"e9a6e73753b631558f113d0ea7cd5659acfd4b6b","modified":1686263754901},{"_id":"source/_posts/DNSMASQ/dnsmasq配置局域网域名.md","hash":"1468ffd3866a41fced5bbe31a5912c9ce775dc3d","modified":1686265933671},{"_id":"source/_posts/Android/adb devices 为空.md","hash":"8be33b9feef2cee76844b3b26d29abe69bf4665e","modified":1686265933671},{"_id":"source/categories/index.md","hash":"2dedab78ac5485dea5011abee3f2dae113729f77","modified":1686262793328},{"_id":"source/_posts/.obsidian/appearance.json","hash":"9439122150a0431e432676115220bc925af96094","modified":1686270358171},{"_id":"source/_posts/.obsidian/core-plugins.json","hash":"eb138d03157a06efdb791f441be97c256aca472c","modified":1686270561635},{"_id":"source/_posts/.obsidian/app.json","hash":"bf21a9e8fbc5a3846fb05b4fa0859e0917b2202f","modified":1686270358152},{"_id":"source/_posts/.obsidian/core-plugins-migration.json","hash":"0e26aae7d03070c204bfa7fd32ce3785211f5316","modified":1686270561637},{"_id":"source/_posts/.obsidian/hotkeys.json","hash":"bf21a9e8fbc5a3846fb05b4fa0859e0917b2202f","modified":1686270357137},{"_id":"source/_posts/.obsidian/templates.json","hash":"fab8bc2647fe63a2d621f48def58472ef3cf1161","modified":1686270617589},{"_id":"source/_posts/FLUTTER/flutter doctor一直等待无响应.md","hash":"bf14201078f233e6341426d1e745e0cec7c8f97c","modified":1686265933748},{"_id":"source/_posts/FLUTTER/flutter mac下安装.md","hash":"35c3a90183db45a1bd33fcb3c263bb15e213bd8e","modified":1686265933748},{"_id":"source/_posts/.obsidian/workspace.json","hash":"3d49f5ded28dca8e88490e9df3f29e478bf6e354","modified":1686270835533},{"_id":"source/_posts/FLUTTER/页面传递参数.md","hash":"b9f47ab56a66abb856df96df57521206babc8c67","modified":1686265933671},{"_id":"source/_posts/GOLANG/LXC容器搭建NSQ集群二.md","hash":"94e7702a6d8180a660ea86d56cb77824e6011cf4","modified":1686265933671},{"_id":"source/_posts/GOLANG/LXC容器搭建NSQ集群三.md","hash":"2fc7ef5276473f791255ab27db358a713d1bb6b6","modified":1686265933671},{"_id":"source/_posts/GOLANG/LXC容器搭建NSQ集群一.md","hash":"e3eaf0cf8d67711904df04f1c285e194ded4c73e","modified":1686265933739},{"_id":"source/_posts/GOLANG/go协程池.md","hash":"3932f57d1d9b909c9bf73170a8c044b4940579c3","modified":1686265933672},{"_id":"source/_posts/GOLANG/beego自动化部署.md","hash":"6845863fca3202971bdea566fb2ea8222d655e3a","modified":1686265933671},{"_id":"source/_posts/GOLANG/go_mod 翻墙问题.md","hash":"47141aea1ae381f537ae9ad9e0b0f64fa9dd7cfb","modified":1686265933671},{"_id":"source/_posts/GOLANG/go解析excel.md","hash":"5e98ab53ffc0949094ba7ab8f2d24704e36430cb","modified":1686265933672},{"_id":"source/_posts/GOLANG/go协程池2.md","hash":"717766494d2d051f9bf035e7316fb609331d909e","modified":1686265933672},{"_id":"source/_posts/GOLANG/grpc_php客户端.md","hash":"135f9ce576a697edf04099c774768966d60a9500","modified":1686265933672},{"_id":"source/_posts/GOLANG/学习channel.md","hash":"4ad8e77e350162f0e312ed26cf8b7739775c6340","modified":1686265933672},{"_id":"source/_posts/GOLANG/直播搭建.md","hash":"581153399d505c0286774799e1ca606c1a90de54","modified":1686265933672},{"_id":"source/_posts/MYSQL/mysqldump数据结构,并且主键重置为1.md","hash":"97d5fdb62031d9b0c180450dfa31211953ced7d1","modified":1686265933672},{"_id":"source/_posts/PUSH/消息快速告警.md","hash":"f9e1ea89f818bbb14ebbf6361346b690f737a56a","modified":1686265933739},{"_id":"source/_posts/MYSQL/mysql计算周报表.md","hash":"c286fe52efa1e1d2f2bf8e82b29c9eef4c15b054","modified":1686265933740},{"_id":"source/_posts/PHP/laravel面试.md","hash":"3afe83723384c87863f70464008d233382f1300a","modified":1686265933672},{"_id":"source/_posts/PHP/二维数组分组.md","hash":"468093a149aa3724d0a8686295ef5aec7d559af7","modified":1686265933673},{"_id":"source/_posts/PHP/解析ini文件.md","hash":"0f7e06f073e9099abf488e0978226223035442ca","modified":1686265933672},{"_id":"source/_posts/PHP/php-fpm理解以及处理502问题.md","hash":"3ec0b79769d34e59b2eb57acf9892fcf28238c0e","modified":1686265933672},{"_id":"source/_posts/SSH/SSH添加阿里云秘钥.md","hash":"fefe8b9ca8fb66a89d04582626f7c98d8ff6be75","modified":1686265933739},{"_id":"source/_posts/REDIS/REDIS安装及应用.md","hash":"a040a76ac13c055bfc610cda15563dfca7a145a7","modified":1686265933739},{"_id":"source/_posts/PHP/逆波兰式计算工资.md","hash":"b55e0ca7efbac576299fc9b4cf4dc9ce8f1f0929","modified":1686265933739},{"_id":"source/_posts/REDIS/REDIS延迟任务队列应用.md","hash":"8d5b55a3ccb0d247d3fb5957fdf9858edf8c7790","modified":1686265933739},{"_id":"source/_posts/SSH/SSH访问局域网网站.md","hash":"fcfa3bc3c4710033b617b29667240befef06c0eb","modified":1686265933739},{"_id":"source/_posts/SSH/acme生成https协议操作方法.md","hash":"54bb324aed937cff8cf5251cbb5e5ebf981073ea","modified":1686265933743},{"_id":"source/_posts/SSH/gitee同步github.md","hash":"b1305d7238288782204c4e1837618eb904bf66bf","modified":1686265933740},{"_id":"source/_posts/VPN/Openvpn.md","hash":"3f6cef3dbeb7595ad06b0c32b8fc0a7c15df7139","modified":1686265933747},{"_id":"source/_posts/吃瓜/炎亚纶新剧出意外！2人坠谷当场死亡，炎亚纶不满剧组强势携全体主演罢工.md","hash":"90acd6d3befdaedccf431fe8c5187804f611ad6a","modified":1686265933744},{"_id":"source/_posts/树莓派/搭建git服务器超简单命令.md","hash":"96e996745dbebf61156fc94b9d09aa263f8f6511","modified":1686265933747},{"_id":"source/_posts/树莓派/树莓派烧录.md","hash":"2e45db44657e58f2513e7dd56d4e38256b511564","modified":1686265933747},{"_id":"source/_posts/微信公众号/如何从0-1开始写作.md","hash":"0853dd3e3c1e37a2235fbcdcc3119f12dbe06b92","modified":1686265933748},{"_id":"source/_posts/微信公众号/华为近期祭出的仓颉是个啥？.md","hash":"08cc0fbd8a82f6b6a31ea3d15bbb06cdaf0aa48c","modified":1686265933748},{"_id":"source/_posts/微信公众号/无痛苦更新公众号（完整）.md","hash":"fe2c98c7a58e1f3ecd13e4ddd5970c4434ee00ee","modified":1686265933748},{"_id":"source/_posts/微信公众号/无痛苦更新公众号.md","hash":"619add894ee4796575196a27b8efabfdac76dd43","modified":1686265933747},{"_id":"source/_posts/微信公众号/破防了.md","hash":"2100a3846ab5ca126f372a490e9a5740f4a4a9b9","modified":1686265933748},{"_id":"source/_posts/微信公众号/阿三与喵姑娘.md","hash":"e64cb0b9ebb3609657ea6c708ea7a1688422bfd8","modified":1686265933748},{"_id":"source/_posts/测试/doc.md","hash":"caee4834acf9994d9bb48d159ef6dd6c8f868a6a","modified":1686270909286},{"_id":"source/_posts/测试/hello-world.md","hash":"45b3bdb1bbe816a467f9659c804c91575424bd33","modified":1686270909284},{"_id":"source/_posts/认知与成长/我如何写出一万元的文章.md","hash":"8cfd4685f6f2a58122c9d375ddfaa3ba19afe3fd","modified":1686265933747},{"_id":"source/_posts/测试/hello-world1.md","hash":"7857f99adae9b1879fa50fd1366f85f7eb7ef7f2","modified":1686270909284},{"_id":"source/_posts/测试/测试.md","hash":"2729a39d2485c1cd73b1b231f065bbdf26989200","modified":1686270909285},{"_id":"source/_posts/测试/index.md","hash":"136cf9ccb56c8b35fc1132ac4abc47995641d888","modified":1686270909284},{"_id":"source/_posts/模版文件夹/博客.md","hash":"92bf4ffd73eb50b6263cae5d5712490aea57c357","modified":1686270909286},{"_id":"themes/next/.gitignore","hash":"417520c4dbbeab9c7e3ab10d944da0886366a0ee","modified":1686250121874},{"_id":"themes/next/.gitattributes","hash":"ec43734985e1cafd53d88ded3020103f7416123c","modified":1686250121865},{"_id":"themes/next/.editorconfig","hash":"8570735a8d8d034a3a175afd1dd40b39140b3e6a","modified":1686250121865},{"_id":"themes/next/.eslintrc.json","hash":"9c0762486f24a8c5e60f8b6c875e4c4728942649","modified":1686250121865},{"_id":"themes/next/LICENSE.md","hash":"68fc9a03d50fd4b5ea97092b05967d1819dea2c4","modified":1686250121875},{"_id":"themes/next/.stylelintrc","hash":"dedb8dd4d454cb1bb6aba594ef2cbd05ec2427d8","modified":1686250121874},{"_id":"themes/next/_vendors.yml","hash":"5aa3b0573d47f85b1be7d21ced21c7810b37ecef","modified":1686250121876},{"_id":"themes/next/README.md","hash":"36c4b25587ca494102323dab5a38de5490451a64","modified":1686250121875},{"_id":"themes/next/package.json","hash":"81f58b70b6601e5273c7b21f0751d923c1124180","modified":1686250121911},{"_id":"themes/next/crowdin.yml","hash":"e026078448c77dcdd9ef50256bb6635a8f83dca6","modified":1686250121876},{"_id":"themes/next/_config.yml","hash":"08e17c2d792406ea1bb7c2722822a9a8c7c0cf30","modified":1686269405586},{"_id":"themes/next/renovate.json","hash":"cb29cc16e61b0b8a6dac34657d76822ae29ad5aa","modified":1686250121911},{"_id":"themes/next/.githooks/pre-commit","hash":"f473eac1aaaa96c947d67988bbed140bbab1a821","modified":1686250121866},{"_id":"themes/next/docs/AGPL3.md","hash":"0d2b8c5fa8a614723be0767cc3bca39c49578036","modified":1686250121877},{"_id":"themes/next/docs/AUTHORS.md","hash":"a648823121563c34a177ae91f5a774b5e29f01a0","modified":1686250121877},{"_id":"themes/next/languages/README.md","hash":"b2567e32805dda79601157351a07e5ca9fe01315","modified":1686250121879},{"_id":"themes/next/languages/ar.yml","hash":"7d0f39e8684284a04bb9808521c87fecda8bd131","modified":1686250121879},{"_id":"themes/next/docs/LICENSE.txt","hash":"f5b14f791b7cfa1d16da981d929152e088a5d1b8","modified":1686250121877},{"_id":"themes/next/languages/bn.yml","hash":"9f791494afa263c3e31f14b8a5fa2996dfc834c0","modified":1686250121880},{"_id":"themes/next/languages/de.yml","hash":"79b37df731c29665dee6cd7c90d278e1edfb6e24","modified":1686250121880},{"_id":"themes/next/languages/en.yml","hash":"ba0fd79a2b1d8db01a034180556061745965ff05","modified":1686250121880},{"_id":"themes/next/languages/fa.yml","hash":"f3ffc444599f4ac92d62e9ed00a1490ebc277d70","modified":1686250121881},{"_id":"themes/next/languages/es.yml","hash":"dffc63ef42e1266b88e0acf08994fd17a9908d53","modified":1686250121881},{"_id":"themes/next/languages/default.yml","hash":"ba0fd79a2b1d8db01a034180556061745965ff05","modified":1686250121880},{"_id":"themes/next/languages/id.yml","hash":"929df147f4f17d638b07de5fe52ca13e2549ab1c","modified":1686250121881},{"_id":"themes/next/languages/ja.yml","hash":"543222bfc516aab6c33e8534f807972ecb8943a9","modified":1686250121882},{"_id":"themes/next/languages/it.yml","hash":"16d716ecfd748def2f6486ef5a82d0ab7ceb4890","modified":1686250121882},{"_id":"themes/next/languages/fr.yml","hash":"44cd26479f503751329f6da2ed80cce1bbf18117","modified":1686250121881},{"_id":"themes/next/languages/nl.yml","hash":"3cb3687696635ec71b4ca40c5fc43b56acc8843e","modified":1686250121882},{"_id":"themes/next/languages/ko.yml","hash":"d345a303310c8a5f4836c3683f3580f861ebd1b4","modified":1686250121882},{"_id":"themes/next/languages/pt-BR.yml","hash":"76b8576ce228d540a16b1f0af5af2cce20923194","modified":1686250121883},{"_id":"themes/next/languages/si.yml","hash":"2d712eedf3f60d04d36c3108cf5a12e2a52e875c","modified":1686250121884},{"_id":"themes/next/languages/pt.yml","hash":"70de366e10ea584ba039d40d6b35ac97f93454ad","modified":1686250121883},{"_id":"themes/next/languages/ru.yml","hash":"c6d8de0ff7d8148d09993257cfd3b7aca755696c","modified":1686250121883},{"_id":"themes/next/languages/th.yml","hash":"6829e998b39f8f143e20b276bb1f62d95a29de58","modified":1686250121884},{"_id":"themes/next/languages/tk.yml","hash":"511726054873f6f8d7ce0d2e803f6731de0ddbe7","modified":1686250121884},{"_id":"themes/next/languages/tr.yml","hash":"a57e4ed089b893a95f5e1ecff17ce625165f4d46","modified":1686250121884},{"_id":"themes/next/languages/zh-CN.yml","hash":"741d7efe0262c9cdc2c648014b55599665d90f6b","modified":1686250121886},{"_id":"themes/next/languages/uk.yml","hash":"ff537047b4b4c3ca9a7b64fa7f428a9942751eeb","modified":1686250121885},{"_id":"themes/next/languages/vi.yml","hash":"7ebcba5e1128784195e4681dffc9d34c4e873fec","modified":1686250121885},{"_id":"themes/next/languages/zh-TW.yml","hash":"4695c87d6b81b3a23d16ad6513d9eaa925f8d8ad","modified":1686250121887},{"_id":"themes/next/layout/_layout.njk","hash":"fc0a45112f2dcfc2642404e8934ea32a793c3bd7","modified":1686250121888},{"_id":"themes/next/layout/index.njk","hash":"dd63e488ae8cc144335a5958acedf6a16edd7a92","modified":1686250121907},{"_id":"themes/next/layout/archive.njk","hash":"d759f4d2cf5ddc6875ea250113a00662c1caf6d1","modified":1686250121906},{"_id":"themes/next/layout/post.njk","hash":"0bfce9f133f501a9a4837257e3b862b3bbca15be","modified":1686250121910},{"_id":"themes/next/layout/category.njk","hash":"c68b7343d0f8145010f93351908cc36ef6212ec1","modified":1686250121906},{"_id":"themes/next/layout/page.njk","hash":"b0660b2af0ac7d3fda14ca4d9f2c9e79ef06c6f9","modified":1686250121907},{"_id":"themes/next/layout/tag.njk","hash":"9e16ba20c28a7f2c6bc75aa427f48122301a30aa","modified":1686250121910},{"_id":"themes/next/.github/CODE_OF_CONDUCT.md","hash":"21cbff565a0445d3a880fff1ee417e309740a9ab","modified":1686250121867},{"_id":"themes/next/.github/PULL_REQUEST_TEMPLATE.md","hash":"fa76760856429b6421abc54e63b2d3c815372900","modified":1686250121870},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"330656d93b6c03df9fb1f2f0e3534c971969473b","modified":1686250121867},{"_id":"themes/next/.github/issue_label_bot.yaml","hash":"fca600ddef6f80c5e61aeed21722d191e5606e5b","modified":1686250121870},{"_id":"themes/next/.github/config.yml","hash":"7984e665e9de481a0e0e51fca5668337713f810b","modified":1686250121870},{"_id":"themes/next/.github/label-commenter-config.yml","hash":"171e2979dd4d128e452300f2182435a049842c2a","modified":1686250121871},{"_id":"themes/next/test/index.js","hash":"6bf0289846538be3e9a63809af98f00e1fbdd90b","modified":1686250122059},{"_id":"themes/next/.github/release.yml","hash":"112310b81f959747f8eaafc2ca2150e1dcf916d8","modified":1686250121871},{"_id":"themes/next/.github/labeler.yml","hash":"5c4bc2bd561e6d9b33ee118cc12218c5de46f72d","modified":1686250121871},{"_id":"themes/next/.githooks/install.js","hash":"0977cb57c8b91ea166b5bbc481e4ddeaf77e9b18","modified":1686250121866},{"_id":"themes/next/docs/ru/README.md","hash":"ac3c4a7616ea80f0d32d68d6e53233952ba756dc","modified":1686250121878},{"_id":"themes/next/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"7a06d443f374bd1e84294067a0ac796afd9fbe60","modified":1686250121878},{"_id":"themes/next/languages/zh-HK.yml","hash":"88ea50eeb9097ab4a87a44981a102d8594feb064","modified":1686250121887},{"_id":"themes/next/docs/zh-CN/README.md","hash":"9bbdbb0656505acceef9b9895a576164175fe888","modified":1686250121879},{"_id":"themes/next/docs/zh-CN/CONTRIBUTING.md","hash":"a089f7a8368ab0b7d7b9b7ec0ac3767a453435df","modified":1686250121879},{"_id":"themes/next/layout/_macro/post.njk","hash":"95822069cce2c4702e035c770b3089bc12a3404c","modified":1686250121889},{"_id":"themes/next/layout/_macro/post-collapse.njk","hash":"1a30d751871dabfa80940042ddb1f77d07d830b9","modified":1686250121888},{"_id":"themes/next/layout/_partials/comments.njk","hash":"d0c470b0f6690aa217e9ada848c5e2e73fb27c6f","modified":1686250121889},{"_id":"themes/next/layout/_macro/sidebar.njk","hash":"547c62ab14d9e05d2d9116db9048a677fbe1fb6d","modified":1686250121889},{"_id":"themes/next/layout/_partials/footer.njk","hash":"c40760b559c516677c8b11a00ba50c011f2079fd","modified":1686250121889},{"_id":"themes/next/layout/_partials/languages.njk","hash":"e43f22198cccb5f6e306b1ce0d28d12a4fb891f8","modified":1686250121891},{"_id":"themes/next/layout/_partials/widgets.njk","hash":"e7f988ecddb2159313699a00827a45eca5622bd4","modified":1686250121896},{"_id":"themes/next/layout/_partials/pagination.njk","hash":"bc719473ed5948ab6859449d60b8d36cfc1542b4","modified":1686250121892},{"_id":"themes/next/layout/_scripts/vendors.njk","hash":"be80b9fe415a9a09d74c28e230995fd292dfc123","modified":1686250121896},{"_id":"themes/next/layout/_third-party/fancybox.njk","hash":"844559f46e2ff1c8be234d5763703106e2072a7b","modified":1686250121903},{"_id":"themes/next/layout/_scripts/index.njk","hash":"6668878a0f9a1166c6a879755f54a08d942da870","modified":1686250121896},{"_id":"themes/next/layout/_third-party/addtoany.njk","hash":"ef64c6bfb8540cd874701236b9be47db2496e98e","modified":1686250121897},{"_id":"themes/next/scripts/events/index.js","hash":"bd9ea82376cd87df611ea3ae077875c7c595a3df","modified":1686250121911},{"_id":"themes/next/scripts/helpers/engine.js","hash":"d292b78485e8e8055712b0ed6de7cf559c5fbdcd","modified":1686250121938},{"_id":"themes/next/scripts/helpers/font.js","hash":"3394185a7f0393c16ce52c8028f90da3e9239c55","modified":1686250121938},{"_id":"themes/next/scripts/helpers/navigation.js","hash":"78107021101553c3d23e89290f7530b60cf4aa86","modified":1686250121938},{"_id":"themes/next/layout/_third-party/index.njk","hash":"bda05391c72f7a25731e762077636c4a97fc4910","modified":1686250121903},{"_id":"themes/next/layout/_third-party/pace.njk","hash":"d7ad5714079f7f65446f880baf14722435ca9061","modified":1686250121904},{"_id":"themes/next/layout/_third-party/quicklink.njk","hash":"0efed71ed530447718c4ea5bbd5fc8695b0b0d5f","modified":1686250121904},{"_id":"themes/next/scripts/helpers/next-config.js","hash":"226fccbe9c93265e65a300e3cb4bf6f9065cfdd7","modified":1686250121938},{"_id":"themes/next/scripts/helpers/next-paginator.js","hash":"e86c764b546e4fbb87970cabc4135a56f9ef9fe1","modified":1686250121939},{"_id":"themes/next/scripts/helpers/next-url.js","hash":"fd24abfaba4d91923ddb6aecf0268b216678c8bd","modified":1686250121939},{"_id":"themes/next/scripts/helpers/next-vendors.js","hash":"afdd6a188a74c188f0dd154fac70efd4080ca262","modified":1686250121939},{"_id":"themes/next/scripts/filters/default-injects.js","hash":"872f01cb10e422a648ea505436532e776e92926b","modified":1686250121915},{"_id":"themes/next/scripts/filters/locals.js","hash":"9eb5310664759931287dd28ea39165dfb67f12ed","modified":1686250121915},{"_id":"themes/next/scripts/filters/minify.js","hash":"964a01bec35a95da974882295cababcb93219b40","modified":1686250121937},{"_id":"themes/next/scripts/filters/post.js","hash":"fdc8a0af90035e89c3fcb754a0eb189b8951a2bc","modified":1686250121937},{"_id":"themes/next/scripts/tags/button.js","hash":"c6ad2ed544fbb25ecb5d820c36e76302504271b7","modified":1686250121940},{"_id":"themes/next/scripts/tags/caniuse.js","hash":"935a311142a409c1896b3ae3f01fe7a9e2db1134","modified":1686250121940},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"9ed799c329abf830f623689d7e136991256a24ca","modified":1686250121940},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"92c19d796bdb3320df9caea59bf52df7a95d9da9","modified":1686250121940},{"_id":"themes/next/scripts/tags/index.js","hash":"1f6aba7820f1fb58b61969485148db21846e1aa9","modified":1686250121941},{"_id":"themes/next/scripts/tags/label.js","hash":"8a73348186113bae0a51ea2f891c1bb882fab05a","modified":1686250121941},{"_id":"themes/next/scripts/tags/link-grid.js","hash":"18a483c2d5afd701f6080ffdddf2d1321370336c","modified":1686250121941},{"_id":"themes/next/scripts/tags/mermaid.js","hash":"4fb01ca650fa8b256b8d48f50dc1b18350bd3d6d","modified":1686250121943},{"_id":"themes/next/scripts/tags/note.js","hash":"7b94ddb46b7d4b0fe815f2fbe4bd375f07f55363","modified":1686250121943},{"_id":"themes/next/scripts/tags/pdf.js","hash":"344636b6fd7e27e8831c1e194039afc0d61931cd","modified":1686250121943},{"_id":"themes/next/scripts/tags/tabs.js","hash":"0eabe51da40b4b13e16419c8fe02452d9a4fef73","modified":1686250121943},{"_id":"themes/next/scripts/tags/video.js","hash":"2ee926448583be8f95af1f2884ae2c9c4830151d","modified":1686250121944},{"_id":"themes/next/scripts/tags/wavedrom.js","hash":"b44dfeeb58b41945d469141787f3dbce4b117d08","modified":1686250121944},{"_id":"themes/next/source/css/_colors.styl","hash":"3c6798c10cc220d83481cb3f3782e78558cee789","modified":1686250121944},{"_id":"themes/next/source/css/_mixins.styl","hash":"83647a6207333b9609ba90b0946b3fa9548e6381","modified":1686250121967},{"_id":"themes/next/source/css/noscript.styl","hash":"dadc81256afb127b77eac6763d5ee0ec9c77f0a3","modified":1686250121987},{"_id":"themes/next/source/css/main.styl","hash":"921a58577f411cf4eb5cfd66db0a241f8f88578c","modified":1686250121987},{"_id":"themes/next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1686250121987},{"_id":"themes/next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1686250121988},{"_id":"themes/next/source/images/avatar.gif","hash":"2dbc3e2f2d624b2ca1afe6edc2ca17307f1950c8","modified":1686250121988},{"_id":"themes/next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1686250121988},{"_id":"themes/next/source/images/logo-algolia-nebula-blue-full.svg","hash":"b85e274207b1392782476a0430feac98db1e7da0","modified":1686250121989},{"_id":"themes/next/source/images/logo.svg","hash":"099e11ab995a2c8981427a85476d082609848c77","modified":1686250121989},{"_id":"themes/next/source/js/bookmark.js","hash":"0f563ffbf05fad30e854e413ab17ff7164ab5a53","modified":1686250121989},{"_id":"themes/next/source/js/comments-buttons.js","hash":"1a7344440321713426a0b2ab17e276b5bdf85ade","modified":1686250121990},{"_id":"themes/next/source/js/comments.js","hash":"66ae2e26ea36a41b72c638ea8b220296638ae952","modified":1686250121990},{"_id":"themes/next/source/js/config.js","hash":"4c4ebbe3b3f3841a26f9d5af6d0ba8bc6da01c54","modified":1686250121991},{"_id":"themes/next/source/js/next-boot.js","hash":"da0f07f9eaaa83de70128b0feaea3fdadb90457a","modified":1686250121992},{"_id":"themes/next/source/js/motion.js","hash":"770d63c26f22705311028a36b52e999cc8a2da82","modified":1686250121991},{"_id":"themes/next/source/js/pjax.js","hash":"b03ba78c6916ad2f390d55bc1bc18fafb64b0ebf","modified":1686250121992},{"_id":"themes/next/source/js/schedule.js","hash":"a1333258726caf84f368a8f8454639c7dc1626bb","modified":1686250121993},{"_id":"themes/next/source/js/utils.js","hash":"5e1cf39de050964e97fb3ba0825aeec7f4bc36dd","modified":1686250122058},{"_id":"themes/next/test/helpers/next-url.js","hash":"a91d880cb75e0a8e65a7be4c7362b2c8ebfb7c4f","modified":1686250122059},{"_id":"themes/next/test/helpers/font.js","hash":"342ef3c6fd2dcca2a8802a516ed6d7f389fd2ca2","modified":1686250122058},{"_id":"themes/next/test/tags/center-quote.js","hash":"7667342fd1a1417eaf6a254012b84ae40e8d13dd","modified":1686250122062},{"_id":"themes/next/test/tags/button.js","hash":"48f2aa4c513e9e24bd6a811410520b74cd7ea88b","modified":1686250122062},{"_id":"themes/next/test/tags/caniuse.js","hash":"aa5e728445caeaf7c2ccd0f3fcb2cad0c93ca6d1","modified":1686250122062},{"_id":"themes/next/test/helpers/index.js","hash":"63ba28afed697f7b3574436b1133b8ecc9c0c357","modified":1686250122059},{"_id":"themes/next/test/tags/group-pictures.js","hash":"5c68ae0184f9da6e00ba199f2554d503d8e6da71","modified":1686250122062},{"_id":"themes/next/test/tags/label.js","hash":"4ebf3698c258ca978b997acbdd0dece44069c09d","modified":1686250122063},{"_id":"themes/next/test/tags/index.js","hash":"e8779e54f0979b221858f8bb74dd081bb503b910","modified":1686250122063},{"_id":"themes/next/test/tags/link-grid.js","hash":"43d298fafb7c45a874b766d443843bd26346e689","modified":1686250122064},{"_id":"themes/next/test/tags/note.js","hash":"3dcfcd65bf9f326972ea7571fdb1444200f5d07e","modified":1686250122064},{"_id":"themes/next/test/tags/pdf.js","hash":"fd6ea5123560a90f7e7c1eface23dbe1455db25f","modified":1686250122064},{"_id":"themes/next/test/tags/tabs.js","hash":"d63722919f9da2e44d6b952801e10a2915ea9c12","modified":1686250122065},{"_id":"themes/next/.github/ISSUE_TEMPLATE/bug-report.yml","hash":"3f19cbf0c2b2fee6bf3788870b842c9ccc1425ca","modified":1686250121868},{"_id":"themes/next/test/tags/video.js","hash":"b796fc4dceb20a30e730c322bb5474c0162464cc","modified":1686250122065},{"_id":"themes/next/test/validate/index.js","hash":"5a95ccc8598667535bd022e988055c0e019f3670","modified":1686250122065},{"_id":"themes/next/test/tags/mermaid.js","hash":"ab77be5f3c6d9a57c7b9dda6decf1906a736fef9","modified":1686250122064},{"_id":"themes/next/.github/ISSUE_TEMPLATE/other.yml","hash":"10eca518b91a19984f6a5a912d41222042f61d63","modified":1686250121869},{"_id":"themes/next/.github/ISSUE_TEMPLATE/feature-request.yml","hash":"fbc3062cd4591c8329fab9db72803746f0d11920","modified":1686250121869},{"_id":"themes/next/.github/ISSUE_TEMPLATE/config.yml","hash":"c40ae7903b6cc99f94c9d45ac7ba8c2850bb1309","modified":1686250121868},{"_id":"themes/next/.github/workflows/codeql.yml","hash":"8da13d7c325addb6b7c1d9ac3683dafd43e3709a","modified":1686250121872},{"_id":"themes/next/.github/workflows/label-commenter.yml","hash":"434cc0674290958b1e9bbc46c3486f073c0722db","modified":1686250121872},{"_id":"themes/next/.github/workflows/labeler.yml","hash":"e9d51e93f239a2d4b69722c69db3463b4baf0f4c","modified":1686250121872},{"_id":"themes/next/.github/workflows/linter.yml","hash":"2ab8720e4b9534e48ba324b73b0b58cb54df689f","modified":1686250121873},{"_id":"themes/next/.github/workflows/pr-reminder.yml","hash":"3ab3e8d9dc0e1d9bd54f44fba476792fb1ee190d","modified":1686250121874},{"_id":"themes/next/.github/workflows/lock.yml","hash":"f1bf7f86c11419b63323bd21e388e6bdaf24d27d","modified":1686250121873},{"_id":"themes/next/layout/_partials/head/head-unique.njk","hash":"8da52a144060db1a0a088ccb2e6cc8376d1fce70","modified":1686250121890},{"_id":"themes/next/.github/workflows/tester.yml","hash":"80a20c3a7522249f051a48239db41d1317e9b552","modified":1686250121874},{"_id":"themes/next/layout/_partials/head/head.njk","hash":"5388b157bba4a40b9312f4a45c6678974ccf0837","modified":1686250121890},{"_id":"themes/next/layout/_partials/header/brand.njk","hash":"dd9c4c03e99dfde0dfb8edefcb2c933f2f560efc","modified":1686250121890},{"_id":"themes/next/layout/_partials/header/sub-menu.njk","hash":"06480d8ec5f0b87eafd47f082f07968d7282dd5c","modified":1686250121891},{"_id":"themes/next/layout/_partials/header/menu-item.njk","hash":"41a8b0cc16f60fa085cb719d07216d86b6bc4bf8","modified":1686250121891},{"_id":"themes/next/layout/_partials/header/index.njk","hash":"650de421a8ce4cf685428ffbe0087ff84cbd1356","modified":1686250121890},{"_id":"themes/next/layout/_partials/header/menu.njk","hash":"ee6fc2f111572d3eeab0a2fecbb2d6b3e37ab26b","modified":1686250121891},{"_id":"themes/next/layout/_partials/page/page-header.njk","hash":"7ed4f102a1825195cff8d7995bf9219f323a9034","modified":1686250121892},{"_id":"themes/next/layout/_partials/page/breadcrumb.njk","hash":"89825e75cc45e9709fa6ba89883669eedaff6f46","modified":1686250121892},{"_id":"themes/next/layout/_partials/page/categories.njk","hash":"17156d99941f28a225951ffdcfa9a115e20dc2d2","modified":1686250121892},{"_id":"themes/next/layout/_partials/page/schedule.njk","hash":"0f4bc8e257da60f77c0c1738607b2bde55810684","modified":1686250121892},{"_id":"themes/next/layout/_partials/post/post-copyright.njk","hash":"79667fd0be85ee0e0c69e542e4f870b114c96c33","modified":1686250121893},{"_id":"themes/next/layout/_partials/page/tags.njk","hash":"a18d1598e36cc72f2b0b24c3cc3c5990dfaa3254","modified":1686250121892},{"_id":"themes/next/layout/_partials/post/post-followme.njk","hash":"c1e33b4889f75acc490af3c8bde0ec56c518ff41","modified":1686250121893},{"_id":"themes/next/layout/_partials/post/post-meta.njk","hash":"9fa47e4fb342811da590ee4adc91cf81118c0a39","modified":1686250121893},{"_id":"themes/next/layout/_partials/post/post-related.njk","hash":"e0986db00a0201dd3c60570f964829c84ba5bc68","modified":1686250121893},{"_id":"themes/next/layout/_partials/post/post-reward.njk","hash":"e8b8a7c41e9ec612d0c0c73419529d55d1c16256","modified":1686250121893},{"_id":"themes/next/layout/_partials/post/post-share.njk","hash":"16696990e4ce65fc8db18c4635082a5d5d06ff07","modified":1686250121894},{"_id":"themes/next/layout/_partials/search/algolia-search.njk","hash":"efb2b6f19df02ba5ae623a1f274fff52aed21e6f","modified":1686250121895},{"_id":"themes/next/layout/_partials/search/index.njk","hash":"8f6f256ab3b351ffc80f1f3f1d9834e9a7cfac31","modified":1686250121895},{"_id":"themes/next/layout/_partials/sidebar/site-overview.njk","hash":"70342218473a6e6aa9148de06bfffe121afb8548","modified":1686250121896},{"_id":"themes/next/layout/_partials/search/localsearch.njk","hash":"661f7acae43f0be694266323320f977d84119abe","modified":1686250121895},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.njk","hash":"6215309aee028dcb734452beec448c5afb6c63fc","modified":1686250121897},{"_id":"themes/next/layout/_third-party/analytics/cloudflare.njk","hash":"a5b8297c2c383124dd6a56e256ecc0c0dcf489be","modified":1686250121897},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.njk","hash":"d89066ff53879693f023e540d59c86137172c529","modified":1686250121897},{"_id":"themes/next/layout/_third-party/analytics/growingio.njk","hash":"8afaa772c390bd9d53a5cff9645ac3168334eb98","modified":1686250121897},{"_id":"themes/next/layout/_third-party/analytics/index.njk","hash":"f900306497b133e8b098bd9f4b96b93d1d96c185","modified":1686250121897},{"_id":"themes/next/layout/_third-party/analytics/matomo.njk","hash":"4e89648a8ec8194c5823064cbca39c938a799006","modified":1686250121899},{"_id":"themes/next/layout/_third-party/analytics/microsoft-clarity.njk","hash":"9dc00fcb0a05899f048eace9f9160b78956655d5","modified":1686250121899},{"_id":"themes/next/layout/_third-party/analytics/plausible.njk","hash":"ef9f2bb7110507f1c4336800af9157d5fa9765bd","modified":1686250121899},{"_id":"themes/next/layout/_third-party/analytics/umami.njk","hash":"3343750682fbd8535e50f8129be3003ad26015b4","modified":1686250121899},{"_id":"themes/next/layout/_third-party/chat/chatra.njk","hash":"d7263fca16d0278ccf1f6aa1c6df6902a6344a09","modified":1686250121900},{"_id":"themes/next/layout/_third-party/chat/tidio.njk","hash":"02aab857c27fc103216029be991688b12a73a525","modified":1686250121900},{"_id":"themes/next/layout/_third-party/chat/gitter.njk","hash":"f8cc14b7aa949999a1faaeb7855e2f20b59a386d","modified":1686250121900},{"_id":"themes/next/layout/_third-party/comments/changyan.njk","hash":"d1c950f8fbdf85e7a3eae5463767a89e858e8220","modified":1686250121901},{"_id":"themes/next/layout/_third-party/comments/gitalk.njk","hash":"b63b7e2ede0d3e66e732fa1a06bda9b19e1e85d4","modified":1686250121901},{"_id":"themes/next/layout/_third-party/comments/disqusjs.njk","hash":"0749cb6902baecdfd01f779a2a2513f6d2f6a823","modified":1686250121901},{"_id":"themes/next/layout/_third-party/comments/disqus.njk","hash":"9375b19a89b7fa9474e558d085af5448d4c5c50c","modified":1686250121901},{"_id":"themes/next/layout/_third-party/comments/isso.njk","hash":"64cc3bdaf644fd32c0d0a247f29f5b6904da9af3","modified":1686250121902},{"_id":"themes/next/layout/_third-party/comments/livere.njk","hash":"3b13b09fba84ec6000886890a6710736a2b8fafe","modified":1686250121902},{"_id":"themes/next/layout/_third-party/comments/utterances.njk","hash":"5a94032bc3512a10ad4328fc19ec07b819a1d687","modified":1686250121902},{"_id":"themes/next/layout/_third-party/math/index.njk","hash":"abf37fc55aa86702118e8fdf5bf2d389dd589aa0","modified":1686250121903},{"_id":"themes/next/layout/_third-party/math/mathjax.njk","hash":"3677017fd4572b158311f5f5d870590ab25184e0","modified":1686250121904},{"_id":"themes/next/layout/_third-party/search/algolia-search.njk","hash":"24ed76e0c72a25ac152820c750a05826a706b6f4","modified":1686250121904},{"_id":"themes/next/layout/_third-party/math/katex.njk","hash":"1ebf658690468ea197bdd0416eb7cfa4bd0b083a","modified":1686250121904},{"_id":"themes/next/layout/_third-party/statistics/busuanzi-counter.njk","hash":"a4bc501da0f22f7e420f0ca47e83988ce90b1368","modified":1686250121905},{"_id":"themes/next/layout/_third-party/search/localsearch.njk","hash":"e45ea3542cdc9ed7ec8447b5e6f35df4c5e82758","modified":1686250121904},{"_id":"themes/next/layout/_third-party/statistics/firestore.njk","hash":"d32ebe94560fa95824478ebbff531bffc47b194d","modified":1686250121905},{"_id":"themes/next/layout/_third-party/statistics/index.njk","hash":"568ddf7955d11d93fb5e842b403a7ac8b1b7fdb1","modified":1686250121905},{"_id":"themes/next/layout/_third-party/statistics/lean-analytics.njk","hash":"2446e748cdc102c78492216319ac02148db7daf6","modified":1686250121906},{"_id":"themes/next/layout/_third-party/tags/mermaid.njk","hash":"099e031f52fb8e47b3af5b2684737efc9e643ee7","modified":1686250121906},{"_id":"themes/next/layout/_third-party/tags/pdf.njk","hash":"2c81984cc4f5123103460442f6e046f5b6c97127","modified":1686250121906},{"_id":"themes/next/scripts/events/lib/config.js","hash":"9ec51eb61f7fee612ffc5252f489003a0fa301fc","modified":1686250121911},{"_id":"themes/next/scripts/events/lib/highlight.js","hash":"6aec7b2c38c50989a23bfaa0d560e75c7f553e12","modified":1686250121911},{"_id":"themes/next/scripts/events/lib/injects.js","hash":"d987709267a1bc6e5014411e9983d7c49c102c16","modified":1686250121912},{"_id":"themes/next/layout/_third-party/tags/wavedrom.njk","hash":"02202bf563fb5eedde2ccad4d6c5b9109d30a703","modified":1686250121906},{"_id":"themes/next/scripts/events/lib/navigation.js","hash":"dd3562686d95a50375e6fd32e717ccb0d99c1e3d","modified":1686250121912},{"_id":"themes/next/scripts/events/lib/utils.js","hash":"6853e5433e3eaa19ea43fa20b08d956ba4cec4ac","modified":1686250121912},{"_id":"themes/next/scripts/events/lib/vendors.js","hash":"464db1e7182e5b9cdbd32e8b5368d5e683b1d9c7","modified":1686250121912},{"_id":"themes/next/scripts/filters/comment/changyan.js","hash":"5798cfc8f63665031dd3e01debed051628cec319","modified":1686250121913},{"_id":"themes/next/scripts/filters/comment/common.js","hash":"19a402a225c31edffc50f202a14e0d582d3db23e","modified":1686250121913},{"_id":"themes/next/scripts/filters/comment/default-config.js","hash":"93ee5f9109dad885dc38c49bcee630c10f9dce6e","modified":1686250121914},{"_id":"themes/next/scripts/filters/comment/disqus.js","hash":"7f71d6b271ba65ff333d5682e7575711d368c0d2","modified":1686250121914},{"_id":"themes/next/scripts/filters/comment/disqusjs.js","hash":"a600a98e7436edeb31e291abca359885567df3c9","modified":1686250121914},{"_id":"themes/next/scripts/filters/comment/gitalk.js","hash":"7bb7dafdd7f6bca8464b54e17e552ce7f1714195","modified":1686250121915},{"_id":"themes/next/scripts/filters/comment/isso.js","hash":"ff8b5b5145220a17d0ecd9508ba9bd2d3b2da47d","modified":1686250121915},{"_id":"themes/next/scripts/filters/comment/livere.js","hash":"5a07d8bb52bc1d51a624ca8db54be144566c306b","modified":1686250121915},{"_id":"themes/next/scripts/filters/comment/utterances.js","hash":"d3bded697bc32dace689d2a6dfb6eb7514169d15","modified":1686250121915},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"e3be898f5ebcf435a26542653a9297ff2c71aeb0","modified":1686250121986},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"96e0a7c2a65ce68215e17e369085b2ea2f1334f2","modified":1686250121985},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"a1418c9dc8c0f1a0ad4ded0f4627c45bf0db1a10","modified":1686250121986},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"48f4f277946a168d0db1ea02804e85c22ca2c7db","modified":1686250121986},{"_id":"themes/next/source/css/_variables/base.styl","hash":"c4fc4e862d09221265ab1466085f057be2ad2e4d","modified":1686250121987},{"_id":"themes/next/source/js/schemes/muse.js","hash":"ba7ba2c129d1f240c6a22cec3e53f3f22af64b6b","modified":1686250121994},{"_id":"themes/next/source/js/third-party/addtoany.js","hash":"5276c8f78ee562a8965216dc67d762e59cb4a9f2","modified":1686250121994},{"_id":"themes/next/source/js/third-party/fancybox.js","hash":"c098d14e65dd170537134358d4b8359ad0539c2c","modified":1686250122052},{"_id":"themes/next/source/js/third-party/pace.js","hash":"0ef04218b93561ba4d0ff420d556c3d90a756d32","modified":1686250122054},{"_id":"themes/next/source/css/_common/components/index.styl","hash":"2298e521253b3bf376a2412271bc2a7d305051f3","modified":1686250121947},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"7664491542046df9a3887cf40a06e00c0b4086a9","modified":1686250121946},{"_id":"themes/next/source/js/third-party/quicklink.js","hash":"eed02e6fced8e5a653077205d4d4d7834ca71472","modified":1686250122054},{"_id":"themes/next/source/css/_common/outline/mobile.styl","hash":"580aa86ed2ec05a7382338a6eea02e9c740b02a5","modified":1686250121956},{"_id":"themes/next/source/css/_common/outline/index.styl","hash":"8e34df131830d4fa3725e4590a672ba1cf1903e5","modified":1686250121956},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"d0a7c99095f490b0d2ed6b1be43d435960798cec","modified":1686250121960},{"_id":"themes/next/source/css/_common/components/reading-progress.styl","hash":"90a86045a33c1bae49fc2f6fa1e1b53170c7f77b","modified":1686250121952},{"_id":"themes/next/source/css/_common/scaffolding/buttons.styl","hash":"a042571d85ff7265f799004239a45f36b716b8a6","modified":1686250121960},{"_id":"themes/next/source/css/_common/scaffolding/comments.styl","hash":"e4fecc889ba3317a64e9abba5842c79dff9b7827","modified":1686250121960},{"_id":"themes/next/source/css/_common/scaffolding/index.styl","hash":"523fb7b653b87ae37fc91fc8813e4ffad87b0d7e","modified":1686250121962},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"b56367ea676ea8e8783ea89cd4ab150c7da7a060","modified":1686250121962},{"_id":"themes/next/source/css/_common/scaffolding/pagination.styl","hash":"f4228c759db4a650c8d38745c2edd1dc83c45687","modified":1686250121962},{"_id":"themes/next/source/css/_common/scaffolding/toggles.styl","hash":"782ee1fc5e669d3ddbfeb82b73ad7fe561f1a4fb","modified":1686250121966},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"e840b23d33023e6d45e018f6e84b683dd56efd8d","modified":1686250121963},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"9dfe853c901bdc52fc950bacdf15484dbb9bf140","modified":1686250121968},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"fb550935d374e0bdf1097fce187337dc05cad3e1","modified":1686250121970},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expand.styl","hash":"485d23ccb42c0d0c8ead7ea8930dd3e06d79a285","modified":1686250121970},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"dafc6d23c80d6fe3e55a7711e94210d2479b629a","modified":1686250121969},{"_id":"themes/next/source/css/_schemes/Mist/_layout.styl","hash":"fa4fd8f76464e214fb7318f325b13c2b62f4b478","modified":1686250121970},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"ab16a3dcdc0393b9b582ef59dcc13db9320e917c","modified":1686250121970},{"_id":"themes/next/source/css/_schemes/Muse/_header.styl","hash":"3fbfab591f280e2e7f3b0265901c93bc4bd137ed","modified":1686250121971},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"6569a6640f79d247a8235b3914772c0e2f99ead2","modified":1686250121971},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"b7f48be3c43bfa393d62142544a5487a67871713","modified":1686250121974},{"_id":"themes/next/source/css/_schemes/Muse/_sub-menu.styl","hash":"c48ccd8d6651fe1a01faff8f01179456d39ba9b1","modified":1686250121981},{"_id":"themes/next/source/css/_schemes/Pisces/_header.styl","hash":"ac2dc0ce9c775a83ef7132ae957b54539366ac9c","modified":1686250121981},{"_id":"themes/next/source/css/_schemes/Muse/_sidebar.styl","hash":"547c0b5cd5e7ea10d21863d13a6b16579a49396c","modified":1686250121976},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"6ad168288b213cec357e9b5a97674ff2ef3a910c","modified":1686250121981},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"26a0cba1eee5de45a45a5e14e17707f905390512","modified":1686250121982},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"72dc825c50357402c342d62ab60fc0c478ab6bc1","modified":1686250121982},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"91dbf3ca5c3a613d4e30618c120da535bf2d0336","modified":1686250121982},{"_id":"themes/next/source/css/_schemes/Pisces/_sub-menu.styl","hash":"778ed2ad5643b93970c95626b325defeb586733f","modified":1686250121982},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"8000075b227749a7495eaf417cac6ccfbe441580","modified":1686250121983},{"_id":"themes/next/source/js/third-party/analytics/baidu-analytics.js","hash":"f629acc46ff40c071ffd31b77d5c7616f0fdd778","modified":1686250121996},{"_id":"themes/next/source/js/third-party/analytics/google-analytics.js","hash":"59684383385059dc4f8a1ff85dbbeb703bcdbcb5","modified":1686250121998},{"_id":"themes/next/source/js/third-party/analytics/growingio.js","hash":"78dd3cf04082b7dbe6246e404b2aa8e726922402","modified":1686250121998},{"_id":"themes/next/source/js/third-party/analytics/matomo.js","hash":"c6a25b26a1443caa70b47fd3dfa282271574deb5","modified":1686250121998},{"_id":"themes/next/source/js/third-party/chat/chatra.js","hash":"c32180522788c10e51df1803aa6842ef0432ddc9","modified":1686250121998},{"_id":"themes/next/source/js/third-party/chat/gitter.js","hash":"cc38c94125f90dadde11b5ebac7d8bf99a1a08a2","modified":1686250121999},{"_id":"themes/next/source/js/third-party/chat/tidio.js","hash":"b0079f6a4601e06ca6fe46e83a2f5af553e9bc3c","modified":1686250121999},{"_id":"themes/next/source/js/third-party/comments/changyan.js","hash":"260d1a77d6a3bb33a579d3e4cca1997003e799b5","modified":1686250122000},{"_id":"themes/next/source/js/third-party/comments/disqus.js","hash":"da361917d65e5dca8362f8cdeb6c8cc0e8316cec","modified":1686250122048},{"_id":"themes/next/source/js/third-party/comments/disqusjs.js","hash":"1e826dea3f684c0515f362dc1352447a1f0eae71","modified":1686250122049},{"_id":"themes/next/source/js/third-party/comments/gitalk.js","hash":"0ec038cf83e8ec067534f16a54041e47a3c1e59a","modified":1686250122049},{"_id":"themes/next/source/js/third-party/comments/isso.js","hash":"753a873b6f566aff5ba77ca23f91b78eb880ca64","modified":1686250122049},{"_id":"themes/next/source/js/third-party/comments/livere.js","hash":"2247d88c934c765c43013337860774aaa99f0b31","modified":1686250122052},{"_id":"themes/next/source/js/third-party/comments/utterances.js","hash":"f67f90eb03e284c82da2b8cf2f1e31801813c16d","modified":1686250122052},{"_id":"themes/next/source/js/third-party/math/katex.js","hash":"83c54ee536e487a1031783443fe0cb63b1b4767e","modified":1686250122053},{"_id":"themes/next/source/js/third-party/math/mathjax.js","hash":"5c749b9c1c3bb738122d0516211ecff6496d4907","modified":1686250122053},{"_id":"themes/next/source/js/third-party/search/algolia-search.js","hash":"fdb7b7cef1a147d897e7f7cd8903b58368ec2062","modified":1686250122055},{"_id":"themes/next/source/js/third-party/search/local-search.js","hash":"4536cb6d0a9bbaaa86fab3fa0101f6a3a3ec5a76","modified":1686250122056},{"_id":"themes/next/source/js/third-party/statistics/firestore.js","hash":"6e0682bb42170d61b13b786295f45f9c785f8b73","modified":1686250122056},{"_id":"themes/next/source/js/third-party/statistics/lean-analytics.js","hash":"835cbf54c49ef1327f47df70ff2636ad36b6f57d","modified":1686250122056},{"_id":"themes/next/source/js/third-party/tags/mermaid.js","hash":"f27d817b0c2138dd3215b1f46af0753f60a008f3","modified":1686250122057},{"_id":"themes/next/source/js/third-party/tags/pdf.js","hash":"af78c22f0e61c8c8aa8794e585e0d632c6d4fcb8","modified":1686250122057},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"b6e2eb1550a7845cb2adf86081a4ab6c7bde1e68","modified":1686250121948},{"_id":"themes/next/source/js/third-party/tags/wavedrom.js","hash":"40dcd10df6edf124088c329346e0cc0bdac74ef1","modified":1686250122057},{"_id":"themes/next/source/css/_common/components/pages/breadcrumb.styl","hash":"8afdc311c6b8db121758371f95cf1c5e77354f42","modified":1686250121947},{"_id":"themes/next/source/css/_common/components/pages/index.styl","hash":"7504dbc5c70262b048143b2c37d2b5aa2809afa2","modified":1686250121948},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"6b816c2511242ee503fb5f34cd3e4dcdafc06b85","modified":1686250121948},{"_id":"themes/next/source/css/_common/components/pages/tag-cloud.styl","hash":"1a81d1a71fcf0699629ce6e72dfd0a15f3a2dd0a","modified":1686250121948},{"_id":"themes/next/source/css/_common/components/post/index.styl","hash":"098d4bd034e986fcf7e443eac4fc2193935461b7","modified":1686250121949},{"_id":"themes/next/source/css/_common/components/post/post-body.styl","hash":"d757768a58743601d0d84158ba955eb15d4c3c01","modified":1686250121949},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"ec37a36e94ba791663607a5022f763915778578f","modified":1686250121949},{"_id":"themes/next/source/css/_common/components/post/post-followme.styl","hash":"1ecfd64507954810b07a9d21fb5305b5378feda0","modified":1686250121950},{"_id":"themes/next/source/css/_common/components/post/post-footer.styl","hash":"11497388f124bfbb4001495a67d3629a9f618405","modified":1686250121950},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"aa366d37389760c8595529b850f461569577a1c5","modified":1686250121951},{"_id":"themes/next/source/css/_common/components/post/post-header.styl","hash":"010c901e4ef49a606f8a350efbf09044e76d2ff3","modified":1686250121951},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"9ac6f477177264c26a46e8333b8456720a0444dc","modified":1686250121951},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"ebfba158a0a4af3d1dabcacbc58986664de52140","modified":1686250121952},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"04cf4a69537fc14d3b8904f965d283356853847f","modified":1686250121952},{"_id":"themes/next/source/css/_common/components/third-party/disqusjs.styl","hash":"877a537d5b95beb048142e4fdee6f17e6ef9c7bb","modified":1686250121952},{"_id":"themes/next/source/css/_common/components/third-party/gitalk.styl","hash":"8f094c4ac17e2ab45569b12d157747f9c7333c12","modified":1686250121953},{"_id":"themes/next/source/css/_common/components/third-party/gitter.styl","hash":"35104dc6883a61c31e0e368dac8ac2f697be62fe","modified":1686250121953},{"_id":"themes/next/source/css/_common/components/third-party/index.styl","hash":"77550e0d3e029b7458e35d8c5ae1fbd612c9673b","modified":1686250121953},{"_id":"themes/next/source/css/_common/components/third-party/math.styl","hash":"9d995eb4871a6c273d9d51558676a1fdabf69e72","modified":1686250121953},{"_id":"themes/next/source/css/_common/components/third-party/search.styl","hash":"e72799ce3f9b79753e365b2f8c8ef6c310668d4a","modified":1686250121954},{"_id":"themes/next/source/css/_common/components/third-party/utterances.styl","hash":"56d90ae0559caa55b75f3c300ff2711f9ed65fc4","modified":1686250121954},{"_id":"themes/next/source/css/_common/outline/footer/index.styl","hash":"4e967702cf4c637132346bc74ec8854426f1a68c","modified":1686250121954},{"_id":"themes/next/source/css/_common/outline/header/bookmark.styl","hash":"e74f4bb47a101b014ee2a1783c87f3b87323f9a0","modified":1686250121955},{"_id":"themes/next/source/css/_common/outline/header/github-banner.styl","hash":"38c64c2d04e46848382bfa246a0e9c508294767b","modified":1686250121955},{"_id":"themes/next/source/css/_common/outline/header/index.styl","hash":"6e0d0796ef7fbbb62ffdfb448753a850de82c74f","modified":1686250121955},{"_id":"themes/next/source/css/_common/outline/header/menu.styl","hash":"b750af2fb833c10c4313b5a4258237161a7833d7","modified":1686250121956},{"_id":"themes/next/source/css/_common/outline/header/site-meta.styl","hash":"a851e9d5aefcd027c95eeb323860b6da70f202d1","modified":1686250121956},{"_id":"themes/next/source/css/_common/outline/header/site-nav.styl","hash":"bf3ad8b4268f763a1e26377681644887694bc009","modified":1686250121956},{"_id":"themes/next/source/css/_common/outline/sidebar/related-posts.styl","hash":"b05908f04ef95f2d91e6eba89b12411c378d050f","modified":1686250121957},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-author-links.styl","hash":"52fc98b1435129eb3edb9293ced9e507741f1350","modified":1686250121957},{"_id":"themes/next/source/css/_common/outline/sidebar/index.styl","hash":"da5e88f8debd5ac8d7af5c6ba6240df66104955f","modified":1686250121957},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-author.styl","hash":"5b38ac4a0f1ade0e681aff0e3366c481d9cf3dcd","modified":1686250121958},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-blogroll.styl","hash":"c6a27beb3f741211a14576026f3b4cfc44cc6407","modified":1686250121958},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-button.styl","hash":"b926e368f702f8686aaa2eb98d3d2e533418958c","modified":1686250121958},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-nav.styl","hash":"24752d145c6fb8f5344dca9c7b9640839c02e009","modified":1686250121959},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-toc.styl","hash":"c2e354a565c8c1b32bd0ceacc972b17982758b67","modified":1686250121959},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-toggle.styl","hash":"9a7c71560fbdc936ad4e736fe15063ea3e8a644b","modified":1686250121959},{"_id":"themes/next/source/css/_common/outline/sidebar/site-state.styl","hash":"26dd0adfcb1db6df29c6090c8d7e9b5a43583fb0","modified":1686250121959},{"_id":"themes/next/source/css/_common/scaffolding/highlight/copy-code.styl","hash":"670fc109b56a010b166b86b616823a1aae97a738","modified":1686250121961},{"_id":"themes/next/source/css/_common/scaffolding/highlight/index.styl","hash":"9056be572ec1cfa429abb22be4b45a662d5b0fb1","modified":1686250121961},{"_id":"themes/next/source/css/_common/scaffolding/tags/group-pictures.styl","hash":"393ff96234e4196b569d4b11496774eb78e147de","modified":1686250121963},{"_id":"themes/next/source/css/_common/scaffolding/tags/blockquote-center.styl","hash":"d6418fd2bbfba7b73ddf11ec62db9637fdf5d8af","modified":1686250121963},{"_id":"themes/next/source/css/_common/scaffolding/tags/index.styl","hash":"22cd37bd5df9972d5074710896aba4424ad5161c","modified":1686250121964},{"_id":"themes/next/source/css/_common/scaffolding/tags/label.styl","hash":"debee14539272fbe3835a7d3853af2230baa3501","modified":1686250121964},{"_id":"themes/next/source/css/_common/scaffolding/tags/link-grid.styl","hash":"7f8a7345e6537a62cd9e9a94c8f7065b541d9b04","modified":1686250121964},{"_id":"themes/next/source/css/_common/scaffolding/tags/mermaid.styl","hash":"48d35dba575a7c9e8845b16652e76b7d4a4646de","modified":1686250121965},{"_id":"themes/next/source/css/_common/scaffolding/tags/note.styl","hash":"98d4c20aff0f0fcfe1824017fb06ab21ef0d218e","modified":1686250121965},{"_id":"themes/next/source/css/_common/scaffolding/tags/pdf.styl","hash":"b6654a1d7cf82577d8263faffee8af3ad4a5c0e8","modified":1686250121965},{"_id":"themes/next/source/css/_common/scaffolding/tags/wavedrom.styl","hash":"af113411ad9cca7674177be36af8dd399680834d","modified":1686250121966},{"_id":"themes/next/source/css/_common/scaffolding/tags/tabs.styl","hash":"7a39bcce7274284e87388743db62afc847fe6897","modified":1686250121966},{"_id":"themes/next/source/images/avatar.jpg","hash":"0323026631cd3500586a5e7d0dfe248b7f54767a","modified":1686251408085},{"_id":"themes/next/package-lock.json","hash":"5216a6efbf40798a0997aef2985d1e4024998dee","modified":1686256227335},{"_id":"public/search.xml","hash":"a5d5560acfd4acd7c06b49cdca30782d5a886773","modified":1686271389207},{"_id":"public/categories/index.html","hash":"24e820c15652afac5d7d4772aca460fcb17354f4","modified":1686271389207},{"_id":"public/tags/index.html","hash":"76a65954e59b1dd5ecdfe0fa300391003f812858","modified":1686271389207},{"_id":"public/about/index.html","hash":"b0a6b24741946c81619d97e4c7f15ec1f6b3a053","modified":1686271389207},{"_id":"public/2023/06/a05e7f1e2c26.html","hash":"7880dad981e34a94aba0ecec302152e2a514c3c3","modified":1686270907610},{"_id":"public/2023/06/c2324b653e8f.html","hash":"2a1774d17ba75f7a47915440e3e013a5e412da10","modified":1686271389207},{"_id":"public/2023/06/923835b63def.html","hash":"1b16168877482968a35d542bd282b070134678f5","modified":1686271389207},{"_id":"public/2023/06/0b8c3aafa761.html","hash":"9f9d6a0ccea2436676f8998ab4b5531b67b90d74","modified":1686271389207},{"_id":"public/2023/06/4c4cf47da89d.html","hash":"77a554040dbcd2b67b59767d045a9ce706a3031a","modified":1686271389207},{"_id":"public/archives/index.html","hash":"98247485061e0ffd1d735e381decb340324106bd","modified":1686271389207},{"_id":"public/archives/page/2/index.html","hash":"f39cad05c26ad04f879370bbb40119faa02b5fc0","modified":1686271389207},{"_id":"public/archives/page/3/index.html","hash":"fc1fc6cbaaa9e0e14a780fe026dd1766a301adc3","modified":1686271389207},{"_id":"public/archives/page/4/index.html","hash":"ed58ad621d91f37591f0ebeede0031cffe5e6990","modified":1686271389207},{"_id":"public/archives/page/5/index.html","hash":"d0f39e5c34f8a23bb12729800e51489a71fcd404","modified":1686271389207},{"_id":"public/archives/page/6/index.html","hash":"c68bf6ef20c6ef6ae87a402787e81f8dbb037516","modified":1686271389207},{"_id":"public/archives/page/7/index.html","hash":"a8ad570b865d451eb665b029883b3a2446558dc6","modified":1686271389207},{"_id":"public/archives/page/8/index.html","hash":"0c1863a5be2ad780526b242cdeb6514407b6192f","modified":1686271389207},{"_id":"public/archives/page/9/index.html","hash":"f1a22373de6f5b01f49a3daed94a27d28244630c","modified":1686271389207},{"_id":"public/archives/page/10/index.html","hash":"f604324960c53a348b6ccfb739067999c644eac5","modified":1686271389207},{"_id":"public/archives/2018/index.html","hash":"4236cbea5c8f6b25641fcc5de6d56de2f781296a","modified":1686271389207},{"_id":"public/archives/2018/02/index.html","hash":"3502a0f867dee96f8a7300069913eb84644ff213","modified":1686271389207},{"_id":"public/archives/2023/index.html","hash":"2aea674a0724ddccd04065fdc2ade8881969090f","modified":1686271389207},{"_id":"public/archives/2023/page/2/index.html","hash":"220b09d131725e49779d1051ff0470a823cb42c8","modified":1686271389207},{"_id":"public/archives/2023/page/3/index.html","hash":"c4dc67e0b37235ae21780e87737a3322c0a34402","modified":1686271389207},{"_id":"public/archives/2023/page/4/index.html","hash":"760d82bdcbd68655b4261502b9899a04e033c156","modified":1686271389207},{"_id":"public/archives/2023/page/5/index.html","hash":"dc39930f5ba8af91218148a61b68e22cee7d3d71","modified":1686271389207},{"_id":"public/archives/2023/page/6/index.html","hash":"6c51e85a0c9ad21ee03d55a364460536d2ec2fa6","modified":1686271389207},{"_id":"public/archives/2023/page/7/index.html","hash":"5de1f3d322e8f07cadd5171261e558132eae0d52","modified":1686271389207},{"_id":"public/archives/2023/page/8/index.html","hash":"3f75b935227d43a60e7807faf806652d8e633abe","modified":1686271389207},{"_id":"public/archives/2023/page/9/index.html","hash":"64472a8789478773e0ccd144e55531b3ebf55c5b","modified":1686271389207},{"_id":"public/archives/2023/page/10/index.html","hash":"426f111a9fa26e9b3e83935754b79d6325c7762d","modified":1686270907610},{"_id":"public/archives/2023/06/index.html","hash":"84c06d1ee8e660e45945991a7a5d8c00fededd6f","modified":1686271389207},{"_id":"public/archives/2023/06/page/2/index.html","hash":"8df152ded02ed00dcd7d6c8ab928c521e67fa64e","modified":1686271389207},{"_id":"public/archives/2023/06/page/3/index.html","hash":"427c37c5cac5077b1281690c6a4b2b3adda4a5c4","modified":1686271389207},{"_id":"public/archives/2023/06/page/4/index.html","hash":"aed0d7ff617d692a7c56e74f0bbfe6955e262b05","modified":1686271389207},{"_id":"public/archives/2023/06/page/5/index.html","hash":"3ca24e00918d0488d35e6c227460d92099df524f","modified":1686271389207},{"_id":"public/archives/2023/06/page/6/index.html","hash":"7a04c834751702239d3a26c784cb86dbeaf7f21e","modified":1686271389207},{"_id":"public/archives/2023/06/page/7/index.html","hash":"777a64e3aca1baa45e5cbe9e500a818d08ef741f","modified":1686271389207},{"_id":"public/archives/2023/06/page/8/index.html","hash":"62da597a28bf790272e95342c2ebdae1e0a62c05","modified":1686271389207},{"_id":"public/archives/2023/06/page/9/index.html","hash":"04409e2ff946f80ac6878917d75acd8fd1a3c2f9","modified":1686271389207},{"_id":"public/archives/2023/06/page/10/index.html","hash":"9ecbc0fb0de6b6f989abc01dd94e91fcf863cc24","modified":1686270907610},{"_id":"public/categories/DNSMASQ/index.html","hash":"6962abd125b8c397c5248ec777d84dff2ef26d7a","modified":1686271389207},{"_id":"public/categories/Android/index.html","hash":"e24d918077be131926579ffc845f87aaf7ab652a","modified":1686271389207},{"_id":"public/categories/FLUTTER/index.html","hash":"fbe55bab30b4173c7af2aeb26616cf849c3c0c56","modified":1686271389207},{"_id":"public/categories/GOLANG/index.html","hash":"45eee3bb45de690ecc418cb5ef2135e3d7eb1de4","modified":1686271389207},{"_id":"public/categories/GOLANG/page/2/index.html","hash":"322a87e2d24260c1dabb71145cedf4daf2952a61","modified":1686271389207},{"_id":"public/categories/GOLANG/page/3/index.html","hash":"9a55b70514c3f97858ae7bf98ad022307673c852","modified":1686271389207},{"_id":"public/categories/MYSQL/index.html","hash":"4c911ea03109775983ee7119359951ea5056aeb6","modified":1686271389207},{"_id":"public/categories/PHP/index.html","hash":"d81d04f6aaefb9565d1dca3753ca997584060047","modified":1686271389207},{"_id":"public/categories/PUSH/index.html","hash":"08f32d9b5d5b5f600048737193252ce1fa215c50","modified":1686271389207},{"_id":"public/categories/SSH/index.html","hash":"54a7ace6b2acea8ffd6d0c6091ba67931ae4f37c","modified":1686271389207},{"_id":"public/2023/06/1c369132c8ac.html","hash":"ff181b974b1b93c59ce64fe8efda0b9a68252af9","modified":1686271389207},{"_id":"public/2023/06/8a9f733e5551.html","hash":"a13ecebaca7ae4b8062c66ecc166182054848698","modified":1686271389207},{"_id":"public/2023/06/79c945657733.html","hash":"8d601f8a636e6b63c4f7518c8c192f43d7de155e","modified":1686271389207},{"_id":"public/2023/06/906fa42b8a26.html","hash":"7b05a4a2db942108d49d58d5972405f98c01d759","modified":1686271389207},{"_id":"public/2023/06/e76cc4012a1b.html","hash":"f9c1e402dd225def3deaf0c924c46a8dd9ebac37","modified":1686271389207},{"_id":"public/2023/06/f2a7f8371fcd.html","hash":"4d4422e01ad5963746a1d8b564f24b70b6aee606","modified":1686271389207},{"_id":"public/2023/06/0e1e47d24320.html","hash":"c40280c63c74c3790b8b81dc09fc0a75590bfa65","modified":1686271389207},{"_id":"public/2023/06/9aaeed3398b2.html","hash":"725f2d26140bfe70328251f3b708a76899470202","modified":1686271389207},{"_id":"public/2023/06/c6b21dafe6cb.html","hash":"67f1dbfe1801f0218ce117c169fa207dd3c63197","modified":1686271389207},{"_id":"public/2023/06/3a072f79a61e.html","hash":"be15fe2e26352115e43e7a37dd19bce77fa73e4c","modified":1686271389207},{"_id":"public/2023/06/3247a9f9d1c1.html","hash":"276b3d4073dbe7f97b1e3851f50c2b3fa2d0e378","modified":1686271389207},{"_id":"public/2023/06/95fb3d4261e3.html","hash":"587e4657922cc240eb4aa92c8b52f83d04c4e7ca","modified":1686271389207},{"_id":"public/2023/06/e045eee6a701.html","hash":"49bf86e4298cc3f555a42252d7ff298de25c1602","modified":1686271389207},{"_id":"public/2023/06/9f3e7eb33263.html","hash":"b1248aee2ed39edc6cd063afb3a17e85af445b73","modified":1686271389207},{"_id":"public/2023/06/b1ab4f5e09e5.html","hash":"e08aaee41a98efb21697249f261c2d97c370d29c","modified":1686271389207},{"_id":"public/2023/06/b0ed4abd3df7.html","hash":"4b2722131606ffdb77e7ed04eab8f6c0cd2ace87","modified":1686271389207},{"_id":"public/2023/06/21d62d62dd8b.html","hash":"5777620735b3c467b4063d3dd5fce11d4424e7cc","modified":1686271389207},{"_id":"public/2023/06/099fac4e65c1.html","hash":"332b9c3ff18a40867aaaf88813f1841888ed7a2f","modified":1686271389207},{"_id":"public/2023/06/3d4d4474576c.html","hash":"eb8e038ecd2f79116c568f415a6082b6426a9722","modified":1686271389207},{"_id":"public/2023/06/651b2ac75d18.html","hash":"be7874a0065575f028cac73ecd19dd9f03e4efef","modified":1686271389207},{"_id":"public/2023/06/5ebec5d905ff.html","hash":"8a086bca229df00e3105c7342d2c597e473db6e7","modified":1686271389207},{"_id":"public/2023/06/846d2c7d9fff.html","hash":"94eddb986494a6e306f0abd22f60c7dfb1c40e04","modified":1686271389207},{"_id":"public/2023/06/09f43ce6bcab.html","hash":"59a065cc40df63e2bef5c9392bf4baff5b1acf8b","modified":1686271389207},{"_id":"public/2023/06/de01e7de7918.html","hash":"85ce7fecb4eadf652b78a1f15ae55e3c663017c5","modified":1686271389207},{"_id":"public/2023/06/e1174f4a2d6e.html","hash":"cf4573a1f91b180582305f6f1d3aae86f31145cd","modified":1686271389207},{"_id":"public/2023/06/f27a4ec6dc25.html","hash":"029c7915bdd3011f7fbb372ef593f251b5579285","modified":1686271389207},{"_id":"public/2023/06/ed420f1ef390.html","hash":"35b710ab50926300a9d5ec7f2c30982b69bed525","modified":1686271389207},{"_id":"public/2023/06/9ed2f2758c62.html","hash":"9d99228980ba56eae4ae72c4258b91bb617e2757","modified":1686271389207},{"_id":"public/2023/06/fd4be80236ff.html","hash":"0283c7fd6883fef3a67a588d0f67d2cbc782dfb2","modified":1686271389207},{"_id":"public/2023/06/5d3c6307dcd9.html","hash":"c0784e60fdcb1f349733ae329df27bbb1f4c1452","modified":1686271389207},{"_id":"public/2023/06/3abbb741dab4.html","hash":"d864f423483d8a55bb47356557d7b41b20249d94","modified":1686271389207},{"_id":"public/2023/06/b011536dab5d.html","hash":"e5fdd96c01faabda6766880558c7c4996792fcf1","modified":1686271389207},{"_id":"public/2023/06/f53a45840398.html","hash":"c8b431ca79d0cf4b86b83d15d7a71ce86e523877","modified":1686271389207},{"_id":"public/2023/06/dbc075b99008.html","hash":"d9d62d89f648a883a1832f67091294409824634f","modified":1686271389207},{"_id":"public/2023/06/505220760d2c.html","hash":"e49073bb559299c35cceefdbb6195cca83d60e91","modified":1686271389207},{"_id":"public/2023/06/d14aebe8f363.html","hash":"4e39e4069f4e94e64a7b1251d9ce9eb90a3deafe","modified":1686271389207},{"_id":"public/2023/06/dace703c1912.html","hash":"40b958dadfb4615922c5fb8a9bddf94414d1a639","modified":1686271389207},{"_id":"public/2023/06/b2cea806b64c.html","hash":"51f969ae1f51da136d91dd23b0064ff1f812f948","modified":1686271389207},{"_id":"public/2023/06/8d48886a6f4e.html","hash":"26c9e292ea186f0e478427d5fe2a3e23244ff1c4","modified":1686271389207},{"_id":"public/2023/06/60edd9302881.html","hash":"e34719dc9faf7016266a67e77ffeeb517484a4c7","modified":1686271389207},{"_id":"public/2023/06/66c5ec627403.html","hash":"c4436c9181edcf49988416c099f7ee63a518ba51","modified":1686271389207},{"_id":"public/2018/02/67b9e89ccc4d.html","hash":"d0ac9f231ad53e5d3af645bc326eca1a8fb89240","modified":1686271389207},{"_id":"public/index.html","hash":"183cfe5bab25b88e820a8f11b43310f9fabe9b5a","modified":1686271389207},{"_id":"public/page/2/index.html","hash":"85384a8605945ab0a26c737d0978c5985254bfb0","modified":1686271389207},{"_id":"public/page/3/index.html","hash":"ad591182589e9056e5981d669c27dcf5e42fbb3e","modified":1686271389207},{"_id":"public/page/4/index.html","hash":"f21231c8166d1fe0d7c329437cddfa63f4c394ee","modified":1686271389207},{"_id":"public/page/5/index.html","hash":"96b947f8471311f11cda7be1a3a6acc1a11f361f","modified":1686271389207},{"_id":"public/categories/REDIS/index.html","hash":"7d6c42118e82dcbf4711fdaadf51e11b19ad1b22","modified":1686271389207},{"_id":"public/categories/吃瓜/index.html","hash":"e4b50b7cc60b7686bdad98d7e6ed6daddade6d51","modified":1686271389207},{"_id":"public/categories/微信公众号/index.html","hash":"e203d06274ab59416302d62996bfa54708a2c389","modified":1686271389207},{"_id":"public/categories/树莓派/index.html","hash":"f6d5aaea4addc73b78b80c247c06c22bb5f36fdd","modified":1686271389207},{"_id":"public/categories/微信公众号/page/2/index.html","hash":"f489f7d9d86138d6d71896f5234ba9a971940752","modified":1686271389207},{"_id":"public/categories/Hexo/index.html","hash":"acff0be32da9fc2129470ab73071622418b6085b","modified":1686270907610},{"_id":"public/categories/Python/index.html","hash":"cf61779d91ad9e9c4e56bdac0277283b1373d34c","modified":1686270907610},{"_id":"public/categories/测试/index.html","hash":"3dcfc064d629f356a21123ca34441bf10c79cb9d","modified":1686271389207},{"_id":"public/categories/认知与成长/index.html","hash":"8b1896a1505028c4d1cbd77fcf1050b1fc730c28","modified":1686271389207},{"_id":"public/categories/模版文件夹/index.html","hash":"28847cb1d6e459eacf2249726af6a9fc1e729444","modified":1686270907610},{"_id":"public/tags/hexo/index.html","hash":"6a32b69ff9a6f034261fb0a6a222b1e8986eb659","modified":1686271389207},{"_id":"public/tags/博客/index.html","hash":"2d42e35a6984d683d311744708b9e78611ac2a36","modified":1686271389207},{"_id":"public/categories/VPN/index.html","hash":"7868363056d43ce9c20c0acd699d55ab558ba637","modified":1686271389207},{"_id":"public/images/avatar.gif","hash":"2dbc3e2f2d624b2ca1afe6edc2ca17307f1950c8","modified":1686270907610},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1686270907610},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1686270907610},{"_id":"public/images/logo-algolia-nebula-blue-full.svg","hash":"b85e274207b1392782476a0430feac98db1e7da0","modified":1686270907610},{"_id":"public/images/logo.svg","hash":"099e11ab995a2c8981427a85476d082609848c77","modified":1686270907610},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1686270907610},{"_id":"public/images/avatar.jpg","hash":"0323026631cd3500586a5e7d0dfe248b7f54767a","modified":1686270907610},{"_id":"public/js/comments.js","hash":"66ae2e26ea36a41b72c638ea8b220296638ae952","modified":1686270907610},{"_id":"public/js/bookmark.js","hash":"0f563ffbf05fad30e854e413ab17ff7164ab5a53","modified":1686270907610},{"_id":"public/js/comments-buttons.js","hash":"1a7344440321713426a0b2ab17e276b5bdf85ade","modified":1686270907610},{"_id":"public/css/noscript.css","hash":"4cd5301e478e0e0d4b176740ec314087ec5cb707","modified":1686270907610},{"_id":"public/js/config.js","hash":"4c4ebbe3b3f3841a26f9d5af6d0ba8bc6da01c54","modified":1686270907610},{"_id":"public/js/next-boot.js","hash":"da0f07f9eaaa83de70128b0feaea3fdadb90457a","modified":1686270907610},{"_id":"public/js/motion.js","hash":"770d63c26f22705311028a36b52e999cc8a2da82","modified":1686270907610},{"_id":"public/js/pjax.js","hash":"b03ba78c6916ad2f390d55bc1bc18fafb64b0ebf","modified":1686270907610},{"_id":"public/js/schemes/muse.js","hash":"ba7ba2c129d1f240c6a22cec3e53f3f22af64b6b","modified":1686270907610},{"_id":"public/js/schedule.js","hash":"a1333258726caf84f368a8f8454639c7dc1626bb","modified":1686270907610},{"_id":"public/js/third-party/addtoany.js","hash":"5276c8f78ee562a8965216dc67d762e59cb4a9f2","modified":1686270907610},{"_id":"public/js/third-party/fancybox.js","hash":"c098d14e65dd170537134358d4b8359ad0539c2c","modified":1686270907610},{"_id":"public/js/third-party/pace.js","hash":"0ef04218b93561ba4d0ff420d556c3d90a756d32","modified":1686270907610},{"_id":"public/js/third-party/analytics/baidu-analytics.js","hash":"f629acc46ff40c071ffd31b77d5c7616f0fdd778","modified":1686270907610},{"_id":"public/js/third-party/quicklink.js","hash":"eed02e6fced8e5a653077205d4d4d7834ca71472","modified":1686270907610},{"_id":"public/js/third-party/analytics/google-analytics.js","hash":"59684383385059dc4f8a1ff85dbbeb703bcdbcb5","modified":1686270907610},{"_id":"public/js/third-party/analytics/growingio.js","hash":"78dd3cf04082b7dbe6246e404b2aa8e726922402","modified":1686270907610},{"_id":"public/js/third-party/chat/chatra.js","hash":"c32180522788c10e51df1803aa6842ef0432ddc9","modified":1686270907610},{"_id":"public/js/third-party/analytics/matomo.js","hash":"c6a25b26a1443caa70b47fd3dfa282271574deb5","modified":1686270907610},{"_id":"public/js/third-party/chat/tidio.js","hash":"b0079f6a4601e06ca6fe46e83a2f5af553e9bc3c","modified":1686270907610},{"_id":"public/js/third-party/comments/changyan.js","hash":"260d1a77d6a3bb33a579d3e4cca1997003e799b5","modified":1686270907610},{"_id":"public/js/third-party/chat/gitter.js","hash":"cc38c94125f90dadde11b5ebac7d8bf99a1a08a2","modified":1686270907610},{"_id":"public/js/third-party/comments/disqusjs.js","hash":"1e826dea3f684c0515f362dc1352447a1f0eae71","modified":1686270907610},{"_id":"public/js/third-party/comments/gitalk.js","hash":"0ec038cf83e8ec067534f16a54041e47a3c1e59a","modified":1686270907610},{"_id":"public/js/third-party/comments/disqus.js","hash":"da361917d65e5dca8362f8cdeb6c8cc0e8316cec","modified":1686270907610},{"_id":"public/js/third-party/comments/isso.js","hash":"753a873b6f566aff5ba77ca23f91b78eb880ca64","modified":1686270907610},{"_id":"public/js/third-party/comments/livere.js","hash":"2247d88c934c765c43013337860774aaa99f0b31","modified":1686270907610},{"_id":"public/js/third-party/math/katex.js","hash":"83c54ee536e487a1031783443fe0cb63b1b4767e","modified":1686270907610},{"_id":"public/js/third-party/comments/utterances.js","hash":"f67f90eb03e284c82da2b8cf2f1e31801813c16d","modified":1686270907610},{"_id":"public/js/third-party/search/algolia-search.js","hash":"fdb7b7cef1a147d897e7f7cd8903b58368ec2062","modified":1686270907610},{"_id":"public/js/third-party/search/local-search.js","hash":"4536cb6d0a9bbaaa86fab3fa0101f6a3a3ec5a76","modified":1686270907610},{"_id":"public/js/third-party/tags/pdf.js","hash":"af78c22f0e61c8c8aa8794e585e0d632c6d4fcb8","modified":1686270907610},{"_id":"public/js/third-party/statistics/firestore.js","hash":"6e0682bb42170d61b13b786295f45f9c785f8b73","modified":1686270907610},{"_id":"public/js/third-party/tags/mermaid.js","hash":"f27d817b0c2138dd3215b1f46af0753f60a008f3","modified":1686270907610},{"_id":"public/js/third-party/tags/wavedrom.js","hash":"40dcd10df6edf124088c329346e0cc0bdac74ef1","modified":1686270907610},{"_id":"public/js/third-party/statistics/lean-analytics.js","hash":"835cbf54c49ef1327f47df70ff2636ad36b6f57d","modified":1686270907610},{"_id":"public/js/third-party/math/mathjax.js","hash":"5c749b9c1c3bb738122d0516211ecff6496d4907","modified":1686270907610},{"_id":"public/css/main.css","hash":"daa4ce4d70089e6071ff47b545a7928da09e1f36","modified":1686270907610},{"_id":"public/js/utils.js","hash":"5e1cf39de050964e97fb3ba0825aeec7f4bc36dd","modified":1686270907610},{"_id":"source/.obsidian/appearance.json","hash":"9439122150a0431e432676115220bc925af96094","modified":1686271254650},{"_id":"source/.obsidian/core-plugins.json","hash":"eb138d03157a06efdb791f441be97c256aca472c","modified":1686271254179},{"_id":"source/.obsidian/workspace.json","hash":"add16358ee74463e6763e73f5b48a8550da2622d","modified":1686271301125},{"_id":"source/.obsidian/app.json","hash":"bf21a9e8fbc5a3846fb05b4fa0859e0917b2202f","modified":1686271254649},{"_id":"source/.obsidian/core-plugins-migration.json","hash":"0e26aae7d03070c204bfa7fd32ce3785211f5316","modified":1686271254190},{"_id":"source/template/blog.md","hash":"d24cb5dd0bf23ed24793285dec8856e8a7cb23fc","modified":1686271349384},{"_id":"source/.obsidian/hotkeys.json","hash":"bf21a9e8fbc5a3846fb05b4fa0859e0917b2202f","modified":1686271253649},{"_id":"public/template/blog.html","hash":"a271d0f694f5f16824687568bf364a5c294b35d5","modified":1686271389207}],"Category":[{"name":"DNSMASQ","_id":"clinu5sds0004dxjc22pd67vl"},{"name":"Android","_id":"clinu5sdx0009dxjcfrwpfz0s"},{"name":"FLUTTER","_id":"clinu5sdz000ddxjc5af80x35"},{"name":"GOLANG","_id":"clinu5se6000odxjc4yo6huga"},{"name":"MYSQL","_id":"clinu5sek001ndxjch6tzakj9"},{"name":"PHP","_id":"clinu5seo001wdxjc71t0ajy2"},{"name":"PUSH","_id":"clinu5sep0021dxjc16oq0jhw"},{"name":"REDIS","_id":"clinu5sey002ldxjc89n9g0ua"},{"name":"SSH","_id":"clinu5sf0002sdxjchpo3cb1k"},{"name":"VPN","_id":"clinu5sf20031dxjcd2qf0pul"},{"name":"吃瓜","_id":"clinu5sf20034dxjcc2le0oas"},{"name":"树莓派","_id":"clinu5sf30036dxjc4iby8kkm"},{"name":"微信公众号","_id":"clinu5sf30039dxjc5vf7cdcp"},{"name":"Hexo","_id":"clinu5sf6003ldxjc30ea4ljw"},{"name":"Python","_id":"clinu5sf6003odxjc3iav47aq"},{"name":"测试","_id":"clinu5sf7003tdxjc96r08qef"},{"name":"认知与成长","_id":"clinu5sf7003wdxjcc22z9ygp"},{"name":"模版文件夹","_id":"clinu5sf8003ydxjc0urq35nb"}],"Data":[],"Page":[{"title":"categories","date":"2023-06-08T22:18:22.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2023-06-09 06:18:22\ntype: \"categories\"\n---\n","updated":"2023-06-08T22:19:53.328Z","path":"categories/index.html","comments":1,"layout":"page","_id":"clinu5sdj0000dxjcc8197d4a","content":"","site":{"data":{}},"length":0,"excerpt":"","more":""},{"title":"关于我","date":"2023-06-08T22:31:51.000Z","_content":"\n\n- 90后|天蝎座\n- 后端程序🐶一枚,前端也会点\n- 精通php、linux、mysql、shell、vue\n- 使用树莓派用asterisk搭建通话系统\n- 搭建直播平台\n- 搭建vpn访问内网\n- go正在学习中 \n- flutter尝试中，已做了一个demo,还在做其他\n- 阿里云的oss,nas在用\n- 最近迷上剪辑视频，pr,finalcutpro,达芬奇调色通通在玩\n- 利用百度飞桨AI抠取人像图，一键换背景python 有时间继续学习  \n- 之前用flutter做的app，感觉还不错，近期用uniapp打通小程序，并且正好用来学习vue,demo之后再补上\n- uniapp 已经做出好几个demo，比如小说小程序，crm系统等等，之后整理出来放到github上，最近尝试使用云开发版，毕竟可以节省服务器。  \n\n\n","source":"about/index.md","raw":"---\ntitle: 关于我\ndate: 2023-06-09 06:31:51\n---\n\n\n- 90后|天蝎座\n- 后端程序🐶一枚,前端也会点\n- 精通php、linux、mysql、shell、vue\n- 使用树莓派用asterisk搭建通话系统\n- 搭建直播平台\n- 搭建vpn访问内网\n- go正在学习中 \n- flutter尝试中，已做了一个demo,还在做其他\n- 阿里云的oss,nas在用\n- 最近迷上剪辑视频，pr,finalcutpro,达芬奇调色通通在玩\n- 利用百度飞桨AI抠取人像图，一键换背景python 有时间继续学习  \n- 之前用flutter做的app，感觉还不错，近期用uniapp打通小程序，并且正好用来学习vue,demo之后再补上\n- uniapp 已经做出好几个demo，比如小说小程序，crm系统等等，之后整理出来放到github上，最近尝试使用云开发版，毕竟可以节省服务器。  \n\n\n","updated":"2023-06-08T22:35:54.901Z","path":"about/index.html","comments":1,"layout":"page","_id":"clinu5sdq0002dxjc82judaib","content":"<ul>\n<li>90后|天蝎座</li>\n<li>后端程序🐶一枚,前端也会点</li>\n<li>精通php、linux、mysql、shell、vue</li>\n<li>使用树莓派用asterisk搭建通话系统</li>\n<li>搭建直播平台</li>\n<li>搭建vpn访问内网</li>\n<li>go正在学习中 </li>\n<li>flutter尝试中，已做了一个demo,还在做其他</li>\n<li>阿里云的oss,nas在用</li>\n<li>最近迷上剪辑视频，pr,finalcutpro,达芬奇调色通通在玩</li>\n<li>利用百度飞桨AI抠取人像图，一键换背景python 有时间继续学习  </li>\n<li>之前用flutter做的app，感觉还不错，近期用uniapp打通小程序，并且正好用来学习vue,demo之后再补上</li>\n<li>uniapp 已经做出好几个demo，比如小说小程序，crm系统等等，之后整理出来放到github上，最近尝试使用云开发版，毕竟可以节省服务器。</li>\n</ul>\n","site":{"data":{}},"length":323,"excerpt":"","more":"<ul>\n<li>90后|天蝎座</li>\n<li>后端程序🐶一枚,前端也会点</li>\n<li>精通php、linux、mysql、shell、vue</li>\n<li>使用树莓派用asterisk搭建通话系统</li>\n<li>搭建直播平台</li>\n<li>搭建vpn访问内网</li>\n<li>go正在学习中 </li>\n<li>flutter尝试中，已做了一个demo,还在做其他</li>\n<li>阿里云的oss,nas在用</li>\n<li>最近迷上剪辑视频，pr,finalcutpro,达芬奇调色通通在玩</li>\n<li>利用百度飞桨AI抠取人像图，一键换背景python 有时间继续学习  </li>\n<li>之前用flutter做的app，感觉还不错，近期用uniapp打通小程序，并且正好用来学习vue,demo之后再补上</li>\n<li>uniapp 已经做出好几个demo，比如小说小程序，crm系统等等，之后整理出来放到github上，最近尝试使用云开发版，毕竟可以节省服务器。</li>\n</ul>\n"},{"title":"tags","date":"2023-06-08T22:28:34.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2023-06-09 06:28:34\ntype: tags\n---\n","updated":"2023-06-08T22:29:04.889Z","path":"tags/index.html","comments":1,"layout":"page","_id":"clinu5sdu0005dxjcclo1cc0h","content":"","site":{"data":{}},"length":0,"excerpt":"","more":""},{"title":"[object Object]","date":"2023-06-09T00:42:29.384Z","tags":[],"_content":"","source":"template/blog.md","raw":"---\ntitle: {{title}}  \ndate: {{date}}  \ntags: []  \n---\n","updated":"2023-06-09T00:42:29.384Z","path":"template/blog.html","comments":1,"layout":"page","_id":"clinug4eh0000syjch9sd9qjg","content":"","site":{"data":{}},"length":0,"excerpt":"","more":""}],"Post":[{"_content":"### 安装dnsmasq\n- apt-get install -y dnsmasq\n#### /etc/dnsmasq.conf\n```conf\nbogus-priv\nno-resolv\nserver=100.100.2.138\nserver=100.100.2.136\ninterface=tun0\nlisten-address=127.0.0.1\nbind-interfaces\naddn-hosts=/etc/internal_ips\n```\n#### /etc/internal_ips\n10.8.0.1 main.int  \n10.8.0.2 cj.int  \n10.8.0.3 cjwindows.int  \n10.8.0.4 s1.int  \n10.8.0.5 s2.int   \n10.8.0.6 s3.int   \n10.8.0.7 s4.int    \n\n#### dnsmasq 配置\n![avatar](https://blog.hexiefamily.xin/assets/dnsmasq.jpg)","source":"_posts/DNSMASQ/dnsmasq配置局域网域名.md","raw":"---\ncategories:\n  - DNSMASQ\n---\n### 安装dnsmasq\n- apt-get install -y dnsmasq\n#### /etc/dnsmasq.conf\n```conf\nbogus-priv\nno-resolv\nserver=100.100.2.138\nserver=100.100.2.136\ninterface=tun0\nlisten-address=127.0.0.1\nbind-interfaces\naddn-hosts=/etc/internal_ips\n```\n#### /etc/internal_ips\n10.8.0.1 main.int  \n10.8.0.2 cj.int  \n10.8.0.3 cjwindows.int  \n10.8.0.4 s1.int  \n10.8.0.5 s2.int   \n10.8.0.6 s3.int   \n10.8.0.7 s4.int    \n\n#### dnsmasq 配置\n![avatar](https://blog.hexiefamily.xin/assets/dnsmasq.jpg)","slug":"dnsmasq配置局域网域名","published":1,"category":"DNSMASQ","date":"2023-06-08T23:03:56.083Z","updated":"2023-06-08T23:12:13.671Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5sdn0001dxjc5rpse25r","content":"<h3 id=\"安装dnsmasq\"><a href=\"#安装dnsmasq\" class=\"headerlink\" title=\"安装dnsmasq\"></a>安装dnsmasq</h3><ul>\n<li>apt-get install -y dnsmasq</li>\n</ul>\n<h4 id=\"x2F-etc-x2F-dnsmasq-conf\"><a href=\"#x2F-etc-x2F-dnsmasq-conf\" class=\"headerlink\" title=\"&#x2F;etc&#x2F;dnsmasq.conf\"></a>&#x2F;etc&#x2F;dnsmasq.conf</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bogus-priv</span><br><span class=\"line\">no-resolv</span><br><span class=\"line\">server=100.100.2.138</span><br><span class=\"line\">server=100.100.2.136</span><br><span class=\"line\">interface=tun0</span><br><span class=\"line\">listen-address=127.0.0.1</span><br><span class=\"line\">bind-interfaces</span><br><span class=\"line\">addn-hosts=/etc/internal_ips</span><br></pre></td></tr></table></figure>\n<h4 id=\"x2F-etc-x2F-internal-ips\"><a href=\"#x2F-etc-x2F-internal-ips\" class=\"headerlink\" title=\"&#x2F;etc&#x2F;internal_ips\"></a>&#x2F;etc&#x2F;internal_ips</h4><p>10.8.0.1 main.int<br>10.8.0.2 cj.int<br>10.8.0.3 cjwindows.int<br>10.8.0.4 s1.int<br>10.8.0.5 s2.int<br>10.8.0.6 s3.int<br>10.8.0.7 s4.int    </p>\n<h4 id=\"dnsmasq-配置\"><a href=\"#dnsmasq-配置\" class=\"headerlink\" title=\"dnsmasq 配置\"></a>dnsmasq 配置</h4><p><img src=\"https://blog.hexiefamily.xin/assets/dnsmasq.jpg\" alt=\"avatar\"></p>\n","site":{"data":{}},"length":350,"excerpt":"","more":"<h3 id=\"安装dnsmasq\"><a href=\"#安装dnsmasq\" class=\"headerlink\" title=\"安装dnsmasq\"></a>安装dnsmasq</h3><ul>\n<li>apt-get install -y dnsmasq</li>\n</ul>\n<h4 id=\"x2F-etc-x2F-dnsmasq-conf\"><a href=\"#x2F-etc-x2F-dnsmasq-conf\" class=\"headerlink\" title=\"&#x2F;etc&#x2F;dnsmasq.conf\"></a>&#x2F;etc&#x2F;dnsmasq.conf</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bogus-priv</span><br><span class=\"line\">no-resolv</span><br><span class=\"line\">server=100.100.2.138</span><br><span class=\"line\">server=100.100.2.136</span><br><span class=\"line\">interface=tun0</span><br><span class=\"line\">listen-address=127.0.0.1</span><br><span class=\"line\">bind-interfaces</span><br><span class=\"line\">addn-hosts=/etc/internal_ips</span><br></pre></td></tr></table></figure>\n<h4 id=\"x2F-etc-x2F-internal-ips\"><a href=\"#x2F-etc-x2F-internal-ips\" class=\"headerlink\" title=\"&#x2F;etc&#x2F;internal_ips\"></a>&#x2F;etc&#x2F;internal_ips</h4><p>10.8.0.1 main.int<br>10.8.0.2 cj.int<br>10.8.0.3 cjwindows.int<br>10.8.0.4 s1.int<br>10.8.0.5 s2.int<br>10.8.0.6 s3.int<br>10.8.0.7 s4.int    </p>\n<h4 id=\"dnsmasq-配置\"><a href=\"#dnsmasq-配置\" class=\"headerlink\" title=\"dnsmasq 配置\"></a>dnsmasq 配置</h4><p><img src=\"https://blog.hexiefamily.xin/assets/dnsmasq.jpg\" alt=\"avatar\"></p>\n"},{"_content":"\n### Adb devices 显示为空？\n\n#### 参考资料\n**https://www.cnblogs.com/wx170119/p/13092595.html**  \n**https://androiddevtools.cn/**\n\n##### 启动命令：\n> 按照上面步骤即可完成\n\n","source":"_posts/Android/adb devices 为空.md","raw":"---\ncategories:\n  - Android\n---\n\n### Adb devices 显示为空？\n\n#### 参考资料\n**https://www.cnblogs.com/wx170119/p/13092595.html**  \n**https://androiddevtools.cn/**\n\n##### 启动命令：\n> 按照上面步骤即可完成\n\n","slug":"adb devices 为空","published":1,"category":"Android","date":"2023-06-08T23:03:56.082Z","updated":"2023-06-08T23:12:13.671Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5sdr0003dxjc9x7l7oln","content":"<h3 id=\"Adb-devices-显示为空？\"><a href=\"#Adb-devices-显示为空？\" class=\"headerlink\" title=\"Adb devices 显示为空？\"></a>Adb devices 显示为空？</h3><h4 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h4><p><strong><a href=\"https://www.cnblogs.com/wx170119/p/13092595.html\">https://www.cnblogs.com/wx170119/p/13092595.html</a></strong><br><strong><a href=\"https://androiddevtools.cn/\">https://androiddevtools.cn/</a></strong></p>\n<h5 id=\"启动命令：\"><a href=\"#启动命令：\" class=\"headerlink\" title=\"启动命令：\"></a>启动命令：</h5><blockquote>\n<p>按照上面步骤即可完成</p>\n</blockquote>\n","site":{"data":{}},"length":109,"excerpt":"","more":"<h3 id=\"Adb-devices-显示为空？\"><a href=\"#Adb-devices-显示为空？\" class=\"headerlink\" title=\"Adb devices 显示为空？\"></a>Adb devices 显示为空？</h3><h4 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h4><p><strong><a href=\"https://www.cnblogs.com/wx170119/p/13092595.html\">https://www.cnblogs.com/wx170119/p/13092595.html</a></strong><br><strong><a href=\"https://androiddevtools.cn/\">https://androiddevtools.cn/</a></strong></p>\n<h5 id=\"启动命令：\"><a href=\"#启动命令：\" class=\"headerlink\" title=\"启动命令：\"></a>启动命令：</h5><blockquote>\n<p>按照上面步骤即可完成</p>\n</blockquote>\n"},{"_content":"#### flutter doctor 一直等待无响应的解决办法\n- 打开flutter的安装目录/bin/cache/\n- 删除lockfile文件\n- 重启vscode","source":"_posts/FLUTTER/flutter doctor一直等待无响应.md","raw":"---\ncategories:\n  - FLUTTER\n---\n#### flutter doctor 一直等待无响应的解决办法\n- 打开flutter的安装目录/bin/cache/\n- 删除lockfile文件\n- 重启vscode","slug":"flutter doctor一直等待无响应","published":1,"category":"FLUTTER","date":"2023-06-08T23:03:56.086Z","updated":"2023-06-08T23:12:13.748Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5sdv0006dxjc9aj89qth","content":"<h4 id=\"flutter-doctor-一直等待无响应的解决办法\"><a href=\"#flutter-doctor-一直等待无响应的解决办法\" class=\"headerlink\" title=\"flutter doctor 一直等待无响应的解决办法\"></a>flutter doctor 一直等待无响应的解决办法</h4><ul>\n<li>打开flutter的安装目录&#x2F;bin&#x2F;cache&#x2F;</li>\n<li>删除lockfile文件</li>\n<li>重启vscode</li>\n</ul>\n","site":{"data":{}},"length":85,"excerpt":"","more":"<h4 id=\"flutter-doctor-一直等待无响应的解决办法\"><a href=\"#flutter-doctor-一直等待无响应的解决办法\" class=\"headerlink\" title=\"flutter doctor 一直等待无响应的解决办法\"></a>flutter doctor 一直等待无响应的解决办法</h4><ul>\n<li>打开flutter的安装目录&#x2F;bin&#x2F;cache&#x2F;</li>\n<li>删除lockfile文件</li>\n<li>重启vscode</li>\n</ul>\n"},{"_content":"#### 参考资料\n**https://ninghao.net/video/6364**  \n**https://flutterchina.club/setup-macos/**\n\n##### 启动命令：\n>$ flutter create cjios  \n>$ flutter emulator --launch apple_ios_simulator  \n如果出现no device 首先要装android studio  \n\n##### 如果出现UIApplication.LaunchOptionsKey问题\n解决办法：\n\nnano  cjios/ios/Runner/AppDelegate.swift\n[UIApplication.LaunchOptionsKey: Any]  \n改成  \n[UIApplicationLaunchOptionsKey: Any]\n\n##### 运行命令  \n>$ flutter run   \n##### 安装命令\n>$ flutter devices  \niPhone • xxxxxx • ios • iOS 13.2\n>$ flutter run -d   xxxxxx \n>即可安装到手机上了\n\n#### 工具栏：\n1、https://pub.dev/packages/zefyr  \n2、https://javiercbk.github.io/json_to_dart/\n3、获取列表数据：https://blog.csdn.net/weixin_30867015/article/details/98277080\n4、展示markdown文件：https://github.com/flutter/flutter_markdown/blob/master/example/lib/main.dart","source":"_posts/FLUTTER/flutter mac下安装.md","raw":"---\ncategories:\n  - FLUTTER\n---\n#### 参考资料\n**https://ninghao.net/video/6364**  \n**https://flutterchina.club/setup-macos/**\n\n##### 启动命令：\n>$ flutter create cjios  \n>$ flutter emulator --launch apple_ios_simulator  \n如果出现no device 首先要装android studio  \n\n##### 如果出现UIApplication.LaunchOptionsKey问题\n解决办法：\n\nnano  cjios/ios/Runner/AppDelegate.swift\n[UIApplication.LaunchOptionsKey: Any]  \n改成  \n[UIApplicationLaunchOptionsKey: Any]\n\n##### 运行命令  \n>$ flutter run   \n##### 安装命令\n>$ flutter devices  \niPhone • xxxxxx • ios • iOS 13.2\n>$ flutter run -d   xxxxxx \n>即可安装到手机上了\n\n#### 工具栏：\n1、https://pub.dev/packages/zefyr  \n2、https://javiercbk.github.io/json_to_dart/\n3、获取列表数据：https://blog.csdn.net/weixin_30867015/article/details/98277080\n4、展示markdown文件：https://github.com/flutter/flutter_markdown/blob/master/example/lib/main.dart","slug":"flutter mac下安装","published":1,"category":"FLUTTER","date":"2023-06-08T23:03:56.085Z","updated":"2023-06-08T23:12:13.748Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5sdw0007dxjc1a7eghkp","content":"<h4 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h4><p><strong><a href=\"https://ninghao.net/video/6364\">https://ninghao.net/video/6364</a></strong><br><strong><a href=\"https://flutterchina.club/setup-macos/\">https://flutterchina.club/setup-macos/</a></strong></p>\n<h5 id=\"启动命令：\"><a href=\"#启动命令：\" class=\"headerlink\" title=\"启动命令：\"></a>启动命令：</h5><blockquote>\n<p>$ flutter create cjios<br>$ flutter emulator –launch apple_ios_simulator<br>如果出现no device 首先要装android studio  </p>\n</blockquote>\n<h5 id=\"如果出现UIApplication-LaunchOptionsKey问题\"><a href=\"#如果出现UIApplication-LaunchOptionsKey问题\" class=\"headerlink\" title=\"如果出现UIApplication.LaunchOptionsKey问题\"></a>如果出现UIApplication.LaunchOptionsKey问题</h5><p>解决办法：</p>\n<p>nano  cjios&#x2F;ios&#x2F;Runner&#x2F;AppDelegate.swift<br>[UIApplication.LaunchOptionsKey: Any]<br>改成<br>[UIApplicationLaunchOptionsKey: Any]</p>\n<h5 id=\"运行命令\"><a href=\"#运行命令\" class=\"headerlink\" title=\"运行命令\"></a>运行命令</h5><blockquote>\n<p>$ flutter run   </p>\n</blockquote>\n<h5 id=\"安装命令\"><a href=\"#安装命令\" class=\"headerlink\" title=\"安装命令\"></a>安装命令</h5><blockquote>\n<p>$ flutter devices<br>iPhone • xxxxxx • ios • iOS 13.2<br>$ flutter run -d   xxxxxx<br>即可安装到手机上了</p>\n</blockquote>\n<h4 id=\"工具栏：\"><a href=\"#工具栏：\" class=\"headerlink\" title=\"工具栏：\"></a>工具栏：</h4><p>1、<a href=\"https://pub.dev/packages/zefyr\">https://pub.dev/packages/zefyr</a><br>2、<a href=\"https://javiercbk.github.io/json_to_dart/\">https://javiercbk.github.io/json_to_dart/</a><br>3、获取列表数据：<a href=\"https://blog.csdn.net/weixin_30867015/article/details/98277080\">https://blog.csdn.net/weixin_30867015/article/details/98277080</a><br>4、展示markdown文件：<a href=\"https://github.com/flutter/flutter_markdown/blob/master/example/lib/main.dart\">https://github.com/flutter/flutter_markdown/blob/master/example/lib/main.dart</a></p>\n","site":{"data":{}},"length":663,"excerpt":"","more":"<h4 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h4><p><strong><a href=\"https://ninghao.net/video/6364\">https://ninghao.net/video/6364</a></strong><br><strong><a href=\"https://flutterchina.club/setup-macos/\">https://flutterchina.club/setup-macos/</a></strong></p>\n<h5 id=\"启动命令：\"><a href=\"#启动命令：\" class=\"headerlink\" title=\"启动命令：\"></a>启动命令：</h5><blockquote>\n<p>$ flutter create cjios<br>$ flutter emulator –launch apple_ios_simulator<br>如果出现no device 首先要装android studio  </p>\n</blockquote>\n<h5 id=\"如果出现UIApplication-LaunchOptionsKey问题\"><a href=\"#如果出现UIApplication-LaunchOptionsKey问题\" class=\"headerlink\" title=\"如果出现UIApplication.LaunchOptionsKey问题\"></a>如果出现UIApplication.LaunchOptionsKey问题</h5><p>解决办法：</p>\n<p>nano  cjios&#x2F;ios&#x2F;Runner&#x2F;AppDelegate.swift<br>[UIApplication.LaunchOptionsKey: Any]<br>改成<br>[UIApplicationLaunchOptionsKey: Any]</p>\n<h5 id=\"运行命令\"><a href=\"#运行命令\" class=\"headerlink\" title=\"运行命令\"></a>运行命令</h5><blockquote>\n<p>$ flutter run   </p>\n</blockquote>\n<h5 id=\"安装命令\"><a href=\"#安装命令\" class=\"headerlink\" title=\"安装命令\"></a>安装命令</h5><blockquote>\n<p>$ flutter devices<br>iPhone • xxxxxx • ios • iOS 13.2<br>$ flutter run -d   xxxxxx<br>即可安装到手机上了</p>\n</blockquote>\n<h4 id=\"工具栏：\"><a href=\"#工具栏：\" class=\"headerlink\" title=\"工具栏：\"></a>工具栏：</h4><p>1、<a href=\"https://pub.dev/packages/zefyr\">https://pub.dev/packages/zefyr</a><br>2、<a href=\"https://javiercbk.github.io/json_to_dart/\">https://javiercbk.github.io/json_to_dart/</a><br>3、获取列表数据：<a href=\"https://blog.csdn.net/weixin_30867015/article/details/98277080\">https://blog.csdn.net/weixin_30867015/article/details/98277080</a><br>4、展示markdown文件：<a href=\"https://github.com/flutter/flutter_markdown/blob/master/example/lib/main.dart\">https://github.com/flutter/flutter_markdown/blob/master/example/lib/main.dart</a></p>\n"},{"_content":"### 第一个页面：\n```flutter\nclass Page extends StatelessWidget {\n  final String title;\n\n  Page({this.title});\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: Text(title),\n        elevation: 0.0,\n      ),\n      body: BlogSheet(title: title),\n    );\n  }\n}\n```\n### 第二个页面\n```flutter\nclass BlogSheet extends StatefulWidget {\n  BlogSheet({Key key, this.title}) : super(key: key);\n  final String title;\n\n  @override\n  _BlogSheetState createState() => _BlogSheetState();\n}\n\nclass _BlogSheetState extends State<BlogSheet> {\n  List bloglists;\n\n  @override\n  void initState() {\n    super.initState();\n\n    getData(type: 'api', category: widget.title);\n  }\n\n  Future getData({String type = 'api', String category = 'PHP'}) async {\n    final String url = \"http://localhost:8081/$type?category=$category\";\n    final response = await http.get(url);\n\n    if (response.statusCode == 200) {\n      List top = json.decode(response.body);\n      setState(() {\n        bloglists = top.map((json) => Blog.fromJson(json)).toList();\n      });\n    } else {\n      print(\"err code $response.statusCode\");\n    }\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Container(\n      child: bloglists == null\n          ? Center(child: CircularProgressIndicator())\n          : Padding(\n              padding: EdgeInsets.symmetric(horizontal: 6.0, vertical: 10.0),\n              child: ListView.builder(\n                itemCount: bloglists.length,\n                itemBuilder: (BuildContext context, int index) {\n                  return BlogCard(bloglists[index]);\n                },\n              ),\n            ),\n    );\n  }\n}\n```","source":"_posts/FLUTTER/页面传递参数.md","raw":"---\ncategories:\n  - FLUTTER\n---\n### 第一个页面：\n```flutter\nclass Page extends StatelessWidget {\n  final String title;\n\n  Page({this.title});\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: Text(title),\n        elevation: 0.0,\n      ),\n      body: BlogSheet(title: title),\n    );\n  }\n}\n```\n### 第二个页面\n```flutter\nclass BlogSheet extends StatefulWidget {\n  BlogSheet({Key key, this.title}) : super(key: key);\n  final String title;\n\n  @override\n  _BlogSheetState createState() => _BlogSheetState();\n}\n\nclass _BlogSheetState extends State<BlogSheet> {\n  List bloglists;\n\n  @override\n  void initState() {\n    super.initState();\n\n    getData(type: 'api', category: widget.title);\n  }\n\n  Future getData({String type = 'api', String category = 'PHP'}) async {\n    final String url = \"http://localhost:8081/$type?category=$category\";\n    final response = await http.get(url);\n\n    if (response.statusCode == 200) {\n      List top = json.decode(response.body);\n      setState(() {\n        bloglists = top.map((json) => Blog.fromJson(json)).toList();\n      });\n    } else {\n      print(\"err code $response.statusCode\");\n    }\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Container(\n      child: bloglists == null\n          ? Center(child: CircularProgressIndicator())\n          : Padding(\n              padding: EdgeInsets.symmetric(horizontal: 6.0, vertical: 10.0),\n              child: ListView.builder(\n                itemCount: bloglists.length,\n                itemBuilder: (BuildContext context, int index) {\n                  return BlogCard(bloglists[index]);\n                },\n              ),\n            ),\n    );\n  }\n}\n```","slug":"页面传递参数","published":1,"category":"FLUTTER","date":"2023-06-08T23:03:56.085Z","updated":"2023-06-08T23:12:13.671Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5sdw0008dxjcbu1p6v5b","content":"<h3 id=\"第一个页面：\"><a href=\"#第一个页面：\" class=\"headerlink\" title=\"第一个页面：\"></a>第一个页面：</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Page extends StatelessWidget &#123;</span><br><span class=\"line\">  final String title;</span><br><span class=\"line\"></span><br><span class=\"line\">  Page(&#123;this.title&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  @override</span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    return Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        title: Text(title),</span><br><span class=\"line\">        elevation: 0.0,</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      body: BlogSheet(title: title),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"第二个页面\"><a href=\"#第二个页面\" class=\"headerlink\" title=\"第二个页面\"></a>第二个页面</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class BlogSheet extends StatefulWidget &#123;</span><br><span class=\"line\">  BlogSheet(&#123;Key key, this.title&#125;) : super(key: key);</span><br><span class=\"line\">  final String title;</span><br><span class=\"line\"></span><br><span class=\"line\">  @override</span><br><span class=\"line\">  _BlogSheetState createState() =&gt; _BlogSheetState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">class _BlogSheetState extends State&lt;BlogSheet&gt; &#123;</span><br><span class=\"line\">  List bloglists;</span><br><span class=\"line\"></span><br><span class=\"line\">  @override</span><br><span class=\"line\">  void initState() &#123;</span><br><span class=\"line\">    super.initState();</span><br><span class=\"line\"></span><br><span class=\"line\">    getData(type: &#x27;api&#x27;, category: widget.title);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  Future getData(&#123;String type = &#x27;api&#x27;, String category = &#x27;PHP&#x27;&#125;) async &#123;</span><br><span class=\"line\">    final String url = &quot;http://localhost:8081/$type?category=$category&quot;;</span><br><span class=\"line\">    final response = await http.get(url);</span><br><span class=\"line\"></span><br><span class=\"line\">    if (response.statusCode == 200) &#123;</span><br><span class=\"line\">      List top = json.decode(response.body);</span><br><span class=\"line\">      setState(() &#123;</span><br><span class=\"line\">        bloglists = top.map((json) =&gt; Blog.fromJson(json)).toList();</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">      print(&quot;err code $response.statusCode&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  @override</span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    return Container(</span><br><span class=\"line\">      child: bloglists == null</span><br><span class=\"line\">          ? Center(child: CircularProgressIndicator())</span><br><span class=\"line\">          : Padding(</span><br><span class=\"line\">              padding: EdgeInsets.symmetric(horizontal: 6.0, vertical: 10.0),</span><br><span class=\"line\">              child: ListView.builder(</span><br><span class=\"line\">                itemCount: bloglists.length,</span><br><span class=\"line\">                itemBuilder: (BuildContext context, int index) &#123;</span><br><span class=\"line\">                  return BlogCard(bloglists[index]);</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">              ),</span><br><span class=\"line\">            ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"length":1493,"excerpt":"","more":"<h3 id=\"第一个页面：\"><a href=\"#第一个页面：\" class=\"headerlink\" title=\"第一个页面：\"></a>第一个页面：</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Page extends StatelessWidget &#123;</span><br><span class=\"line\">  final String title;</span><br><span class=\"line\"></span><br><span class=\"line\">  Page(&#123;this.title&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  @override</span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    return Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        title: Text(title),</span><br><span class=\"line\">        elevation: 0.0,</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      body: BlogSheet(title: title),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"第二个页面\"><a href=\"#第二个页面\" class=\"headerlink\" title=\"第二个页面\"></a>第二个页面</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class BlogSheet extends StatefulWidget &#123;</span><br><span class=\"line\">  BlogSheet(&#123;Key key, this.title&#125;) : super(key: key);</span><br><span class=\"line\">  final String title;</span><br><span class=\"line\"></span><br><span class=\"line\">  @override</span><br><span class=\"line\">  _BlogSheetState createState() =&gt; _BlogSheetState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">class _BlogSheetState extends State&lt;BlogSheet&gt; &#123;</span><br><span class=\"line\">  List bloglists;</span><br><span class=\"line\"></span><br><span class=\"line\">  @override</span><br><span class=\"line\">  void initState() &#123;</span><br><span class=\"line\">    super.initState();</span><br><span class=\"line\"></span><br><span class=\"line\">    getData(type: &#x27;api&#x27;, category: widget.title);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  Future getData(&#123;String type = &#x27;api&#x27;, String category = &#x27;PHP&#x27;&#125;) async &#123;</span><br><span class=\"line\">    final String url = &quot;http://localhost:8081/$type?category=$category&quot;;</span><br><span class=\"line\">    final response = await http.get(url);</span><br><span class=\"line\"></span><br><span class=\"line\">    if (response.statusCode == 200) &#123;</span><br><span class=\"line\">      List top = json.decode(response.body);</span><br><span class=\"line\">      setState(() &#123;</span><br><span class=\"line\">        bloglists = top.map((json) =&gt; Blog.fromJson(json)).toList();</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">      print(&quot;err code $response.statusCode&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  @override</span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    return Container(</span><br><span class=\"line\">      child: bloglists == null</span><br><span class=\"line\">          ? Center(child: CircularProgressIndicator())</span><br><span class=\"line\">          : Padding(</span><br><span class=\"line\">              padding: EdgeInsets.symmetric(horizontal: 6.0, vertical: 10.0),</span><br><span class=\"line\">              child: ListView.builder(</span><br><span class=\"line\">                itemCount: bloglists.length,</span><br><span class=\"line\">                itemBuilder: (BuildContext context, int index) &#123;</span><br><span class=\"line\">                  return BlogCard(bloglists[index]);</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">              ),</span><br><span class=\"line\">            ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"_content":"### LXC 容器搭建nsq集群\n- [原文链接](http://ddrv.cn/a/291527)  \n\n#### 使用场景\n有两个服务中心，apiserver处理用户的请求，dataserver处理数据，dataserver 有很多个，并且遵循raft高可用协议，写在配置文件中，当用户发起一个请求到apiserver,apiserver会向dataserver中的任意一个请求，这样做的好处是当dataserver中任意一个挂掉，apiserver只需获取当前配置文件中可用的地址即可，存活的dataserver会返回地址。  \n#### NSQ当中的用处：\n- 每一个dataserver 以生产者的角色，连接nsqd，同时每隔几秒发送topic消息心跳检测，（可以有多个channel，nsq 保证消息投递一次以上，随机挑选channel发送消息，无序性）保证nsqlookupd 知道有哪些nsqd对应的生产者存活。  \n- apiserver充当消费者的角色，连接nsqlookupd 4161 http端口，监听topic消息以及channel1，当有消息publish，即通知apiserver,本文即所有存活的dataserver的地址，apiserver 可随机挑选任意一个dataserver进行调用。   \n#### 代码\n\n##### dataserver.go\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"math/rand\"\n\t\"net/http\"\n\t\"nsq_client/config\"\n\t\"time\"\n\n\t\"github.com/nsqio/go-nsq\"\n)\n\n// Conf *\nvar Conf *config.Cfgparams\n\nfunc main() {\n\n\tConf = config.GetConfig()\n\t// randomAddr := RadomGetNsqd(Conf.NSQ_TCP_ADDRS)\n\tfmt.Println(Conf)\n\t// name := viper.GetString(\"name\")\n\t// x := viper.Get(\"common.nsqd\")\n\t// fmt.Println(x, reflect.TypeOf(x))\n\n\tserver := http.Server{\n\t\tAddr: Conf.SERVER_ADDR,\n\t}\n\tgo HeartBeat() //这里开goroutine来发送心跳包\n\tif err := server.ListenAndServe(); err != nil {\n\t\tpanic(err)\n\t}\n\n\t// fmt.Println(\"Viper get name:\", name)\n}\n\n// RadomGetNsqd\nfunc RadomGetNsqd(nsqTCPAddrs []string) string {\n\trand.Seed(time.Now().UnixNano())\n\treturn nsqTCPAddrs[rand.Intn(len(nsqTCPAddrs))]\n}\n\n// HeartBeat\nfunc HeartBeat() {\n\tvar (\n\t\tproducer *nsq.Producer\n\t\terr      error\n\t\tticker   *time.Ticker\n\t)\n\tticker = time.NewTicker(time.Duration(Conf.HEART_BEAT_TIME) * time.Second) //创建一个定时器，这里的时间我都写到配置文件里了，然后用conf包拿出来。我这里是设置的5秒\n\tfor {\n\t\tselect {\n\t\tcase <-ticker.C:\n\t\t\t//创建一个生产者，这里的RanDomGetServer()是自定义的一个工具，用来随机获取一个nsqd地址\n\t\t\tif producer, err = nsq.NewProducer(RadomGetNsqd(Conf.NSQ_TCP_ADDRS), nsq.NewConfig()); err != nil {\n\t\t\t\tpanic(err)\n\t\t\t}\n\t\t\t//pulish()接的第一个参数是topic，这个也是自己定义(值为data_server_addr），第二个参数是要发送的消息，这里是本机服务器地址\n\t\t\terr = producer.Publish(Conf.DATA_SERVER_TOPIC, []byte(Conf.SERVER_ADDR))\n\t\t\tif err != nil {\n\t\t\t\tpanic(err)\n\t\t\t}\n\t\t}\n\t}\n}\n```\n##### apiserver.go\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"net/http\"\n\t\"nsq_client/config\"\n\t\"sync\"\n\t\"time\"\n\n\t\"github.com/nsqio/go-nsq\"\n)\n\n//创建一个nsq.handler接口实例\nvar ServerConsumerHandler = &ServerConsumer{DataServerAddrs: make(map[string]time.Time)}\n\n//ServerConsumer实现了nsq.handler接口\ntype ServerConsumer struct {\n\tDataServerAddrs map[string]time.Time //保存dataServer进程发过来的服务器地址和接收时间\n\trwLocker        sync.RWMutex         //防止多线程同时读写\n}\n\n//这里第一个参数是需要绑定topic(data_server_addr),\n//第二个参数传入一个string，这就是创建的ch，topic消息队列中的消息会分发到每个ch中.\n//每个消费者可以创建不通的ch，也可以共用一个ch，共用一个ch, ch的消息会随机发送给其中一个消费者\n//第三个参数是处理message的nsq.handler接口，需要实现一个HanddleMessage(*nsq.Message)error()方法。\nfunc NewConsumer(topic string, chanName string, h nsq.Handler) (consumer *nsq.Consumer, err error) {\n\tif consumer, err = nsq.NewConsumer(topic, chanName, nsq.NewConfig()); err != nil {\n\t\treturn nil, err\n\t}\n\tconsumer.ChangeMaxInFlight(3) //可以根据nsqds数量来配置\n\tconsumer.AddHandler(h)\n\terr = consumer.ConnectToNSQLookupd(Conf.NSQ_LOOKUPD_ADDR) //todo:读取配置地址\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treturn consumer, nil\n}\n\n//HandleMessage是nsq,handler接口定义方法，必须实现，主要是用来处理传递过来的消息\nfunc (h *ServerConsumer) HandleMessage(message *nsq.Message) error {\n\tif dataServer := string(message.Body); dataServer != \"\" {\n\t\th.rwLocker.Lock()\n\t\th.DataServerAddrs[dataServer] = time.Now()\n\t\th.rwLocker.Unlock()\n\t}\n\treturn nil\n}\n\n//监听服务data_server_addr这个消息队列\nfunc MonitorDataServerAddrs() {\n\tconsumer, err := NewConsumer(\"data_server_addr\", \"ch1\", ServerConsumerHandler)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\t//连接到NSQLookupd，它底层会创建连接到每个nsqd.这样就可以监听每个nsqd中的消息\n\terr = consumer.ConnectToNSQLookupd(Conf.NSQ_LOOKUPD_ADDR) //方法本身会开一个goroutine来检查消息队列\n\tif err != nil {\n\t\tpanic(err)\n\t}\n}\n\n//删除过期的服务器地址\nfunc (h *ServerConsumer) removeExpireDatasServers() {\n\tfor {\n\t\th.rwLocker.Lock()\n\t\tfor dataServer, t := range h.DataServerAddrs {\n\t\t\t//只保存10秒之内发送过来的服务器地址\n\t\t\tif t.Add(10 * time.Second).Before(time.Now()) {\n\t\t\t\tdelete(h.DataServerAddrs, dataServer)\n\t\t\t}\n\t\t}\n\t\th.rwLocker.Unlock()\n\t\ttime.Sleep(2 * time.Second)\n\t}\n}\n\nvar Conf *config.Cfgparams\n\nfunc main() {\n\n\tConf = config.GetConfig()\n\tfmt.Println(Conf)\n\n\tserver := http.Server{\n\t\tAddr: \"127.0.0.1:9000\",\n\t}\n\tMonitorDataServerAddrs() //不用单独开goroutine\n\tif err := server.ListenAndServe(); err != nil {\n\t\tpanic(err)\n\t}\n}\n```\n##### config.go\n```go\npackage config\n\nimport (\n\t\"fmt\"\n\n\t\"github.com/fsnotify/fsnotify\"\n\t\"github.com/spf13/viper\"\n)\n\ntype Cfgparams struct {\n\tHEART_BEAT_TIME   int\n\tSERVER_ADDR       string\n\tNSQ_LOOKUPD_ADDR  string\n\tNSQ_TCP_ADDRS     []string\n\tDATA_SERVER_TOPIC string\n}\n\ntype Config struct {\n\tName string\n}\n\nfunc Init(cfg string) error {\n\tc := Config{\n\t\tName: cfg,\n\t}\n\t// 初始化配置文件\n\tif err := c.initConfig(); err != nil {\n\t\treturn err\n\t}\n\n\tc.watchConfig()\n\n\treturn nil\n}\n\nfunc (c *Config) initConfig() error {\n\tif c.Name != \"\" {\n\t\t// 如果指定了配置文件，则解析指定的配置文件\n\t\tviper.SetConfigFile(c.Name)\n\t} else {\n\t\t// 如果没有指定配置文件，则解析默认的配置文件\n\t\tviper.AddConfigPath(\"conf\")\n\t\tviper.SetConfigName(\"config\")\n\t}\n\t// 设置配置文件格式为YAML\n\tviper.SetConfigType(\"yaml\")\n\t// viper解析配置文件\n\tif err := viper.ReadInConfig(); err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}\n\n// 监听配置文件是否改变,用于热更新\nfunc (c *Config) watchConfig() {\n\tviper.WatchConfig()\n\tviper.OnConfigChange(func(e fsnotify.Event) {\n\t\tfmt.Printf(\"Config file changed: %s\\n\", e.Name)\n\t})\n}\n\n// 获取到配置文件\nfunc GetConfig() *Cfgparams {\n\tif err := Init(\"./conf/config.yaml\"); err != nil {\n\t\tpanic(err)\n\t}\n\tc := &Cfgparams{}\n\t// name := viper.GetString(\"name\")\n\tc.HEART_BEAT_TIME = viper.GetInt(\"common.heart_beat_time\")\n\tc.SERVER_ADDR = viper.GetString(\"common.server_addr\")\n\tc.DATA_SERVER_TOPIC = viper.GetString(\"common.server_topic\")\n\taddr := viper.GetString(\"common.nsqlookupd.addr\")\n\tport := viper.GetString(\"common.nsqlookupd.http_port\")\n\tc.NSQ_LOOKUPD_ADDR = addr + \":\" + port\n\tx := viper.Get(\"common.nsqd\")\n\t// c.NSQ_TCP_ADDRS = viper.Get(\"common.nsqd\").([]string)\n\tvar y []string\n\tfor _, v := range x.([]interface{}) {\n\t\ty = append(y, v.(string))\n\t}\n\tc.NSQ_TCP_ADDRS = y\n\t// fmt.Println(c)\n\treturn c\n\n}\n```\n##### config.yaml\n```yaml\nname:   nsq\ncommon:\n    heart_beat_time: 5\n    nsqlookupd:\n        name:   s1\n        addr:   10.8.0.4\n        tcp_port:   4160\n        http_port:  4161\n    nsqadmin:\n        name:   s1\n        addr:   10.8.0.4\n        port:   4171\n    nsqd:\n    - 10.8.0.4:4150\n    - 10.8.0.5:4150\n    - 10.8.0.6:4150\n    - 10.8.0.7:4150\n    server_topic:   \"data_server_addr\"\n    server_addr:   \"127.0.0.1:10001\"\n```","source":"_posts/GOLANG/LXC容器搭建NSQ集群三.md","raw":"---\ncategories:\n  - GOLANG\n---\n### LXC 容器搭建nsq集群\n- [原文链接](http://ddrv.cn/a/291527)  \n\n#### 使用场景\n有两个服务中心，apiserver处理用户的请求，dataserver处理数据，dataserver 有很多个，并且遵循raft高可用协议，写在配置文件中，当用户发起一个请求到apiserver,apiserver会向dataserver中的任意一个请求，这样做的好处是当dataserver中任意一个挂掉，apiserver只需获取当前配置文件中可用的地址即可，存活的dataserver会返回地址。  \n#### NSQ当中的用处：\n- 每一个dataserver 以生产者的角色，连接nsqd，同时每隔几秒发送topic消息心跳检测，（可以有多个channel，nsq 保证消息投递一次以上，随机挑选channel发送消息，无序性）保证nsqlookupd 知道有哪些nsqd对应的生产者存活。  \n- apiserver充当消费者的角色，连接nsqlookupd 4161 http端口，监听topic消息以及channel1，当有消息publish，即通知apiserver,本文即所有存活的dataserver的地址，apiserver 可随机挑选任意一个dataserver进行调用。   \n#### 代码\n\n##### dataserver.go\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"math/rand\"\n\t\"net/http\"\n\t\"nsq_client/config\"\n\t\"time\"\n\n\t\"github.com/nsqio/go-nsq\"\n)\n\n// Conf *\nvar Conf *config.Cfgparams\n\nfunc main() {\n\n\tConf = config.GetConfig()\n\t// randomAddr := RadomGetNsqd(Conf.NSQ_TCP_ADDRS)\n\tfmt.Println(Conf)\n\t// name := viper.GetString(\"name\")\n\t// x := viper.Get(\"common.nsqd\")\n\t// fmt.Println(x, reflect.TypeOf(x))\n\n\tserver := http.Server{\n\t\tAddr: Conf.SERVER_ADDR,\n\t}\n\tgo HeartBeat() //这里开goroutine来发送心跳包\n\tif err := server.ListenAndServe(); err != nil {\n\t\tpanic(err)\n\t}\n\n\t// fmt.Println(\"Viper get name:\", name)\n}\n\n// RadomGetNsqd\nfunc RadomGetNsqd(nsqTCPAddrs []string) string {\n\trand.Seed(time.Now().UnixNano())\n\treturn nsqTCPAddrs[rand.Intn(len(nsqTCPAddrs))]\n}\n\n// HeartBeat\nfunc HeartBeat() {\n\tvar (\n\t\tproducer *nsq.Producer\n\t\terr      error\n\t\tticker   *time.Ticker\n\t)\n\tticker = time.NewTicker(time.Duration(Conf.HEART_BEAT_TIME) * time.Second) //创建一个定时器，这里的时间我都写到配置文件里了，然后用conf包拿出来。我这里是设置的5秒\n\tfor {\n\t\tselect {\n\t\tcase <-ticker.C:\n\t\t\t//创建一个生产者，这里的RanDomGetServer()是自定义的一个工具，用来随机获取一个nsqd地址\n\t\t\tif producer, err = nsq.NewProducer(RadomGetNsqd(Conf.NSQ_TCP_ADDRS), nsq.NewConfig()); err != nil {\n\t\t\t\tpanic(err)\n\t\t\t}\n\t\t\t//pulish()接的第一个参数是topic，这个也是自己定义(值为data_server_addr），第二个参数是要发送的消息，这里是本机服务器地址\n\t\t\terr = producer.Publish(Conf.DATA_SERVER_TOPIC, []byte(Conf.SERVER_ADDR))\n\t\t\tif err != nil {\n\t\t\t\tpanic(err)\n\t\t\t}\n\t\t}\n\t}\n}\n```\n##### apiserver.go\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"net/http\"\n\t\"nsq_client/config\"\n\t\"sync\"\n\t\"time\"\n\n\t\"github.com/nsqio/go-nsq\"\n)\n\n//创建一个nsq.handler接口实例\nvar ServerConsumerHandler = &ServerConsumer{DataServerAddrs: make(map[string]time.Time)}\n\n//ServerConsumer实现了nsq.handler接口\ntype ServerConsumer struct {\n\tDataServerAddrs map[string]time.Time //保存dataServer进程发过来的服务器地址和接收时间\n\trwLocker        sync.RWMutex         //防止多线程同时读写\n}\n\n//这里第一个参数是需要绑定topic(data_server_addr),\n//第二个参数传入一个string，这就是创建的ch，topic消息队列中的消息会分发到每个ch中.\n//每个消费者可以创建不通的ch，也可以共用一个ch，共用一个ch, ch的消息会随机发送给其中一个消费者\n//第三个参数是处理message的nsq.handler接口，需要实现一个HanddleMessage(*nsq.Message)error()方法。\nfunc NewConsumer(topic string, chanName string, h nsq.Handler) (consumer *nsq.Consumer, err error) {\n\tif consumer, err = nsq.NewConsumer(topic, chanName, nsq.NewConfig()); err != nil {\n\t\treturn nil, err\n\t}\n\tconsumer.ChangeMaxInFlight(3) //可以根据nsqds数量来配置\n\tconsumer.AddHandler(h)\n\terr = consumer.ConnectToNSQLookupd(Conf.NSQ_LOOKUPD_ADDR) //todo:读取配置地址\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treturn consumer, nil\n}\n\n//HandleMessage是nsq,handler接口定义方法，必须实现，主要是用来处理传递过来的消息\nfunc (h *ServerConsumer) HandleMessage(message *nsq.Message) error {\n\tif dataServer := string(message.Body); dataServer != \"\" {\n\t\th.rwLocker.Lock()\n\t\th.DataServerAddrs[dataServer] = time.Now()\n\t\th.rwLocker.Unlock()\n\t}\n\treturn nil\n}\n\n//监听服务data_server_addr这个消息队列\nfunc MonitorDataServerAddrs() {\n\tconsumer, err := NewConsumer(\"data_server_addr\", \"ch1\", ServerConsumerHandler)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\t//连接到NSQLookupd，它底层会创建连接到每个nsqd.这样就可以监听每个nsqd中的消息\n\terr = consumer.ConnectToNSQLookupd(Conf.NSQ_LOOKUPD_ADDR) //方法本身会开一个goroutine来检查消息队列\n\tif err != nil {\n\t\tpanic(err)\n\t}\n}\n\n//删除过期的服务器地址\nfunc (h *ServerConsumer) removeExpireDatasServers() {\n\tfor {\n\t\th.rwLocker.Lock()\n\t\tfor dataServer, t := range h.DataServerAddrs {\n\t\t\t//只保存10秒之内发送过来的服务器地址\n\t\t\tif t.Add(10 * time.Second).Before(time.Now()) {\n\t\t\t\tdelete(h.DataServerAddrs, dataServer)\n\t\t\t}\n\t\t}\n\t\th.rwLocker.Unlock()\n\t\ttime.Sleep(2 * time.Second)\n\t}\n}\n\nvar Conf *config.Cfgparams\n\nfunc main() {\n\n\tConf = config.GetConfig()\n\tfmt.Println(Conf)\n\n\tserver := http.Server{\n\t\tAddr: \"127.0.0.1:9000\",\n\t}\n\tMonitorDataServerAddrs() //不用单独开goroutine\n\tif err := server.ListenAndServe(); err != nil {\n\t\tpanic(err)\n\t}\n}\n```\n##### config.go\n```go\npackage config\n\nimport (\n\t\"fmt\"\n\n\t\"github.com/fsnotify/fsnotify\"\n\t\"github.com/spf13/viper\"\n)\n\ntype Cfgparams struct {\n\tHEART_BEAT_TIME   int\n\tSERVER_ADDR       string\n\tNSQ_LOOKUPD_ADDR  string\n\tNSQ_TCP_ADDRS     []string\n\tDATA_SERVER_TOPIC string\n}\n\ntype Config struct {\n\tName string\n}\n\nfunc Init(cfg string) error {\n\tc := Config{\n\t\tName: cfg,\n\t}\n\t// 初始化配置文件\n\tif err := c.initConfig(); err != nil {\n\t\treturn err\n\t}\n\n\tc.watchConfig()\n\n\treturn nil\n}\n\nfunc (c *Config) initConfig() error {\n\tif c.Name != \"\" {\n\t\t// 如果指定了配置文件，则解析指定的配置文件\n\t\tviper.SetConfigFile(c.Name)\n\t} else {\n\t\t// 如果没有指定配置文件，则解析默认的配置文件\n\t\tviper.AddConfigPath(\"conf\")\n\t\tviper.SetConfigName(\"config\")\n\t}\n\t// 设置配置文件格式为YAML\n\tviper.SetConfigType(\"yaml\")\n\t// viper解析配置文件\n\tif err := viper.ReadInConfig(); err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}\n\n// 监听配置文件是否改变,用于热更新\nfunc (c *Config) watchConfig() {\n\tviper.WatchConfig()\n\tviper.OnConfigChange(func(e fsnotify.Event) {\n\t\tfmt.Printf(\"Config file changed: %s\\n\", e.Name)\n\t})\n}\n\n// 获取到配置文件\nfunc GetConfig() *Cfgparams {\n\tif err := Init(\"./conf/config.yaml\"); err != nil {\n\t\tpanic(err)\n\t}\n\tc := &Cfgparams{}\n\t// name := viper.GetString(\"name\")\n\tc.HEART_BEAT_TIME = viper.GetInt(\"common.heart_beat_time\")\n\tc.SERVER_ADDR = viper.GetString(\"common.server_addr\")\n\tc.DATA_SERVER_TOPIC = viper.GetString(\"common.server_topic\")\n\taddr := viper.GetString(\"common.nsqlookupd.addr\")\n\tport := viper.GetString(\"common.nsqlookupd.http_port\")\n\tc.NSQ_LOOKUPD_ADDR = addr + \":\" + port\n\tx := viper.Get(\"common.nsqd\")\n\t// c.NSQ_TCP_ADDRS = viper.Get(\"common.nsqd\").([]string)\n\tvar y []string\n\tfor _, v := range x.([]interface{}) {\n\t\ty = append(y, v.(string))\n\t}\n\tc.NSQ_TCP_ADDRS = y\n\t// fmt.Println(c)\n\treturn c\n\n}\n```\n##### config.yaml\n```yaml\nname:   nsq\ncommon:\n    heart_beat_time: 5\n    nsqlookupd:\n        name:   s1\n        addr:   10.8.0.4\n        tcp_port:   4160\n        http_port:  4161\n    nsqadmin:\n        name:   s1\n        addr:   10.8.0.4\n        port:   4171\n    nsqd:\n    - 10.8.0.4:4150\n    - 10.8.0.5:4150\n    - 10.8.0.6:4150\n    - 10.8.0.7:4150\n    server_topic:   \"data_server_addr\"\n    server_addr:   \"127.0.0.1:10001\"\n```","slug":"LXC容器搭建NSQ集群三","published":1,"category":"GOLANG","date":"2023-06-08T23:03:56.093Z","updated":"2023-06-08T23:12:13.671Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5sdy000adxjcfmr99v38","content":"<h3 id=\"LXC-容器搭建nsq集群\"><a href=\"#LXC-容器搭建nsq集群\" class=\"headerlink\" title=\"LXC 容器搭建nsq集群\"></a>LXC 容器搭建nsq集群</h3><ul>\n<li><a href=\"http://ddrv.cn/a/291527\">原文链接</a></li>\n</ul>\n<h4 id=\"使用场景\"><a href=\"#使用场景\" class=\"headerlink\" title=\"使用场景\"></a>使用场景</h4><p>有两个服务中心，apiserver处理用户的请求，dataserver处理数据，dataserver 有很多个，并且遵循raft高可用协议，写在配置文件中，当用户发起一个请求到apiserver,apiserver会向dataserver中的任意一个请求，这样做的好处是当dataserver中任意一个挂掉，apiserver只需获取当前配置文件中可用的地址即可，存活的dataserver会返回地址。  </p>\n<h4 id=\"NSQ当中的用处：\"><a href=\"#NSQ当中的用处：\" class=\"headerlink\" title=\"NSQ当中的用处：\"></a>NSQ当中的用处：</h4><ul>\n<li>每一个dataserver 以生产者的角色，连接nsqd，同时每隔几秒发送topic消息心跳检测，（可以有多个channel，nsq 保证消息投递一次以上，随机挑选channel发送消息，无序性）保证nsqlookupd 知道有哪些nsqd对应的生产者存活。  </li>\n<li>apiserver充当消费者的角色，连接nsqlookupd 4161 http端口，监听topic消息以及channel1，当有消息publish，即通知apiserver,本文即所有存活的dataserver的地址，apiserver 可随机挑选任意一个dataserver进行调用。</li>\n</ul>\n<h4 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h4><h5 id=\"dataserver-go\"><a href=\"#dataserver-go\" class=\"headerlink\" title=\"dataserver.go\"></a>dataserver.go</h5><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;math/rand&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net/http&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;nsq_client/config&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/nsqio/go-nsq&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Conf *</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Conf *config.Cfgparams</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tConf = config.GetConfig()</span><br><span class=\"line\">\t<span class=\"comment\">// randomAddr := RadomGetNsqd(Conf.NSQ_TCP_ADDRS)</span></span><br><span class=\"line\">\tfmt.Println(Conf)</span><br><span class=\"line\">\t<span class=\"comment\">// name := viper.GetString(&quot;name&quot;)</span></span><br><span class=\"line\">\t<span class=\"comment\">// x := viper.Get(&quot;common.nsqd&quot;)</span></span><br><span class=\"line\">\t<span class=\"comment\">// fmt.Println(x, reflect.TypeOf(x))</span></span><br><span class=\"line\"></span><br><span class=\"line\">\tserver := http.Server&#123;</span><br><span class=\"line\">\t\tAddr: Conf.SERVER_ADDR,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> HeartBeat() <span class=\"comment\">//这里开goroutine来发送心跳包</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err := server.ListenAndServe(); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// fmt.Println(&quot;Viper get name:&quot;, name)</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// RadomGetNsqd</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">RadomGetNsqd</span><span class=\"params\">(nsqTCPAddrs []<span class=\"type\">string</span>)</span></span> <span class=\"type\">string</span> &#123;</span><br><span class=\"line\">\trand.Seed(time.Now().UnixNano())</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> nsqTCPAddrs[rand.Intn(<span class=\"built_in\">len</span>(nsqTCPAddrs))]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// HeartBeat</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">HeartBeat</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> (</span><br><span class=\"line\">\t\tproducer *nsq.Producer</span><br><span class=\"line\">\t\terr      <span class=\"type\">error</span></span><br><span class=\"line\">\t\tticker   *time.Ticker</span><br><span class=\"line\">\t)</span><br><span class=\"line\">\tticker = time.NewTicker(time.Duration(Conf.HEART_BEAT_TIME) * time.Second) <span class=\"comment\">//创建一个定时器，这里的时间我都写到配置文件里了，然后用conf包拿出来。我这里是设置的5秒</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> &lt;-ticker.C:</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//创建一个生产者，这里的RanDomGetServer()是自定义的一个工具，用来随机获取一个nsqd地址</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> producer, err = nsq.NewProducer(RadomGetNsqd(Conf.NSQ_TCP_ADDRS), nsq.NewConfig()); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//pulish()接的第一个参数是topic，这个也是自己定义(值为data_server_addr），第二个参数是要发送的消息，这里是本机服务器地址</span></span><br><span class=\"line\">\t\t\terr = producer.Publish(Conf.DATA_SERVER_TOPIC, []<span class=\"type\">byte</span>(Conf.SERVER_ADDR))</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"apiserver-go\"><a href=\"#apiserver-go\" class=\"headerlink\" title=\"apiserver.go\"></a>apiserver.go</h5><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net/http&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;nsq_client/config&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;sync&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/nsqio/go-nsq&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//创建一个nsq.handler接口实例</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> ServerConsumerHandler = &amp;ServerConsumer&#123;DataServerAddrs: <span class=\"built_in\">make</span>(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]time.Time)&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//ServerConsumer实现了nsq.handler接口</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> ServerConsumer <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tDataServerAddrs <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]time.Time <span class=\"comment\">//保存dataServer进程发过来的服务器地址和接收时间</span></span><br><span class=\"line\">\trwLocker        sync.RWMutex         <span class=\"comment\">//防止多线程同时读写</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//这里第一个参数是需要绑定topic(data_server_addr),</span></span><br><span class=\"line\"><span class=\"comment\">//第二个参数传入一个string，这就是创建的ch，topic消息队列中的消息会分发到每个ch中.</span></span><br><span class=\"line\"><span class=\"comment\">//每个消费者可以创建不通的ch，也可以共用一个ch，共用一个ch, ch的消息会随机发送给其中一个消费者</span></span><br><span class=\"line\"><span class=\"comment\">//第三个参数是处理message的nsq.handler接口，需要实现一个HanddleMessage(*nsq.Message)error()方法。</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewConsumer</span><span class=\"params\">(topic <span class=\"type\">string</span>, chanName <span class=\"type\">string</span>, h nsq.Handler)</span></span> (consumer *nsq.Consumer, err <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> consumer, err = nsq.NewConsumer(topic, chanName, nsq.NewConfig()); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tconsumer.ChangeMaxInFlight(<span class=\"number\">3</span>) <span class=\"comment\">//可以根据nsqds数量来配置</span></span><br><span class=\"line\">\tconsumer.AddHandler(h)</span><br><span class=\"line\">\terr = consumer.ConnectToNSQLookupd(Conf.NSQ_LOOKUPD_ADDR) <span class=\"comment\">//todo:读取配置地址</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> consumer, <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//HandleMessage是nsq,handler接口定义方法，必须实现，主要是用来处理传递过来的消息</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(h *ServerConsumer)</span></span> HandleMessage(message *nsq.Message) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> dataServer := <span class=\"type\">string</span>(message.Body); dataServer != <span class=\"string\">&quot;&quot;</span> &#123;</span><br><span class=\"line\">\t\th.rwLocker.Lock()</span><br><span class=\"line\">\t\th.DataServerAddrs[dataServer] = time.Now()</span><br><span class=\"line\">\t\th.rwLocker.Unlock()</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//监听服务data_server_addr这个消息队列</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">MonitorDataServerAddrs</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tconsumer, err := NewConsumer(<span class=\"string\">&quot;data_server_addr&quot;</span>, <span class=\"string\">&quot;ch1&quot;</span>, ServerConsumerHandler)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">//连接到NSQLookupd，它底层会创建连接到每个nsqd.这样就可以监听每个nsqd中的消息</span></span><br><span class=\"line\">\terr = consumer.ConnectToNSQLookupd(Conf.NSQ_LOOKUPD_ADDR) <span class=\"comment\">//方法本身会开一个goroutine来检查消息队列</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//删除过期的服务器地址</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(h *ServerConsumer)</span></span> removeExpireDatasServers() &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">\t\th.rwLocker.Lock()</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> dataServer, t := <span class=\"keyword\">range</span> h.DataServerAddrs &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//只保存10秒之内发送过来的服务器地址</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> t.Add(<span class=\"number\">10</span> * time.Second).Before(time.Now()) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">delete</span>(h.DataServerAddrs, dataServer)</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\th.rwLocker.Unlock()</span><br><span class=\"line\">\t\ttime.Sleep(<span class=\"number\">2</span> * time.Second)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> Conf *config.Cfgparams</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tConf = config.GetConfig()</span><br><span class=\"line\">\tfmt.Println(Conf)</span><br><span class=\"line\"></span><br><span class=\"line\">\tserver := http.Server&#123;</span><br><span class=\"line\">\t\tAddr: <span class=\"string\">&quot;127.0.0.1:9000&quot;</span>,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tMonitorDataServerAddrs() <span class=\"comment\">//不用单独开goroutine</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err := server.ListenAndServe(); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"config-go\"><a href=\"#config-go\" class=\"headerlink\" title=\"config.go\"></a>config.go</h5><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> config</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/fsnotify/fsnotify&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/spf13/viper&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Cfgparams <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tHEART_BEAT_TIME   <span class=\"type\">int</span></span><br><span class=\"line\">\tSERVER_ADDR       <span class=\"type\">string</span></span><br><span class=\"line\">\tNSQ_LOOKUPD_ADDR  <span class=\"type\">string</span></span><br><span class=\"line\">\tNSQ_TCP_ADDRS     []<span class=\"type\">string</span></span><br><span class=\"line\">\tDATA_SERVER_TOPIC <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Config <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tName <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Init</span><span class=\"params\">(cfg <span class=\"type\">string</span>)</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\tc := Config&#123;</span><br><span class=\"line\">\t\tName: cfg,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">// 初始化配置文件</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err := c.initConfig(); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tc.watchConfig()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(c *Config)</span></span> initConfig() <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> c.Name != <span class=\"string\">&quot;&quot;</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 如果指定了配置文件，则解析指定的配置文件</span></span><br><span class=\"line\">\t\tviper.SetConfigFile(c.Name)</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 如果没有指定配置文件，则解析默认的配置文件</span></span><br><span class=\"line\">\t\tviper.AddConfigPath(<span class=\"string\">&quot;conf&quot;</span>)</span><br><span class=\"line\">\t\tviper.SetConfigName(<span class=\"string\">&quot;config&quot;</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">// 设置配置文件格式为YAML</span></span><br><span class=\"line\">\tviper.SetConfigType(<span class=\"string\">&quot;yaml&quot;</span>)</span><br><span class=\"line\">\t<span class=\"comment\">// viper解析配置文件</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err := viper.ReadInConfig(); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 监听配置文件是否改变,用于热更新</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(c *Config)</span></span> watchConfig() &#123;</span><br><span class=\"line\">\tviper.WatchConfig()</span><br><span class=\"line\">\tviper.OnConfigChange(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(e fsnotify.Event)</span></span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;Config file changed: %s\\n&quot;</span>, e.Name)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 获取到配置文件</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">GetConfig</span><span class=\"params\">()</span></span> *Cfgparams &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err := Init(<span class=\"string\">&quot;./conf/config.yaml&quot;</span>); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tc := &amp;Cfgparams&#123;&#125;</span><br><span class=\"line\">\t<span class=\"comment\">// name := viper.GetString(&quot;name&quot;)</span></span><br><span class=\"line\">\tc.HEART_BEAT_TIME = viper.GetInt(<span class=\"string\">&quot;common.heart_beat_time&quot;</span>)</span><br><span class=\"line\">\tc.SERVER_ADDR = viper.GetString(<span class=\"string\">&quot;common.server_addr&quot;</span>)</span><br><span class=\"line\">\tc.DATA_SERVER_TOPIC = viper.GetString(<span class=\"string\">&quot;common.server_topic&quot;</span>)</span><br><span class=\"line\">\taddr := viper.GetString(<span class=\"string\">&quot;common.nsqlookupd.addr&quot;</span>)</span><br><span class=\"line\">\tport := viper.GetString(<span class=\"string\">&quot;common.nsqlookupd.http_port&quot;</span>)</span><br><span class=\"line\">\tc.NSQ_LOOKUPD_ADDR = addr + <span class=\"string\">&quot;:&quot;</span> + port</span><br><span class=\"line\">\tx := viper.Get(<span class=\"string\">&quot;common.nsqd&quot;</span>)</span><br><span class=\"line\">\t<span class=\"comment\">// c.NSQ_TCP_ADDRS = viper.Get(&quot;common.nsqd&quot;).([]string)</span></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> y []<span class=\"type\">string</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> _, v := <span class=\"keyword\">range</span> x.([]<span class=\"keyword\">interface</span>&#123;&#125;) &#123;</span><br><span class=\"line\">\t\ty = <span class=\"built_in\">append</span>(y, v.(<span class=\"type\">string</span>))</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tc.NSQ_TCP_ADDRS = y</span><br><span class=\"line\">\t<span class=\"comment\">// fmt.Println(c)</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> c</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"config-yaml\"><a href=\"#config-yaml\" class=\"headerlink\" title=\"config.yaml\"></a>config.yaml</h5><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">name:</span>   <span class=\"string\">nsq</span></span><br><span class=\"line\"><span class=\"attr\">common:</span></span><br><span class=\"line\">    <span class=\"attr\">heart_beat_time:</span> <span class=\"number\">5</span></span><br><span class=\"line\">    <span class=\"attr\">nsqlookupd:</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span>   <span class=\"string\">s1</span></span><br><span class=\"line\">        <span class=\"attr\">addr:</span>   <span class=\"number\">10.8</span><span class=\"number\">.0</span><span class=\"number\">.4</span></span><br><span class=\"line\">        <span class=\"attr\">tcp_port:</span>   <span class=\"number\">4160</span></span><br><span class=\"line\">        <span class=\"attr\">http_port:</span>  <span class=\"number\">4161</span></span><br><span class=\"line\">    <span class=\"attr\">nsqadmin:</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span>   <span class=\"string\">s1</span></span><br><span class=\"line\">        <span class=\"attr\">addr:</span>   <span class=\"number\">10.8</span><span class=\"number\">.0</span><span class=\"number\">.4</span></span><br><span class=\"line\">        <span class=\"attr\">port:</span>   <span class=\"number\">4171</span></span><br><span class=\"line\">    <span class=\"attr\">nsqd:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"number\">10.8</span><span class=\"number\">.0</span><span class=\"number\">.4</span><span class=\"string\">:4150</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"number\">10.8</span><span class=\"number\">.0</span><span class=\"number\">.5</span><span class=\"string\">:4150</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"number\">10.8</span><span class=\"number\">.0</span><span class=\"number\">.6</span><span class=\"string\">:4150</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"number\">10.8</span><span class=\"number\">.0</span><span class=\"number\">.7</span><span class=\"string\">:4150</span></span><br><span class=\"line\">    <span class=\"attr\">server_topic:</span>   <span class=\"string\">&quot;data_server_addr&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">server_addr:</span>   <span class=\"string\">&quot;127.0.0.1:10001&quot;</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"length":6630,"excerpt":"","more":"<h3 id=\"LXC-容器搭建nsq集群\"><a href=\"#LXC-容器搭建nsq集群\" class=\"headerlink\" title=\"LXC 容器搭建nsq集群\"></a>LXC 容器搭建nsq集群</h3><ul>\n<li><a href=\"http://ddrv.cn/a/291527\">原文链接</a></li>\n</ul>\n<h4 id=\"使用场景\"><a href=\"#使用场景\" class=\"headerlink\" title=\"使用场景\"></a>使用场景</h4><p>有两个服务中心，apiserver处理用户的请求，dataserver处理数据，dataserver 有很多个，并且遵循raft高可用协议，写在配置文件中，当用户发起一个请求到apiserver,apiserver会向dataserver中的任意一个请求，这样做的好处是当dataserver中任意一个挂掉，apiserver只需获取当前配置文件中可用的地址即可，存活的dataserver会返回地址。  </p>\n<h4 id=\"NSQ当中的用处：\"><a href=\"#NSQ当中的用处：\" class=\"headerlink\" title=\"NSQ当中的用处：\"></a>NSQ当中的用处：</h4><ul>\n<li>每一个dataserver 以生产者的角色，连接nsqd，同时每隔几秒发送topic消息心跳检测，（可以有多个channel，nsq 保证消息投递一次以上，随机挑选channel发送消息，无序性）保证nsqlookupd 知道有哪些nsqd对应的生产者存活。  </li>\n<li>apiserver充当消费者的角色，连接nsqlookupd 4161 http端口，监听topic消息以及channel1，当有消息publish，即通知apiserver,本文即所有存活的dataserver的地址，apiserver 可随机挑选任意一个dataserver进行调用。</li>\n</ul>\n<h4 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h4><h5 id=\"dataserver-go\"><a href=\"#dataserver-go\" class=\"headerlink\" title=\"dataserver.go\"></a>dataserver.go</h5><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;math/rand&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net/http&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;nsq_client/config&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/nsqio/go-nsq&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Conf *</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Conf *config.Cfgparams</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tConf = config.GetConfig()</span><br><span class=\"line\">\t<span class=\"comment\">// randomAddr := RadomGetNsqd(Conf.NSQ_TCP_ADDRS)</span></span><br><span class=\"line\">\tfmt.Println(Conf)</span><br><span class=\"line\">\t<span class=\"comment\">// name := viper.GetString(&quot;name&quot;)</span></span><br><span class=\"line\">\t<span class=\"comment\">// x := viper.Get(&quot;common.nsqd&quot;)</span></span><br><span class=\"line\">\t<span class=\"comment\">// fmt.Println(x, reflect.TypeOf(x))</span></span><br><span class=\"line\"></span><br><span class=\"line\">\tserver := http.Server&#123;</span><br><span class=\"line\">\t\tAddr: Conf.SERVER_ADDR,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> HeartBeat() <span class=\"comment\">//这里开goroutine来发送心跳包</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err := server.ListenAndServe(); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// fmt.Println(&quot;Viper get name:&quot;, name)</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// RadomGetNsqd</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">RadomGetNsqd</span><span class=\"params\">(nsqTCPAddrs []<span class=\"type\">string</span>)</span></span> <span class=\"type\">string</span> &#123;</span><br><span class=\"line\">\trand.Seed(time.Now().UnixNano())</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> nsqTCPAddrs[rand.Intn(<span class=\"built_in\">len</span>(nsqTCPAddrs))]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// HeartBeat</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">HeartBeat</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> (</span><br><span class=\"line\">\t\tproducer *nsq.Producer</span><br><span class=\"line\">\t\terr      <span class=\"type\">error</span></span><br><span class=\"line\">\t\tticker   *time.Ticker</span><br><span class=\"line\">\t)</span><br><span class=\"line\">\tticker = time.NewTicker(time.Duration(Conf.HEART_BEAT_TIME) * time.Second) <span class=\"comment\">//创建一个定时器，这里的时间我都写到配置文件里了，然后用conf包拿出来。我这里是设置的5秒</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> &lt;-ticker.C:</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//创建一个生产者，这里的RanDomGetServer()是自定义的一个工具，用来随机获取一个nsqd地址</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> producer, err = nsq.NewProducer(RadomGetNsqd(Conf.NSQ_TCP_ADDRS), nsq.NewConfig()); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//pulish()接的第一个参数是topic，这个也是自己定义(值为data_server_addr），第二个参数是要发送的消息，这里是本机服务器地址</span></span><br><span class=\"line\">\t\t\terr = producer.Publish(Conf.DATA_SERVER_TOPIC, []<span class=\"type\">byte</span>(Conf.SERVER_ADDR))</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"apiserver-go\"><a href=\"#apiserver-go\" class=\"headerlink\" title=\"apiserver.go\"></a>apiserver.go</h5><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net/http&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;nsq_client/config&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;sync&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/nsqio/go-nsq&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//创建一个nsq.handler接口实例</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> ServerConsumerHandler = &amp;ServerConsumer&#123;DataServerAddrs: <span class=\"built_in\">make</span>(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]time.Time)&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//ServerConsumer实现了nsq.handler接口</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> ServerConsumer <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tDataServerAddrs <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]time.Time <span class=\"comment\">//保存dataServer进程发过来的服务器地址和接收时间</span></span><br><span class=\"line\">\trwLocker        sync.RWMutex         <span class=\"comment\">//防止多线程同时读写</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//这里第一个参数是需要绑定topic(data_server_addr),</span></span><br><span class=\"line\"><span class=\"comment\">//第二个参数传入一个string，这就是创建的ch，topic消息队列中的消息会分发到每个ch中.</span></span><br><span class=\"line\"><span class=\"comment\">//每个消费者可以创建不通的ch，也可以共用一个ch，共用一个ch, ch的消息会随机发送给其中一个消费者</span></span><br><span class=\"line\"><span class=\"comment\">//第三个参数是处理message的nsq.handler接口，需要实现一个HanddleMessage(*nsq.Message)error()方法。</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewConsumer</span><span class=\"params\">(topic <span class=\"type\">string</span>, chanName <span class=\"type\">string</span>, h nsq.Handler)</span></span> (consumer *nsq.Consumer, err <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> consumer, err = nsq.NewConsumer(topic, chanName, nsq.NewConfig()); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tconsumer.ChangeMaxInFlight(<span class=\"number\">3</span>) <span class=\"comment\">//可以根据nsqds数量来配置</span></span><br><span class=\"line\">\tconsumer.AddHandler(h)</span><br><span class=\"line\">\terr = consumer.ConnectToNSQLookupd(Conf.NSQ_LOOKUPD_ADDR) <span class=\"comment\">//todo:读取配置地址</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> consumer, <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//HandleMessage是nsq,handler接口定义方法，必须实现，主要是用来处理传递过来的消息</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(h *ServerConsumer)</span></span> HandleMessage(message *nsq.Message) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> dataServer := <span class=\"type\">string</span>(message.Body); dataServer != <span class=\"string\">&quot;&quot;</span> &#123;</span><br><span class=\"line\">\t\th.rwLocker.Lock()</span><br><span class=\"line\">\t\th.DataServerAddrs[dataServer] = time.Now()</span><br><span class=\"line\">\t\th.rwLocker.Unlock()</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//监听服务data_server_addr这个消息队列</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">MonitorDataServerAddrs</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tconsumer, err := NewConsumer(<span class=\"string\">&quot;data_server_addr&quot;</span>, <span class=\"string\">&quot;ch1&quot;</span>, ServerConsumerHandler)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">//连接到NSQLookupd，它底层会创建连接到每个nsqd.这样就可以监听每个nsqd中的消息</span></span><br><span class=\"line\">\terr = consumer.ConnectToNSQLookupd(Conf.NSQ_LOOKUPD_ADDR) <span class=\"comment\">//方法本身会开一个goroutine来检查消息队列</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//删除过期的服务器地址</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(h *ServerConsumer)</span></span> removeExpireDatasServers() &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">\t\th.rwLocker.Lock()</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> dataServer, t := <span class=\"keyword\">range</span> h.DataServerAddrs &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//只保存10秒之内发送过来的服务器地址</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> t.Add(<span class=\"number\">10</span> * time.Second).Before(time.Now()) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">delete</span>(h.DataServerAddrs, dataServer)</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\th.rwLocker.Unlock()</span><br><span class=\"line\">\t\ttime.Sleep(<span class=\"number\">2</span> * time.Second)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> Conf *config.Cfgparams</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tConf = config.GetConfig()</span><br><span class=\"line\">\tfmt.Println(Conf)</span><br><span class=\"line\"></span><br><span class=\"line\">\tserver := http.Server&#123;</span><br><span class=\"line\">\t\tAddr: <span class=\"string\">&quot;127.0.0.1:9000&quot;</span>,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tMonitorDataServerAddrs() <span class=\"comment\">//不用单独开goroutine</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err := server.ListenAndServe(); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"config-go\"><a href=\"#config-go\" class=\"headerlink\" title=\"config.go\"></a>config.go</h5><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> config</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/fsnotify/fsnotify&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/spf13/viper&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Cfgparams <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tHEART_BEAT_TIME   <span class=\"type\">int</span></span><br><span class=\"line\">\tSERVER_ADDR       <span class=\"type\">string</span></span><br><span class=\"line\">\tNSQ_LOOKUPD_ADDR  <span class=\"type\">string</span></span><br><span class=\"line\">\tNSQ_TCP_ADDRS     []<span class=\"type\">string</span></span><br><span class=\"line\">\tDATA_SERVER_TOPIC <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Config <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tName <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Init</span><span class=\"params\">(cfg <span class=\"type\">string</span>)</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\tc := Config&#123;</span><br><span class=\"line\">\t\tName: cfg,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">// 初始化配置文件</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err := c.initConfig(); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tc.watchConfig()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(c *Config)</span></span> initConfig() <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> c.Name != <span class=\"string\">&quot;&quot;</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 如果指定了配置文件，则解析指定的配置文件</span></span><br><span class=\"line\">\t\tviper.SetConfigFile(c.Name)</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 如果没有指定配置文件，则解析默认的配置文件</span></span><br><span class=\"line\">\t\tviper.AddConfigPath(<span class=\"string\">&quot;conf&quot;</span>)</span><br><span class=\"line\">\t\tviper.SetConfigName(<span class=\"string\">&quot;config&quot;</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">// 设置配置文件格式为YAML</span></span><br><span class=\"line\">\tviper.SetConfigType(<span class=\"string\">&quot;yaml&quot;</span>)</span><br><span class=\"line\">\t<span class=\"comment\">// viper解析配置文件</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err := viper.ReadInConfig(); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 监听配置文件是否改变,用于热更新</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(c *Config)</span></span> watchConfig() &#123;</span><br><span class=\"line\">\tviper.WatchConfig()</span><br><span class=\"line\">\tviper.OnConfigChange(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(e fsnotify.Event)</span></span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;Config file changed: %s\\n&quot;</span>, e.Name)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 获取到配置文件</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">GetConfig</span><span class=\"params\">()</span></span> *Cfgparams &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err := Init(<span class=\"string\">&quot;./conf/config.yaml&quot;</span>); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tc := &amp;Cfgparams&#123;&#125;</span><br><span class=\"line\">\t<span class=\"comment\">// name := viper.GetString(&quot;name&quot;)</span></span><br><span class=\"line\">\tc.HEART_BEAT_TIME = viper.GetInt(<span class=\"string\">&quot;common.heart_beat_time&quot;</span>)</span><br><span class=\"line\">\tc.SERVER_ADDR = viper.GetString(<span class=\"string\">&quot;common.server_addr&quot;</span>)</span><br><span class=\"line\">\tc.DATA_SERVER_TOPIC = viper.GetString(<span class=\"string\">&quot;common.server_topic&quot;</span>)</span><br><span class=\"line\">\taddr := viper.GetString(<span class=\"string\">&quot;common.nsqlookupd.addr&quot;</span>)</span><br><span class=\"line\">\tport := viper.GetString(<span class=\"string\">&quot;common.nsqlookupd.http_port&quot;</span>)</span><br><span class=\"line\">\tc.NSQ_LOOKUPD_ADDR = addr + <span class=\"string\">&quot;:&quot;</span> + port</span><br><span class=\"line\">\tx := viper.Get(<span class=\"string\">&quot;common.nsqd&quot;</span>)</span><br><span class=\"line\">\t<span class=\"comment\">// c.NSQ_TCP_ADDRS = viper.Get(&quot;common.nsqd&quot;).([]string)</span></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> y []<span class=\"type\">string</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> _, v := <span class=\"keyword\">range</span> x.([]<span class=\"keyword\">interface</span>&#123;&#125;) &#123;</span><br><span class=\"line\">\t\ty = <span class=\"built_in\">append</span>(y, v.(<span class=\"type\">string</span>))</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tc.NSQ_TCP_ADDRS = y</span><br><span class=\"line\">\t<span class=\"comment\">// fmt.Println(c)</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> c</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"config-yaml\"><a href=\"#config-yaml\" class=\"headerlink\" title=\"config.yaml\"></a>config.yaml</h5><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">name:</span>   <span class=\"string\">nsq</span></span><br><span class=\"line\"><span class=\"attr\">common:</span></span><br><span class=\"line\">    <span class=\"attr\">heart_beat_time:</span> <span class=\"number\">5</span></span><br><span class=\"line\">    <span class=\"attr\">nsqlookupd:</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span>   <span class=\"string\">s1</span></span><br><span class=\"line\">        <span class=\"attr\">addr:</span>   <span class=\"number\">10.8</span><span class=\"number\">.0</span><span class=\"number\">.4</span></span><br><span class=\"line\">        <span class=\"attr\">tcp_port:</span>   <span class=\"number\">4160</span></span><br><span class=\"line\">        <span class=\"attr\">http_port:</span>  <span class=\"number\">4161</span></span><br><span class=\"line\">    <span class=\"attr\">nsqadmin:</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span>   <span class=\"string\">s1</span></span><br><span class=\"line\">        <span class=\"attr\">addr:</span>   <span class=\"number\">10.8</span><span class=\"number\">.0</span><span class=\"number\">.4</span></span><br><span class=\"line\">        <span class=\"attr\">port:</span>   <span class=\"number\">4171</span></span><br><span class=\"line\">    <span class=\"attr\">nsqd:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"number\">10.8</span><span class=\"number\">.0</span><span class=\"number\">.4</span><span class=\"string\">:4150</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"number\">10.8</span><span class=\"number\">.0</span><span class=\"number\">.5</span><span class=\"string\">:4150</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"number\">10.8</span><span class=\"number\">.0</span><span class=\"number\">.6</span><span class=\"string\">:4150</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"number\">10.8</span><span class=\"number\">.0</span><span class=\"number\">.7</span><span class=\"string\">:4150</span></span><br><span class=\"line\">    <span class=\"attr\">server_topic:</span>   <span class=\"string\">&quot;data_server_addr&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">server_addr:</span>   <span class=\"string\">&quot;127.0.0.1:10001&quot;</span></span><br></pre></td></tr></table></figure>"},{"_content":"### LXC 容器搭建nsq集群\n- 阿里云服务器cpu飙到100，登不上去，好不容易登上去之后打开lxc容器内发现连不上网\n注意lxc的几个目录：/etc/default/lxc \n时间有限，暂时先贴这些\n##### ecs_restart_lxc_config.sh\n``` shell\n#! /bin/sh\n# See how we were called.\n#检查容器内网络是否通畅\nnetwork()\n{\n    \n    #超时时间\n    local timeout=1\n    lxcname=$(lxc list|awk ' NR>2 && $2!=\"\" && $2!=\"|\" {print $2}'|awk '{print $0}' | sed -n '$p')\n    #目标网站\n    local target=www.baidu.com\n\n    #获取响应状态码\n    local ret_code=`lxc exec $lxcname -- bash -c \"curl -I -s --connect-timeout ${timeout} ${target} -w %{http_code} | tail -n1\"`\n\n    if [ \"x$ret_code\" = \"x200\" ]; then\n        #网络畅通\n        return 1\n    else\n        #网络不畅通\n        return 0\n    fi\n\n    return 0\n}\n\n#awk 'BEGIN { FS=\":\";print \"统计销售金额\";total=0} {print NR;total=total+NR;} END {printf \"销售金额总计：%.2f\",total}' sx\nlastnr=$(lxc list|awk ' NR>2 && $2!=\"\" && $2!=\"|\" {print $2}'|awk '{print NR}' | sed -n '$p')\nif [ x\"$lastnr\" != x ];then\n    state=$1\n    case \"$state\" in\n        start)\n            echo \"start action is right\"\n        ;;\n\n        stop)\n            echo \"stop action is right\"\n        ;;\n\n        restart|reload|force-reload)\n            echo \"reload action is right\"\n        ;;\n\n        *)\n            echo \"Usage: $0 $lxcname {start|stop|restart|reload|force-reload}\"\n            exit 2\n    esac\n    # 检测网络是否正确\n    network\n    if [ $? -eq 0 ];then\n        echo\n        echo \"容器内网络不畅通，请检查网络设置！\"\n        echo\n        read -p \"是否启用 ? [y/N]: \" NET\n        if [ \"$NET\" = 'y' -o \"$NET\" = 'Y' ]; then\n            echo \"先关闭容器内部网络，可能存在dnsmasq正在运行\"\n            ./lxc_reconnect_internet.sh  stop\n            echo \"开启容器内部网络\"\n            ./lxc_reconnect_internet.sh  start\n        else\n            exit 1;\n        fi\n    else\n        echo\n        echo \"容器内网络非常畅通！\"\n        echo\n        read -p \"是否关闭 ? [y/N]: \" NETSTOP\n        if [ \"$NETSTOP\" = 'y' -o \"$NETSTOP\" = 'Y' ]; then\n            ./lxc_reconnect_internet.sh  stop\n        fi\n    fi\n    echo\n    echo \"检测过后容器内网络通畅\"\n    echo\n    exitnr=$((lastnr+1))\n    echo\n    echo \"哪一个容器你需要选择开启或关闭 openvpn和nsq?\"\n    echo\n    text=$(lxc list|awk ' NR>2 && $2!=\"\" && $2!=\"|\" {print $2}'|awk '{print NR \")\" $0}')\n    defaultlxcname=$(lxc list|awk ' NR>2 && $2!=\"\" && $2!=\"|\" {print $2}'|awk '{print $0}'|sed -n \"1p\")\n    echo \"0) 所有容器\"\n    # echo $text #只能在同一行\n    echo \"$text\"\n    echo \"$exitnr) Exit\"\n    read -p \"Select an option [0-$exitnr]: \" nr \n    # echo $nr\n    if [ $nr = $exitnr ];then\n        echo \"退出了\"\n        exit;\n    elif [ $nr = \"0\" ];then\n        for container in $(lxc list|awk ' NR>2 && $2!=\"\" && $2!=\"|\" {print $2}'|awk '{print $0}'); do\n            lxcname=$container\n            # echo $container\n            case \"$state\" in\n                start)\n                    ./lxc_restart.sh $lxcname $defaultlxcname\n                ;;\n\n                stop)\n                    ./lxc_stop_vpn_nsq.sh $lxcname\n                ;;\n\n                restart|reload|force-reload)\n                    ./lxc_stop_vpn_nsq.sh $lxcname\n                    ./lxc_restart.sh $lxcname $defaultlxcname\n                ;;\n\n                *)\n                    echo \"Usage: $0 $lxcname {start|stop|restart|reload|force-reload}\"\n                    exit 2\n            esac\n        done\n    else\n        # sed -n \"2p\" 查找第2行内\n        # echo $(lxc list|awk -F '|' ' NR%3==1 && $2!=\"\" && NR>2 {print $2}'|sed -n \"${nr}p\")\n        lxcname=$(lxc list|awk ' NR>2 && $2!=\"\" && $2!=\"|\" {print $2}'|awk '{print $0}'|sed -n \"${nr}p\")\n        echo $lxcname\n        case \"$state\" in\n            start)\n                ./lxc_restart.sh $lxcname $defaultlxcname\n            ;;\n\n            stop)\n                ./lxc_stop_vpn_nsq.sh $lxcname\n            ;;\n\n            restart|reload|force-reload)\n                ./lxc_stop_vpn_nsq.sh $lxcname\n                ./lxc_restart.sh $lxcname $defaultlxcname\n            ;;\n\n            *)\n                echo \"Usage: $0 {start|stop|restart|reload|force-reload} \"\n                exit 2\n        esac\n    fi\nfi\nexit $?\n\n```\n\n##### lxc_restart.sh\n```shell\n#!/bin/sh\n#./opevpn/lxc_reconnect_internet.sh\n#用作比较的nsq 只放一个主nsqlookupd server\nCONTAINERNAME=$2\n# CONTAINERNAME=\"s1\"\nNSQFOLDER=\"/root/nsq1.2\"\n# read -p \"请输入对应的lxc容器名称: \" lxcname\nlxcname=$1\n# echo $lxcname\nif [ -n \"$NSQ\" ]; then \n    echo \"容器$lxcname 不存在\"\n    exit 1;\nfi\nif [ ! -f \"/root/$lxcname.ovpn\" ]; then \n    echo \"$lxcname.ovpn 不存在,请用openinstall.sh 添加新用户\"\n    exit 1;\nfi\nOPENVPN=`lxc exec $lxcname pgrep openvpn`     \nif [ -n \"$OPENVPN\" ];then  \n    echo \"openvpn service is running\"\nelse\n    echo \"openvpn service is not running,ok then can do this\"\n    lxc file push /root/$lxcname.ovpn $lxcname/root/\n    lxc exec $lxcname  -- sh -c \"apt-get install -y openvpn\"\n    # lxc exec test -- nohup bash -c \"/root/test.sh &\"\n    # lxc exec $lxcname -- sh -c \"nohup openvpn --config /root/$lxcname.ovpn &\" #不生效\n    lxc exec $lxcname -- nohup bash -c \" openvpn --config /root/$lxcname.ovpn &\"\nfi\necho \"等待5s openvpn启动\"\nsleep 5\n\nlookupdip=`lxc exec ${CONTAINERNAME} ifconfig tun0 | grep \"inet addr:\" | awk '{print $2}' | cut -c 6-` \ncurrentip=`lxc exec ${lxcname} ifconfig tun0 | grep \"inet addr:\" | awk '{print $2}' | cut -c 6-` \necho\necho \"lookupdip openvpn ip is : $lookupdip\"\necho\necho \"current ip is : $currentip \"\necho \nNSQ=`lxc exec $lxcname pgrep nsq`       \nif [ -n \"$NSQ\" ]; then \n        echo \"nsq service is running\"\n        exit 1;\n    else\n        echo \"nsq service is not running,we can do this;\"\n        lxc file push /root/nsq-1.2.0.linux-amd64.go1.12.9.tar.gz $lxcname/root/\n        lxc exec $lxcname -- sh -c \"tar -zxvf /root/nsq-1.2.0.linux-amd64.go1.12.9.tar.gz\" \n        lxc exec $lxcname -- sh -c \"rm -rf ${NSQFOLDER}\"\n        lxc exec $lxcname -- sh -c \"mv /root/nsq-1.2.0.linux-amd64.go1.12.9 ${NSQFOLDER}\"\n        if [ $lxcname = ${CONTAINERNAME} ];then \n            echo \"xxxx\"\n            #lxc exec s1 -- nohup bash -c \"/root/nsq1.2/bin/nsqlookupd &\"\n            lxc exec $lxcname -- nohup bash -c \"/${NSQFOLDER}/bin/nsqlookupd &\"\n            lxc exec $lxcname -- nohup bash -c \"/${NSQFOLDER}/bin/nsqd --lookupd-tcp-address=127.0.0.1:4160  --broadcast-address=$currentip &\"\n            lxc exec $lxcname -- nohup bash -c \"/${NSQFOLDER}/bin/nsqadmin --lookupd-http-address=127.0.0.1:4161 &\"\n        else\n            lxc exec $lxcname -- nohup bash -c \"/${NSQFOLDER}/bin/nsqd --lookupd-tcp-address=$lookupdip:4160 --broadcast-address=$currentip &\"\n        fi\nfi\n```\n\n##### lxc_stop_vpn_nsq.sh\n``` shell\n#!/bin/sh\nstopfile=\"stop_vpn_nsq.sh\"\nlxcname=$1\n# read -p \"请输入对应的lxc容器名称: \" lxcname\necho $lxcname\nlxc file push /root/openvpn/$stopfile $lxcname/root/\nlxc exec $lxcname -- bash -c \"/root/$stopfile \"\n```","source":"_posts/GOLANG/LXC容器搭建NSQ集群一.md","raw":"---\ncategories:\n  - GOLANG\n---\n### LXC 容器搭建nsq集群\n- 阿里云服务器cpu飙到100，登不上去，好不容易登上去之后打开lxc容器内发现连不上网\n注意lxc的几个目录：/etc/default/lxc \n时间有限，暂时先贴这些\n##### ecs_restart_lxc_config.sh\n``` shell\n#! /bin/sh\n# See how we were called.\n#检查容器内网络是否通畅\nnetwork()\n{\n    \n    #超时时间\n    local timeout=1\n    lxcname=$(lxc list|awk ' NR>2 && $2!=\"\" && $2!=\"|\" {print $2}'|awk '{print $0}' | sed -n '$p')\n    #目标网站\n    local target=www.baidu.com\n\n    #获取响应状态码\n    local ret_code=`lxc exec $lxcname -- bash -c \"curl -I -s --connect-timeout ${timeout} ${target} -w %{http_code} | tail -n1\"`\n\n    if [ \"x$ret_code\" = \"x200\" ]; then\n        #网络畅通\n        return 1\n    else\n        #网络不畅通\n        return 0\n    fi\n\n    return 0\n}\n\n#awk 'BEGIN { FS=\":\";print \"统计销售金额\";total=0} {print NR;total=total+NR;} END {printf \"销售金额总计：%.2f\",total}' sx\nlastnr=$(lxc list|awk ' NR>2 && $2!=\"\" && $2!=\"|\" {print $2}'|awk '{print NR}' | sed -n '$p')\nif [ x\"$lastnr\" != x ];then\n    state=$1\n    case \"$state\" in\n        start)\n            echo \"start action is right\"\n        ;;\n\n        stop)\n            echo \"stop action is right\"\n        ;;\n\n        restart|reload|force-reload)\n            echo \"reload action is right\"\n        ;;\n\n        *)\n            echo \"Usage: $0 $lxcname {start|stop|restart|reload|force-reload}\"\n            exit 2\n    esac\n    # 检测网络是否正确\n    network\n    if [ $? -eq 0 ];then\n        echo\n        echo \"容器内网络不畅通，请检查网络设置！\"\n        echo\n        read -p \"是否启用 ? [y/N]: \" NET\n        if [ \"$NET\" = 'y' -o \"$NET\" = 'Y' ]; then\n            echo \"先关闭容器内部网络，可能存在dnsmasq正在运行\"\n            ./lxc_reconnect_internet.sh  stop\n            echo \"开启容器内部网络\"\n            ./lxc_reconnect_internet.sh  start\n        else\n            exit 1;\n        fi\n    else\n        echo\n        echo \"容器内网络非常畅通！\"\n        echo\n        read -p \"是否关闭 ? [y/N]: \" NETSTOP\n        if [ \"$NETSTOP\" = 'y' -o \"$NETSTOP\" = 'Y' ]; then\n            ./lxc_reconnect_internet.sh  stop\n        fi\n    fi\n    echo\n    echo \"检测过后容器内网络通畅\"\n    echo\n    exitnr=$((lastnr+1))\n    echo\n    echo \"哪一个容器你需要选择开启或关闭 openvpn和nsq?\"\n    echo\n    text=$(lxc list|awk ' NR>2 && $2!=\"\" && $2!=\"|\" {print $2}'|awk '{print NR \")\" $0}')\n    defaultlxcname=$(lxc list|awk ' NR>2 && $2!=\"\" && $2!=\"|\" {print $2}'|awk '{print $0}'|sed -n \"1p\")\n    echo \"0) 所有容器\"\n    # echo $text #只能在同一行\n    echo \"$text\"\n    echo \"$exitnr) Exit\"\n    read -p \"Select an option [0-$exitnr]: \" nr \n    # echo $nr\n    if [ $nr = $exitnr ];then\n        echo \"退出了\"\n        exit;\n    elif [ $nr = \"0\" ];then\n        for container in $(lxc list|awk ' NR>2 && $2!=\"\" && $2!=\"|\" {print $2}'|awk '{print $0}'); do\n            lxcname=$container\n            # echo $container\n            case \"$state\" in\n                start)\n                    ./lxc_restart.sh $lxcname $defaultlxcname\n                ;;\n\n                stop)\n                    ./lxc_stop_vpn_nsq.sh $lxcname\n                ;;\n\n                restart|reload|force-reload)\n                    ./lxc_stop_vpn_nsq.sh $lxcname\n                    ./lxc_restart.sh $lxcname $defaultlxcname\n                ;;\n\n                *)\n                    echo \"Usage: $0 $lxcname {start|stop|restart|reload|force-reload}\"\n                    exit 2\n            esac\n        done\n    else\n        # sed -n \"2p\" 查找第2行内\n        # echo $(lxc list|awk -F '|' ' NR%3==1 && $2!=\"\" && NR>2 {print $2}'|sed -n \"${nr}p\")\n        lxcname=$(lxc list|awk ' NR>2 && $2!=\"\" && $2!=\"|\" {print $2}'|awk '{print $0}'|sed -n \"${nr}p\")\n        echo $lxcname\n        case \"$state\" in\n            start)\n                ./lxc_restart.sh $lxcname $defaultlxcname\n            ;;\n\n            stop)\n                ./lxc_stop_vpn_nsq.sh $lxcname\n            ;;\n\n            restart|reload|force-reload)\n                ./lxc_stop_vpn_nsq.sh $lxcname\n                ./lxc_restart.sh $lxcname $defaultlxcname\n            ;;\n\n            *)\n                echo \"Usage: $0 {start|stop|restart|reload|force-reload} \"\n                exit 2\n        esac\n    fi\nfi\nexit $?\n\n```\n\n##### lxc_restart.sh\n```shell\n#!/bin/sh\n#./opevpn/lxc_reconnect_internet.sh\n#用作比较的nsq 只放一个主nsqlookupd server\nCONTAINERNAME=$2\n# CONTAINERNAME=\"s1\"\nNSQFOLDER=\"/root/nsq1.2\"\n# read -p \"请输入对应的lxc容器名称: \" lxcname\nlxcname=$1\n# echo $lxcname\nif [ -n \"$NSQ\" ]; then \n    echo \"容器$lxcname 不存在\"\n    exit 1;\nfi\nif [ ! -f \"/root/$lxcname.ovpn\" ]; then \n    echo \"$lxcname.ovpn 不存在,请用openinstall.sh 添加新用户\"\n    exit 1;\nfi\nOPENVPN=`lxc exec $lxcname pgrep openvpn`     \nif [ -n \"$OPENVPN\" ];then  \n    echo \"openvpn service is running\"\nelse\n    echo \"openvpn service is not running,ok then can do this\"\n    lxc file push /root/$lxcname.ovpn $lxcname/root/\n    lxc exec $lxcname  -- sh -c \"apt-get install -y openvpn\"\n    # lxc exec test -- nohup bash -c \"/root/test.sh &\"\n    # lxc exec $lxcname -- sh -c \"nohup openvpn --config /root/$lxcname.ovpn &\" #不生效\n    lxc exec $lxcname -- nohup bash -c \" openvpn --config /root/$lxcname.ovpn &\"\nfi\necho \"等待5s openvpn启动\"\nsleep 5\n\nlookupdip=`lxc exec ${CONTAINERNAME} ifconfig tun0 | grep \"inet addr:\" | awk '{print $2}' | cut -c 6-` \ncurrentip=`lxc exec ${lxcname} ifconfig tun0 | grep \"inet addr:\" | awk '{print $2}' | cut -c 6-` \necho\necho \"lookupdip openvpn ip is : $lookupdip\"\necho\necho \"current ip is : $currentip \"\necho \nNSQ=`lxc exec $lxcname pgrep nsq`       \nif [ -n \"$NSQ\" ]; then \n        echo \"nsq service is running\"\n        exit 1;\n    else\n        echo \"nsq service is not running,we can do this;\"\n        lxc file push /root/nsq-1.2.0.linux-amd64.go1.12.9.tar.gz $lxcname/root/\n        lxc exec $lxcname -- sh -c \"tar -zxvf /root/nsq-1.2.0.linux-amd64.go1.12.9.tar.gz\" \n        lxc exec $lxcname -- sh -c \"rm -rf ${NSQFOLDER}\"\n        lxc exec $lxcname -- sh -c \"mv /root/nsq-1.2.0.linux-amd64.go1.12.9 ${NSQFOLDER}\"\n        if [ $lxcname = ${CONTAINERNAME} ];then \n            echo \"xxxx\"\n            #lxc exec s1 -- nohup bash -c \"/root/nsq1.2/bin/nsqlookupd &\"\n            lxc exec $lxcname -- nohup bash -c \"/${NSQFOLDER}/bin/nsqlookupd &\"\n            lxc exec $lxcname -- nohup bash -c \"/${NSQFOLDER}/bin/nsqd --lookupd-tcp-address=127.0.0.1:4160  --broadcast-address=$currentip &\"\n            lxc exec $lxcname -- nohup bash -c \"/${NSQFOLDER}/bin/nsqadmin --lookupd-http-address=127.0.0.1:4161 &\"\n        else\n            lxc exec $lxcname -- nohup bash -c \"/${NSQFOLDER}/bin/nsqd --lookupd-tcp-address=$lookupdip:4160 --broadcast-address=$currentip &\"\n        fi\nfi\n```\n\n##### lxc_stop_vpn_nsq.sh\n``` shell\n#!/bin/sh\nstopfile=\"stop_vpn_nsq.sh\"\nlxcname=$1\n# read -p \"请输入对应的lxc容器名称: \" lxcname\necho $lxcname\nlxc file push /root/openvpn/$stopfile $lxcname/root/\nlxc exec $lxcname -- bash -c \"/root/$stopfile \"\n```","slug":"LXC容器搭建NSQ集群一","published":1,"category":"GOLANG","date":"2023-06-08T23:03:56.087Z","updated":"2023-06-08T23:12:13.739Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5sdy000bdxjc0457h6nn","content":"<h3 id=\"LXC-容器搭建nsq集群\"><a href=\"#LXC-容器搭建nsq集群\" class=\"headerlink\" title=\"LXC 容器搭建nsq集群\"></a>LXC 容器搭建nsq集群</h3><ul>\n<li>阿里云服务器cpu飙到100，登不上去，好不容易登上去之后打开lxc容器内发现连不上网<br>注意lxc的几个目录：&#x2F;etc&#x2F;default&#x2F;lxc<br>时间有限，暂时先贴这些</li>\n</ul>\n<h5 id=\"ecs-restart-lxc-config-sh\"><a href=\"#ecs-restart-lxc-config-sh\" class=\"headerlink\" title=\"ecs_restart_lxc_config.sh\"></a>ecs_restart_lxc_config.sh</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">! /bin/sh</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">See how we were called.</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">检查容器内网络是否通畅</span></span><br><span class=\"line\">network()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    #超时时间</span><br><span class=\"line\">    local timeout=1</span><br><span class=\"line\">    lxcname=$(lxc list|awk &#x27; NR&gt;2 &amp;&amp; $2!=&quot;&quot; &amp;&amp; $2!=&quot;|&quot; &#123;print $2&#125;&#x27;|awk &#x27;&#123;print $0&#125;&#x27; | sed -n &#x27;$p&#x27;)</span><br><span class=\"line\">    #目标网站</span><br><span class=\"line\">    local target=www.baidu.com</span><br><span class=\"line\"></span><br><span class=\"line\">    #获取响应状态码</span><br><span class=\"line\">    local ret_code=`lxc exec $lxcname -- bash -c &quot;curl -I -s --connect-timeout $&#123;timeout&#125; $&#123;target&#125; -w %&#123;http_code&#125; | tail -n1&quot;`</span><br><span class=\"line\"></span><br><span class=\"line\">    if [ &quot;x$ret_code&quot; = &quot;x200&quot; ]; then</span><br><span class=\"line\">        #网络畅通</span><br><span class=\"line\">        return 1</span><br><span class=\"line\">    else</span><br><span class=\"line\">        #网络不畅通</span><br><span class=\"line\">        return 0</span><br><span class=\"line\">    fi</span><br><span class=\"line\"></span><br><span class=\"line\">    return 0</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">awk <span class=\"string\">&#x27;BEGIN &#123; FS=&quot;:&quot;;print &quot;统计销售金额&quot;;total=0&#125; &#123;print NR;total=total+NR;&#125; END &#123;printf &quot;销售金额总计：%.2f&quot;,total&#125;&#x27;</span> sx</span></span><br><span class=\"line\">lastnr=$(lxc list|awk &#x27; NR&gt;2 &amp;&amp; $2!=&quot;&quot; &amp;&amp; $2!=&quot;|&quot; &#123;print $2&#125;&#x27;|awk &#x27;&#123;print NR&#125;&#x27; | sed -n &#x27;$p&#x27;)</span><br><span class=\"line\">if [ x&quot;$lastnr&quot; != x ];then</span><br><span class=\"line\">    state=$1</span><br><span class=\"line\">    case &quot;$state&quot; in</span><br><span class=\"line\">        start)</span><br><span class=\"line\">            echo &quot;start action is right&quot;</span><br><span class=\"line\">        ;;</span><br><span class=\"line\"></span><br><span class=\"line\">        stop)</span><br><span class=\"line\">            echo &quot;stop action is right&quot;</span><br><span class=\"line\">        ;;</span><br><span class=\"line\"></span><br><span class=\"line\">        restart|reload|force-reload)</span><br><span class=\"line\">            echo &quot;reload action is right&quot;</span><br><span class=\"line\">        ;;</span><br><span class=\"line\"></span><br><span class=\"line\">        *)</span><br><span class=\"line\">            echo &quot;Usage: $0 $lxcname &#123;start|stop|restart|reload|force-reload&#125;&quot;</span><br><span class=\"line\">            exit 2</span><br><span class=\"line\">    esac</span><br><span class=\"line\">    # 检测网络是否正确</span><br><span class=\"line\">    network</span><br><span class=\"line\">    if [ $? -eq 0 ];then</span><br><span class=\"line\">        echo</span><br><span class=\"line\">        echo &quot;容器内网络不畅通，请检查网络设置！&quot;</span><br><span class=\"line\">        echo</span><br><span class=\"line\">        read -p &quot;是否启用 ? [y/N]: &quot; NET</span><br><span class=\"line\">        if [ &quot;$NET&quot; = &#x27;y&#x27; -o &quot;$NET&quot; = &#x27;Y&#x27; ]; then</span><br><span class=\"line\">            echo &quot;先关闭容器内部网络，可能存在dnsmasq正在运行&quot;</span><br><span class=\"line\">            ./lxc_reconnect_internet.sh  stop</span><br><span class=\"line\">            echo &quot;开启容器内部网络&quot;</span><br><span class=\"line\">            ./lxc_reconnect_internet.sh  start</span><br><span class=\"line\">        else</span><br><span class=\"line\">            exit 1;</span><br><span class=\"line\">        fi</span><br><span class=\"line\">    else</span><br><span class=\"line\">        echo</span><br><span class=\"line\">        echo &quot;容器内网络非常畅通！&quot;</span><br><span class=\"line\">        echo</span><br><span class=\"line\">        read -p &quot;是否关闭 ? [y/N]: &quot; NETSTOP</span><br><span class=\"line\">        if [ &quot;$NETSTOP&quot; = &#x27;y&#x27; -o &quot;$NETSTOP&quot; = &#x27;Y&#x27; ]; then</span><br><span class=\"line\">            ./lxc_reconnect_internet.sh  stop</span><br><span class=\"line\">        fi</span><br><span class=\"line\">    fi</span><br><span class=\"line\">    echo</span><br><span class=\"line\">    echo &quot;检测过后容器内网络通畅&quot;</span><br><span class=\"line\">    echo</span><br><span class=\"line\">    exitnr=$((lastnr+1))</span><br><span class=\"line\">    echo</span><br><span class=\"line\">    echo &quot;哪一个容器你需要选择开启或关闭 openvpn和nsq?&quot;</span><br><span class=\"line\">    echo</span><br><span class=\"line\">    text=$(lxc list|awk &#x27; NR&gt;2 &amp;&amp; $2!=&quot;&quot; &amp;&amp; $2!=&quot;|&quot; &#123;print $2&#125;&#x27;|awk &#x27;&#123;print NR &quot;)&quot; $0&#125;&#x27;)</span><br><span class=\"line\">    defaultlxcname=$(lxc list|awk &#x27; NR&gt;2 &amp;&amp; $2!=&quot;&quot; &amp;&amp; $2!=&quot;|&quot; &#123;print $2&#125;&#x27;|awk &#x27;&#123;print $0&#125;&#x27;|sed -n &quot;1p&quot;)</span><br><span class=\"line\">    echo &quot;0) 所有容器&quot;</span><br><span class=\"line\">    # echo $text #只能在同一行</span><br><span class=\"line\">    echo &quot;$text&quot;</span><br><span class=\"line\">    echo &quot;$exitnr) Exit&quot;</span><br><span class=\"line\">    read -p &quot;Select an option [0-$exitnr]: &quot; nr </span><br><span class=\"line\">    # echo $nr</span><br><span class=\"line\">    if [ $nr = $exitnr ];then</span><br><span class=\"line\">        echo &quot;退出了&quot;</span><br><span class=\"line\">        exit;</span><br><span class=\"line\">    elif [ $nr = &quot;0&quot; ];then</span><br><span class=\"line\">        for container in $(lxc list|awk &#x27; NR&gt;2 &amp;&amp; $2!=&quot;&quot; &amp;&amp; $2!=&quot;|&quot; &#123;print $2&#125;&#x27;|awk &#x27;&#123;print $0&#125;&#x27;); do</span><br><span class=\"line\">            lxcname=$container</span><br><span class=\"line\">            # echo $container</span><br><span class=\"line\">            case &quot;$state&quot; in</span><br><span class=\"line\">                start)</span><br><span class=\"line\">                    ./lxc_restart.sh $lxcname $defaultlxcname</span><br><span class=\"line\">                ;;</span><br><span class=\"line\"></span><br><span class=\"line\">                stop)</span><br><span class=\"line\">                    ./lxc_stop_vpn_nsq.sh $lxcname</span><br><span class=\"line\">                ;;</span><br><span class=\"line\"></span><br><span class=\"line\">                restart|reload|force-reload)</span><br><span class=\"line\">                    ./lxc_stop_vpn_nsq.sh $lxcname</span><br><span class=\"line\">                    ./lxc_restart.sh $lxcname $defaultlxcname</span><br><span class=\"line\">                ;;</span><br><span class=\"line\"></span><br><span class=\"line\">                *)</span><br><span class=\"line\">                    echo &quot;Usage: $0 $lxcname &#123;start|stop|restart|reload|force-reload&#125;&quot;</span><br><span class=\"line\">                    exit 2</span><br><span class=\"line\">            esac</span><br><span class=\"line\">        done</span><br><span class=\"line\">    else</span><br><span class=\"line\">        # sed -n &quot;2p&quot; 查找第2行内</span><br><span class=\"line\">        # echo $(lxc list|awk -F &#x27;|&#x27; &#x27; NR%3==1 &amp;&amp; $2!=&quot;&quot; &amp;&amp; NR&gt;2 &#123;print $2&#125;&#x27;|sed -n &quot;$&#123;nr&#125;p&quot;)</span><br><span class=\"line\">        lxcname=$(lxc list|awk &#x27; NR&gt;2 &amp;&amp; $2!=&quot;&quot; &amp;&amp; $2!=&quot;|&quot; &#123;print $2&#125;&#x27;|awk &#x27;&#123;print $0&#125;&#x27;|sed -n &quot;$&#123;nr&#125;p&quot;)</span><br><span class=\"line\">        echo $lxcname</span><br><span class=\"line\">        case &quot;$state&quot; in</span><br><span class=\"line\">            start)</span><br><span class=\"line\">                ./lxc_restart.sh $lxcname $defaultlxcname</span><br><span class=\"line\">            ;;</span><br><span class=\"line\"></span><br><span class=\"line\">            stop)</span><br><span class=\"line\">                ./lxc_stop_vpn_nsq.sh $lxcname</span><br><span class=\"line\">            ;;</span><br><span class=\"line\"></span><br><span class=\"line\">            restart|reload|force-reload)</span><br><span class=\"line\">                ./lxc_stop_vpn_nsq.sh $lxcname</span><br><span class=\"line\">                ./lxc_restart.sh $lxcname $defaultlxcname</span><br><span class=\"line\">            ;;</span><br><span class=\"line\"></span><br><span class=\"line\">            *)</span><br><span class=\"line\">                echo &quot;Usage: $0 &#123;start|stop|restart|reload|force-reload&#125; &quot;</span><br><span class=\"line\">                exit 2</span><br><span class=\"line\">        esac</span><br><span class=\"line\">    fi</span><br><span class=\"line\">fi</span><br><span class=\"line\">exit $?</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"lxc-restart-sh\"><a href=\"#lxc-restart-sh\" class=\"headerlink\" title=\"lxc_restart.sh\"></a>lxc_restart.sh</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">!/bin/sh</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">./opevpn/lxc_reconnect_internet.sh</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">用作比较的nsq 只放一个主nsqlookupd server</span></span><br><span class=\"line\">CONTAINERNAME=$2</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">CONTAINERNAME=<span class=\"string\">&quot;s1&quot;</span></span></span><br><span class=\"line\">NSQFOLDER=&quot;/root/nsq1.2&quot;</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">read</span> -p <span class=\"string\">&quot;请输入对应的lxc容器名称: &quot;</span> lxcname</span></span><br><span class=\"line\">lxcname=$1</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">echo</span> <span class=\"variable\">$lxcname</span></span></span><br><span class=\"line\">if [ -n &quot;$NSQ&quot; ]; then </span><br><span class=\"line\">    echo &quot;容器$lxcname 不存在&quot;</span><br><span class=\"line\">    exit 1;</span><br><span class=\"line\">fi</span><br><span class=\"line\">if [ ! -f &quot;/root/$lxcname.ovpn&quot; ]; then </span><br><span class=\"line\">    echo &quot;$lxcname.ovpn 不存在,请用openinstall.sh 添加新用户&quot;</span><br><span class=\"line\">    exit 1;</span><br><span class=\"line\">fi</span><br><span class=\"line\">OPENVPN=`lxc exec $lxcname pgrep openvpn`     </span><br><span class=\"line\">if [ -n &quot;$OPENVPN&quot; ];then  </span><br><span class=\"line\">    echo &quot;openvpn service is running&quot;</span><br><span class=\"line\">else</span><br><span class=\"line\">    echo &quot;openvpn service is not running,ok then can do this&quot;</span><br><span class=\"line\">    lxc file push /root/$lxcname.ovpn $lxcname/root/</span><br><span class=\"line\">    lxc exec $lxcname  -- sh -c &quot;apt-get install -y openvpn&quot;</span><br><span class=\"line\">    # lxc exec test -- nohup bash -c &quot;/root/test.sh &amp;&quot;</span><br><span class=\"line\">    # lxc exec $lxcname -- sh -c &quot;nohup openvpn --config /root/$lxcname.ovpn &amp;&quot; #不生效</span><br><span class=\"line\">    lxc exec $lxcname -- nohup bash -c &quot; openvpn --config /root/$lxcname.ovpn &amp;&quot;</span><br><span class=\"line\">fi</span><br><span class=\"line\">echo &quot;等待5s openvpn启动&quot;</span><br><span class=\"line\">sleep 5</span><br><span class=\"line\"></span><br><span class=\"line\">lookupdip=`lxc exec $&#123;CONTAINERNAME&#125; ifconfig tun0 | grep &quot;inet addr:&quot; | awk &#x27;&#123;print $2&#125;&#x27; | cut -c 6-` </span><br><span class=\"line\">currentip=`lxc exec $&#123;lxcname&#125; ifconfig tun0 | grep &quot;inet addr:&quot; | awk &#x27;&#123;print $2&#125;&#x27; | cut -c 6-` </span><br><span class=\"line\">echo</span><br><span class=\"line\">echo &quot;lookupdip openvpn ip is : $lookupdip&quot;</span><br><span class=\"line\">echo</span><br><span class=\"line\">echo &quot;current ip is : $currentip &quot;</span><br><span class=\"line\">echo </span><br><span class=\"line\">NSQ=`lxc exec $lxcname pgrep nsq`       </span><br><span class=\"line\">if [ -n &quot;$NSQ&quot; ]; then </span><br><span class=\"line\">        echo &quot;nsq service is running&quot;</span><br><span class=\"line\">        exit 1;</span><br><span class=\"line\">    else</span><br><span class=\"line\">        echo &quot;nsq service is not running,we can do this;&quot;</span><br><span class=\"line\">        lxc file push /root/nsq-1.2.0.linux-amd64.go1.12.9.tar.gz $lxcname/root/</span><br><span class=\"line\">        lxc exec $lxcname -- sh -c &quot;tar -zxvf /root/nsq-1.2.0.linux-amd64.go1.12.9.tar.gz&quot; </span><br><span class=\"line\">        lxc exec $lxcname -- sh -c &quot;rm -rf $&#123;NSQFOLDER&#125;&quot;</span><br><span class=\"line\">        lxc exec $lxcname -- sh -c &quot;mv /root/nsq-1.2.0.linux-amd64.go1.12.9 $&#123;NSQFOLDER&#125;&quot;</span><br><span class=\"line\">        if [ $lxcname = $&#123;CONTAINERNAME&#125; ];then </span><br><span class=\"line\">            echo &quot;xxxx&quot;</span><br><span class=\"line\">            #lxc exec s1 -- nohup bash -c &quot;/root/nsq1.2/bin/nsqlookupd &amp;&quot;</span><br><span class=\"line\">            lxc exec $lxcname -- nohup bash -c &quot;/$&#123;NSQFOLDER&#125;/bin/nsqlookupd &amp;&quot;</span><br><span class=\"line\">            lxc exec $lxcname -- nohup bash -c &quot;/$&#123;NSQFOLDER&#125;/bin/nsqd --lookupd-tcp-address=127.0.0.1:4160  --broadcast-address=$currentip &amp;&quot;</span><br><span class=\"line\">            lxc exec $lxcname -- nohup bash -c &quot;/$&#123;NSQFOLDER&#125;/bin/nsqadmin --lookupd-http-address=127.0.0.1:4161 &amp;&quot;</span><br><span class=\"line\">        else</span><br><span class=\"line\">            lxc exec $lxcname -- nohup bash -c &quot;/$&#123;NSQFOLDER&#125;/bin/nsqd --lookupd-tcp-address=$lookupdip:4160 --broadcast-address=$currentip &amp;&quot;</span><br><span class=\"line\">        fi</span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"lxc-stop-vpn-nsq-sh\"><a href=\"#lxc-stop-vpn-nsq-sh\" class=\"headerlink\" title=\"lxc_stop_vpn_nsq.sh\"></a>lxc_stop_vpn_nsq.sh</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">!/bin/sh</span></span><br><span class=\"line\">stopfile=&quot;stop_vpn_nsq.sh&quot;</span><br><span class=\"line\">lxcname=$1</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">read</span> -p <span class=\"string\">&quot;请输入对应的lxc容器名称: &quot;</span> lxcname</span></span><br><span class=\"line\">echo $lxcname</span><br><span class=\"line\">lxc file push /root/openvpn/$stopfile $lxcname/root/</span><br><span class=\"line\">lxc exec $lxcname -- bash -c &quot;/root/$stopfile &quot;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"length":6610,"excerpt":"","more":"<h3 id=\"LXC-容器搭建nsq集群\"><a href=\"#LXC-容器搭建nsq集群\" class=\"headerlink\" title=\"LXC 容器搭建nsq集群\"></a>LXC 容器搭建nsq集群</h3><ul>\n<li>阿里云服务器cpu飙到100，登不上去，好不容易登上去之后打开lxc容器内发现连不上网<br>注意lxc的几个目录：&#x2F;etc&#x2F;default&#x2F;lxc<br>时间有限，暂时先贴这些</li>\n</ul>\n<h5 id=\"ecs-restart-lxc-config-sh\"><a href=\"#ecs-restart-lxc-config-sh\" class=\"headerlink\" title=\"ecs_restart_lxc_config.sh\"></a>ecs_restart_lxc_config.sh</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">! /bin/sh</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">See how we were called.</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">检查容器内网络是否通畅</span></span><br><span class=\"line\">network()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    #超时时间</span><br><span class=\"line\">    local timeout=1</span><br><span class=\"line\">    lxcname=$(lxc list|awk &#x27; NR&gt;2 &amp;&amp; $2!=&quot;&quot; &amp;&amp; $2!=&quot;|&quot; &#123;print $2&#125;&#x27;|awk &#x27;&#123;print $0&#125;&#x27; | sed -n &#x27;$p&#x27;)</span><br><span class=\"line\">    #目标网站</span><br><span class=\"line\">    local target=www.baidu.com</span><br><span class=\"line\"></span><br><span class=\"line\">    #获取响应状态码</span><br><span class=\"line\">    local ret_code=`lxc exec $lxcname -- bash -c &quot;curl -I -s --connect-timeout $&#123;timeout&#125; $&#123;target&#125; -w %&#123;http_code&#125; | tail -n1&quot;`</span><br><span class=\"line\"></span><br><span class=\"line\">    if [ &quot;x$ret_code&quot; = &quot;x200&quot; ]; then</span><br><span class=\"line\">        #网络畅通</span><br><span class=\"line\">        return 1</span><br><span class=\"line\">    else</span><br><span class=\"line\">        #网络不畅通</span><br><span class=\"line\">        return 0</span><br><span class=\"line\">    fi</span><br><span class=\"line\"></span><br><span class=\"line\">    return 0</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">awk <span class=\"string\">&#x27;BEGIN &#123; FS=&quot;:&quot;;print &quot;统计销售金额&quot;;total=0&#125; &#123;print NR;total=total+NR;&#125; END &#123;printf &quot;销售金额总计：%.2f&quot;,total&#125;&#x27;</span> sx</span></span><br><span class=\"line\">lastnr=$(lxc list|awk &#x27; NR&gt;2 &amp;&amp; $2!=&quot;&quot; &amp;&amp; $2!=&quot;|&quot; &#123;print $2&#125;&#x27;|awk &#x27;&#123;print NR&#125;&#x27; | sed -n &#x27;$p&#x27;)</span><br><span class=\"line\">if [ x&quot;$lastnr&quot; != x ];then</span><br><span class=\"line\">    state=$1</span><br><span class=\"line\">    case &quot;$state&quot; in</span><br><span class=\"line\">        start)</span><br><span class=\"line\">            echo &quot;start action is right&quot;</span><br><span class=\"line\">        ;;</span><br><span class=\"line\"></span><br><span class=\"line\">        stop)</span><br><span class=\"line\">            echo &quot;stop action is right&quot;</span><br><span class=\"line\">        ;;</span><br><span class=\"line\"></span><br><span class=\"line\">        restart|reload|force-reload)</span><br><span class=\"line\">            echo &quot;reload action is right&quot;</span><br><span class=\"line\">        ;;</span><br><span class=\"line\"></span><br><span class=\"line\">        *)</span><br><span class=\"line\">            echo &quot;Usage: $0 $lxcname &#123;start|stop|restart|reload|force-reload&#125;&quot;</span><br><span class=\"line\">            exit 2</span><br><span class=\"line\">    esac</span><br><span class=\"line\">    # 检测网络是否正确</span><br><span class=\"line\">    network</span><br><span class=\"line\">    if [ $? -eq 0 ];then</span><br><span class=\"line\">        echo</span><br><span class=\"line\">        echo &quot;容器内网络不畅通，请检查网络设置！&quot;</span><br><span class=\"line\">        echo</span><br><span class=\"line\">        read -p &quot;是否启用 ? [y/N]: &quot; NET</span><br><span class=\"line\">        if [ &quot;$NET&quot; = &#x27;y&#x27; -o &quot;$NET&quot; = &#x27;Y&#x27; ]; then</span><br><span class=\"line\">            echo &quot;先关闭容器内部网络，可能存在dnsmasq正在运行&quot;</span><br><span class=\"line\">            ./lxc_reconnect_internet.sh  stop</span><br><span class=\"line\">            echo &quot;开启容器内部网络&quot;</span><br><span class=\"line\">            ./lxc_reconnect_internet.sh  start</span><br><span class=\"line\">        else</span><br><span class=\"line\">            exit 1;</span><br><span class=\"line\">        fi</span><br><span class=\"line\">    else</span><br><span class=\"line\">        echo</span><br><span class=\"line\">        echo &quot;容器内网络非常畅通！&quot;</span><br><span class=\"line\">        echo</span><br><span class=\"line\">        read -p &quot;是否关闭 ? [y/N]: &quot; NETSTOP</span><br><span class=\"line\">        if [ &quot;$NETSTOP&quot; = &#x27;y&#x27; -o &quot;$NETSTOP&quot; = &#x27;Y&#x27; ]; then</span><br><span class=\"line\">            ./lxc_reconnect_internet.sh  stop</span><br><span class=\"line\">        fi</span><br><span class=\"line\">    fi</span><br><span class=\"line\">    echo</span><br><span class=\"line\">    echo &quot;检测过后容器内网络通畅&quot;</span><br><span class=\"line\">    echo</span><br><span class=\"line\">    exitnr=$((lastnr+1))</span><br><span class=\"line\">    echo</span><br><span class=\"line\">    echo &quot;哪一个容器你需要选择开启或关闭 openvpn和nsq?&quot;</span><br><span class=\"line\">    echo</span><br><span class=\"line\">    text=$(lxc list|awk &#x27; NR&gt;2 &amp;&amp; $2!=&quot;&quot; &amp;&amp; $2!=&quot;|&quot; &#123;print $2&#125;&#x27;|awk &#x27;&#123;print NR &quot;)&quot; $0&#125;&#x27;)</span><br><span class=\"line\">    defaultlxcname=$(lxc list|awk &#x27; NR&gt;2 &amp;&amp; $2!=&quot;&quot; &amp;&amp; $2!=&quot;|&quot; &#123;print $2&#125;&#x27;|awk &#x27;&#123;print $0&#125;&#x27;|sed -n &quot;1p&quot;)</span><br><span class=\"line\">    echo &quot;0) 所有容器&quot;</span><br><span class=\"line\">    # echo $text #只能在同一行</span><br><span class=\"line\">    echo &quot;$text&quot;</span><br><span class=\"line\">    echo &quot;$exitnr) Exit&quot;</span><br><span class=\"line\">    read -p &quot;Select an option [0-$exitnr]: &quot; nr </span><br><span class=\"line\">    # echo $nr</span><br><span class=\"line\">    if [ $nr = $exitnr ];then</span><br><span class=\"line\">        echo &quot;退出了&quot;</span><br><span class=\"line\">        exit;</span><br><span class=\"line\">    elif [ $nr = &quot;0&quot; ];then</span><br><span class=\"line\">        for container in $(lxc list|awk &#x27; NR&gt;2 &amp;&amp; $2!=&quot;&quot; &amp;&amp; $2!=&quot;|&quot; &#123;print $2&#125;&#x27;|awk &#x27;&#123;print $0&#125;&#x27;); do</span><br><span class=\"line\">            lxcname=$container</span><br><span class=\"line\">            # echo $container</span><br><span class=\"line\">            case &quot;$state&quot; in</span><br><span class=\"line\">                start)</span><br><span class=\"line\">                    ./lxc_restart.sh $lxcname $defaultlxcname</span><br><span class=\"line\">                ;;</span><br><span class=\"line\"></span><br><span class=\"line\">                stop)</span><br><span class=\"line\">                    ./lxc_stop_vpn_nsq.sh $lxcname</span><br><span class=\"line\">                ;;</span><br><span class=\"line\"></span><br><span class=\"line\">                restart|reload|force-reload)</span><br><span class=\"line\">                    ./lxc_stop_vpn_nsq.sh $lxcname</span><br><span class=\"line\">                    ./lxc_restart.sh $lxcname $defaultlxcname</span><br><span class=\"line\">                ;;</span><br><span class=\"line\"></span><br><span class=\"line\">                *)</span><br><span class=\"line\">                    echo &quot;Usage: $0 $lxcname &#123;start|stop|restart|reload|force-reload&#125;&quot;</span><br><span class=\"line\">                    exit 2</span><br><span class=\"line\">            esac</span><br><span class=\"line\">        done</span><br><span class=\"line\">    else</span><br><span class=\"line\">        # sed -n &quot;2p&quot; 查找第2行内</span><br><span class=\"line\">        # echo $(lxc list|awk -F &#x27;|&#x27; &#x27; NR%3==1 &amp;&amp; $2!=&quot;&quot; &amp;&amp; NR&gt;2 &#123;print $2&#125;&#x27;|sed -n &quot;$&#123;nr&#125;p&quot;)</span><br><span class=\"line\">        lxcname=$(lxc list|awk &#x27; NR&gt;2 &amp;&amp; $2!=&quot;&quot; &amp;&amp; $2!=&quot;|&quot; &#123;print $2&#125;&#x27;|awk &#x27;&#123;print $0&#125;&#x27;|sed -n &quot;$&#123;nr&#125;p&quot;)</span><br><span class=\"line\">        echo $lxcname</span><br><span class=\"line\">        case &quot;$state&quot; in</span><br><span class=\"line\">            start)</span><br><span class=\"line\">                ./lxc_restart.sh $lxcname $defaultlxcname</span><br><span class=\"line\">            ;;</span><br><span class=\"line\"></span><br><span class=\"line\">            stop)</span><br><span class=\"line\">                ./lxc_stop_vpn_nsq.sh $lxcname</span><br><span class=\"line\">            ;;</span><br><span class=\"line\"></span><br><span class=\"line\">            restart|reload|force-reload)</span><br><span class=\"line\">                ./lxc_stop_vpn_nsq.sh $lxcname</span><br><span class=\"line\">                ./lxc_restart.sh $lxcname $defaultlxcname</span><br><span class=\"line\">            ;;</span><br><span class=\"line\"></span><br><span class=\"line\">            *)</span><br><span class=\"line\">                echo &quot;Usage: $0 &#123;start|stop|restart|reload|force-reload&#125; &quot;</span><br><span class=\"line\">                exit 2</span><br><span class=\"line\">        esac</span><br><span class=\"line\">    fi</span><br><span class=\"line\">fi</span><br><span class=\"line\">exit $?</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"lxc-restart-sh\"><a href=\"#lxc-restart-sh\" class=\"headerlink\" title=\"lxc_restart.sh\"></a>lxc_restart.sh</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">!/bin/sh</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">./opevpn/lxc_reconnect_internet.sh</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">用作比较的nsq 只放一个主nsqlookupd server</span></span><br><span class=\"line\">CONTAINERNAME=$2</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">CONTAINERNAME=<span class=\"string\">&quot;s1&quot;</span></span></span><br><span class=\"line\">NSQFOLDER=&quot;/root/nsq1.2&quot;</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">read</span> -p <span class=\"string\">&quot;请输入对应的lxc容器名称: &quot;</span> lxcname</span></span><br><span class=\"line\">lxcname=$1</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">echo</span> <span class=\"variable\">$lxcname</span></span></span><br><span class=\"line\">if [ -n &quot;$NSQ&quot; ]; then </span><br><span class=\"line\">    echo &quot;容器$lxcname 不存在&quot;</span><br><span class=\"line\">    exit 1;</span><br><span class=\"line\">fi</span><br><span class=\"line\">if [ ! -f &quot;/root/$lxcname.ovpn&quot; ]; then </span><br><span class=\"line\">    echo &quot;$lxcname.ovpn 不存在,请用openinstall.sh 添加新用户&quot;</span><br><span class=\"line\">    exit 1;</span><br><span class=\"line\">fi</span><br><span class=\"line\">OPENVPN=`lxc exec $lxcname pgrep openvpn`     </span><br><span class=\"line\">if [ -n &quot;$OPENVPN&quot; ];then  </span><br><span class=\"line\">    echo &quot;openvpn service is running&quot;</span><br><span class=\"line\">else</span><br><span class=\"line\">    echo &quot;openvpn service is not running,ok then can do this&quot;</span><br><span class=\"line\">    lxc file push /root/$lxcname.ovpn $lxcname/root/</span><br><span class=\"line\">    lxc exec $lxcname  -- sh -c &quot;apt-get install -y openvpn&quot;</span><br><span class=\"line\">    # lxc exec test -- nohup bash -c &quot;/root/test.sh &amp;&quot;</span><br><span class=\"line\">    # lxc exec $lxcname -- sh -c &quot;nohup openvpn --config /root/$lxcname.ovpn &amp;&quot; #不生效</span><br><span class=\"line\">    lxc exec $lxcname -- nohup bash -c &quot; openvpn --config /root/$lxcname.ovpn &amp;&quot;</span><br><span class=\"line\">fi</span><br><span class=\"line\">echo &quot;等待5s openvpn启动&quot;</span><br><span class=\"line\">sleep 5</span><br><span class=\"line\"></span><br><span class=\"line\">lookupdip=`lxc exec $&#123;CONTAINERNAME&#125; ifconfig tun0 | grep &quot;inet addr:&quot; | awk &#x27;&#123;print $2&#125;&#x27; | cut -c 6-` </span><br><span class=\"line\">currentip=`lxc exec $&#123;lxcname&#125; ifconfig tun0 | grep &quot;inet addr:&quot; | awk &#x27;&#123;print $2&#125;&#x27; | cut -c 6-` </span><br><span class=\"line\">echo</span><br><span class=\"line\">echo &quot;lookupdip openvpn ip is : $lookupdip&quot;</span><br><span class=\"line\">echo</span><br><span class=\"line\">echo &quot;current ip is : $currentip &quot;</span><br><span class=\"line\">echo </span><br><span class=\"line\">NSQ=`lxc exec $lxcname pgrep nsq`       </span><br><span class=\"line\">if [ -n &quot;$NSQ&quot; ]; then </span><br><span class=\"line\">        echo &quot;nsq service is running&quot;</span><br><span class=\"line\">        exit 1;</span><br><span class=\"line\">    else</span><br><span class=\"line\">        echo &quot;nsq service is not running,we can do this;&quot;</span><br><span class=\"line\">        lxc file push /root/nsq-1.2.0.linux-amd64.go1.12.9.tar.gz $lxcname/root/</span><br><span class=\"line\">        lxc exec $lxcname -- sh -c &quot;tar -zxvf /root/nsq-1.2.0.linux-amd64.go1.12.9.tar.gz&quot; </span><br><span class=\"line\">        lxc exec $lxcname -- sh -c &quot;rm -rf $&#123;NSQFOLDER&#125;&quot;</span><br><span class=\"line\">        lxc exec $lxcname -- sh -c &quot;mv /root/nsq-1.2.0.linux-amd64.go1.12.9 $&#123;NSQFOLDER&#125;&quot;</span><br><span class=\"line\">        if [ $lxcname = $&#123;CONTAINERNAME&#125; ];then </span><br><span class=\"line\">            echo &quot;xxxx&quot;</span><br><span class=\"line\">            #lxc exec s1 -- nohup bash -c &quot;/root/nsq1.2/bin/nsqlookupd &amp;&quot;</span><br><span class=\"line\">            lxc exec $lxcname -- nohup bash -c &quot;/$&#123;NSQFOLDER&#125;/bin/nsqlookupd &amp;&quot;</span><br><span class=\"line\">            lxc exec $lxcname -- nohup bash -c &quot;/$&#123;NSQFOLDER&#125;/bin/nsqd --lookupd-tcp-address=127.0.0.1:4160  --broadcast-address=$currentip &amp;&quot;</span><br><span class=\"line\">            lxc exec $lxcname -- nohup bash -c &quot;/$&#123;NSQFOLDER&#125;/bin/nsqadmin --lookupd-http-address=127.0.0.1:4161 &amp;&quot;</span><br><span class=\"line\">        else</span><br><span class=\"line\">            lxc exec $lxcname -- nohup bash -c &quot;/$&#123;NSQFOLDER&#125;/bin/nsqd --lookupd-tcp-address=$lookupdip:4160 --broadcast-address=$currentip &amp;&quot;</span><br><span class=\"line\">        fi</span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"lxc-stop-vpn-nsq-sh\"><a href=\"#lxc-stop-vpn-nsq-sh\" class=\"headerlink\" title=\"lxc_stop_vpn_nsq.sh\"></a>lxc_stop_vpn_nsq.sh</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">!/bin/sh</span></span><br><span class=\"line\">stopfile=&quot;stop_vpn_nsq.sh&quot;</span><br><span class=\"line\">lxcname=$1</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">read</span> -p <span class=\"string\">&quot;请输入对应的lxc容器名称: &quot;</span> lxcname</span></span><br><span class=\"line\">echo $lxcname</span><br><span class=\"line\">lxc file push /root/openvpn/$stopfile $lxcname/root/</span><br><span class=\"line\">lxc exec $lxcname -- bash -c &quot;/root/$stopfile &quot;</span><br></pre></td></tr></table></figure>"},{"_content":"### LXC 容器搭建nsq集群\n#### go-nsq\n- 生产者角色和消费者角色\n\n```yaml\nversion: '2' # 高版本支持3\nservices:\n  nsqlookupd:\n    image: nsqio/nsq\n    command: /nsqlookupd\n    ports:\n      - \"4160:4160\" # tcp\n      - \"4161:4161\" # http\n\n  nsqd:\n    image: nsqio/nsq\n    # 广播地址不填的话默认就是hostname(或虚拟机名称)，不加就变成lxc的容器名，那样 lookupd 会连接不上，所以直接写IP\n    command: /nsqd --broadcast-address=10.220.151.50 --lookupd-tcp-address=nsqlookupd:4160\n    depends_on:\n      - nsqlookupd\n    ports:\n      - \"4150:4150\" # tcp\n      - \"4151:4151\" # http\n\n  nsqadmin:\n    image: nsqio/nsq\n    command: /nsqadmin --lookupd-http-address=nsqlookupd:4161\n    depends_on:\n      - nsqlookupd\n    ports:\n      - \"4171:4171\" # http\n```\n##### producer.go\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"log\"\n\t\"time\"\n\n\t\"github.com/nsqio/go-nsq\"\n)\n\nfunc main() {\n\tconfig := nsq.NewConfig()\n\t//直连的是nsqd\n\tp, err := nsq.NewProducer(\"10.8.0.6:4150\", config)\n\n\tif err != nil {\n\t\tlog.Panic(err)\n\t}\n\n\tfor i := 1000; i < 2000; i++ {\n\t\tmsg := fmt.Sprintf(\"num-%d\", i)\n\t\tlog.Println(\"Pub2:\" + msg)\n\t\terr = p.Publish(\"testTopic\", []byte(msg))\n\t\tif err != nil {\n\t\t\tlog.Panic(err)\n\t\t}\n\t\ttime.Sleep(time.Second * 1)\n\t}\n\n\tp.Stop()\n}\n\n```\n##### consumer.go\n```go\npackage main\n\nimport (\n\t\"log\"\n\t\"sync\"\n\n\t\"github.com/nsqio/go-nsq\"\n)\n\nfunc main() {\n\twg := &sync.WaitGroup{}\n\twg.Add(1000)\n\n\tconfig := nsq.NewConfig()\n\tc, _ := nsq.NewConsumer(\"testTopic\", \"ch\", config)\n\tc.AddHandler(nsq.HandlerFunc(func(message *nsq.Message) error {\n\t\tlog.Printf(\"Got a message: %s\", message.Body)\n\t\twg.Done()\n\t\treturn nil\n\t}))\n\n\t// 1.直连nsqd\n\t// err := c.ConnectToNSQD(\"127.0.0.1:4150\")\n\n\t// 2.通过 nsqlookupd 服务发现\n\terr := c.ConnectToNSQLookupd(\"10.8.0.4:4161\")\n\tif err != nil {\n\t\tlog.Panic(err)\n\t}\n\twg.Wait()\n}\n\n```\n","source":"_posts/GOLANG/LXC容器搭建NSQ集群二.md","raw":"---\ncategories:\n  - GOLANG\n---\n### LXC 容器搭建nsq集群\n#### go-nsq\n- 生产者角色和消费者角色\n\n```yaml\nversion: '2' # 高版本支持3\nservices:\n  nsqlookupd:\n    image: nsqio/nsq\n    command: /nsqlookupd\n    ports:\n      - \"4160:4160\" # tcp\n      - \"4161:4161\" # http\n\n  nsqd:\n    image: nsqio/nsq\n    # 广播地址不填的话默认就是hostname(或虚拟机名称)，不加就变成lxc的容器名，那样 lookupd 会连接不上，所以直接写IP\n    command: /nsqd --broadcast-address=10.220.151.50 --lookupd-tcp-address=nsqlookupd:4160\n    depends_on:\n      - nsqlookupd\n    ports:\n      - \"4150:4150\" # tcp\n      - \"4151:4151\" # http\n\n  nsqadmin:\n    image: nsqio/nsq\n    command: /nsqadmin --lookupd-http-address=nsqlookupd:4161\n    depends_on:\n      - nsqlookupd\n    ports:\n      - \"4171:4171\" # http\n```\n##### producer.go\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"log\"\n\t\"time\"\n\n\t\"github.com/nsqio/go-nsq\"\n)\n\nfunc main() {\n\tconfig := nsq.NewConfig()\n\t//直连的是nsqd\n\tp, err := nsq.NewProducer(\"10.8.0.6:4150\", config)\n\n\tif err != nil {\n\t\tlog.Panic(err)\n\t}\n\n\tfor i := 1000; i < 2000; i++ {\n\t\tmsg := fmt.Sprintf(\"num-%d\", i)\n\t\tlog.Println(\"Pub2:\" + msg)\n\t\terr = p.Publish(\"testTopic\", []byte(msg))\n\t\tif err != nil {\n\t\t\tlog.Panic(err)\n\t\t}\n\t\ttime.Sleep(time.Second * 1)\n\t}\n\n\tp.Stop()\n}\n\n```\n##### consumer.go\n```go\npackage main\n\nimport (\n\t\"log\"\n\t\"sync\"\n\n\t\"github.com/nsqio/go-nsq\"\n)\n\nfunc main() {\n\twg := &sync.WaitGroup{}\n\twg.Add(1000)\n\n\tconfig := nsq.NewConfig()\n\tc, _ := nsq.NewConsumer(\"testTopic\", \"ch\", config)\n\tc.AddHandler(nsq.HandlerFunc(func(message *nsq.Message) error {\n\t\tlog.Printf(\"Got a message: %s\", message.Body)\n\t\twg.Done()\n\t\treturn nil\n\t}))\n\n\t// 1.直连nsqd\n\t// err := c.ConnectToNSQD(\"127.0.0.1:4150\")\n\n\t// 2.通过 nsqlookupd 服务发现\n\terr := c.ConnectToNSQLookupd(\"10.8.0.4:4161\")\n\tif err != nil {\n\t\tlog.Panic(err)\n\t}\n\twg.Wait()\n}\n\n```\n","slug":"LXC容器搭建NSQ集群二","published":1,"category":"GOLANG","date":"2023-06-08T23:03:56.089Z","updated":"2023-06-08T23:12:13.671Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5sdz000edxjc9caedjkh","content":"<h3 id=\"LXC-容器搭建nsq集群\"><a href=\"#LXC-容器搭建nsq集群\" class=\"headerlink\" title=\"LXC 容器搭建nsq集群\"></a>LXC 容器搭建nsq集群</h3><h4 id=\"go-nsq\"><a href=\"#go-nsq\" class=\"headerlink\" title=\"go-nsq\"></a>go-nsq</h4><ul>\n<li>生产者角色和消费者角色</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&#x27;2&#x27;</span> <span class=\"comment\"># 高版本支持3</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">nsqlookupd:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">nsqio/nsq</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">/nsqlookupd</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;4160:4160&quot;</span> <span class=\"comment\"># tcp</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;4161:4161&quot;</span> <span class=\"comment\"># http</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">nsqd:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">nsqio/nsq</span></span><br><span class=\"line\">    <span class=\"comment\"># 广播地址不填的话默认就是hostname(或虚拟机名称)，不加就变成lxc的容器名，那样 lookupd 会连接不上，所以直接写IP</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">/nsqd</span> <span class=\"string\">--broadcast-address=10.220.151.50</span> <span class=\"string\">--lookupd-tcp-address=nsqlookupd:4160</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">nsqlookupd</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;4150:4150&quot;</span> <span class=\"comment\"># tcp</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;4151:4151&quot;</span> <span class=\"comment\"># http</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">nsqadmin:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">nsqio/nsq</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">/nsqadmin</span> <span class=\"string\">--lookupd-http-address=nsqlookupd:4161</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">nsqlookupd</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;4171:4171&quot;</span> <span class=\"comment\"># http</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"producer-go\"><a href=\"#producer-go\" class=\"headerlink\" title=\"producer.go\"></a>producer.go</h5><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/nsqio/go-nsq&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tconfig := nsq.NewConfig()</span><br><span class=\"line\">\t<span class=\"comment\">//直连的是nsqd</span></span><br><span class=\"line\">\tp, err := nsq.NewProducer(<span class=\"string\">&quot;10.8.0.6:4150&quot;</span>, config)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tlog.Panic(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">1000</span>; i &lt; <span class=\"number\">2000</span>; i++ &#123;</span><br><span class=\"line\">\t\tmsg := fmt.Sprintf(<span class=\"string\">&quot;num-%d&quot;</span>, i)</span><br><span class=\"line\">\t\tlog.Println(<span class=\"string\">&quot;Pub2:&quot;</span> + msg)</span><br><span class=\"line\">\t\terr = p.Publish(<span class=\"string\">&quot;testTopic&quot;</span>, []<span class=\"type\">byte</span>(msg))</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\tlog.Panic(err)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\ttime.Sleep(time.Second * <span class=\"number\">1</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tp.Stop()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h5 id=\"consumer-go\"><a href=\"#consumer-go\" class=\"headerlink\" title=\"consumer.go\"></a>consumer.go</h5><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;sync&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/nsqio/go-nsq&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\twg := &amp;sync.WaitGroup&#123;&#125;</span><br><span class=\"line\">\twg.Add(<span class=\"number\">1000</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\tconfig := nsq.NewConfig()</span><br><span class=\"line\">\tc, _ := nsq.NewConsumer(<span class=\"string\">&quot;testTopic&quot;</span>, <span class=\"string\">&quot;ch&quot;</span>, config)</span><br><span class=\"line\">\tc.AddHandler(nsq.HandlerFunc(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(message *nsq.Message)</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t\tlog.Printf(<span class=\"string\">&quot;Got a message: %s&quot;</span>, message.Body)</span><br><span class=\"line\">\t\twg.Done()</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t&#125;))</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 1.直连nsqd</span></span><br><span class=\"line\">\t<span class=\"comment\">// err := c.ConnectToNSQD(&quot;127.0.0.1:4150&quot;)</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 2.通过 nsqlookupd 服务发现</span></span><br><span class=\"line\">\terr := c.ConnectToNSQLookupd(<span class=\"string\">&quot;10.8.0.4:4161&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tlog.Panic(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\twg.Wait()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"length":1762,"excerpt":"","more":"<h3 id=\"LXC-容器搭建nsq集群\"><a href=\"#LXC-容器搭建nsq集群\" class=\"headerlink\" title=\"LXC 容器搭建nsq集群\"></a>LXC 容器搭建nsq集群</h3><h4 id=\"go-nsq\"><a href=\"#go-nsq\" class=\"headerlink\" title=\"go-nsq\"></a>go-nsq</h4><ul>\n<li>生产者角色和消费者角色</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&#x27;2&#x27;</span> <span class=\"comment\"># 高版本支持3</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">nsqlookupd:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">nsqio/nsq</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">/nsqlookupd</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;4160:4160&quot;</span> <span class=\"comment\"># tcp</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;4161:4161&quot;</span> <span class=\"comment\"># http</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">nsqd:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">nsqio/nsq</span></span><br><span class=\"line\">    <span class=\"comment\"># 广播地址不填的话默认就是hostname(或虚拟机名称)，不加就变成lxc的容器名，那样 lookupd 会连接不上，所以直接写IP</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">/nsqd</span> <span class=\"string\">--broadcast-address=10.220.151.50</span> <span class=\"string\">--lookupd-tcp-address=nsqlookupd:4160</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">nsqlookupd</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;4150:4150&quot;</span> <span class=\"comment\"># tcp</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;4151:4151&quot;</span> <span class=\"comment\"># http</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">nsqadmin:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">nsqio/nsq</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">/nsqadmin</span> <span class=\"string\">--lookupd-http-address=nsqlookupd:4161</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">nsqlookupd</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;4171:4171&quot;</span> <span class=\"comment\"># http</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"producer-go\"><a href=\"#producer-go\" class=\"headerlink\" title=\"producer.go\"></a>producer.go</h5><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/nsqio/go-nsq&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tconfig := nsq.NewConfig()</span><br><span class=\"line\">\t<span class=\"comment\">//直连的是nsqd</span></span><br><span class=\"line\">\tp, err := nsq.NewProducer(<span class=\"string\">&quot;10.8.0.6:4150&quot;</span>, config)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tlog.Panic(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">1000</span>; i &lt; <span class=\"number\">2000</span>; i++ &#123;</span><br><span class=\"line\">\t\tmsg := fmt.Sprintf(<span class=\"string\">&quot;num-%d&quot;</span>, i)</span><br><span class=\"line\">\t\tlog.Println(<span class=\"string\">&quot;Pub2:&quot;</span> + msg)</span><br><span class=\"line\">\t\terr = p.Publish(<span class=\"string\">&quot;testTopic&quot;</span>, []<span class=\"type\">byte</span>(msg))</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\tlog.Panic(err)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\ttime.Sleep(time.Second * <span class=\"number\">1</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tp.Stop()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h5 id=\"consumer-go\"><a href=\"#consumer-go\" class=\"headerlink\" title=\"consumer.go\"></a>consumer.go</h5><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;sync&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/nsqio/go-nsq&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\twg := &amp;sync.WaitGroup&#123;&#125;</span><br><span class=\"line\">\twg.Add(<span class=\"number\">1000</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\tconfig := nsq.NewConfig()</span><br><span class=\"line\">\tc, _ := nsq.NewConsumer(<span class=\"string\">&quot;testTopic&quot;</span>, <span class=\"string\">&quot;ch&quot;</span>, config)</span><br><span class=\"line\">\tc.AddHandler(nsq.HandlerFunc(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(message *nsq.Message)</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t\tlog.Printf(<span class=\"string\">&quot;Got a message: %s&quot;</span>, message.Body)</span><br><span class=\"line\">\t\twg.Done()</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t&#125;))</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 1.直连nsqd</span></span><br><span class=\"line\">\t<span class=\"comment\">// err := c.ConnectToNSQD(&quot;127.0.0.1:4150&quot;)</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 2.通过 nsqlookupd 服务发现</span></span><br><span class=\"line\">\terr := c.ConnectToNSQLookupd(<span class=\"string\">&quot;10.8.0.4:4161&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tlog.Panic(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\twg.Wait()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n"},{"_content":"### mac下安装sshpass\n>$ brew install https://raw.githubusercontent.com/kadwanev/bigboybrew/master/Library/Formula/sshpass.rb    \n\n>$ cd /usr/local/bin  \n\n>$ ln -s sshpass ../Cellar/sshpass/1.05/bin/sshpass  \n\n#### deploy.sh\n```shell\n#!/usr/bin/env bash\npassword=\"xxxxx\"\necho 'update code'\necho 'pack'\ncd $GOPATH/src/learnbeego/blog/\nbee pack -be GOOS=linux\necho 'upload'\nsshpass -p $password scp blog.tar.gz root@test.com:/var/www/html/blog\necho 'restart'\nsshpass -p $password ssh root@test.com \"cd ~ && ./restart.sh\"\n```\n#### restart.sh\n```shell\n#! /bin/bash\n#默认进入的是登录用户的目录\ncd /var/www/html/blog\ntar -xzvf blog.tar.gz\n#remove conf of dev\nsystemctl restart blog.service\n```\n#### 服务器使用systemd 部署\n>$ nano /etc/systemd/system/dd-bi-go.service\n```php\n[Unit]\nDescription=blog\nAfter=blog.service\n[Service]\nType=simple\nUser=root\nGroup=root\nWorkingDirectory=/var/www/html/blog\nExecStart=/var/www/html/blog/blog\nRestart=always\n[Install]\nWantedBy=multi-user.target\n```\n>$ systemctl start blog.service即可  \n\n##### 重新加载配置文件\n>$ sudo systemctl daemon-reload\n\n##### 重启相关服务\n>$ sudo systemctl restart foobar","source":"_posts/GOLANG/beego自动化部署.md","raw":"---\ncategories:\n  - GOLANG\n---\n### mac下安装sshpass\n>$ brew install https://raw.githubusercontent.com/kadwanev/bigboybrew/master/Library/Formula/sshpass.rb    \n\n>$ cd /usr/local/bin  \n\n>$ ln -s sshpass ../Cellar/sshpass/1.05/bin/sshpass  \n\n#### deploy.sh\n```shell\n#!/usr/bin/env bash\npassword=\"xxxxx\"\necho 'update code'\necho 'pack'\ncd $GOPATH/src/learnbeego/blog/\nbee pack -be GOOS=linux\necho 'upload'\nsshpass -p $password scp blog.tar.gz root@test.com:/var/www/html/blog\necho 'restart'\nsshpass -p $password ssh root@test.com \"cd ~ && ./restart.sh\"\n```\n#### restart.sh\n```shell\n#! /bin/bash\n#默认进入的是登录用户的目录\ncd /var/www/html/blog\ntar -xzvf blog.tar.gz\n#remove conf of dev\nsystemctl restart blog.service\n```\n#### 服务器使用systemd 部署\n>$ nano /etc/systemd/system/dd-bi-go.service\n```php\n[Unit]\nDescription=blog\nAfter=blog.service\n[Service]\nType=simple\nUser=root\nGroup=root\nWorkingDirectory=/var/www/html/blog\nExecStart=/var/www/html/blog/blog\nRestart=always\n[Install]\nWantedBy=multi-user.target\n```\n>$ systemctl start blog.service即可  \n\n##### 重新加载配置文件\n>$ sudo systemctl daemon-reload\n\n##### 重启相关服务\n>$ sudo systemctl restart foobar","slug":"beego自动化部署","published":1,"category":"GOLANG","date":"2023-06-08T23:03:56.089Z","updated":"2023-06-08T23:12:13.671Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5se0000fdxjcacvtc5za","content":"<h3 id=\"mac下安装sshpass\"><a href=\"#mac下安装sshpass\" class=\"headerlink\" title=\"mac下安装sshpass\"></a>mac下安装sshpass</h3><blockquote>\n<p>$ brew install <a href=\"https://raw.githubusercontent.com/kadwanev/bigboybrew/master/Library/Formula/sshpass.rb\">https://raw.githubusercontent.com/kadwanev/bigboybrew/master/Library/Formula/sshpass.rb</a>    </p>\n</blockquote>\n<blockquote>\n<p>$ cd &#x2F;usr&#x2F;local&#x2F;bin  </p>\n</blockquote>\n<blockquote>\n<p>$ ln -s sshpass ..&#x2F;Cellar&#x2F;sshpass&#x2F;1.05&#x2F;bin&#x2F;sshpass  </p>\n</blockquote>\n<h4 id=\"deploy-sh\"><a href=\"#deploy-sh\" class=\"headerlink\" title=\"deploy.sh\"></a>deploy.sh</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">!/usr/bin/env bash</span></span><br><span class=\"line\">password=&quot;xxxxx&quot;</span><br><span class=\"line\">echo &#x27;update code&#x27;</span><br><span class=\"line\">echo &#x27;pack&#x27;</span><br><span class=\"line\">cd $GOPATH/src/learnbeego/blog/</span><br><span class=\"line\">bee pack -be GOOS=linux</span><br><span class=\"line\">echo &#x27;upload&#x27;</span><br><span class=\"line\">sshpass -p $password scp blog.tar.gz root@test.com:/var/www/html/blog</span><br><span class=\"line\">echo &#x27;restart&#x27;</span><br><span class=\"line\">sshpass -p $password ssh root@test.com &quot;cd ~ &amp;&amp; ./restart.sh&quot;</span><br></pre></td></tr></table></figure>\n<h4 id=\"restart-sh\"><a href=\"#restart-sh\" class=\"headerlink\" title=\"restart.sh\"></a>restart.sh</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">! /bin/bash</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">默认进入的是登录用户的目录</span></span><br><span class=\"line\">cd /var/www/html/blog</span><br><span class=\"line\">tar -xzvf blog.tar.gz</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">remove conf of dev</span></span><br><span class=\"line\">systemctl restart blog.service</span><br></pre></td></tr></table></figure>\n<h4 id=\"服务器使用systemd-部署\"><a href=\"#服务器使用systemd-部署\" class=\"headerlink\" title=\"服务器使用systemd 部署\"></a>服务器使用systemd 部署</h4><blockquote>\n<p>$ nano &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;dd-bi-go.service</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=blog</span><br><span class=\"line\">After=blog.service</span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=simple</span><br><span class=\"line\">User=root</span><br><span class=\"line\">Group=root</span><br><span class=\"line\">WorkingDirectory=/<span class=\"keyword\">var</span>/www/html/blog</span><br><span class=\"line\">ExecStart=/<span class=\"keyword\">var</span>/www/html/blog/blog</span><br><span class=\"line\">Restart=always</span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>$ systemctl start blog.service即可  </p>\n</blockquote>\n<h5 id=\"重新加载配置文件\"><a href=\"#重新加载配置文件\" class=\"headerlink\" title=\"重新加载配置文件\"></a>重新加载配置文件</h5><blockquote>\n<p>$ sudo systemctl daemon-reload</p>\n</blockquote>\n<h5 id=\"重启相关服务\"><a href=\"#重启相关服务\" class=\"headerlink\" title=\"重启相关服务\"></a>重启相关服务</h5><blockquote>\n<p>$ sudo systemctl restart foobar</p>\n</blockquote>\n","site":{"data":{}},"length":1062,"excerpt":"","more":"<h3 id=\"mac下安装sshpass\"><a href=\"#mac下安装sshpass\" class=\"headerlink\" title=\"mac下安装sshpass\"></a>mac下安装sshpass</h3><blockquote>\n<p>$ brew install <a href=\"https://raw.githubusercontent.com/kadwanev/bigboybrew/master/Library/Formula/sshpass.rb\">https://raw.githubusercontent.com/kadwanev/bigboybrew/master/Library/Formula/sshpass.rb</a>    </p>\n</blockquote>\n<blockquote>\n<p>$ cd &#x2F;usr&#x2F;local&#x2F;bin  </p>\n</blockquote>\n<blockquote>\n<p>$ ln -s sshpass ..&#x2F;Cellar&#x2F;sshpass&#x2F;1.05&#x2F;bin&#x2F;sshpass  </p>\n</blockquote>\n<h4 id=\"deploy-sh\"><a href=\"#deploy-sh\" class=\"headerlink\" title=\"deploy.sh\"></a>deploy.sh</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">!/usr/bin/env bash</span></span><br><span class=\"line\">password=&quot;xxxxx&quot;</span><br><span class=\"line\">echo &#x27;update code&#x27;</span><br><span class=\"line\">echo &#x27;pack&#x27;</span><br><span class=\"line\">cd $GOPATH/src/learnbeego/blog/</span><br><span class=\"line\">bee pack -be GOOS=linux</span><br><span class=\"line\">echo &#x27;upload&#x27;</span><br><span class=\"line\">sshpass -p $password scp blog.tar.gz root@test.com:/var/www/html/blog</span><br><span class=\"line\">echo &#x27;restart&#x27;</span><br><span class=\"line\">sshpass -p $password ssh root@test.com &quot;cd ~ &amp;&amp; ./restart.sh&quot;</span><br></pre></td></tr></table></figure>\n<h4 id=\"restart-sh\"><a href=\"#restart-sh\" class=\"headerlink\" title=\"restart.sh\"></a>restart.sh</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">! /bin/bash</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">默认进入的是登录用户的目录</span></span><br><span class=\"line\">cd /var/www/html/blog</span><br><span class=\"line\">tar -xzvf blog.tar.gz</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">remove conf of dev</span></span><br><span class=\"line\">systemctl restart blog.service</span><br></pre></td></tr></table></figure>\n<h4 id=\"服务器使用systemd-部署\"><a href=\"#服务器使用systemd-部署\" class=\"headerlink\" title=\"服务器使用systemd 部署\"></a>服务器使用systemd 部署</h4><blockquote>\n<p>$ nano &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;dd-bi-go.service</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=blog</span><br><span class=\"line\">After=blog.service</span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=simple</span><br><span class=\"line\">User=root</span><br><span class=\"line\">Group=root</span><br><span class=\"line\">WorkingDirectory=/<span class=\"keyword\">var</span>/www/html/blog</span><br><span class=\"line\">ExecStart=/<span class=\"keyword\">var</span>/www/html/blog/blog</span><br><span class=\"line\">Restart=always</span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>$ systemctl start blog.service即可  </p>\n</blockquote>\n<h5 id=\"重新加载配置文件\"><a href=\"#重新加载配置文件\" class=\"headerlink\" title=\"重新加载配置文件\"></a>重新加载配置文件</h5><blockquote>\n<p>$ sudo systemctl daemon-reload</p>\n</blockquote>\n<h5 id=\"重启相关服务\"><a href=\"#重启相关服务\" class=\"headerlink\" title=\"重启相关服务\"></a>重启相关服务</h5><blockquote>\n<p>$ sudo systemctl restart foobar</p>\n</blockquote>\n"},{"_content":"##### 只需要在go.mod 后面假如replace即可解决，加完记得go mod tidy \n```go\nreplace (\n\tcloud.google.com/go => github.com/googleapis/google-cloud-go v0.34.0\n\tgithub.com/go-tomb/tomb => gopkg.in/tomb.v1 v1.0.0-20141024135613-dd632973f1e7\n\tgo.opencensus.io => github.com/census-instrumentation/opencensus-go v0.19.0\n\tgo.uber.org/atomic => github.com/uber-go/atomic v1.3.2\n\tgo.uber.org/multierr => github.com/uber-go/multierr v1.1.0\n\tgo.uber.org/zap => github.com/uber-go/zap v1.9.1\n\n\tgolang.org/x/crypto => github.com/golang/crypto v0.0.0-20181001203147-e3636079e1a4\n\tgolang.org/x/lint => github.com/golang/lint v0.0.0-20181026193005-c67002cb31c3\n\tgolang.org/x/net => github.com/golang/net v0.0.0-20180826012351-8a410e7b638d\n\tgolang.org/x/oauth2 => github.com/golang/oauth2 v0.0.0-20180821212333-d2e6202438be\n\tgolang.org/x/sync => github.com/golang/sync v0.0.0-20181108010431-42b317875d0f\n\tgolang.org/x/sys => github.com/golang/sys v0.0.0-20181116152217-5ac8a444bdc5\n\tgolang.org/x/text => github.com/golang/text v0.3.0\n\tgolang.org/x/time => github.com/golang/time v0.0.0-20180412165947-fbb02b2291d2\n\tgolang.org/x/tools => github.com/golang/tools v0.0.0-20181219222714-6e267b5cc78e\n\tgoogle.golang.org/api => github.com/googleapis/google-api-go-client v0.0.0-20181220000619-583d854617af\n\tgoogle.golang.org/appengine => github.com/golang/appengine v1.3.0\n\tgoogle.golang.org/genproto => github.com/google/go-genproto v0.0.0-20181219182458-5a97ab628bfb\n\tgoogle.golang.org/grpc => github.com/grpc/grpc-go v1.17.0\n\tgopkg.in/alecthomas/kingpin.v2 => github.com/alecthomas/kingpin v2.2.6+incompatible\n\tgopkg.in/mgo.v2 => github.com/go-mgo/mgo v0.0.0-20180705113604-9856a29383ce\n\tgopkg.in/vmihailenco/msgpack.v2 => github.com/vmihailenco/msgpack v2.9.1+incompatible\n\tgopkg.in/yaml.v2 => github.com/go-yaml/yaml v0.0.0-20181115110504-51d6538a90f8\n\tlabix.org/v2/mgo => github.com/go-mgo/mgo v0.0.0-20160801194620-b6121c6199b7\n\tlaunchpad.net/gocheck => github.com/go-check/check v0.0.0-20180628173108-788fd7840127\n)\n```\n### 一键解决这个问题\nexport GOPROXY=https://goproxy.io 或者国内 https://goproxy.cn\nexport GO111MODULE=on \n\n","source":"_posts/GOLANG/go_mod 翻墙问题.md","raw":"---\ncategories:\n  - GOLANG\n---\n##### 只需要在go.mod 后面假如replace即可解决，加完记得go mod tidy \n```go\nreplace (\n\tcloud.google.com/go => github.com/googleapis/google-cloud-go v0.34.0\n\tgithub.com/go-tomb/tomb => gopkg.in/tomb.v1 v1.0.0-20141024135613-dd632973f1e7\n\tgo.opencensus.io => github.com/census-instrumentation/opencensus-go v0.19.0\n\tgo.uber.org/atomic => github.com/uber-go/atomic v1.3.2\n\tgo.uber.org/multierr => github.com/uber-go/multierr v1.1.0\n\tgo.uber.org/zap => github.com/uber-go/zap v1.9.1\n\n\tgolang.org/x/crypto => github.com/golang/crypto v0.0.0-20181001203147-e3636079e1a4\n\tgolang.org/x/lint => github.com/golang/lint v0.0.0-20181026193005-c67002cb31c3\n\tgolang.org/x/net => github.com/golang/net v0.0.0-20180826012351-8a410e7b638d\n\tgolang.org/x/oauth2 => github.com/golang/oauth2 v0.0.0-20180821212333-d2e6202438be\n\tgolang.org/x/sync => github.com/golang/sync v0.0.0-20181108010431-42b317875d0f\n\tgolang.org/x/sys => github.com/golang/sys v0.0.0-20181116152217-5ac8a444bdc5\n\tgolang.org/x/text => github.com/golang/text v0.3.0\n\tgolang.org/x/time => github.com/golang/time v0.0.0-20180412165947-fbb02b2291d2\n\tgolang.org/x/tools => github.com/golang/tools v0.0.0-20181219222714-6e267b5cc78e\n\tgoogle.golang.org/api => github.com/googleapis/google-api-go-client v0.0.0-20181220000619-583d854617af\n\tgoogle.golang.org/appengine => github.com/golang/appengine v1.3.0\n\tgoogle.golang.org/genproto => github.com/google/go-genproto v0.0.0-20181219182458-5a97ab628bfb\n\tgoogle.golang.org/grpc => github.com/grpc/grpc-go v1.17.0\n\tgopkg.in/alecthomas/kingpin.v2 => github.com/alecthomas/kingpin v2.2.6+incompatible\n\tgopkg.in/mgo.v2 => github.com/go-mgo/mgo v0.0.0-20180705113604-9856a29383ce\n\tgopkg.in/vmihailenco/msgpack.v2 => github.com/vmihailenco/msgpack v2.9.1+incompatible\n\tgopkg.in/yaml.v2 => github.com/go-yaml/yaml v0.0.0-20181115110504-51d6538a90f8\n\tlabix.org/v2/mgo => github.com/go-mgo/mgo v0.0.0-20160801194620-b6121c6199b7\n\tlaunchpad.net/gocheck => github.com/go-check/check v0.0.0-20180628173108-788fd7840127\n)\n```\n### 一键解决这个问题\nexport GOPROXY=https://goproxy.io 或者国内 https://goproxy.cn\nexport GO111MODULE=on \n\n","slug":"go_mod 翻墙问题","published":1,"category":"GOLANG","date":"2023-06-08T23:03:56.093Z","updated":"2023-06-08T23:12:13.671Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5se2000idxjcdj755m4l","content":"<h5 id=\"只需要在go-mod-后面假如replace即可解决，加完记得go-mod-tidy\"><a href=\"#只需要在go-mod-后面假如replace即可解决，加完记得go-mod-tidy\" class=\"headerlink\" title=\"只需要在go.mod 后面假如replace即可解决，加完记得go mod tidy\"></a>只需要在go.mod 后面假如replace即可解决，加完记得go mod tidy</h5><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">replace (</span><br><span class=\"line\">\tcloud.google.com/<span class=\"keyword\">go</span> =&gt; github.com/googleapis/google-cloud-<span class=\"keyword\">go</span> v0<span class=\"number\">.34</span><span class=\"number\">.0</span></span><br><span class=\"line\">\tgithub.com/<span class=\"keyword\">go</span>-tomb/tomb =&gt; gopkg.in/tomb.v1 v1<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20141024135613</span>-dd632973f1e7</span><br><span class=\"line\">\t<span class=\"keyword\">go</span>.opencensus.io =&gt; github.com/census-instrumentation/opencensus-<span class=\"keyword\">go</span> v0<span class=\"number\">.19</span><span class=\"number\">.0</span></span><br><span class=\"line\">\t<span class=\"keyword\">go</span>.uber.org/atomic =&gt; github.com/uber-<span class=\"keyword\">go</span>/atomic v1<span class=\"number\">.3</span><span class=\"number\">.2</span></span><br><span class=\"line\">\t<span class=\"keyword\">go</span>.uber.org/multierr =&gt; github.com/uber-<span class=\"keyword\">go</span>/multierr v1<span class=\"number\">.1</span><span class=\"number\">.0</span></span><br><span class=\"line\">\t<span class=\"keyword\">go</span>.uber.org/zap =&gt; github.com/uber-<span class=\"keyword\">go</span>/zap v1<span class=\"number\">.9</span><span class=\"number\">.1</span></span><br><span class=\"line\"></span><br><span class=\"line\">\tgolang.org/x/crypto =&gt; github.com/golang/crypto v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20181001203147</span>-e3636079e1a4</span><br><span class=\"line\">\tgolang.org/x/lint =&gt; github.com/golang/lint v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20181026193005</span>-c67002cb31c3</span><br><span class=\"line\">\tgolang.org/x/net =&gt; github.com/golang/net v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20180826012351</span><span class=\"number\">-8</span>a410e7b638d</span><br><span class=\"line\">\tgolang.org/x/oauth2 =&gt; github.com/golang/oauth2 v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20180821212333</span>-d2e6202438be</span><br><span class=\"line\">\tgolang.org/x/sync =&gt; github.com/golang/sync v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20181108010431</span><span class=\"number\">-42</span>b317875d0f</span><br><span class=\"line\">\tgolang.org/x/sys =&gt; github.com/golang/sys v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20181116152217</span><span class=\"number\">-5</span>ac8a444bdc5</span><br><span class=\"line\">\tgolang.org/x/text =&gt; github.com/golang/text v0<span class=\"number\">.3</span><span class=\"number\">.0</span></span><br><span class=\"line\">\tgolang.org/x/time =&gt; github.com/golang/time v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20180412165947</span>-fbb02b2291d2</span><br><span class=\"line\">\tgolang.org/x/tools =&gt; github.com/golang/tools v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20181219222714</span><span class=\"number\">-6e267</span>b5cc78e</span><br><span class=\"line\">\tgoogle.golang.org/api =&gt; github.com/googleapis/google-api-<span class=\"keyword\">go</span>-client v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20181220000619</span><span class=\"number\">-583</span>d854617af</span><br><span class=\"line\">\tgoogle.golang.org/appengine =&gt; github.com/golang/appengine v1<span class=\"number\">.3</span><span class=\"number\">.0</span></span><br><span class=\"line\">\tgoogle.golang.org/genproto =&gt; github.com/google/<span class=\"keyword\">go</span>-genproto v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20181219182458</span><span class=\"number\">-5</span>a97ab628bfb</span><br><span class=\"line\">\tgoogle.golang.org/grpc =&gt; github.com/grpc/grpc-<span class=\"keyword\">go</span> v1<span class=\"number\">.17</span><span class=\"number\">.0</span></span><br><span class=\"line\">\tgopkg.in/alecthomas/kingpin.v2 =&gt; github.com/alecthomas/kingpin v2<span class=\"number\">.2</span><span class=\"number\">.6</span>+incompatible</span><br><span class=\"line\">\tgopkg.in/mgo.v2 =&gt; github.com/<span class=\"keyword\">go</span>-mgo/mgo v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20180705113604</span><span class=\"number\">-9856</span>a29383ce</span><br><span class=\"line\">\tgopkg.in/vmihailenco/msgpack.v2 =&gt; github.com/vmihailenco/msgpack v2<span class=\"number\">.9</span><span class=\"number\">.1</span>+incompatible</span><br><span class=\"line\">\tgopkg.in/yaml.v2 =&gt; github.com/<span class=\"keyword\">go</span>-yaml/yaml v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20181115110504</span><span class=\"number\">-51</span>d6538a90f8</span><br><span class=\"line\">\tlabix.org/v2/mgo =&gt; github.com/<span class=\"keyword\">go</span>-mgo/mgo v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20160801194620</span>-b6121c6199b7</span><br><span class=\"line\">\tlaunchpad.net/gocheck =&gt; github.com/<span class=\"keyword\">go</span>-check/check v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20180628173108</span><span class=\"number\">-788</span>fd7840127</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<h3 id=\"一键解决这个问题\"><a href=\"#一键解决这个问题\" class=\"headerlink\" title=\"一键解决这个问题\"></a>一键解决这个问题</h3><p>export GOPROXY&#x3D;<a href=\"https://goproxy.io/\">https://goproxy.io</a> 或者国内 <a href=\"https://goproxy.cn/\">https://goproxy.cn</a><br>export GO111MODULE&#x3D;on </p>\n","site":{"data":{}},"length":2048,"excerpt":"","more":"<h5 id=\"只需要在go-mod-后面假如replace即可解决，加完记得go-mod-tidy\"><a href=\"#只需要在go-mod-后面假如replace即可解决，加完记得go-mod-tidy\" class=\"headerlink\" title=\"只需要在go.mod 后面假如replace即可解决，加完记得go mod tidy\"></a>只需要在go.mod 后面假如replace即可解决，加完记得go mod tidy</h5><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">replace (</span><br><span class=\"line\">\tcloud.google.com/<span class=\"keyword\">go</span> =&gt; github.com/googleapis/google-cloud-<span class=\"keyword\">go</span> v0<span class=\"number\">.34</span><span class=\"number\">.0</span></span><br><span class=\"line\">\tgithub.com/<span class=\"keyword\">go</span>-tomb/tomb =&gt; gopkg.in/tomb.v1 v1<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20141024135613</span>-dd632973f1e7</span><br><span class=\"line\">\t<span class=\"keyword\">go</span>.opencensus.io =&gt; github.com/census-instrumentation/opencensus-<span class=\"keyword\">go</span> v0<span class=\"number\">.19</span><span class=\"number\">.0</span></span><br><span class=\"line\">\t<span class=\"keyword\">go</span>.uber.org/atomic =&gt; github.com/uber-<span class=\"keyword\">go</span>/atomic v1<span class=\"number\">.3</span><span class=\"number\">.2</span></span><br><span class=\"line\">\t<span class=\"keyword\">go</span>.uber.org/multierr =&gt; github.com/uber-<span class=\"keyword\">go</span>/multierr v1<span class=\"number\">.1</span><span class=\"number\">.0</span></span><br><span class=\"line\">\t<span class=\"keyword\">go</span>.uber.org/zap =&gt; github.com/uber-<span class=\"keyword\">go</span>/zap v1<span class=\"number\">.9</span><span class=\"number\">.1</span></span><br><span class=\"line\"></span><br><span class=\"line\">\tgolang.org/x/crypto =&gt; github.com/golang/crypto v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20181001203147</span>-e3636079e1a4</span><br><span class=\"line\">\tgolang.org/x/lint =&gt; github.com/golang/lint v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20181026193005</span>-c67002cb31c3</span><br><span class=\"line\">\tgolang.org/x/net =&gt; github.com/golang/net v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20180826012351</span><span class=\"number\">-8</span>a410e7b638d</span><br><span class=\"line\">\tgolang.org/x/oauth2 =&gt; github.com/golang/oauth2 v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20180821212333</span>-d2e6202438be</span><br><span class=\"line\">\tgolang.org/x/sync =&gt; github.com/golang/sync v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20181108010431</span><span class=\"number\">-42</span>b317875d0f</span><br><span class=\"line\">\tgolang.org/x/sys =&gt; github.com/golang/sys v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20181116152217</span><span class=\"number\">-5</span>ac8a444bdc5</span><br><span class=\"line\">\tgolang.org/x/text =&gt; github.com/golang/text v0<span class=\"number\">.3</span><span class=\"number\">.0</span></span><br><span class=\"line\">\tgolang.org/x/time =&gt; github.com/golang/time v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20180412165947</span>-fbb02b2291d2</span><br><span class=\"line\">\tgolang.org/x/tools =&gt; github.com/golang/tools v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20181219222714</span><span class=\"number\">-6e267</span>b5cc78e</span><br><span class=\"line\">\tgoogle.golang.org/api =&gt; github.com/googleapis/google-api-<span class=\"keyword\">go</span>-client v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20181220000619</span><span class=\"number\">-583</span>d854617af</span><br><span class=\"line\">\tgoogle.golang.org/appengine =&gt; github.com/golang/appengine v1<span class=\"number\">.3</span><span class=\"number\">.0</span></span><br><span class=\"line\">\tgoogle.golang.org/genproto =&gt; github.com/google/<span class=\"keyword\">go</span>-genproto v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20181219182458</span><span class=\"number\">-5</span>a97ab628bfb</span><br><span class=\"line\">\tgoogle.golang.org/grpc =&gt; github.com/grpc/grpc-<span class=\"keyword\">go</span> v1<span class=\"number\">.17</span><span class=\"number\">.0</span></span><br><span class=\"line\">\tgopkg.in/alecthomas/kingpin.v2 =&gt; github.com/alecthomas/kingpin v2<span class=\"number\">.2</span><span class=\"number\">.6</span>+incompatible</span><br><span class=\"line\">\tgopkg.in/mgo.v2 =&gt; github.com/<span class=\"keyword\">go</span>-mgo/mgo v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20180705113604</span><span class=\"number\">-9856</span>a29383ce</span><br><span class=\"line\">\tgopkg.in/vmihailenco/msgpack.v2 =&gt; github.com/vmihailenco/msgpack v2<span class=\"number\">.9</span><span class=\"number\">.1</span>+incompatible</span><br><span class=\"line\">\tgopkg.in/yaml.v2 =&gt; github.com/<span class=\"keyword\">go</span>-yaml/yaml v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20181115110504</span><span class=\"number\">-51</span>d6538a90f8</span><br><span class=\"line\">\tlabix.org/v2/mgo =&gt; github.com/<span class=\"keyword\">go</span>-mgo/mgo v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20160801194620</span>-b6121c6199b7</span><br><span class=\"line\">\tlaunchpad.net/gocheck =&gt; github.com/<span class=\"keyword\">go</span>-check/check v0<span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"number\">-20180628173108</span><span class=\"number\">-788</span>fd7840127</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<h3 id=\"一键解决这个问题\"><a href=\"#一键解决这个问题\" class=\"headerlink\" title=\"一键解决这个问题\"></a>一键解决这个问题</h3><p>export GOPROXY&#x3D;<a href=\"https://goproxy.io/\">https://goproxy.io</a> 或者国内 <a href=\"https://goproxy.cn/\">https://goproxy.cn</a><br>export GO111MODULE&#x3D;on </p>\n"},{"_content":"#### 目的学习go协程池\n- 网上go协程池大同小异，理解原理就可以了，我是根据bilibili上一个视频操作的，讲的还挺好的，自行搜索下，不过因为这个视频中任务队列是没有长度限制的，所以在那个基础上进行改编。\n\n#### 看下协程池的原理\n![avatar](https://blog.hexiefamily.xin/assets/workerpool.jpg)  \n\n#### 协程池结构体,并且建立有缓存的channel\n```go\ntype Workpool struct {\n\tJobchannel chan *Task\n\tWorkernum int\n}\n// maxsize 工人多少个，maxlen 多长的管道\nfunc NewWorkpool(maxsize int,maxlen int) *Workpool {\n\tw := Workpool{\n\t\tJobchannel:      make(chan *Task,maxlen),\n\t\tWorkernum:       maxsize,\n\t}\n\treturn &w\n}\n```\n#### Task 任务，这里我是派发了十个任务，然后休息两秒，然后再派发\n```go\nfunc (t *Task) Execute(){\n\tfmt.Println(\"任务id为：\",t.Id,\",当前时间为：\",time.Now())\n\tt.f()\n\ttime.Sleep(2 * time.Second)\n}\n```\n\n#### 完整代码如下\n```go\npackage cache\n\nimport (\n\t\"fmt\"\n\t\"sync\"\n\t\"time\"\n)\n\ntype Task struct {\n\tf func() error\n\tId int\n}\nfunc Newtask(arg_f func() error,id int) *Task{\n\tt :=Task{\n\t\tf:\targ_f,\n\t\tId:\tid,\n\t}\n\treturn &t\n}\nfunc (t *Task) Execute(){\n\tfmt.Println(\"任务id为：\",t.Id,\",当前时间为：\",time.Now())\n\tt.f()\n\ttime.Sleep(2 * time.Second)\n}\ntype Workpool struct {\n\tJobchannel chan *Task\n\tWorkernum int\n}\n// maxsize 工人多少个，maxlen 多长的管道\nfunc NewWorkpool(maxsize int,maxlen int) *Workpool {\n\tw := Workpool{\n\t\tJobchannel:      make(chan *Task,maxlen),\n\t\tWorkernum:       maxsize,\n\t}\n\treturn &w\n}\n\n\nfunc (p *Workpool) AllocateJobTask(maxnumjobs int) {\n\tfor i:=0;i<maxnumjobs;i++{\n\t\tt := Newtask(func() error {\n\t\t\t//任务是打印当前时间\n\t\t\t//fmt.Println(\"任务id为：\",i,\",当前时间为：\",time.Now())\n\t\t\treturn nil\n\t\t},i)\n\t\tp.Jobchannel <- t\n\t}\n\tclose(p.Jobchannel)\n}\nfunc (p *Workpool) CreateWorkPool(){\n\tvar wg sync.WaitGroup\n\tfor i:=0; i<p.Workernum;i++  {\n\t\tgo p.Work(&wg,i)\n\t\twg.Add(1)\n\t}\n\twg.Wait()\n\n}\nfunc (p *Workpool) Work(wg *sync.WaitGroup,id int){\n\tfor job :=range p.Jobchannel{\n\t\tjob.Execute()\n\t\tfmt.Println(\"我是工人:\",id,\"正在工作job:\",job.Id)\n\t}\n\twg.Done()\n}\n\nfunc GetCacheChannel(){\n\tstartTime :=time.Now()\n\tw :=NewWorkpool(10,10)\n\tmaxnumjobs :=100\n\t//先初始化线程池\n\tgo w.AllocateJobTask(maxnumjobs)\n\tw.CreateWorkPool()\n\n\tendTime := time.Now()\n\tdiff := endTime.Sub(startTime)\n\tfmt.Println(\"total time taken \", diff.Seconds(), \"seconds\")\n}\n\n```\n\n写完这段代码，网上还有其他协程池的原理，大同小异\n- [<font color=#0099ff>其他高效协程池做法</font>](https://segmentfault.com/a/1190000018193161)\n","source":"_posts/GOLANG/go协程池.md","raw":"---\ncategories:\n  - GOLANG\n---\n#### 目的学习go协程池\n- 网上go协程池大同小异，理解原理就可以了，我是根据bilibili上一个视频操作的，讲的还挺好的，自行搜索下，不过因为这个视频中任务队列是没有长度限制的，所以在那个基础上进行改编。\n\n#### 看下协程池的原理\n![avatar](https://blog.hexiefamily.xin/assets/workerpool.jpg)  \n\n#### 协程池结构体,并且建立有缓存的channel\n```go\ntype Workpool struct {\n\tJobchannel chan *Task\n\tWorkernum int\n}\n// maxsize 工人多少个，maxlen 多长的管道\nfunc NewWorkpool(maxsize int,maxlen int) *Workpool {\n\tw := Workpool{\n\t\tJobchannel:      make(chan *Task,maxlen),\n\t\tWorkernum:       maxsize,\n\t}\n\treturn &w\n}\n```\n#### Task 任务，这里我是派发了十个任务，然后休息两秒，然后再派发\n```go\nfunc (t *Task) Execute(){\n\tfmt.Println(\"任务id为：\",t.Id,\",当前时间为：\",time.Now())\n\tt.f()\n\ttime.Sleep(2 * time.Second)\n}\n```\n\n#### 完整代码如下\n```go\npackage cache\n\nimport (\n\t\"fmt\"\n\t\"sync\"\n\t\"time\"\n)\n\ntype Task struct {\n\tf func() error\n\tId int\n}\nfunc Newtask(arg_f func() error,id int) *Task{\n\tt :=Task{\n\t\tf:\targ_f,\n\t\tId:\tid,\n\t}\n\treturn &t\n}\nfunc (t *Task) Execute(){\n\tfmt.Println(\"任务id为：\",t.Id,\",当前时间为：\",time.Now())\n\tt.f()\n\ttime.Sleep(2 * time.Second)\n}\ntype Workpool struct {\n\tJobchannel chan *Task\n\tWorkernum int\n}\n// maxsize 工人多少个，maxlen 多长的管道\nfunc NewWorkpool(maxsize int,maxlen int) *Workpool {\n\tw := Workpool{\n\t\tJobchannel:      make(chan *Task,maxlen),\n\t\tWorkernum:       maxsize,\n\t}\n\treturn &w\n}\n\n\nfunc (p *Workpool) AllocateJobTask(maxnumjobs int) {\n\tfor i:=0;i<maxnumjobs;i++{\n\t\tt := Newtask(func() error {\n\t\t\t//任务是打印当前时间\n\t\t\t//fmt.Println(\"任务id为：\",i,\",当前时间为：\",time.Now())\n\t\t\treturn nil\n\t\t},i)\n\t\tp.Jobchannel <- t\n\t}\n\tclose(p.Jobchannel)\n}\nfunc (p *Workpool) CreateWorkPool(){\n\tvar wg sync.WaitGroup\n\tfor i:=0; i<p.Workernum;i++  {\n\t\tgo p.Work(&wg,i)\n\t\twg.Add(1)\n\t}\n\twg.Wait()\n\n}\nfunc (p *Workpool) Work(wg *sync.WaitGroup,id int){\n\tfor job :=range p.Jobchannel{\n\t\tjob.Execute()\n\t\tfmt.Println(\"我是工人:\",id,\"正在工作job:\",job.Id)\n\t}\n\twg.Done()\n}\n\nfunc GetCacheChannel(){\n\tstartTime :=time.Now()\n\tw :=NewWorkpool(10,10)\n\tmaxnumjobs :=100\n\t//先初始化线程池\n\tgo w.AllocateJobTask(maxnumjobs)\n\tw.CreateWorkPool()\n\n\tendTime := time.Now()\n\tdiff := endTime.Sub(startTime)\n\tfmt.Println(\"total time taken \", diff.Seconds(), \"seconds\")\n}\n\n```\n\n写完这段代码，网上还有其他协程池的原理，大同小异\n- [<font color=#0099ff>其他高效协程池做法</font>](https://segmentfault.com/a/1190000018193161)\n","slug":"go协程池","published":1,"category":"GOLANG","date":"2023-06-08T23:03:56.088Z","updated":"2023-06-08T23:12:13.672Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5se3000jdxjc2wv317z0","content":"<h4 id=\"目的学习go协程池\"><a href=\"#目的学习go协程池\" class=\"headerlink\" title=\"目的学习go协程池\"></a>目的学习go协程池</h4><ul>\n<li>网上go协程池大同小异，理解原理就可以了，我是根据bilibili上一个视频操作的，讲的还挺好的，自行搜索下，不过因为这个视频中任务队列是没有长度限制的，所以在那个基础上进行改编。</li>\n</ul>\n<h4 id=\"看下协程池的原理\"><a href=\"#看下协程池的原理\" class=\"headerlink\" title=\"看下协程池的原理\"></a>看下协程池的原理</h4><p><img src=\"https://blog.hexiefamily.xin/assets/workerpool.jpg\" alt=\"avatar\">  </p>\n<h4 id=\"协程池结构体-并且建立有缓存的channel\"><a href=\"#协程池结构体-并且建立有缓存的channel\" class=\"headerlink\" title=\"协程池结构体,并且建立有缓存的channel\"></a>协程池结构体,并且建立有缓存的channel</h4><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Workpool <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tJobchannel <span class=\"keyword\">chan</span> *Task</span><br><span class=\"line\">\tWorkernum <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// maxsize 工人多少个，maxlen 多长的管道</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewWorkpool</span><span class=\"params\">(maxsize <span class=\"type\">int</span>,maxlen <span class=\"type\">int</span>)</span></span> *Workpool &#123;</span><br><span class=\"line\">\tw := Workpool&#123;</span><br><span class=\"line\">\t\tJobchannel:      <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> *Task,maxlen),</span><br><span class=\"line\">\t\tWorkernum:       maxsize,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;w</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"Task-任务，这里我是派发了十个任务，然后休息两秒，然后再派发\"><a href=\"#Task-任务，这里我是派发了十个任务，然后休息两秒，然后再派发\" class=\"headerlink\" title=\"Task 任务，这里我是派发了十个任务，然后休息两秒，然后再派发\"></a>Task 任务，这里我是派发了十个任务，然后休息两秒，然后再派发</h4><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(t *Task)</span></span> Execute()&#123;</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;任务id为：&quot;</span>,t.Id,<span class=\"string\">&quot;,当前时间为：&quot;</span>,time.Now())</span><br><span class=\"line\">\tt.f()</span><br><span class=\"line\">\ttime.Sleep(<span class=\"number\">2</span> * time.Second)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"完整代码如下\"><a href=\"#完整代码如下\" class=\"headerlink\" title=\"完整代码如下\"></a>完整代码如下</h4><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cache</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;sync&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Task <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tf <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> <span class=\"type\">error</span></span><br><span class=\"line\">\tId <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Newtask</span><span class=\"params\">(arg_f <span class=\"keyword\">func</span>()</span></span> <span class=\"type\">error</span>,id <span class=\"type\">int</span>) *Task&#123;</span><br><span class=\"line\">\tt :=Task&#123;</span><br><span class=\"line\">\t\tf:\targ_f,</span><br><span class=\"line\">\t\tId:\tid,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;t</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(t *Task)</span></span> Execute()&#123;</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;任务id为：&quot;</span>,t.Id,<span class=\"string\">&quot;,当前时间为：&quot;</span>,time.Now())</span><br><span class=\"line\">\tt.f()</span><br><span class=\"line\">\ttime.Sleep(<span class=\"number\">2</span> * time.Second)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">type</span> Workpool <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tJobchannel <span class=\"keyword\">chan</span> *Task</span><br><span class=\"line\">\tWorkernum <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// maxsize 工人多少个，maxlen 多长的管道</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewWorkpool</span><span class=\"params\">(maxsize <span class=\"type\">int</span>,maxlen <span class=\"type\">int</span>)</span></span> *Workpool &#123;</span><br><span class=\"line\">\tw := Workpool&#123;</span><br><span class=\"line\">\t\tJobchannel:      <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> *Task,maxlen),</span><br><span class=\"line\">\t\tWorkernum:       maxsize,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;w</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(p *Workpool)</span></span> AllocateJobTask(maxnumjobs <span class=\"type\">int</span>) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i:=<span class=\"number\">0</span>;i&lt;maxnumjobs;i++&#123;</span><br><span class=\"line\">\t\tt := Newtask(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//任务是打印当前时间</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">//fmt.Println(&quot;任务id为：&quot;,i,&quot;,当前时间为：&quot;,time.Now())</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t\t&#125;,i)</span><br><span class=\"line\">\t\tp.Jobchannel &lt;- t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"built_in\">close</span>(p.Jobchannel)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(p *Workpool)</span></span> CreateWorkPool()&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> wg sync.WaitGroup</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i:=<span class=\"number\">0</span>; i&lt;p.Workernum;i++  &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">go</span> p.Work(&amp;wg,i)</span><br><span class=\"line\">\t\twg.Add(<span class=\"number\">1</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\twg.Wait()</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(p *Workpool)</span></span> Work(wg *sync.WaitGroup,id <span class=\"type\">int</span>)&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> job :=<span class=\"keyword\">range</span> p.Jobchannel&#123;</span><br><span class=\"line\">\t\tjob.Execute()</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;我是工人:&quot;</span>,id,<span class=\"string\">&quot;正在工作job:&quot;</span>,job.Id)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\twg.Done()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">GetCacheChannel</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\tstartTime :=time.Now()</span><br><span class=\"line\">\tw :=NewWorkpool(<span class=\"number\">10</span>,<span class=\"number\">10</span>)</span><br><span class=\"line\">\tmaxnumjobs :=<span class=\"number\">100</span></span><br><span class=\"line\">\t<span class=\"comment\">//先初始化线程池</span></span><br><span class=\"line\">\t<span class=\"keyword\">go</span> w.AllocateJobTask(maxnumjobs)</span><br><span class=\"line\">\tw.CreateWorkPool()</span><br><span class=\"line\"></span><br><span class=\"line\">\tendTime := time.Now()</span><br><span class=\"line\">\tdiff := endTime.Sub(startTime)</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;total time taken &quot;</span>, diff.Seconds(), <span class=\"string\">&quot;seconds&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>写完这段代码，网上还有其他协程池的原理，大同小异</p>\n<ul>\n<li><a href=\"https://segmentfault.com/a/1190000018193161\"><font color=#0099ff>其他高效协程池做法</font></a></li>\n</ul>\n","site":{"data":{}},"length":2142,"excerpt":"","more":"<h4 id=\"目的学习go协程池\"><a href=\"#目的学习go协程池\" class=\"headerlink\" title=\"目的学习go协程池\"></a>目的学习go协程池</h4><ul>\n<li>网上go协程池大同小异，理解原理就可以了，我是根据bilibili上一个视频操作的，讲的还挺好的，自行搜索下，不过因为这个视频中任务队列是没有长度限制的，所以在那个基础上进行改编。</li>\n</ul>\n<h4 id=\"看下协程池的原理\"><a href=\"#看下协程池的原理\" class=\"headerlink\" title=\"看下协程池的原理\"></a>看下协程池的原理</h4><p><img src=\"https://blog.hexiefamily.xin/assets/workerpool.jpg\" alt=\"avatar\">  </p>\n<h4 id=\"协程池结构体-并且建立有缓存的channel\"><a href=\"#协程池结构体-并且建立有缓存的channel\" class=\"headerlink\" title=\"协程池结构体,并且建立有缓存的channel\"></a>协程池结构体,并且建立有缓存的channel</h4><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Workpool <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tJobchannel <span class=\"keyword\">chan</span> *Task</span><br><span class=\"line\">\tWorkernum <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// maxsize 工人多少个，maxlen 多长的管道</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewWorkpool</span><span class=\"params\">(maxsize <span class=\"type\">int</span>,maxlen <span class=\"type\">int</span>)</span></span> *Workpool &#123;</span><br><span class=\"line\">\tw := Workpool&#123;</span><br><span class=\"line\">\t\tJobchannel:      <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> *Task,maxlen),</span><br><span class=\"line\">\t\tWorkernum:       maxsize,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;w</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"Task-任务，这里我是派发了十个任务，然后休息两秒，然后再派发\"><a href=\"#Task-任务，这里我是派发了十个任务，然后休息两秒，然后再派发\" class=\"headerlink\" title=\"Task 任务，这里我是派发了十个任务，然后休息两秒，然后再派发\"></a>Task 任务，这里我是派发了十个任务，然后休息两秒，然后再派发</h4><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(t *Task)</span></span> Execute()&#123;</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;任务id为：&quot;</span>,t.Id,<span class=\"string\">&quot;,当前时间为：&quot;</span>,time.Now())</span><br><span class=\"line\">\tt.f()</span><br><span class=\"line\">\ttime.Sleep(<span class=\"number\">2</span> * time.Second)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"完整代码如下\"><a href=\"#完整代码如下\" class=\"headerlink\" title=\"完整代码如下\"></a>完整代码如下</h4><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cache</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;sync&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Task <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tf <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> <span class=\"type\">error</span></span><br><span class=\"line\">\tId <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Newtask</span><span class=\"params\">(arg_f <span class=\"keyword\">func</span>()</span></span> <span class=\"type\">error</span>,id <span class=\"type\">int</span>) *Task&#123;</span><br><span class=\"line\">\tt :=Task&#123;</span><br><span class=\"line\">\t\tf:\targ_f,</span><br><span class=\"line\">\t\tId:\tid,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;t</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(t *Task)</span></span> Execute()&#123;</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;任务id为：&quot;</span>,t.Id,<span class=\"string\">&quot;,当前时间为：&quot;</span>,time.Now())</span><br><span class=\"line\">\tt.f()</span><br><span class=\"line\">\ttime.Sleep(<span class=\"number\">2</span> * time.Second)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">type</span> Workpool <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tJobchannel <span class=\"keyword\">chan</span> *Task</span><br><span class=\"line\">\tWorkernum <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// maxsize 工人多少个，maxlen 多长的管道</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewWorkpool</span><span class=\"params\">(maxsize <span class=\"type\">int</span>,maxlen <span class=\"type\">int</span>)</span></span> *Workpool &#123;</span><br><span class=\"line\">\tw := Workpool&#123;</span><br><span class=\"line\">\t\tJobchannel:      <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> *Task,maxlen),</span><br><span class=\"line\">\t\tWorkernum:       maxsize,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;w</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(p *Workpool)</span></span> AllocateJobTask(maxnumjobs <span class=\"type\">int</span>) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i:=<span class=\"number\">0</span>;i&lt;maxnumjobs;i++&#123;</span><br><span class=\"line\">\t\tt := Newtask(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//任务是打印当前时间</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">//fmt.Println(&quot;任务id为：&quot;,i,&quot;,当前时间为：&quot;,time.Now())</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t\t&#125;,i)</span><br><span class=\"line\">\t\tp.Jobchannel &lt;- t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"built_in\">close</span>(p.Jobchannel)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(p *Workpool)</span></span> CreateWorkPool()&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> wg sync.WaitGroup</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i:=<span class=\"number\">0</span>; i&lt;p.Workernum;i++  &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">go</span> p.Work(&amp;wg,i)</span><br><span class=\"line\">\t\twg.Add(<span class=\"number\">1</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\twg.Wait()</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(p *Workpool)</span></span> Work(wg *sync.WaitGroup,id <span class=\"type\">int</span>)&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> job :=<span class=\"keyword\">range</span> p.Jobchannel&#123;</span><br><span class=\"line\">\t\tjob.Execute()</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;我是工人:&quot;</span>,id,<span class=\"string\">&quot;正在工作job:&quot;</span>,job.Id)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\twg.Done()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">GetCacheChannel</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\tstartTime :=time.Now()</span><br><span class=\"line\">\tw :=NewWorkpool(<span class=\"number\">10</span>,<span class=\"number\">10</span>)</span><br><span class=\"line\">\tmaxnumjobs :=<span class=\"number\">100</span></span><br><span class=\"line\">\t<span class=\"comment\">//先初始化线程池</span></span><br><span class=\"line\">\t<span class=\"keyword\">go</span> w.AllocateJobTask(maxnumjobs)</span><br><span class=\"line\">\tw.CreateWorkPool()</span><br><span class=\"line\"></span><br><span class=\"line\">\tendTime := time.Now()</span><br><span class=\"line\">\tdiff := endTime.Sub(startTime)</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;total time taken &quot;</span>, diff.Seconds(), <span class=\"string\">&quot;seconds&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>写完这段代码，网上还有其他协程池的原理，大同小异</p>\n<ul>\n<li><a href=\"https://segmentfault.com/a/1190000018193161\"><font color=#0099ff>其他高效协程池做法</font></a></li>\n</ul>\n"},{"_content":"#### go协程池改编\n-基于[<font color=#0099ff>go协程池</font>](http://blog.hexiefamily.xin/article?path=%2fGOLANG%2fgo%e5%8d%8f%e7%a8%8b%e6%b1%a0.md)  \n\n#### 看下协程池的原理\n![avatar](https://blog.hexiefamily.xin/assets/workerpool2.png)  \n\n#### 协程池结构体,并且建立有缓存的任务channel\n```go\ntype Taskpool struct {\n\tTasknum     int\n\tTaskchannel chan *Task\n}\n\nfunc NewTaskPool(tasknum int, taskmaxlen int) *Taskpool {\n\ttp := &Taskpool{\n\t\tTasknum:     tasknum,\n\t\tTaskchannel: make(chan *Task, taskmaxlen),\n\t}\n\treturn tp\n}\nfunc (tp *Taskpool) AllocateTask() {\n\tdefer close(tp.Taskchannel)\n\tfor i := 0; i < tp.Tasknum; i++ {\n\t\tt := NewTask(func() error {\n\t\t\tfmt.Println(\"task \", i, \" is allocate\")\n\t\t\treturn nil\n\t\t}, i)\n\t\ttp.Taskchannel <- t\n\t}\n}\n```\n#### 图中goroutine2\n```go\nfunc (tp *Taskpool) ReceiveTask(jobchannel chan *Task) {\n\tdefer close(jobchannel)\n\tfor task := range tp.Taskchannel {\n\t\tfmt.Println(\"job channel get this task channel\", task.Id)\n\t\tjobchannel <- task\n\t}\n}\n```\n\n#### 图中goroutine3\n```go\nfunc (wp *Workerpool) ReceiveWork(jobchannel chan *Task) {\n\tdefer close(wp.Workchannel)\n\tfor work := range jobchannel {\n\t\tfmt.Println(\"work channel get this work from job channel\", work.Id)\n\t\twp.Workchannel <- work\n\t}\n}\n```\n\n#### 完整代码如下\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"sync\"\n\t\"time\"\n)\n\ntype Task struct {\n\tF  func() error\n\tId int\n}\n\nfunc NewTask(argc func() error, id int) *Task {\n\tt := &Task{\n\t\tF:  argc,\n\t\tId: id,\n\t}\n\treturn t\n}\n\nfunc (t *Task) Execute() {\n\tfmt.Println(\"task \", t.Id, \" is running \")\n\tt.F()\n\ttime.Sleep(2 * time.Second)\n}\n\n//Taskpool 可以不包含channel不然只剩tasknum\ntype Taskpool struct {\n\tTasknum     int\n\tTaskchannel chan *Task\n}\n\nfunc NewTaskPool(tasknum int, taskmaxlen int) *Taskpool {\n\ttp := &Taskpool{\n\t\tTasknum:     tasknum,\n\t\tTaskchannel: make(chan *Task, taskmaxlen),\n\t}\n\treturn tp\n}\nfunc (tp *Taskpool) AllocateTask() {\n\tdefer close(tp.Taskchannel)\n\tfor i := 0; i < tp.Tasknum; i++ {\n\t\tt := NewTask(func() error {\n\t\t\tfmt.Println(\"task \", i, \" is allocate\")\n\t\t\treturn nil\n\t\t}, i)\n\t\ttp.Taskchannel <- t\n\t}\n}\n\nfunc (tp *Taskpool) ReceiveTask(jobchannel chan *Task) {\n\tdefer close(jobchannel)\n\tfor task := range tp.Taskchannel {\n\t\tfmt.Println(\"job channel get this task channel\", task.Id)\n\t\tjobchannel <- task\n\t}\n}\n\ntype Workerpool struct {\n\tWorkernum   int\n\tWorkchannel chan *Task\n}\n\nfunc (wp *Workerpool) ReceiveWork(jobchannel chan *Task) {\n\tdefer close(wp.Workchannel)\n\tfor work := range jobchannel {\n\t\tfmt.Println(\"work channel get this work from job channel\", work.Id)\n\t\twp.Workchannel <- work\n\t}\n}\nfunc NewWorkerPool(workernum int, workmaxlen int) *Workerpool {\n\tw := &Workerpool{\n\t\tWorkernum:   workernum,\n\t\tWorkchannel: make(chan *Task, workmaxlen),\n\t}\n\treturn w\n}\nfunc (w *Workerpool) CreateWork() {\n\tvar wg sync.WaitGroup\n\tfmt.Println(\"work num is:\", w.Workernum)\n\tfor i := 0; i < w.Workernum; i++ {\n\t\twg.Add(1)\n\t\t//waitgroup 需要加goroutine\n\t\tgo w.GetWork(&wg, i)\n\t}\n\twg.Wait()\n}\nfunc (w *Workerpool) GetWork(wg *sync.WaitGroup, id int) {\n\tfor job := range w.Workchannel {\n\t\tjob.Execute()\n\t\tfmt.Println(\"worker \", id, \" works with task \", job.Id)\n\t}\n\twg.Done()\n}\nfunc main() {\n\tstartTime := time.Now()\n\tchannelLen := 10\n\tworkerNum := 20\n\ttaskNum := 100\n\tjobChannel := make(chan *Task, channelLen)\n\tworker := NewWorkerPool(workerNum, channelLen)\n\ttask := NewTaskPool(taskNum, channelLen)\n\tgo task.AllocateTask()\n\tgo task.ReceiveTask(jobChannel)\n\tgo worker.ReceiveWork(jobChannel)\n\tworker.CreateWork()\n\tendTime := time.Now()\n\tdiff := endTime.Sub(startTime)\n\tfmt.Println(\"total time is :\", diff.Seconds(), \" seconds\")\n}\n\n```\n","source":"_posts/GOLANG/go协程池2.md","raw":"---\ncategories:\n  - GOLANG\n---\n#### go协程池改编\n-基于[<font color=#0099ff>go协程池</font>](http://blog.hexiefamily.xin/article?path=%2fGOLANG%2fgo%e5%8d%8f%e7%a8%8b%e6%b1%a0.md)  \n\n#### 看下协程池的原理\n![avatar](https://blog.hexiefamily.xin/assets/workerpool2.png)  \n\n#### 协程池结构体,并且建立有缓存的任务channel\n```go\ntype Taskpool struct {\n\tTasknum     int\n\tTaskchannel chan *Task\n}\n\nfunc NewTaskPool(tasknum int, taskmaxlen int) *Taskpool {\n\ttp := &Taskpool{\n\t\tTasknum:     tasknum,\n\t\tTaskchannel: make(chan *Task, taskmaxlen),\n\t}\n\treturn tp\n}\nfunc (tp *Taskpool) AllocateTask() {\n\tdefer close(tp.Taskchannel)\n\tfor i := 0; i < tp.Tasknum; i++ {\n\t\tt := NewTask(func() error {\n\t\t\tfmt.Println(\"task \", i, \" is allocate\")\n\t\t\treturn nil\n\t\t}, i)\n\t\ttp.Taskchannel <- t\n\t}\n}\n```\n#### 图中goroutine2\n```go\nfunc (tp *Taskpool) ReceiveTask(jobchannel chan *Task) {\n\tdefer close(jobchannel)\n\tfor task := range tp.Taskchannel {\n\t\tfmt.Println(\"job channel get this task channel\", task.Id)\n\t\tjobchannel <- task\n\t}\n}\n```\n\n#### 图中goroutine3\n```go\nfunc (wp *Workerpool) ReceiveWork(jobchannel chan *Task) {\n\tdefer close(wp.Workchannel)\n\tfor work := range jobchannel {\n\t\tfmt.Println(\"work channel get this work from job channel\", work.Id)\n\t\twp.Workchannel <- work\n\t}\n}\n```\n\n#### 完整代码如下\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"sync\"\n\t\"time\"\n)\n\ntype Task struct {\n\tF  func() error\n\tId int\n}\n\nfunc NewTask(argc func() error, id int) *Task {\n\tt := &Task{\n\t\tF:  argc,\n\t\tId: id,\n\t}\n\treturn t\n}\n\nfunc (t *Task) Execute() {\n\tfmt.Println(\"task \", t.Id, \" is running \")\n\tt.F()\n\ttime.Sleep(2 * time.Second)\n}\n\n//Taskpool 可以不包含channel不然只剩tasknum\ntype Taskpool struct {\n\tTasknum     int\n\tTaskchannel chan *Task\n}\n\nfunc NewTaskPool(tasknum int, taskmaxlen int) *Taskpool {\n\ttp := &Taskpool{\n\t\tTasknum:     tasknum,\n\t\tTaskchannel: make(chan *Task, taskmaxlen),\n\t}\n\treturn tp\n}\nfunc (tp *Taskpool) AllocateTask() {\n\tdefer close(tp.Taskchannel)\n\tfor i := 0; i < tp.Tasknum; i++ {\n\t\tt := NewTask(func() error {\n\t\t\tfmt.Println(\"task \", i, \" is allocate\")\n\t\t\treturn nil\n\t\t}, i)\n\t\ttp.Taskchannel <- t\n\t}\n}\n\nfunc (tp *Taskpool) ReceiveTask(jobchannel chan *Task) {\n\tdefer close(jobchannel)\n\tfor task := range tp.Taskchannel {\n\t\tfmt.Println(\"job channel get this task channel\", task.Id)\n\t\tjobchannel <- task\n\t}\n}\n\ntype Workerpool struct {\n\tWorkernum   int\n\tWorkchannel chan *Task\n}\n\nfunc (wp *Workerpool) ReceiveWork(jobchannel chan *Task) {\n\tdefer close(wp.Workchannel)\n\tfor work := range jobchannel {\n\t\tfmt.Println(\"work channel get this work from job channel\", work.Id)\n\t\twp.Workchannel <- work\n\t}\n}\nfunc NewWorkerPool(workernum int, workmaxlen int) *Workerpool {\n\tw := &Workerpool{\n\t\tWorkernum:   workernum,\n\t\tWorkchannel: make(chan *Task, workmaxlen),\n\t}\n\treturn w\n}\nfunc (w *Workerpool) CreateWork() {\n\tvar wg sync.WaitGroup\n\tfmt.Println(\"work num is:\", w.Workernum)\n\tfor i := 0; i < w.Workernum; i++ {\n\t\twg.Add(1)\n\t\t//waitgroup 需要加goroutine\n\t\tgo w.GetWork(&wg, i)\n\t}\n\twg.Wait()\n}\nfunc (w *Workerpool) GetWork(wg *sync.WaitGroup, id int) {\n\tfor job := range w.Workchannel {\n\t\tjob.Execute()\n\t\tfmt.Println(\"worker \", id, \" works with task \", job.Id)\n\t}\n\twg.Done()\n}\nfunc main() {\n\tstartTime := time.Now()\n\tchannelLen := 10\n\tworkerNum := 20\n\ttaskNum := 100\n\tjobChannel := make(chan *Task, channelLen)\n\tworker := NewWorkerPool(workerNum, channelLen)\n\ttask := NewTaskPool(taskNum, channelLen)\n\tgo task.AllocateTask()\n\tgo task.ReceiveTask(jobChannel)\n\tgo worker.ReceiveWork(jobChannel)\n\tworker.CreateWork()\n\tendTime := time.Now()\n\tdiff := endTime.Sub(startTime)\n\tfmt.Println(\"total time is :\", diff.Seconds(), \" seconds\")\n}\n\n```\n","slug":"go协程池2","published":1,"category":"GOLANG","date":"2023-06-08T23:03:56.090Z","updated":"2023-06-08T23:12:13.672Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5se5000mdxjc3pv2cl2k","content":"<h4 id=\"go协程池改编\"><a href=\"#go协程池改编\" class=\"headerlink\" title=\"go协程池改编\"></a>go协程池改编</h4><p>-基于<a href=\"http://blog.hexiefamily.xin/article?path=/GOLANG/go%E5%8D%8F%E7%A8%8B%E6%B1%A0.md\"><font color=#0099ff>go协程池</font></a>  </p>\n<h4 id=\"看下协程池的原理\"><a href=\"#看下协程池的原理\" class=\"headerlink\" title=\"看下协程池的原理\"></a>看下协程池的原理</h4><p><img src=\"https://blog.hexiefamily.xin/assets/workerpool2.png\" alt=\"avatar\">  </p>\n<h4 id=\"协程池结构体-并且建立有缓存的任务channel\"><a href=\"#协程池结构体-并且建立有缓存的任务channel\" class=\"headerlink\" title=\"协程池结构体,并且建立有缓存的任务channel\"></a>协程池结构体,并且建立有缓存的任务channel</h4><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Taskpool <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tTasknum     <span class=\"type\">int</span></span><br><span class=\"line\">\tTaskchannel <span class=\"keyword\">chan</span> *Task</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewTaskPool</span><span class=\"params\">(tasknum <span class=\"type\">int</span>, taskmaxlen <span class=\"type\">int</span>)</span></span> *Taskpool &#123;</span><br><span class=\"line\">\ttp := &amp;Taskpool&#123;</span><br><span class=\"line\">\t\tTasknum:     tasknum,</span><br><span class=\"line\">\t\tTaskchannel: <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> *Task, taskmaxlen),</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> tp</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(tp *Taskpool)</span></span> AllocateTask() &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> <span class=\"built_in\">close</span>(tp.Taskchannel)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; tp.Tasknum; i++ &#123;</span><br><span class=\"line\">\t\tt := NewTask(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t\t\tfmt.Println(<span class=\"string\">&quot;task &quot;</span>, i, <span class=\"string\">&quot; is allocate&quot;</span>)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t\t&#125;, i)</span><br><span class=\"line\">\t\ttp.Taskchannel &lt;- t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"图中goroutine2\"><a href=\"#图中goroutine2\" class=\"headerlink\" title=\"图中goroutine2\"></a>图中goroutine2</h4><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(tp *Taskpool)</span></span> ReceiveTask(jobchannel <span class=\"keyword\">chan</span> *Task) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> <span class=\"built_in\">close</span>(jobchannel)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> task := <span class=\"keyword\">range</span> tp.Taskchannel &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;job channel get this task channel&quot;</span>, task.Id)</span><br><span class=\"line\">\t\tjobchannel &lt;- task</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"图中goroutine3\"><a href=\"#图中goroutine3\" class=\"headerlink\" title=\"图中goroutine3\"></a>图中goroutine3</h4><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(wp *Workerpool)</span></span> ReceiveWork(jobchannel <span class=\"keyword\">chan</span> *Task) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> <span class=\"built_in\">close</span>(wp.Workchannel)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> work := <span class=\"keyword\">range</span> jobchannel &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;work channel get this work from job channel&quot;</span>, work.Id)</span><br><span class=\"line\">\t\twp.Workchannel &lt;- work</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"完整代码如下\"><a href=\"#完整代码如下\" class=\"headerlink\" title=\"完整代码如下\"></a>完整代码如下</h4><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;sync&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Task <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tF  <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> <span class=\"type\">error</span></span><br><span class=\"line\">\tId <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewTask</span><span class=\"params\">(argc <span class=\"keyword\">func</span>()</span></span> <span class=\"type\">error</span>, id <span class=\"type\">int</span>) *Task &#123;</span><br><span class=\"line\">\tt := &amp;Task&#123;</span><br><span class=\"line\">\t\tF:  argc,</span><br><span class=\"line\">\t\tId: id,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> t</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(t *Task)</span></span> Execute() &#123;</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;task &quot;</span>, t.Id, <span class=\"string\">&quot; is running &quot;</span>)</span><br><span class=\"line\">\tt.F()</span><br><span class=\"line\">\ttime.Sleep(<span class=\"number\">2</span> * time.Second)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Taskpool 可以不包含channel不然只剩tasknum</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> Taskpool <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tTasknum     <span class=\"type\">int</span></span><br><span class=\"line\">\tTaskchannel <span class=\"keyword\">chan</span> *Task</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewTaskPool</span><span class=\"params\">(tasknum <span class=\"type\">int</span>, taskmaxlen <span class=\"type\">int</span>)</span></span> *Taskpool &#123;</span><br><span class=\"line\">\ttp := &amp;Taskpool&#123;</span><br><span class=\"line\">\t\tTasknum:     tasknum,</span><br><span class=\"line\">\t\tTaskchannel: <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> *Task, taskmaxlen),</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> tp</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(tp *Taskpool)</span></span> AllocateTask() &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> <span class=\"built_in\">close</span>(tp.Taskchannel)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; tp.Tasknum; i++ &#123;</span><br><span class=\"line\">\t\tt := NewTask(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t\t\tfmt.Println(<span class=\"string\">&quot;task &quot;</span>, i, <span class=\"string\">&quot; is allocate&quot;</span>)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t\t&#125;, i)</span><br><span class=\"line\">\t\ttp.Taskchannel &lt;- t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(tp *Taskpool)</span></span> ReceiveTask(jobchannel <span class=\"keyword\">chan</span> *Task) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> <span class=\"built_in\">close</span>(jobchannel)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> task := <span class=\"keyword\">range</span> tp.Taskchannel &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;job channel get this task channel&quot;</span>, task.Id)</span><br><span class=\"line\">\t\tjobchannel &lt;- task</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Workerpool <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tWorkernum   <span class=\"type\">int</span></span><br><span class=\"line\">\tWorkchannel <span class=\"keyword\">chan</span> *Task</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(wp *Workerpool)</span></span> ReceiveWork(jobchannel <span class=\"keyword\">chan</span> *Task) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> <span class=\"built_in\">close</span>(wp.Workchannel)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> work := <span class=\"keyword\">range</span> jobchannel &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;work channel get this work from job channel&quot;</span>, work.Id)</span><br><span class=\"line\">\t\twp.Workchannel &lt;- work</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewWorkerPool</span><span class=\"params\">(workernum <span class=\"type\">int</span>, workmaxlen <span class=\"type\">int</span>)</span></span> *Workerpool &#123;</span><br><span class=\"line\">\tw := &amp;Workerpool&#123;</span><br><span class=\"line\">\t\tWorkernum:   workernum,</span><br><span class=\"line\">\t\tWorkchannel: <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> *Task, workmaxlen),</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> w</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(w *Workerpool)</span></span> CreateWork() &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> wg sync.WaitGroup</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;work num is:&quot;</span>, w.Workernum)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; w.Workernum; i++ &#123;</span><br><span class=\"line\">\t\twg.Add(<span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t<span class=\"comment\">//waitgroup 需要加goroutine</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">go</span> w.GetWork(&amp;wg, i)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\twg.Wait()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(w *Workerpool)</span></span> GetWork(wg *sync.WaitGroup, id <span class=\"type\">int</span>) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> job := <span class=\"keyword\">range</span> w.Workchannel &#123;</span><br><span class=\"line\">\t\tjob.Execute()</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;worker &quot;</span>, id, <span class=\"string\">&quot; works with task &quot;</span>, job.Id)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\twg.Done()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tstartTime := time.Now()</span><br><span class=\"line\">\tchannelLen := <span class=\"number\">10</span></span><br><span class=\"line\">\tworkerNum := <span class=\"number\">20</span></span><br><span class=\"line\">\ttaskNum := <span class=\"number\">100</span></span><br><span class=\"line\">\tjobChannel := <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> *Task, channelLen)</span><br><span class=\"line\">\tworker := NewWorkerPool(workerNum, channelLen)</span><br><span class=\"line\">\ttask := NewTaskPool(taskNum, channelLen)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> task.AllocateTask()</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> task.ReceiveTask(jobChannel)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> worker.ReceiveWork(jobChannel)</span><br><span class=\"line\">\tworker.CreateWork()</span><br><span class=\"line\">\tendTime := time.Now()</span><br><span class=\"line\">\tdiff := endTime.Sub(startTime)</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;total time is :&quot;</span>, diff.Seconds(), <span class=\"string\">&quot; seconds&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"length":3483,"excerpt":"","more":"<h4 id=\"go协程池改编\"><a href=\"#go协程池改编\" class=\"headerlink\" title=\"go协程池改编\"></a>go协程池改编</h4><p>-基于<a href=\"http://blog.hexiefamily.xin/article?path=/GOLANG/go%E5%8D%8F%E7%A8%8B%E6%B1%A0.md\"><font color=#0099ff>go协程池</font></a>  </p>\n<h4 id=\"看下协程池的原理\"><a href=\"#看下协程池的原理\" class=\"headerlink\" title=\"看下协程池的原理\"></a>看下协程池的原理</h4><p><img src=\"https://blog.hexiefamily.xin/assets/workerpool2.png\" alt=\"avatar\">  </p>\n<h4 id=\"协程池结构体-并且建立有缓存的任务channel\"><a href=\"#协程池结构体-并且建立有缓存的任务channel\" class=\"headerlink\" title=\"协程池结构体,并且建立有缓存的任务channel\"></a>协程池结构体,并且建立有缓存的任务channel</h4><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Taskpool <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tTasknum     <span class=\"type\">int</span></span><br><span class=\"line\">\tTaskchannel <span class=\"keyword\">chan</span> *Task</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewTaskPool</span><span class=\"params\">(tasknum <span class=\"type\">int</span>, taskmaxlen <span class=\"type\">int</span>)</span></span> *Taskpool &#123;</span><br><span class=\"line\">\ttp := &amp;Taskpool&#123;</span><br><span class=\"line\">\t\tTasknum:     tasknum,</span><br><span class=\"line\">\t\tTaskchannel: <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> *Task, taskmaxlen),</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> tp</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(tp *Taskpool)</span></span> AllocateTask() &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> <span class=\"built_in\">close</span>(tp.Taskchannel)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; tp.Tasknum; i++ &#123;</span><br><span class=\"line\">\t\tt := NewTask(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t\t\tfmt.Println(<span class=\"string\">&quot;task &quot;</span>, i, <span class=\"string\">&quot; is allocate&quot;</span>)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t\t&#125;, i)</span><br><span class=\"line\">\t\ttp.Taskchannel &lt;- t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"图中goroutine2\"><a href=\"#图中goroutine2\" class=\"headerlink\" title=\"图中goroutine2\"></a>图中goroutine2</h4><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(tp *Taskpool)</span></span> ReceiveTask(jobchannel <span class=\"keyword\">chan</span> *Task) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> <span class=\"built_in\">close</span>(jobchannel)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> task := <span class=\"keyword\">range</span> tp.Taskchannel &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;job channel get this task channel&quot;</span>, task.Id)</span><br><span class=\"line\">\t\tjobchannel &lt;- task</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"图中goroutine3\"><a href=\"#图中goroutine3\" class=\"headerlink\" title=\"图中goroutine3\"></a>图中goroutine3</h4><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(wp *Workerpool)</span></span> ReceiveWork(jobchannel <span class=\"keyword\">chan</span> *Task) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> <span class=\"built_in\">close</span>(wp.Workchannel)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> work := <span class=\"keyword\">range</span> jobchannel &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;work channel get this work from job channel&quot;</span>, work.Id)</span><br><span class=\"line\">\t\twp.Workchannel &lt;- work</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"完整代码如下\"><a href=\"#完整代码如下\" class=\"headerlink\" title=\"完整代码如下\"></a>完整代码如下</h4><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;sync&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Task <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tF  <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> <span class=\"type\">error</span></span><br><span class=\"line\">\tId <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewTask</span><span class=\"params\">(argc <span class=\"keyword\">func</span>()</span></span> <span class=\"type\">error</span>, id <span class=\"type\">int</span>) *Task &#123;</span><br><span class=\"line\">\tt := &amp;Task&#123;</span><br><span class=\"line\">\t\tF:  argc,</span><br><span class=\"line\">\t\tId: id,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> t</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(t *Task)</span></span> Execute() &#123;</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;task &quot;</span>, t.Id, <span class=\"string\">&quot; is running &quot;</span>)</span><br><span class=\"line\">\tt.F()</span><br><span class=\"line\">\ttime.Sleep(<span class=\"number\">2</span> * time.Second)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Taskpool 可以不包含channel不然只剩tasknum</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> Taskpool <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tTasknum     <span class=\"type\">int</span></span><br><span class=\"line\">\tTaskchannel <span class=\"keyword\">chan</span> *Task</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewTaskPool</span><span class=\"params\">(tasknum <span class=\"type\">int</span>, taskmaxlen <span class=\"type\">int</span>)</span></span> *Taskpool &#123;</span><br><span class=\"line\">\ttp := &amp;Taskpool&#123;</span><br><span class=\"line\">\t\tTasknum:     tasknum,</span><br><span class=\"line\">\t\tTaskchannel: <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> *Task, taskmaxlen),</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> tp</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(tp *Taskpool)</span></span> AllocateTask() &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> <span class=\"built_in\">close</span>(tp.Taskchannel)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; tp.Tasknum; i++ &#123;</span><br><span class=\"line\">\t\tt := NewTask(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t\t\tfmt.Println(<span class=\"string\">&quot;task &quot;</span>, i, <span class=\"string\">&quot; is allocate&quot;</span>)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t\t&#125;, i)</span><br><span class=\"line\">\t\ttp.Taskchannel &lt;- t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(tp *Taskpool)</span></span> ReceiveTask(jobchannel <span class=\"keyword\">chan</span> *Task) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> <span class=\"built_in\">close</span>(jobchannel)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> task := <span class=\"keyword\">range</span> tp.Taskchannel &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;job channel get this task channel&quot;</span>, task.Id)</span><br><span class=\"line\">\t\tjobchannel &lt;- task</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Workerpool <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tWorkernum   <span class=\"type\">int</span></span><br><span class=\"line\">\tWorkchannel <span class=\"keyword\">chan</span> *Task</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(wp *Workerpool)</span></span> ReceiveWork(jobchannel <span class=\"keyword\">chan</span> *Task) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> <span class=\"built_in\">close</span>(wp.Workchannel)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> work := <span class=\"keyword\">range</span> jobchannel &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;work channel get this work from job channel&quot;</span>, work.Id)</span><br><span class=\"line\">\t\twp.Workchannel &lt;- work</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewWorkerPool</span><span class=\"params\">(workernum <span class=\"type\">int</span>, workmaxlen <span class=\"type\">int</span>)</span></span> *Workerpool &#123;</span><br><span class=\"line\">\tw := &amp;Workerpool&#123;</span><br><span class=\"line\">\t\tWorkernum:   workernum,</span><br><span class=\"line\">\t\tWorkchannel: <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> *Task, workmaxlen),</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> w</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(w *Workerpool)</span></span> CreateWork() &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> wg sync.WaitGroup</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;work num is:&quot;</span>, w.Workernum)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; w.Workernum; i++ &#123;</span><br><span class=\"line\">\t\twg.Add(<span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t<span class=\"comment\">//waitgroup 需要加goroutine</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">go</span> w.GetWork(&amp;wg, i)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\twg.Wait()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(w *Workerpool)</span></span> GetWork(wg *sync.WaitGroup, id <span class=\"type\">int</span>) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> job := <span class=\"keyword\">range</span> w.Workchannel &#123;</span><br><span class=\"line\">\t\tjob.Execute()</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;worker &quot;</span>, id, <span class=\"string\">&quot; works with task &quot;</span>, job.Id)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\twg.Done()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tstartTime := time.Now()</span><br><span class=\"line\">\tchannelLen := <span class=\"number\">10</span></span><br><span class=\"line\">\tworkerNum := <span class=\"number\">20</span></span><br><span class=\"line\">\ttaskNum := <span class=\"number\">100</span></span><br><span class=\"line\">\tjobChannel := <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> *Task, channelLen)</span><br><span class=\"line\">\tworker := NewWorkerPool(workerNum, channelLen)</span><br><span class=\"line\">\ttask := NewTaskPool(taskNum, channelLen)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> task.AllocateTask()</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> task.ReceiveTask(jobChannel)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> worker.ReceiveWork(jobChannel)</span><br><span class=\"line\">\tworker.CreateWork()</span><br><span class=\"line\">\tendTime := time.Now()</span><br><span class=\"line\">\tdiff := endTime.Sub(startTime)</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;total time is :&quot;</span>, diff.Seconds(), <span class=\"string\">&quot; seconds&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n"},{"_content":"#### 时间格式转化\n1. import (\"github.com/360EntSecGroup-Skylar/excelize/v2\")\n2.  go.mod require (\n   github.com/360EntSecGroup-Skylar/excelize/v2 v2.0.2)\n3. \n```go\nstyle, _ = xlsx.NewStyle(`{\"number_format\":15}`)\nxlsx.SetCellStyle(\"Sheet1\", \"E7\", \"E7\", style)\ne7 := xlsx.GetCellValue(\"Sheet1\", \"E7\")\nprintln(e7) // 29-Jun-17\ncol,_:=excelize.ColumnNumberToName(5)//将索引转成字母\nstyle, _ := xlsx.NewStyle(`{\"number_format\":15}`)\nxlsx.SetCellStyle(oldsheet, col+strconv.Itoa(keyrow), col+strconv.Itoa(keyrow), style)\nformatday ,_:=xlsx.GetCellValue(oldsheet, col+strconv.Itoa(keyrow))\n```\n\n#### 时区问题：\n```go\nvar loc = time.FixedZone(\"CST\", 8*3600)       // 东八\nif runtime.GOOS !=\"windows\" {\n   loc, _ = time.LoadLocation(\"Asia/Shanghai\") //获取时区\n}\n\nlog.Println(\"2\",loc,runtime.GOOS)\nstarttmp, _ := time.ParseInLocation(timeLayout, start, loc)\n\n\n时间格式化输出的时区为东八区北京时间，无需关系系统所在时区。\n在Go语言上，go语言的time.Now()返回的是当地时区时间，直接用：\ntime.Now().Format(\"2006-01-02 15:04:05\")\n\n输出的是当地时区时间。\ngo语言并没有全局设置时区这么一个东西，每次输出时间都需要调用一个In()函数改变时区：\nvar cstSh, _ = time.LoadLocation(\"Asia/Shanghai\") //上海\nfmt.Println(\"SH : \", time.Now().In(cstSh).Format(\"2006-01-02 15:04:05\"))\n\n在windows系统上，没有安装go语言环境的情况下，time.LoadLocation会加载失败。\nvar cstZone = time.FixedZone(\"CST\", 8*3600)       // 东八\nfmt.Println(\"SH : \", time.Now().In(cstZone).Format(\"2006-01-02 15:04:05\"))\n\n最好的办法是用time.FixedZone\n```\n\n#### 获取单元格的背景颜色：\n```go\n  package main\n  import (\n   \"fmt\"\n   \"github.com/360EntSecGroup-Skylar/excelize\"\n  )\n  func main() {\n    xlsx, _ := excelize.OpenFile(\"Book1.xlsx\")\n    fmt.Println(getCellBgColor(xlsx, \"Sheet1\", \"C1\"))\n  }\n  func getCellBgColor(xlsx *excelize.File, sheet, axix string) string {\n    styleID := xlsx.GetCellStyle(sheet, axix)\n    fillID := xlsx.Styles.CellXfs.Xf[styleID].FillID\n    fgColor := xlsx.Styles.Fills.Fill[fillID].PatternFill.FgColor\n    if fgColor.Theme != nil {\n        srgbClr := xlsx.Theme.ThemeElements.ClrScheme.Children[*fgColor.Theme].SrgbClr.Val\n        return excelize.ThemeColor(srgbClr, fgColor.Tint)\n    }\n    return fgColor.RGB\n  }\n  ```","source":"_posts/GOLANG/go解析excel.md","raw":"---\ncategories:\n  - GOLANG\n---\n#### 时间格式转化\n1. import (\"github.com/360EntSecGroup-Skylar/excelize/v2\")\n2.  go.mod require (\n   github.com/360EntSecGroup-Skylar/excelize/v2 v2.0.2)\n3. \n```go\nstyle, _ = xlsx.NewStyle(`{\"number_format\":15}`)\nxlsx.SetCellStyle(\"Sheet1\", \"E7\", \"E7\", style)\ne7 := xlsx.GetCellValue(\"Sheet1\", \"E7\")\nprintln(e7) // 29-Jun-17\ncol,_:=excelize.ColumnNumberToName(5)//将索引转成字母\nstyle, _ := xlsx.NewStyle(`{\"number_format\":15}`)\nxlsx.SetCellStyle(oldsheet, col+strconv.Itoa(keyrow), col+strconv.Itoa(keyrow), style)\nformatday ,_:=xlsx.GetCellValue(oldsheet, col+strconv.Itoa(keyrow))\n```\n\n#### 时区问题：\n```go\nvar loc = time.FixedZone(\"CST\", 8*3600)       // 东八\nif runtime.GOOS !=\"windows\" {\n   loc, _ = time.LoadLocation(\"Asia/Shanghai\") //获取时区\n}\n\nlog.Println(\"2\",loc,runtime.GOOS)\nstarttmp, _ := time.ParseInLocation(timeLayout, start, loc)\n\n\n时间格式化输出的时区为东八区北京时间，无需关系系统所在时区。\n在Go语言上，go语言的time.Now()返回的是当地时区时间，直接用：\ntime.Now().Format(\"2006-01-02 15:04:05\")\n\n输出的是当地时区时间。\ngo语言并没有全局设置时区这么一个东西，每次输出时间都需要调用一个In()函数改变时区：\nvar cstSh, _ = time.LoadLocation(\"Asia/Shanghai\") //上海\nfmt.Println(\"SH : \", time.Now().In(cstSh).Format(\"2006-01-02 15:04:05\"))\n\n在windows系统上，没有安装go语言环境的情况下，time.LoadLocation会加载失败。\nvar cstZone = time.FixedZone(\"CST\", 8*3600)       // 东八\nfmt.Println(\"SH : \", time.Now().In(cstZone).Format(\"2006-01-02 15:04:05\"))\n\n最好的办法是用time.FixedZone\n```\n\n#### 获取单元格的背景颜色：\n```go\n  package main\n  import (\n   \"fmt\"\n   \"github.com/360EntSecGroup-Skylar/excelize\"\n  )\n  func main() {\n    xlsx, _ := excelize.OpenFile(\"Book1.xlsx\")\n    fmt.Println(getCellBgColor(xlsx, \"Sheet1\", \"C1\"))\n  }\n  func getCellBgColor(xlsx *excelize.File, sheet, axix string) string {\n    styleID := xlsx.GetCellStyle(sheet, axix)\n    fillID := xlsx.Styles.CellXfs.Xf[styleID].FillID\n    fgColor := xlsx.Styles.Fills.Fill[fillID].PatternFill.FgColor\n    if fgColor.Theme != nil {\n        srgbClr := xlsx.Theme.ThemeElements.ClrScheme.Children[*fgColor.Theme].SrgbClr.Val\n        return excelize.ThemeColor(srgbClr, fgColor.Tint)\n    }\n    return fgColor.RGB\n  }\n  ```","slug":"go解析excel","published":1,"category":"GOLANG","date":"2023-06-08T23:03:56.092Z","updated":"2023-06-08T23:12:13.672Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5se6000ndxjcb6yuh7e9","content":"<h4 id=\"时间格式转化\"><a href=\"#时间格式转化\" class=\"headerlink\" title=\"时间格式转化\"></a>时间格式转化</h4><ol>\n<li>import (“github.com&#x2F;360EntSecGroup-Skylar&#x2F;excelize&#x2F;v2”)</li>\n<li>go.mod require (<br>   github.com&#x2F;360EntSecGroup-Skylar&#x2F;excelize&#x2F;v2 v2.0.2)</li>\n<li><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">style, _ = xlsx.NewStyle(<span class=\"string\">`&#123;&quot;number_format&quot;:15&#125;`</span>)</span><br><span class=\"line\">xlsx.SetCellStyle(<span class=\"string\">&quot;Sheet1&quot;</span>, <span class=\"string\">&quot;E7&quot;</span>, <span class=\"string\">&quot;E7&quot;</span>, style)</span><br><span class=\"line\">e7 := xlsx.GetCellValue(<span class=\"string\">&quot;Sheet1&quot;</span>, <span class=\"string\">&quot;E7&quot;</span>)</span><br><span class=\"line\"><span class=\"built_in\">println</span>(e7) <span class=\"comment\">// 29-Jun-17</span></span><br><span class=\"line\">col,_:=excelize.ColumnNumberToName(<span class=\"number\">5</span>)<span class=\"comment\">//将索引转成字母</span></span><br><span class=\"line\">style, _ := xlsx.NewStyle(<span class=\"string\">`&#123;&quot;number_format&quot;:15&#125;`</span>)</span><br><span class=\"line\">xlsx.SetCellStyle(oldsheet, col+strconv.Itoa(keyrow), col+strconv.Itoa(keyrow), style)</span><br><span class=\"line\">formatday ,_:=xlsx.GetCellValue(oldsheet, col+strconv.Itoa(keyrow))</span><br></pre></td></tr></table></figure></li>\n</ol>\n<h4 id=\"时区问题：\"><a href=\"#时区问题：\" class=\"headerlink\" title=\"时区问题：\"></a>时区问题：</h4><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> loc = time.FixedZone(<span class=\"string\">&quot;CST&quot;</span>, <span class=\"number\">8</span>*<span class=\"number\">3600</span>)       <span class=\"comment\">// 东八</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> runtime.GOOS !=<span class=\"string\">&quot;windows&quot;</span> &#123;</span><br><span class=\"line\">   loc, _ = time.LoadLocation(<span class=\"string\">&quot;Asia/Shanghai&quot;</span>) <span class=\"comment\">//获取时区</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">log.Println(<span class=\"string\">&quot;2&quot;</span>,loc,runtime.GOOS)</span><br><span class=\"line\">starttmp, _ := time.ParseInLocation(timeLayout, start, loc)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">时间格式化输出的时区为东八区北京时间，无需关系系统所在时区。</span><br><span class=\"line\">在Go语言上，<span class=\"keyword\">go</span>语言的time.Now()返回的是当地时区时间，直接用：</span><br><span class=\"line\">time.Now().Format(<span class=\"string\">&quot;2006-01-02 15:04:05&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">输出的是当地时区时间。</span><br><span class=\"line\"><span class=\"keyword\">go</span>语言并没有全局设置时区这么一个东西，每次输出时间都需要调用一个In()函数改变时区：</span><br><span class=\"line\"><span class=\"keyword\">var</span> cstSh, _ = time.LoadLocation(<span class=\"string\">&quot;Asia/Shanghai&quot;</span>) <span class=\"comment\">//上海</span></span><br><span class=\"line\">fmt.Println(<span class=\"string\">&quot;SH : &quot;</span>, time.Now().In(cstSh).Format(<span class=\"string\">&quot;2006-01-02 15:04:05&quot;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">在windows系统上，没有安装<span class=\"keyword\">go</span>语言环境的情况下，time.LoadLocation会加载失败。</span><br><span class=\"line\"><span class=\"keyword\">var</span> cstZone = time.FixedZone(<span class=\"string\">&quot;CST&quot;</span>, <span class=\"number\">8</span>*<span class=\"number\">3600</span>)       <span class=\"comment\">// 东八</span></span><br><span class=\"line\">fmt.Println(<span class=\"string\">&quot;SH : &quot;</span>, time.Now().In(cstZone).Format(<span class=\"string\">&quot;2006-01-02 15:04:05&quot;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">最好的办法是用time.FixedZone</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"获取单元格的背景颜色：\"><a href=\"#获取单元格的背景颜色：\" class=\"headerlink\" title=\"获取单元格的背景颜色：\"></a>获取单元格的背景颜色：</h4><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\"> <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\"> <span class=\"string\">&quot;github.com/360EntSecGroup-Skylar/excelize&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  xlsx, _ := excelize.OpenFile(<span class=\"string\">&quot;Book1.xlsx&quot;</span>)</span><br><span class=\"line\">  fmt.Println(getCellBgColor(xlsx, <span class=\"string\">&quot;Sheet1&quot;</span>, <span class=\"string\">&quot;C1&quot;</span>))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">getCellBgColor</span><span class=\"params\">(xlsx *excelize.File, sheet, axix <span class=\"type\">string</span>)</span></span> <span class=\"type\">string</span> &#123;</span><br><span class=\"line\">  styleID := xlsx.GetCellStyle(sheet, axix)</span><br><span class=\"line\">  fillID := xlsx.Styles.CellXfs.Xf[styleID].FillID</span><br><span class=\"line\">  fgColor := xlsx.Styles.Fills.Fill[fillID].PatternFill.FgColor</span><br><span class=\"line\">  <span class=\"keyword\">if</span> fgColor.Theme != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">      srgbClr := xlsx.Theme.ThemeElements.ClrScheme.Children[*fgColor.Theme].SrgbClr.Val</span><br><span class=\"line\">      <span class=\"keyword\">return</span> excelize.ThemeColor(srgbClr, fgColor.Tint)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> fgColor.RGB</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"length":2119,"excerpt":"","more":"<h4 id=\"时间格式转化\"><a href=\"#时间格式转化\" class=\"headerlink\" title=\"时间格式转化\"></a>时间格式转化</h4><ol>\n<li>import (“github.com&#x2F;360EntSecGroup-Skylar&#x2F;excelize&#x2F;v2”)</li>\n<li>go.mod require (<br>   github.com&#x2F;360EntSecGroup-Skylar&#x2F;excelize&#x2F;v2 v2.0.2)</li>\n<li><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">style, _ = xlsx.NewStyle(<span class=\"string\">`&#123;&quot;number_format&quot;:15&#125;`</span>)</span><br><span class=\"line\">xlsx.SetCellStyle(<span class=\"string\">&quot;Sheet1&quot;</span>, <span class=\"string\">&quot;E7&quot;</span>, <span class=\"string\">&quot;E7&quot;</span>, style)</span><br><span class=\"line\">e7 := xlsx.GetCellValue(<span class=\"string\">&quot;Sheet1&quot;</span>, <span class=\"string\">&quot;E7&quot;</span>)</span><br><span class=\"line\"><span class=\"built_in\">println</span>(e7) <span class=\"comment\">// 29-Jun-17</span></span><br><span class=\"line\">col,_:=excelize.ColumnNumberToName(<span class=\"number\">5</span>)<span class=\"comment\">//将索引转成字母</span></span><br><span class=\"line\">style, _ := xlsx.NewStyle(<span class=\"string\">`&#123;&quot;number_format&quot;:15&#125;`</span>)</span><br><span class=\"line\">xlsx.SetCellStyle(oldsheet, col+strconv.Itoa(keyrow), col+strconv.Itoa(keyrow), style)</span><br><span class=\"line\">formatday ,_:=xlsx.GetCellValue(oldsheet, col+strconv.Itoa(keyrow))</span><br></pre></td></tr></table></figure></li>\n</ol>\n<h4 id=\"时区问题：\"><a href=\"#时区问题：\" class=\"headerlink\" title=\"时区问题：\"></a>时区问题：</h4><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> loc = time.FixedZone(<span class=\"string\">&quot;CST&quot;</span>, <span class=\"number\">8</span>*<span class=\"number\">3600</span>)       <span class=\"comment\">// 东八</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> runtime.GOOS !=<span class=\"string\">&quot;windows&quot;</span> &#123;</span><br><span class=\"line\">   loc, _ = time.LoadLocation(<span class=\"string\">&quot;Asia/Shanghai&quot;</span>) <span class=\"comment\">//获取时区</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">log.Println(<span class=\"string\">&quot;2&quot;</span>,loc,runtime.GOOS)</span><br><span class=\"line\">starttmp, _ := time.ParseInLocation(timeLayout, start, loc)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">时间格式化输出的时区为东八区北京时间，无需关系系统所在时区。</span><br><span class=\"line\">在Go语言上，<span class=\"keyword\">go</span>语言的time.Now()返回的是当地时区时间，直接用：</span><br><span class=\"line\">time.Now().Format(<span class=\"string\">&quot;2006-01-02 15:04:05&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">输出的是当地时区时间。</span><br><span class=\"line\"><span class=\"keyword\">go</span>语言并没有全局设置时区这么一个东西，每次输出时间都需要调用一个In()函数改变时区：</span><br><span class=\"line\"><span class=\"keyword\">var</span> cstSh, _ = time.LoadLocation(<span class=\"string\">&quot;Asia/Shanghai&quot;</span>) <span class=\"comment\">//上海</span></span><br><span class=\"line\">fmt.Println(<span class=\"string\">&quot;SH : &quot;</span>, time.Now().In(cstSh).Format(<span class=\"string\">&quot;2006-01-02 15:04:05&quot;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">在windows系统上，没有安装<span class=\"keyword\">go</span>语言环境的情况下，time.LoadLocation会加载失败。</span><br><span class=\"line\"><span class=\"keyword\">var</span> cstZone = time.FixedZone(<span class=\"string\">&quot;CST&quot;</span>, <span class=\"number\">8</span>*<span class=\"number\">3600</span>)       <span class=\"comment\">// 东八</span></span><br><span class=\"line\">fmt.Println(<span class=\"string\">&quot;SH : &quot;</span>, time.Now().In(cstZone).Format(<span class=\"string\">&quot;2006-01-02 15:04:05&quot;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">最好的办法是用time.FixedZone</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"获取单元格的背景颜色：\"><a href=\"#获取单元格的背景颜色：\" class=\"headerlink\" title=\"获取单元格的背景颜色：\"></a>获取单元格的背景颜色：</h4><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\"> <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\"> <span class=\"string\">&quot;github.com/360EntSecGroup-Skylar/excelize&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  xlsx, _ := excelize.OpenFile(<span class=\"string\">&quot;Book1.xlsx&quot;</span>)</span><br><span class=\"line\">  fmt.Println(getCellBgColor(xlsx, <span class=\"string\">&quot;Sheet1&quot;</span>, <span class=\"string\">&quot;C1&quot;</span>))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">getCellBgColor</span><span class=\"params\">(xlsx *excelize.File, sheet, axix <span class=\"type\">string</span>)</span></span> <span class=\"type\">string</span> &#123;</span><br><span class=\"line\">  styleID := xlsx.GetCellStyle(sheet, axix)</span><br><span class=\"line\">  fillID := xlsx.Styles.CellXfs.Xf[styleID].FillID</span><br><span class=\"line\">  fgColor := xlsx.Styles.Fills.Fill[fillID].PatternFill.FgColor</span><br><span class=\"line\">  <span class=\"keyword\">if</span> fgColor.Theme != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">      srgbClr := xlsx.Theme.ThemeElements.ClrScheme.Children[*fgColor.Theme].SrgbClr.Val</span><br><span class=\"line\">      <span class=\"keyword\">return</span> excelize.ThemeColor(srgbClr, fgColor.Tint)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> fgColor.RGB</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"_content":"# grpc php client \n**服务端取的是https://www.jianshu.com/p/7fe7a8507745 案例**  \n\n\n#### 需要执行\n> export GO111MODULE=on  \ngo mod tidy\n#### 安装依赖\n>pecl install grpc  \npecl install protobuf  \n同时并.so 文件放进ini中，如果是在docker中使用docker-php-ext-enable grpc,docker-php-ext-enable protobuf  \nwget https://github.com/google/protobuf/releases/download/v3.5.1/protobuf-all-3.5.1.zip  \nunzip protobuf-all-3.5.1.zip  \ncd protobuf-3.5.1/  \n./configure  \nmake  \nmake install  \nprotoc --version  \n出现make 错误，安装apt-get install automake  \nldconfig  \n\n1、protoc --proto_path=../../ --php_out=. helloServer.proto  \n2、在client/phpclient/Rpc_proto 文件夹新建HelloClient.php  \n\n    <?php\n\t\tnamespace Rpc_proto;\n\t\tclass HelloClient extends \\Grpc\\BaseStub{\n\t\t\tpublic function __construct($hostname, $opts, $channel = null) {\n\t\t\t\tparent::__construct($hostname, $opts, $channel);\n\t\t\t}\n\t\t\tpublic function SayHello(\\Rpc_proto\\HelloRequest $argument,$metadata=[],$options=[]){\n\t\t\t\treturn $this->_simpleRequest('/rpc_proto.HelloServer/SayHello',\n\t\t\t\t\t$argument,\n\t\t\t\t\t['\\Rpc_proto\\HelloReply', 'decode'],\n\t\t\t\t\t$metadata, $options);\n\t\t\t}\n\t\t\tpublic function GetHelloMsg(\\Rpc_proto\\HelloRequest $argument,$metadata=[],$options=[]){\n\t\t\t\treturn $this->_simpleRequest('/rpc_proto.HelloServer/GetHelloMsg',\n\t\t\t\t\t$argument,\n\t\t\t\t\t['\\Rpc_proto\\HelloMessage', 'decode'],\n\t\t\t\t\t$metadata, $options);\n\t\t\t}\n\t\t}\n\t?>\n3、cd client/phpclient && composer install  \n4、cd server && go run server.go  \n5、新建hello.php,并执行php hello.php\n结果：\n> helloGreenHat  \nthis is from server HAHA!","source":"_posts/GOLANG/grpc_php客户端.md","raw":"---\ncategories:\n  - GOLANG\n---\n# grpc php client \n**服务端取的是https://www.jianshu.com/p/7fe7a8507745 案例**  \n\n\n#### 需要执行\n> export GO111MODULE=on  \ngo mod tidy\n#### 安装依赖\n>pecl install grpc  \npecl install protobuf  \n同时并.so 文件放进ini中，如果是在docker中使用docker-php-ext-enable grpc,docker-php-ext-enable protobuf  \nwget https://github.com/google/protobuf/releases/download/v3.5.1/protobuf-all-3.5.1.zip  \nunzip protobuf-all-3.5.1.zip  \ncd protobuf-3.5.1/  \n./configure  \nmake  \nmake install  \nprotoc --version  \n出现make 错误，安装apt-get install automake  \nldconfig  \n\n1、protoc --proto_path=../../ --php_out=. helloServer.proto  \n2、在client/phpclient/Rpc_proto 文件夹新建HelloClient.php  \n\n    <?php\n\t\tnamespace Rpc_proto;\n\t\tclass HelloClient extends \\Grpc\\BaseStub{\n\t\t\tpublic function __construct($hostname, $opts, $channel = null) {\n\t\t\t\tparent::__construct($hostname, $opts, $channel);\n\t\t\t}\n\t\t\tpublic function SayHello(\\Rpc_proto\\HelloRequest $argument,$metadata=[],$options=[]){\n\t\t\t\treturn $this->_simpleRequest('/rpc_proto.HelloServer/SayHello',\n\t\t\t\t\t$argument,\n\t\t\t\t\t['\\Rpc_proto\\HelloReply', 'decode'],\n\t\t\t\t\t$metadata, $options);\n\t\t\t}\n\t\t\tpublic function GetHelloMsg(\\Rpc_proto\\HelloRequest $argument,$metadata=[],$options=[]){\n\t\t\t\treturn $this->_simpleRequest('/rpc_proto.HelloServer/GetHelloMsg',\n\t\t\t\t\t$argument,\n\t\t\t\t\t['\\Rpc_proto\\HelloMessage', 'decode'],\n\t\t\t\t\t$metadata, $options);\n\t\t\t}\n\t\t}\n\t?>\n3、cd client/phpclient && composer install  \n4、cd server && go run server.go  \n5、新建hello.php,并执行php hello.php\n结果：\n> helloGreenHat  \nthis is from server HAHA!","slug":"grpc_php客户端","published":1,"category":"GOLANG","date":"2023-06-08T23:03:56.090Z","updated":"2023-06-08T23:12:13.672Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5se7000qdxjc7hlncvok","content":"<h1 id=\"grpc-php-client\"><a href=\"#grpc-php-client\" class=\"headerlink\" title=\"grpc php client\"></a>grpc php client</h1><p><strong>服务端取的是<a href=\"https://www.jianshu.com/p/7fe7a8507745\">https://www.jianshu.com/p/7fe7a8507745</a> 案例</strong>  </p>\n<h4 id=\"需要执行\"><a href=\"#需要执行\" class=\"headerlink\" title=\"需要执行\"></a>需要执行</h4><blockquote>\n<p>export GO111MODULE&#x3D;on<br>go mod tidy</p>\n</blockquote>\n<h4 id=\"安装依赖\"><a href=\"#安装依赖\" class=\"headerlink\" title=\"安装依赖\"></a>安装依赖</h4><blockquote>\n<p>pecl install grpc<br>pecl install protobuf<br>同时并.so 文件放进ini中，如果是在docker中使用docker-php-ext-enable grpc,docker-php-ext-enable protobuf<br>wget <a href=\"https://github.com/google/protobuf/releases/download/v3.5.1/protobuf-all-3.5.1.zip\">https://github.com/google/protobuf/releases/download/v3.5.1/protobuf-all-3.5.1.zip</a><br>unzip protobuf-all-3.5.1.zip<br>cd protobuf-3.5.1&#x2F;<br>.&#x2F;configure<br>make<br>make install<br>protoc –version<br>出现make 错误，安装apt-get install automake<br>ldconfig  </p>\n</blockquote>\n<p>1、protoc –proto_path&#x3D;..&#x2F;..&#x2F; –php_out&#x3D;. helloServer.proto<br>2、在client&#x2F;phpclient&#x2F;Rpc_proto 文件夹新建HelloClient.php  </p>\n<pre><code>&lt;?php\n    namespace Rpc_proto;\n    class HelloClient extends \\Grpc\\BaseStub&#123;\n        public function __construct($hostname, $opts, $channel = null) &#123;\n            parent::__construct($hostname, $opts, $channel);\n        &#125;\n        public function SayHello(\\Rpc_proto\\HelloRequest $argument,$metadata=[],$options=[])&#123;\n            return $this-&gt;_simpleRequest(&#39;/rpc_proto.HelloServer/SayHello&#39;,\n                $argument,\n                [&#39;\\Rpc_proto\\HelloReply&#39;, &#39;decode&#39;],\n                $metadata, $options);\n        &#125;\n        public function GetHelloMsg(\\Rpc_proto\\HelloRequest $argument,$metadata=[],$options=[])&#123;\n            return $this-&gt;_simpleRequest(&#39;/rpc_proto.HelloServer/GetHelloMsg&#39;,\n                $argument,\n                [&#39;\\Rpc_proto\\HelloMessage&#39;, &#39;decode&#39;],\n                $metadata, $options);\n        &#125;\n    &#125;\n?&gt;\n</code></pre>\n<p>3、cd client&#x2F;phpclient &amp;&amp; composer install<br>4、cd server &amp;&amp; go run server.go<br>5、新建hello.php,并执行php hello.php<br>结果：</p>\n<blockquote>\n<p>helloGreenHat<br>this is from server HAHA!</p>\n</blockquote>\n","site":{"data":{}},"length":1418,"excerpt":"","more":"<h1 id=\"grpc-php-client\"><a href=\"#grpc-php-client\" class=\"headerlink\" title=\"grpc php client\"></a>grpc php client</h1><p><strong>服务端取的是<a href=\"https://www.jianshu.com/p/7fe7a8507745\">https://www.jianshu.com/p/7fe7a8507745</a> 案例</strong>  </p>\n<h4 id=\"需要执行\"><a href=\"#需要执行\" class=\"headerlink\" title=\"需要执行\"></a>需要执行</h4><blockquote>\n<p>export GO111MODULE&#x3D;on<br>go mod tidy</p>\n</blockquote>\n<h4 id=\"安装依赖\"><a href=\"#安装依赖\" class=\"headerlink\" title=\"安装依赖\"></a>安装依赖</h4><blockquote>\n<p>pecl install grpc<br>pecl install protobuf<br>同时并.so 文件放进ini中，如果是在docker中使用docker-php-ext-enable grpc,docker-php-ext-enable protobuf<br>wget <a href=\"https://github.com/google/protobuf/releases/download/v3.5.1/protobuf-all-3.5.1.zip\">https://github.com/google/protobuf/releases/download/v3.5.1/protobuf-all-3.5.1.zip</a><br>unzip protobuf-all-3.5.1.zip<br>cd protobuf-3.5.1&#x2F;<br>.&#x2F;configure<br>make<br>make install<br>protoc –version<br>出现make 错误，安装apt-get install automake<br>ldconfig  </p>\n</blockquote>\n<p>1、protoc –proto_path&#x3D;..&#x2F;..&#x2F; –php_out&#x3D;. helloServer.proto<br>2、在client&#x2F;phpclient&#x2F;Rpc_proto 文件夹新建HelloClient.php  </p>\n<pre><code>&lt;?php\n    namespace Rpc_proto;\n    class HelloClient extends \\Grpc\\BaseStub&#123;\n        public function __construct($hostname, $opts, $channel = null) &#123;\n            parent::__construct($hostname, $opts, $channel);\n        &#125;\n        public function SayHello(\\Rpc_proto\\HelloRequest $argument,$metadata=[],$options=[])&#123;\n            return $this-&gt;_simpleRequest(&#39;/rpc_proto.HelloServer/SayHello&#39;,\n                $argument,\n                [&#39;\\Rpc_proto\\HelloReply&#39;, &#39;decode&#39;],\n                $metadata, $options);\n        &#125;\n        public function GetHelloMsg(\\Rpc_proto\\HelloRequest $argument,$metadata=[],$options=[])&#123;\n            return $this-&gt;_simpleRequest(&#39;/rpc_proto.HelloServer/GetHelloMsg&#39;,\n                $argument,\n                [&#39;\\Rpc_proto\\HelloMessage&#39;, &#39;decode&#39;],\n                $metadata, $options);\n        &#125;\n    &#125;\n?&gt;\n</code></pre>\n<p>3、cd client&#x2F;phpclient &amp;&amp; composer install<br>4、cd server &amp;&amp; go run server.go<br>5、新建hello.php,并执行php hello.php<br>结果：</p>\n<blockquote>\n<p>helloGreenHat<br>this is from server HAHA!</p>\n</blockquote>\n"},{"_content":"```go\npackage main\nimport(\n\t\"fmt\"\n\t\"time\"\n)\nfunc producer(nums ...int) <-chan int{// 括号里输入参数，括号外返回的参数类型\n\tout :=make(chan int)\n\tgo func() {\n\t\tdefer close(out)\n\t\tfor _,n :=range nums{\n\t\t\tout<-n\n\t\t}\n\t}()\n\treturn out\n}\nfunc cal(inch <-chan int) <-chan int{//括号里从chan读取数据，括号外返回的参数类型\n\tout :=make(chan int)\n\tgo func() {\n\t\tdefer close(out)\n\t\tfor n :=range inch{\n\t\t\tout<-n*n\n\t\t}\n\t}()\n\treturn out\n}\nfunc main(){\n\tt := time.Now()\n\tin :=producer(1000000)\n\tch :=cal(in)\n\t//consumer\n\tfor ret :=range ch{\n\t\tfmt.Printf(\"%3d\", ret)\n\t}\n\tfmt.Println()\n\telapsed := time.Since(t)\n    fmt.Println(\"app elapsed:\", elapsed)\n}\n```\n\n##### 这个是首尾各一管道，读取数据用协程读取管道，写入数据用协程写入管道  \n1.无缓冲的  就是一个送信人去你家门口送信 ，你不在家 他不走，你一定要接下信，他才会走。  \n2.无缓冲保证信能到你手上\n3.有缓冲的 就是一个送信人去你家仍到你家的信箱 转身就走 ，除非你的信箱满了 他必须等信箱空下来。\n4.有缓冲的 保证 信能进你家的邮箱\n5.如果这里没有缓冲的话，就会出现阻塞，因为无缓冲，他需要等你接到信，main 方法执行完了，你还没接，阻塞了，针对协程，要加个有缓冲，这样直接到邮箱里，到时候自己去取，这里的缓冲池，在retch中。\n```go\npackage main\nimport(\n\t\"fmt\"\n\t\"time\"\n)\nfunc workerpool(n int,jobch <-chan int,retch chan<- string){// 没有返回的参数，jobch 读取chan中的数据，retch 写数据到chan中\n\tfor i :=0;i<n;i++{\n\t\tgo worker(i,jobch,retch);\n\t}\n}\nfunc worker(id int,jobch <-chan int,retch chan<- string){\n\tfor job :=range jobch{\n\t\tret := fmt.Sprintf(\"worker %d process job %d\",id,job)\n\t\tretch <-ret\n\t}\n}\nfunc genjob(n int) <-chan int{\n\tjobch :=make(chan int,200)\n\tgo func(){\n\t\tfor i :=0;i<n;i++{\n\t\t\tjobch <-i\n\t\t}\n\t\tclose(jobch)\n\t}()\n\treturn jobch\n}\nfunc main(){\n\tjobch :=genjob(10)\n\tretch :=make(chan string,200)\n\tworkerpool(5,jobch,retch)\n\ttime.Sleep(time.Second)\n\tclose(retch)\n\tfor ret :=range retch{\n\t\tfmt.Println(ret)\n\t}\n}\n```\n\n\n\n\n\n\n","source":"_posts/GOLANG/学习channel.md","raw":"---\ncategories:\n  - GOLANG\n---\n```go\npackage main\nimport(\n\t\"fmt\"\n\t\"time\"\n)\nfunc producer(nums ...int) <-chan int{// 括号里输入参数，括号外返回的参数类型\n\tout :=make(chan int)\n\tgo func() {\n\t\tdefer close(out)\n\t\tfor _,n :=range nums{\n\t\t\tout<-n\n\t\t}\n\t}()\n\treturn out\n}\nfunc cal(inch <-chan int) <-chan int{//括号里从chan读取数据，括号外返回的参数类型\n\tout :=make(chan int)\n\tgo func() {\n\t\tdefer close(out)\n\t\tfor n :=range inch{\n\t\t\tout<-n*n\n\t\t}\n\t}()\n\treturn out\n}\nfunc main(){\n\tt := time.Now()\n\tin :=producer(1000000)\n\tch :=cal(in)\n\t//consumer\n\tfor ret :=range ch{\n\t\tfmt.Printf(\"%3d\", ret)\n\t}\n\tfmt.Println()\n\telapsed := time.Since(t)\n    fmt.Println(\"app elapsed:\", elapsed)\n}\n```\n\n##### 这个是首尾各一管道，读取数据用协程读取管道，写入数据用协程写入管道  \n1.无缓冲的  就是一个送信人去你家门口送信 ，你不在家 他不走，你一定要接下信，他才会走。  \n2.无缓冲保证信能到你手上\n3.有缓冲的 就是一个送信人去你家仍到你家的信箱 转身就走 ，除非你的信箱满了 他必须等信箱空下来。\n4.有缓冲的 保证 信能进你家的邮箱\n5.如果这里没有缓冲的话，就会出现阻塞，因为无缓冲，他需要等你接到信，main 方法执行完了，你还没接，阻塞了，针对协程，要加个有缓冲，这样直接到邮箱里，到时候自己去取，这里的缓冲池，在retch中。\n```go\npackage main\nimport(\n\t\"fmt\"\n\t\"time\"\n)\nfunc workerpool(n int,jobch <-chan int,retch chan<- string){// 没有返回的参数，jobch 读取chan中的数据，retch 写数据到chan中\n\tfor i :=0;i<n;i++{\n\t\tgo worker(i,jobch,retch);\n\t}\n}\nfunc worker(id int,jobch <-chan int,retch chan<- string){\n\tfor job :=range jobch{\n\t\tret := fmt.Sprintf(\"worker %d process job %d\",id,job)\n\t\tretch <-ret\n\t}\n}\nfunc genjob(n int) <-chan int{\n\tjobch :=make(chan int,200)\n\tgo func(){\n\t\tfor i :=0;i<n;i++{\n\t\t\tjobch <-i\n\t\t}\n\t\tclose(jobch)\n\t}()\n\treturn jobch\n}\nfunc main(){\n\tjobch :=genjob(10)\n\tretch :=make(chan string,200)\n\tworkerpool(5,jobch,retch)\n\ttime.Sleep(time.Second)\n\tclose(retch)\n\tfor ret :=range retch{\n\t\tfmt.Println(ret)\n\t}\n}\n```\n\n\n\n\n\n\n","slug":"学习channel","published":1,"category":"GOLANG","date":"2023-06-08T23:03:56.092Z","updated":"2023-06-08T23:12:13.672Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5se7000rdxjcc2vbcjry","content":"<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"><span class=\"keyword\">import</span>(</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">producer</span><span class=\"params\">(nums ...<span class=\"type\">int</span>)</span></span> &lt;-<span class=\"keyword\">chan</span> <span class=\"type\">int</span>&#123;<span class=\"comment\">// 括号里输入参数，括号外返回的参数类型</span></span><br><span class=\"line\">\tout :=<span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"type\">int</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">defer</span> <span class=\"built_in\">close</span>(out)</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> _,n :=<span class=\"keyword\">range</span> nums&#123;</span><br><span class=\"line\">\t\t\tout&lt;-n</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> out</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">cal</span><span class=\"params\">(inch &lt;-<span class=\"keyword\">chan</span> <span class=\"type\">int</span>)</span></span> &lt;-<span class=\"keyword\">chan</span> <span class=\"type\">int</span>&#123;<span class=\"comment\">//括号里从chan读取数据，括号外返回的参数类型</span></span><br><span class=\"line\">\tout :=<span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"type\">int</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">defer</span> <span class=\"built_in\">close</span>(out)</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> n :=<span class=\"keyword\">range</span> inch&#123;</span><br><span class=\"line\">\t\t\tout&lt;-n*n</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> out</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\tt := time.Now()</span><br><span class=\"line\">\tin :=producer(<span class=\"number\">1000000</span>)</span><br><span class=\"line\">\tch :=cal(in)</span><br><span class=\"line\">\t<span class=\"comment\">//consumer</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> ret :=<span class=\"keyword\">range</span> ch&#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;%3d&quot;</span>, ret)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tfmt.Println()</span><br><span class=\"line\">\telapsed := time.Since(t)</span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;app elapsed:&quot;</span>, elapsed)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"这个是首尾各一管道，读取数据用协程读取管道，写入数据用协程写入管道\"><a href=\"#这个是首尾各一管道，读取数据用协程读取管道，写入数据用协程写入管道\" class=\"headerlink\" title=\"这个是首尾各一管道，读取数据用协程读取管道，写入数据用协程写入管道\"></a>这个是首尾各一管道，读取数据用协程读取管道，写入数据用协程写入管道</h5><p>1.无缓冲的  就是一个送信人去你家门口送信 ，你不在家 他不走，你一定要接下信，他才会走。<br>2.无缓冲保证信能到你手上<br>3.有缓冲的 就是一个送信人去你家仍到你家的信箱 转身就走 ，除非你的信箱满了 他必须等信箱空下来。<br>4.有缓冲的 保证 信能进你家的邮箱<br>5.如果这里没有缓冲的话，就会出现阻塞，因为无缓冲，他需要等你接到信，main 方法执行完了，你还没接，阻塞了，针对协程，要加个有缓冲，这样直接到邮箱里，到时候自己去取，这里的缓冲池，在retch中。</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"><span class=\"keyword\">import</span>(</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">workerpool</span><span class=\"params\">(n <span class=\"type\">int</span>,jobch &lt;-<span class=\"keyword\">chan</span> <span class=\"type\">int</span>,retch <span class=\"keyword\">chan</span>&lt;- <span class=\"type\">string</span>)</span></span>&#123;<span class=\"comment\">// 没有返回的参数，jobch 读取chan中的数据，retch 写数据到chan中</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i :=<span class=\"number\">0</span>;i&lt;n;i++&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">go</span> worker(i,jobch,retch);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">worker</span><span class=\"params\">(id <span class=\"type\">int</span>,jobch &lt;-<span class=\"keyword\">chan</span> <span class=\"type\">int</span>,retch <span class=\"keyword\">chan</span>&lt;- <span class=\"type\">string</span>)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> job :=<span class=\"keyword\">range</span> jobch&#123;</span><br><span class=\"line\">\t\tret := fmt.Sprintf(<span class=\"string\">&quot;worker %d process job %d&quot;</span>,id,job)</span><br><span class=\"line\">\t\tretch &lt;-ret</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">genjob</span><span class=\"params\">(n <span class=\"type\">int</span>)</span></span> &lt;-<span class=\"keyword\">chan</span> <span class=\"type\">int</span>&#123;</span><br><span class=\"line\">\tjobch :=<span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"type\">int</span>,<span class=\"number\">200</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> i :=<span class=\"number\">0</span>;i&lt;n;i++&#123;</span><br><span class=\"line\">\t\t\tjobch &lt;-i</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"built_in\">close</span>(jobch)</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> jobch</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\tjobch :=genjob(<span class=\"number\">10</span>)</span><br><span class=\"line\">\tretch :=<span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"type\">string</span>,<span class=\"number\">200</span>)</span><br><span class=\"line\">\tworkerpool(<span class=\"number\">5</span>,jobch,retch)</span><br><span class=\"line\">\ttime.Sleep(time.Second)</span><br><span class=\"line\">\t<span class=\"built_in\">close</span>(retch)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> ret :=<span class=\"keyword\">range</span> retch&#123;</span><br><span class=\"line\">\t\tfmt.Println(ret)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n","site":{"data":{}},"length":1692,"excerpt":"","more":"<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"><span class=\"keyword\">import</span>(</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">producer</span><span class=\"params\">(nums ...<span class=\"type\">int</span>)</span></span> &lt;-<span class=\"keyword\">chan</span> <span class=\"type\">int</span>&#123;<span class=\"comment\">// 括号里输入参数，括号外返回的参数类型</span></span><br><span class=\"line\">\tout :=<span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"type\">int</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">defer</span> <span class=\"built_in\">close</span>(out)</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> _,n :=<span class=\"keyword\">range</span> nums&#123;</span><br><span class=\"line\">\t\t\tout&lt;-n</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> out</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">cal</span><span class=\"params\">(inch &lt;-<span class=\"keyword\">chan</span> <span class=\"type\">int</span>)</span></span> &lt;-<span class=\"keyword\">chan</span> <span class=\"type\">int</span>&#123;<span class=\"comment\">//括号里从chan读取数据，括号外返回的参数类型</span></span><br><span class=\"line\">\tout :=<span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"type\">int</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">defer</span> <span class=\"built_in\">close</span>(out)</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> n :=<span class=\"keyword\">range</span> inch&#123;</span><br><span class=\"line\">\t\t\tout&lt;-n*n</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> out</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\tt := time.Now()</span><br><span class=\"line\">\tin :=producer(<span class=\"number\">1000000</span>)</span><br><span class=\"line\">\tch :=cal(in)</span><br><span class=\"line\">\t<span class=\"comment\">//consumer</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> ret :=<span class=\"keyword\">range</span> ch&#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;%3d&quot;</span>, ret)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tfmt.Println()</span><br><span class=\"line\">\telapsed := time.Since(t)</span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;app elapsed:&quot;</span>, elapsed)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"这个是首尾各一管道，读取数据用协程读取管道，写入数据用协程写入管道\"><a href=\"#这个是首尾各一管道，读取数据用协程读取管道，写入数据用协程写入管道\" class=\"headerlink\" title=\"这个是首尾各一管道，读取数据用协程读取管道，写入数据用协程写入管道\"></a>这个是首尾各一管道，读取数据用协程读取管道，写入数据用协程写入管道</h5><p>1.无缓冲的  就是一个送信人去你家门口送信 ，你不在家 他不走，你一定要接下信，他才会走。<br>2.无缓冲保证信能到你手上<br>3.有缓冲的 就是一个送信人去你家仍到你家的信箱 转身就走 ，除非你的信箱满了 他必须等信箱空下来。<br>4.有缓冲的 保证 信能进你家的邮箱<br>5.如果这里没有缓冲的话，就会出现阻塞，因为无缓冲，他需要等你接到信，main 方法执行完了，你还没接，阻塞了，针对协程，要加个有缓冲，这样直接到邮箱里，到时候自己去取，这里的缓冲池，在retch中。</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"><span class=\"keyword\">import</span>(</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">workerpool</span><span class=\"params\">(n <span class=\"type\">int</span>,jobch &lt;-<span class=\"keyword\">chan</span> <span class=\"type\">int</span>,retch <span class=\"keyword\">chan</span>&lt;- <span class=\"type\">string</span>)</span></span>&#123;<span class=\"comment\">// 没有返回的参数，jobch 读取chan中的数据，retch 写数据到chan中</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i :=<span class=\"number\">0</span>;i&lt;n;i++&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">go</span> worker(i,jobch,retch);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">worker</span><span class=\"params\">(id <span class=\"type\">int</span>,jobch &lt;-<span class=\"keyword\">chan</span> <span class=\"type\">int</span>,retch <span class=\"keyword\">chan</span>&lt;- <span class=\"type\">string</span>)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> job :=<span class=\"keyword\">range</span> jobch&#123;</span><br><span class=\"line\">\t\tret := fmt.Sprintf(<span class=\"string\">&quot;worker %d process job %d&quot;</span>,id,job)</span><br><span class=\"line\">\t\tretch &lt;-ret</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">genjob</span><span class=\"params\">(n <span class=\"type\">int</span>)</span></span> &lt;-<span class=\"keyword\">chan</span> <span class=\"type\">int</span>&#123;</span><br><span class=\"line\">\tjobch :=<span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"type\">int</span>,<span class=\"number\">200</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> i :=<span class=\"number\">0</span>;i&lt;n;i++&#123;</span><br><span class=\"line\">\t\t\tjobch &lt;-i</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"built_in\">close</span>(jobch)</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> jobch</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\tjobch :=genjob(<span class=\"number\">10</span>)</span><br><span class=\"line\">\tretch :=<span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"type\">string</span>,<span class=\"number\">200</span>)</span><br><span class=\"line\">\tworkerpool(<span class=\"number\">5</span>,jobch,retch)</span><br><span class=\"line\">\ttime.Sleep(time.Second)</span><br><span class=\"line\">\t<span class=\"built_in\">close</span>(retch)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> ret :=<span class=\"keyword\">range</span> retch&#123;</span><br><span class=\"line\">\t\tfmt.Println(ret)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n"},{"_content":"### linux 搭建直播服务器\n#### 同时也在学习livego中\n1.\n>$ apt-get install ffmpeg \n\n>$ git clone https://github.com/gwuhaolin/livego.git \n\n2.记得需要加\nexport GOPROXY=https://goproxy.io 或者国内 https://goproxy.cn  \nexport GO111MODULE=on \n \n3.同时在阿里云安全组规则把livego.yaml 里面的端口全部开启\n\n4.使用tmux  go run main.go\n\n#### 添加ngix 配置oss 反向代理模块 /etc/nginx/conf.d/oss.conf\n``` conf\n\nserver {\n    server_name  localhost; # oss域名，替换成你自己的域名\n    server_name_in_redirect off; # 多域名防干扰，详细说明可自行查阅\n\n    location / {\n      # 反向代理oss地址，需替换成你的oss内网或外网地址\n      proxy_pass http://bb.oss-cn-shanghai-internal.aliyuncs.com/;\n      # 设置反向代理时请求header, 也是本方案核心内容\n      # $ossDate， $ossAuth 变量名需和nginx.conf文件内变量名一致\n      #proxy_set_header Date $ossDate;\n      #proxy_set_header Authorization $ossAuth;\n    }\n\n}\n\n```  \n#### 客户端我使用的是dplayer 因为兼容微信 safari 浏览器\n具体的代码\n参考 https://github.com/MoePlayer/DPlayer  \n仅需更改其中的url即可 \n比如可使用刚才 http://localhost/a.mp4 \n如果出现cors跨域问题，需要在oss端更改权限设置 将请求get post添加上，header上添加* 即可访问.\n\n#### 直播推流\n1.打开 http://localhost:8090/control/get?room=movie movie 可以变成任意的，但是下面要保持一致  \n2.在dplayer 的url中设置 为：http://localhost:7002/live/movie.m3u8\n3. \n(1) 摄像头推流 \nffmpeg -f avfoundation -framerate 30 -video_size 1280x720 -i  \"0\"  -vcodec libx264 -acodec libfaac -f flv   rtmp://localhost:1935/live/rfBd56ti2SMtYvSgD5xAV0YU99zampta7Z7S575KLkIZ9PYk  \n(2) 视频推流 \nffmpeg -re -i 123.mp4 -c copy -f flv rtmp://localhost:1935/live/rfBd56ti2SMtYvSgD5xAV0YU99zampta7Z7S575KLkIZ9PYk  \n(3) 电脑端的推流可以使用obs  \n(4) 手机端推流使用腾讯的视频云工具包 \n摄像头推流-》rtmp://localhost:1935/live/rfBd56ti2SMtYvSgD5xAV0YU99zampta7Z7S575KLkIZ9PYk \n\n#### 直播拉流\n拉流的地址就是： http://localhost:7002/live/movie.m3u8 \n\n#### 上传视频文件到oss \n此处用https://github.com/dcq2016/plupload 上传到oss 更改其中的\nsrc/components/Plupload.vue中  \naccessid \naccesskey \nhost  \n换成自己阿里云对应的值\n\n","source":"_posts/GOLANG/直播搭建.md","raw":"---\ncategories:\n  - GOLANG\n---\n### linux 搭建直播服务器\n#### 同时也在学习livego中\n1.\n>$ apt-get install ffmpeg \n\n>$ git clone https://github.com/gwuhaolin/livego.git \n\n2.记得需要加\nexport GOPROXY=https://goproxy.io 或者国内 https://goproxy.cn  \nexport GO111MODULE=on \n \n3.同时在阿里云安全组规则把livego.yaml 里面的端口全部开启\n\n4.使用tmux  go run main.go\n\n#### 添加ngix 配置oss 反向代理模块 /etc/nginx/conf.d/oss.conf\n``` conf\n\nserver {\n    server_name  localhost; # oss域名，替换成你自己的域名\n    server_name_in_redirect off; # 多域名防干扰，详细说明可自行查阅\n\n    location / {\n      # 反向代理oss地址，需替换成你的oss内网或外网地址\n      proxy_pass http://bb.oss-cn-shanghai-internal.aliyuncs.com/;\n      # 设置反向代理时请求header, 也是本方案核心内容\n      # $ossDate， $ossAuth 变量名需和nginx.conf文件内变量名一致\n      #proxy_set_header Date $ossDate;\n      #proxy_set_header Authorization $ossAuth;\n    }\n\n}\n\n```  \n#### 客户端我使用的是dplayer 因为兼容微信 safari 浏览器\n具体的代码\n参考 https://github.com/MoePlayer/DPlayer  \n仅需更改其中的url即可 \n比如可使用刚才 http://localhost/a.mp4 \n如果出现cors跨域问题，需要在oss端更改权限设置 将请求get post添加上，header上添加* 即可访问.\n\n#### 直播推流\n1.打开 http://localhost:8090/control/get?room=movie movie 可以变成任意的，但是下面要保持一致  \n2.在dplayer 的url中设置 为：http://localhost:7002/live/movie.m3u8\n3. \n(1) 摄像头推流 \nffmpeg -f avfoundation -framerate 30 -video_size 1280x720 -i  \"0\"  -vcodec libx264 -acodec libfaac -f flv   rtmp://localhost:1935/live/rfBd56ti2SMtYvSgD5xAV0YU99zampta7Z7S575KLkIZ9PYk  \n(2) 视频推流 \nffmpeg -re -i 123.mp4 -c copy -f flv rtmp://localhost:1935/live/rfBd56ti2SMtYvSgD5xAV0YU99zampta7Z7S575KLkIZ9PYk  \n(3) 电脑端的推流可以使用obs  \n(4) 手机端推流使用腾讯的视频云工具包 \n摄像头推流-》rtmp://localhost:1935/live/rfBd56ti2SMtYvSgD5xAV0YU99zampta7Z7S575KLkIZ9PYk \n\n#### 直播拉流\n拉流的地址就是： http://localhost:7002/live/movie.m3u8 \n\n#### 上传视频文件到oss \n此处用https://github.com/dcq2016/plupload 上传到oss 更改其中的\nsrc/components/Plupload.vue中  \naccessid \naccesskey \nhost  \n换成自己阿里云对应的值\n\n","slug":"直播搭建","published":1,"category":"GOLANG","date":"2023-06-08T23:03:56.091Z","updated":"2023-06-08T23:12:13.672Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5se8000udxjccw8x7jm7","content":"<h3 id=\"linux-搭建直播服务器\"><a href=\"#linux-搭建直播服务器\" class=\"headerlink\" title=\"linux 搭建直播服务器\"></a>linux 搭建直播服务器</h3><h4 id=\"同时也在学习livego中\"><a href=\"#同时也在学习livego中\" class=\"headerlink\" title=\"同时也在学习livego中\"></a>同时也在学习livego中</h4><ol>\n<li><blockquote>\n<p>$ apt-get install ffmpeg</p>\n</blockquote>\n</li>\n</ol>\n<blockquote>\n<p>$ git clone <a href=\"https://github.com/gwuhaolin/livego.git\">https://github.com/gwuhaolin/livego.git</a> </p>\n</blockquote>\n<p>2.记得需要加<br>export GOPROXY&#x3D;<a href=\"https://goproxy.io/\">https://goproxy.io</a> 或者国内 <a href=\"https://goproxy.cn/\">https://goproxy.cn</a><br>export GO111MODULE&#x3D;on </p>\n<p>3.同时在阿里云安全组规则把livego.yaml 里面的端口全部开启</p>\n<p>4.使用tmux  go run main.go</p>\n<h4 id=\"添加ngix-配置oss-反向代理模块-x2F-etc-x2F-nginx-x2F-conf-d-x2F-oss-conf\"><a href=\"#添加ngix-配置oss-反向代理模块-x2F-etc-x2F-nginx-x2F-conf-d-x2F-oss-conf\" class=\"headerlink\" title=\"添加ngix 配置oss 反向代理模块 &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;oss.conf\"></a>添加ngix 配置oss 反向代理模块 &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;oss.conf</h4><pre><code class=\"conf\">\nserver &#123;\n    server_name  localhost; # oss域名，替换成你自己的域名\n    server_name_in_redirect off; # 多域名防干扰，详细说明可自行查阅\n\n    location / &#123;\n      # 反向代理oss地址，需替换成你的oss内网或外网地址\n      proxy_pass http://bb.oss-cn-shanghai-internal.aliyuncs.com/;\n      # 设置反向代理时请求header, 也是本方案核心内容\n      # $ossDate， $ossAuth 变量名需和nginx.conf文件内变量名一致\n      #proxy_set_header Date $ossDate;\n      #proxy_set_header Authorization $ossAuth;\n    &#125;\n\n&#125;\n</code></pre>\n<h4 id=\"客户端我使用的是dplayer-因为兼容微信-safari-浏览器\"><a href=\"#客户端我使用的是dplayer-因为兼容微信-safari-浏览器\" class=\"headerlink\" title=\"客户端我使用的是dplayer 因为兼容微信 safari 浏览器\"></a>客户端我使用的是dplayer 因为兼容微信 safari 浏览器</h4><p>具体的代码<br>参考 <a href=\"https://github.com/MoePlayer/DPlayer\">https://github.com/MoePlayer/DPlayer</a><br>仅需更改其中的url即可<br>比如可使用刚才 <a href=\"http://localhost/a.mp4\">http://localhost/a.mp4</a><br>如果出现cors跨域问题，需要在oss端更改权限设置 将请求get post添加上，header上添加* 即可访问.</p>\n<h4 id=\"直播推流\"><a href=\"#直播推流\" class=\"headerlink\" title=\"直播推流\"></a>直播推流</h4><p>1.打开 <a href=\"http://localhost:8090/control/get?room=movie\">http://localhost:8090/control/get?room=movie</a> movie 可以变成任意的，但是下面要保持一致<br>2.在dplayer 的url中设置 为：<a href=\"http://localhost:7002/live/movie.m3u8\">http://localhost:7002/live/movie.m3u8</a><br>3.<br>(1) 摄像头推流<br>ffmpeg -f avfoundation -framerate 30 -video_size 1280x720 -i  “0”  -vcodec libx264 -acodec libfaac -f flv   rtmp:&#x2F;&#x2F;localhost:1935&#x2F;live&#x2F;rfBd56ti2SMtYvSgD5xAV0YU99zampta7Z7S575KLkIZ9PYk<br>(2) 视频推流<br>ffmpeg -re -i 123.mp4 -c copy -f flv rtmp:&#x2F;&#x2F;localhost:1935&#x2F;live&#x2F;rfBd56ti2SMtYvSgD5xAV0YU99zampta7Z7S575KLkIZ9PYk<br>(3) 电脑端的推流可以使用obs<br>(4) 手机端推流使用腾讯的视频云工具包<br>摄像头推流-》rtmp:&#x2F;&#x2F;localhost:1935&#x2F;live&#x2F;rfBd56ti2SMtYvSgD5xAV0YU99zampta7Z7S575KLkIZ9PYk </p>\n<h4 id=\"直播拉流\"><a href=\"#直播拉流\" class=\"headerlink\" title=\"直播拉流\"></a>直播拉流</h4><p>拉流的地址就是： <a href=\"http://localhost:7002/live/movie.m3u8\">http://localhost:7002/live/movie.m3u8</a> </p>\n<h4 id=\"上传视频文件到oss\"><a href=\"#上传视频文件到oss\" class=\"headerlink\" title=\"上传视频文件到oss\"></a>上传视频文件到oss</h4><p>此处用<a href=\"https://github.com/dcq2016/plupload\">https://github.com/dcq2016/plupload</a> 上传到oss 更改其中的<br>src&#x2F;components&#x2F;Plupload.vue中<br>accessid<br>accesskey<br>host<br>换成自己阿里云对应的值</p>\n","site":{"data":{}},"length":1583,"excerpt":"","more":"<h3 id=\"linux-搭建直播服务器\"><a href=\"#linux-搭建直播服务器\" class=\"headerlink\" title=\"linux 搭建直播服务器\"></a>linux 搭建直播服务器</h3><h4 id=\"同时也在学习livego中\"><a href=\"#同时也在学习livego中\" class=\"headerlink\" title=\"同时也在学习livego中\"></a>同时也在学习livego中</h4><ol>\n<li><blockquote>\n<p>$ apt-get install ffmpeg</p>\n</blockquote>\n</li>\n</ol>\n<blockquote>\n<p>$ git clone <a href=\"https://github.com/gwuhaolin/livego.git\">https://github.com/gwuhaolin/livego.git</a> </p>\n</blockquote>\n<p>2.记得需要加<br>export GOPROXY&#x3D;<a href=\"https://goproxy.io/\">https://goproxy.io</a> 或者国内 <a href=\"https://goproxy.cn/\">https://goproxy.cn</a><br>export GO111MODULE&#x3D;on </p>\n<p>3.同时在阿里云安全组规则把livego.yaml 里面的端口全部开启</p>\n<p>4.使用tmux  go run main.go</p>\n<h4 id=\"添加ngix-配置oss-反向代理模块-x2F-etc-x2F-nginx-x2F-conf-d-x2F-oss-conf\"><a href=\"#添加ngix-配置oss-反向代理模块-x2F-etc-x2F-nginx-x2F-conf-d-x2F-oss-conf\" class=\"headerlink\" title=\"添加ngix 配置oss 反向代理模块 &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;oss.conf\"></a>添加ngix 配置oss 反向代理模块 &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;oss.conf</h4><pre><code class=\"conf\">\nserver &#123;\n    server_name  localhost; # oss域名，替换成你自己的域名\n    server_name_in_redirect off; # 多域名防干扰，详细说明可自行查阅\n\n    location / &#123;\n      # 反向代理oss地址，需替换成你的oss内网或外网地址\n      proxy_pass http://bb.oss-cn-shanghai-internal.aliyuncs.com/;\n      # 设置反向代理时请求header, 也是本方案核心内容\n      # $ossDate， $ossAuth 变量名需和nginx.conf文件内变量名一致\n      #proxy_set_header Date $ossDate;\n      #proxy_set_header Authorization $ossAuth;\n    &#125;\n\n&#125;\n</code></pre>\n<h4 id=\"客户端我使用的是dplayer-因为兼容微信-safari-浏览器\"><a href=\"#客户端我使用的是dplayer-因为兼容微信-safari-浏览器\" class=\"headerlink\" title=\"客户端我使用的是dplayer 因为兼容微信 safari 浏览器\"></a>客户端我使用的是dplayer 因为兼容微信 safari 浏览器</h4><p>具体的代码<br>参考 <a href=\"https://github.com/MoePlayer/DPlayer\">https://github.com/MoePlayer/DPlayer</a><br>仅需更改其中的url即可<br>比如可使用刚才 <a href=\"http://localhost/a.mp4\">http://localhost/a.mp4</a><br>如果出现cors跨域问题，需要在oss端更改权限设置 将请求get post添加上，header上添加* 即可访问.</p>\n<h4 id=\"直播推流\"><a href=\"#直播推流\" class=\"headerlink\" title=\"直播推流\"></a>直播推流</h4><p>1.打开 <a href=\"http://localhost:8090/control/get?room=movie\">http://localhost:8090/control/get?room=movie</a> movie 可以变成任意的，但是下面要保持一致<br>2.在dplayer 的url中设置 为：<a href=\"http://localhost:7002/live/movie.m3u8\">http://localhost:7002/live/movie.m3u8</a><br>3.<br>(1) 摄像头推流<br>ffmpeg -f avfoundation -framerate 30 -video_size 1280x720 -i  “0”  -vcodec libx264 -acodec libfaac -f flv   rtmp:&#x2F;&#x2F;localhost:1935&#x2F;live&#x2F;rfBd56ti2SMtYvSgD5xAV0YU99zampta7Z7S575KLkIZ9PYk<br>(2) 视频推流<br>ffmpeg -re -i 123.mp4 -c copy -f flv rtmp:&#x2F;&#x2F;localhost:1935&#x2F;live&#x2F;rfBd56ti2SMtYvSgD5xAV0YU99zampta7Z7S575KLkIZ9PYk<br>(3) 电脑端的推流可以使用obs<br>(4) 手机端推流使用腾讯的视频云工具包<br>摄像头推流-》rtmp:&#x2F;&#x2F;localhost:1935&#x2F;live&#x2F;rfBd56ti2SMtYvSgD5xAV0YU99zampta7Z7S575KLkIZ9PYk </p>\n<h4 id=\"直播拉流\"><a href=\"#直播拉流\" class=\"headerlink\" title=\"直播拉流\"></a>直播拉流</h4><p>拉流的地址就是： <a href=\"http://localhost:7002/live/movie.m3u8\">http://localhost:7002/live/movie.m3u8</a> </p>\n<h4 id=\"上传视频文件到oss\"><a href=\"#上传视频文件到oss\" class=\"headerlink\" title=\"上传视频文件到oss\"></a>上传视频文件到oss</h4><p>此处用<a href=\"https://github.com/dcq2016/plupload\">https://github.com/dcq2016/plupload</a> 上传到oss 更改其中的<br>src&#x2F;components&#x2F;Plupload.vue中<br>accessid<br>accesskey<br>host<br>换成自己阿里云对应的值</p>\n"},{"_content":"- mysqldump\n```shell\nmysqldump -u root -pxxx123456 -d testa  \n```\n- 这个是导出数据结构  \n\n```sql\nCREATE TABLE `users` (\n  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,\n  `customerpath` char(20) DEFAULT NULL,\n  `username` varchar(50) DEFAULT NULL,\n  `contactid` int(10) unsigned DEFAULT NULL,\n  `unique_openid` varchar(50) DEFAULT NULL,\n  `created_on` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (`id`),\n  KEY `unique_openid` (`unique_openid`),\n  KEY `contactid` (`contactid`),\n  KEY `customerpath` (`customerpath`)\n) ENGINE=InnoDB AUTO_INCREMENT=74 DEFAULT CHARSET=latin1;  \n```\n\n- 发现虽然导出了，但是主键是从74条记录开始算起所以需要用sed\n```shell\nsed -i 's/\\(AUTO_INCREMENT\\)=[0-9]*/\\1=1/g'\n```\n\n- 在mysqldump的时候不需要-i所以最终命令是:   \n```shell\nmysqldump -u root -pxxx123456 -d testa | sed 's/\\(AUTO_INCREMENT\\)=[0-9]*/\\1=1/g' > a1.sql\n```\n\n\n- 参考 \n1. https://blog.csdn.net/weixin_34096182/article/details/92083589\n2. https://www.cnblogs.com/pengmengnan/p/9041310.html loverable 替换\n3. https://segmentfault.com/q/1010000000408080\n","source":"_posts/MYSQL/mysqldump数据结构,并且主键重置为1.md","raw":"---\ncategories:\n  - MYSQL\n---\n- mysqldump\n```shell\nmysqldump -u root -pxxx123456 -d testa  \n```\n- 这个是导出数据结构  \n\n```sql\nCREATE TABLE `users` (\n  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,\n  `customerpath` char(20) DEFAULT NULL,\n  `username` varchar(50) DEFAULT NULL,\n  `contactid` int(10) unsigned DEFAULT NULL,\n  `unique_openid` varchar(50) DEFAULT NULL,\n  `created_on` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (`id`),\n  KEY `unique_openid` (`unique_openid`),\n  KEY `contactid` (`contactid`),\n  KEY `customerpath` (`customerpath`)\n) ENGINE=InnoDB AUTO_INCREMENT=74 DEFAULT CHARSET=latin1;  \n```\n\n- 发现虽然导出了，但是主键是从74条记录开始算起所以需要用sed\n```shell\nsed -i 's/\\(AUTO_INCREMENT\\)=[0-9]*/\\1=1/g'\n```\n\n- 在mysqldump的时候不需要-i所以最终命令是:   \n```shell\nmysqldump -u root -pxxx123456 -d testa | sed 's/\\(AUTO_INCREMENT\\)=[0-9]*/\\1=1/g' > a1.sql\n```\n\n\n- 参考 \n1. https://blog.csdn.net/weixin_34096182/article/details/92083589\n2. https://www.cnblogs.com/pengmengnan/p/9041310.html loverable 替换\n3. https://segmentfault.com/q/1010000000408080\n","slug":"mysqldump数据结构,并且主键重置为1","published":1,"category":"MYSQL","date":"2023-06-08T23:03:56.095Z","updated":"2023-06-08T23:12:13.672Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5se9000vdxjc6s6w1zad","content":"<ul>\n<li>mysqldump<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysqldump -u root -pxxx123456 -d testa  </span><br></pre></td></tr></table></figure></li>\n<li>这个是导出数据结构</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> `users` (</span><br><span class=\"line\">  `id` <span class=\"type\">int</span>(<span class=\"number\">10</span>) unsigned <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span> AUTO_INCREMENT,</span><br><span class=\"line\">  `customerpath` <span class=\"type\">char</span>(<span class=\"number\">20</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  `username` <span class=\"type\">varchar</span>(<span class=\"number\">50</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  `contactid` <span class=\"type\">int</span>(<span class=\"number\">10</span>) unsigned <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  `unique_openid` <span class=\"type\">varchar</span>(<span class=\"number\">50</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  `created_on` <span class=\"type\">timestamp</span> <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"built_in\">CURRENT_TIMESTAMP</span>,</span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY</span> KEY (`id`),</span><br><span class=\"line\">  KEY `unique_openid` (`unique_openid`),</span><br><span class=\"line\">  KEY `contactid` (`contactid`),</span><br><span class=\"line\">  KEY `customerpath` (`customerpath`)</span><br><span class=\"line\">) ENGINE<span class=\"operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"operator\">=</span><span class=\"number\">74</span> <span class=\"keyword\">DEFAULT</span> CHARSET<span class=\"operator\">=</span>latin1;  </span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>发现虽然导出了，但是主键是从74条记录开始算起所以需要用sed</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -i &#x27;s/\\(AUTO_INCREMENT\\)=[0-9]*/\\1=1/g&#x27;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>在mysqldump的时候不需要-i所以最终命令是:   </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysqldump -u root -pxxx123456 -d testa | sed &#x27;s/\\(AUTO_INCREMENT\\)=[0-9]*/\\1=1/g&#x27; &gt; a1.sql</span><br></pre></td></tr></table></figure>\n\n</li>\n<li><p>参考</p>\n</li>\n</ul>\n<ol>\n<li><a href=\"https://blog.csdn.net/weixin_34096182/article/details/92083589\">https://blog.csdn.net/weixin_34096182/article/details/92083589</a></li>\n<li><a href=\"https://www.cnblogs.com/pengmengnan/p/9041310.html\">https://www.cnblogs.com/pengmengnan/p/9041310.html</a> loverable 替换</li>\n<li><a href=\"https://segmentfault.com/q/1010000000408080\">https://segmentfault.com/q/1010000000408080</a></li>\n</ol>\n","site":{"data":{}},"length":861,"excerpt":"","more":"<ul>\n<li>mysqldump<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysqldump -u root -pxxx123456 -d testa  </span><br></pre></td></tr></table></figure></li>\n<li>这个是导出数据结构</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> `users` (</span><br><span class=\"line\">  `id` <span class=\"type\">int</span>(<span class=\"number\">10</span>) unsigned <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span> AUTO_INCREMENT,</span><br><span class=\"line\">  `customerpath` <span class=\"type\">char</span>(<span class=\"number\">20</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  `username` <span class=\"type\">varchar</span>(<span class=\"number\">50</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  `contactid` <span class=\"type\">int</span>(<span class=\"number\">10</span>) unsigned <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  `unique_openid` <span class=\"type\">varchar</span>(<span class=\"number\">50</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  `created_on` <span class=\"type\">timestamp</span> <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"built_in\">CURRENT_TIMESTAMP</span>,</span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY</span> KEY (`id`),</span><br><span class=\"line\">  KEY `unique_openid` (`unique_openid`),</span><br><span class=\"line\">  KEY `contactid` (`contactid`),</span><br><span class=\"line\">  KEY `customerpath` (`customerpath`)</span><br><span class=\"line\">) ENGINE<span class=\"operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"operator\">=</span><span class=\"number\">74</span> <span class=\"keyword\">DEFAULT</span> CHARSET<span class=\"operator\">=</span>latin1;  </span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>发现虽然导出了，但是主键是从74条记录开始算起所以需要用sed</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -i &#x27;s/\\(AUTO_INCREMENT\\)=[0-9]*/\\1=1/g&#x27;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>在mysqldump的时候不需要-i所以最终命令是:   </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysqldump -u root -pxxx123456 -d testa | sed &#x27;s/\\(AUTO_INCREMENT\\)=[0-9]*/\\1=1/g&#x27; &gt; a1.sql</span><br></pre></td></tr></table></figure>\n\n</li>\n<li><p>参考</p>\n</li>\n</ul>\n<ol>\n<li><a href=\"https://blog.csdn.net/weixin_34096182/article/details/92083589\">https://blog.csdn.net/weixin_34096182/article/details/92083589</a></li>\n<li><a href=\"https://www.cnblogs.com/pengmengnan/p/9041310.html\">https://www.cnblogs.com/pengmengnan/p/9041310.html</a> loverable 替换</li>\n<li><a href=\"https://segmentfault.com/q/1010000000408080\">https://segmentfault.com/q/1010000000408080</a></li>\n</ol>\n"},{"_content":"#### 到年底了，都需要统计下报表，mysql统计的时候有点问题，尤其是到12-31 到01-01 有问题\n```php\nselect location as locationid\n,if(DATE_FORMAT(date,'%v')='01' and date_format(date_add('1900-01-01',interval floor(datediff(date,'1900-01-01')/7)*7 day),'%Y')!=date_format(date_add('1900-01-01',interval floor(datediff(date,'1900-01-01')/7)*7+6 day),'%Y'),concat(date_format(date_add('1900-01-01',interval floor(datediff(date,'1900-01-01')/7)*7+6 day),'%Y'),'-',DATE_FORMAT(date,'%v')),DATE_FORMAT(date,'%X-%v')) weeks\n\n,DATE_FORMAT(date,'%v') weeknum\n\n,date_add('1900-01-01',interval floor(datediff(date,'1900-01-01')/7)*7 day) as week_start\n\n, date_add('1900-01-01',interval floor(datediff(date,'1900-01-01')/7)*7+6 day) as week_end\n\n,count(*) as count \n\nfrom resdata  where date >'2014-11-14 00:00:00' and date<'2019-12-14 23:59:59'  and location  = 5\n  group by floor(datediff(date,'1900-01-01')/7),location\n```\n\n如下图  \n![avatar](https://blog.hexiefamily.xin/assets/mysql1.jpg)  \n\n#### 列出时间段中的所有周\n```php\nfunction list_middle_weeks($start,$end){\n//    $start = \"2014-10-14\";\n//    $end = \"2019-12-14\";\n\n    //$first =1 表示每周星期一为开始日期 0表示每周日为开始日期\n    $first=1;\n    //获取当前周的第几天 周日是 0 周一到周六是 1 - 6\n    $s_w=date('w',strtotime($start));\n    //获取本周开始日期，如果$w是0，则表示周日，减去 6 天\n    $s_week_start=date('Y-m-d',strtotime(\"$start -\".($s_w ? $s_w - $first : 6).' days'));\n    //本周结束日期\n    $s_week_end=date('Y-m-d',strtotime(\"$s_week_start +6 days\"));\n\n    $weeknum = date('W', strtotime($start));\n    // echo \"week start:\".$s_week_start.\",week end:\".$s_week_end.\",weeks num is:\".$weeknum;\n\n\n    $e_w=date('w',strtotime($end));\n    $e_week_start=date('Y-m-d',strtotime(\"$end -\".($e_w ? $e_w - $first : 6).' days'));\n    $e_week_end=date('Y-m-d',strtotime(\"$e_week_start +6 days\"));\n    $weeknum = date('W', strtotime($end));\n    // echo \"week start:\".$e_week_start.\",week end:\".$e_week_end.\",weeks num is:\".$weeknum;\n\n\n    $weeks = [];\n    $startdate = $s_week_start;\n    while(strtotime($startdate)<=strtotime($e_week_start)){\n        $starttime = strtotime($startdate);\n        $endtime =  strtotime(\"$startdate +6 days\");\n        $enddate = date(\"Y-m-d\",$endtime);\n        //startdate enddate\n        $weeknum = date('W', $starttime);\n        $firsty = date('Y',$starttime);\n        $lasty = date('Y',$endtime);\n        $year = $firsty;\n        if($weeknum==\"01\" && $firsty!=$lasty){\n            $year = $lasty;\n        }\n        $c = [];\n        $c['week_start'] = $startdate;\n        $c['week_end'] = $enddate;\n        $weeks[$year.\"-\".$weeknum] = $c;\n        $startdate = date(\"Y-m-d\",strtotime(\"$startdate +7 days\"));\n    }\n\n\n//    echo json_encode($weeks);\n    return $weeks;\n}\n```\n\n","source":"_posts/MYSQL/mysql计算周报表.md","raw":"---\ncategories:\n  - MYSQL\n---\n#### 到年底了，都需要统计下报表，mysql统计的时候有点问题，尤其是到12-31 到01-01 有问题\n```php\nselect location as locationid\n,if(DATE_FORMAT(date,'%v')='01' and date_format(date_add('1900-01-01',interval floor(datediff(date,'1900-01-01')/7)*7 day),'%Y')!=date_format(date_add('1900-01-01',interval floor(datediff(date,'1900-01-01')/7)*7+6 day),'%Y'),concat(date_format(date_add('1900-01-01',interval floor(datediff(date,'1900-01-01')/7)*7+6 day),'%Y'),'-',DATE_FORMAT(date,'%v')),DATE_FORMAT(date,'%X-%v')) weeks\n\n,DATE_FORMAT(date,'%v') weeknum\n\n,date_add('1900-01-01',interval floor(datediff(date,'1900-01-01')/7)*7 day) as week_start\n\n, date_add('1900-01-01',interval floor(datediff(date,'1900-01-01')/7)*7+6 day) as week_end\n\n,count(*) as count \n\nfrom resdata  where date >'2014-11-14 00:00:00' and date<'2019-12-14 23:59:59'  and location  = 5\n  group by floor(datediff(date,'1900-01-01')/7),location\n```\n\n如下图  \n![avatar](https://blog.hexiefamily.xin/assets/mysql1.jpg)  \n\n#### 列出时间段中的所有周\n```php\nfunction list_middle_weeks($start,$end){\n//    $start = \"2014-10-14\";\n//    $end = \"2019-12-14\";\n\n    //$first =1 表示每周星期一为开始日期 0表示每周日为开始日期\n    $first=1;\n    //获取当前周的第几天 周日是 0 周一到周六是 1 - 6\n    $s_w=date('w',strtotime($start));\n    //获取本周开始日期，如果$w是0，则表示周日，减去 6 天\n    $s_week_start=date('Y-m-d',strtotime(\"$start -\".($s_w ? $s_w - $first : 6).' days'));\n    //本周结束日期\n    $s_week_end=date('Y-m-d',strtotime(\"$s_week_start +6 days\"));\n\n    $weeknum = date('W', strtotime($start));\n    // echo \"week start:\".$s_week_start.\",week end:\".$s_week_end.\",weeks num is:\".$weeknum;\n\n\n    $e_w=date('w',strtotime($end));\n    $e_week_start=date('Y-m-d',strtotime(\"$end -\".($e_w ? $e_w - $first : 6).' days'));\n    $e_week_end=date('Y-m-d',strtotime(\"$e_week_start +6 days\"));\n    $weeknum = date('W', strtotime($end));\n    // echo \"week start:\".$e_week_start.\",week end:\".$e_week_end.\",weeks num is:\".$weeknum;\n\n\n    $weeks = [];\n    $startdate = $s_week_start;\n    while(strtotime($startdate)<=strtotime($e_week_start)){\n        $starttime = strtotime($startdate);\n        $endtime =  strtotime(\"$startdate +6 days\");\n        $enddate = date(\"Y-m-d\",$endtime);\n        //startdate enddate\n        $weeknum = date('W', $starttime);\n        $firsty = date('Y',$starttime);\n        $lasty = date('Y',$endtime);\n        $year = $firsty;\n        if($weeknum==\"01\" && $firsty!=$lasty){\n            $year = $lasty;\n        }\n        $c = [];\n        $c['week_start'] = $startdate;\n        $c['week_end'] = $enddate;\n        $weeks[$year.\"-\".$weeknum] = $c;\n        $startdate = date(\"Y-m-d\",strtotime(\"$startdate +7 days\"));\n    }\n\n\n//    echo json_encode($weeks);\n    return $weeks;\n}\n```\n\n","slug":"mysql计算周报表","published":1,"category":"MYSQL","date":"2023-06-08T23:03:56.094Z","updated":"2023-06-08T23:12:13.740Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5sea000ydxjc5vpx1ffj","content":"<h4 id=\"到年底了，都需要统计下报表，mysql统计的时候有点问题，尤其是到12-31-到01-01-有问题\"><a href=\"#到年底了，都需要统计下报表，mysql统计的时候有点问题，尤其是到12-31-到01-01-有问题\" class=\"headerlink\" title=\"到年底了，都需要统计下报表，mysql统计的时候有点问题，尤其是到12-31 到01-01 有问题\"></a>到年底了，都需要统计下报表，mysql统计的时候有点问题，尤其是到12-31 到01-01 有问题</h4><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select location <span class=\"keyword\">as</span> locationid</span><br><span class=\"line\">,<span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">DATE_FORMAT</span>(date,<span class=\"string\">&#x27;%v&#x27;</span>)=<span class=\"string\">&#x27;01&#x27;</span> <span class=\"keyword\">and</span> <span class=\"title function_ invoke__\">date_format</span>(<span class=\"title function_ invoke__\">date_add</span>(<span class=\"string\">&#x27;1900-01-01&#x27;</span>,interval <span class=\"title function_ invoke__\">floor</span>(<span class=\"title function_ invoke__\">datediff</span>(date,<span class=\"string\">&#x27;1900-01-01&#x27;</span>)/<span class=\"number\">7</span>)*<span class=\"number\">7</span> day),<span class=\"string\">&#x27;%Y&#x27;</span>)!=<span class=\"title function_ invoke__\">date_format</span>(<span class=\"title function_ invoke__\">date_add</span>(<span class=\"string\">&#x27;1900-01-01&#x27;</span>,interval <span class=\"title function_ invoke__\">floor</span>(<span class=\"title function_ invoke__\">datediff</span>(date,<span class=\"string\">&#x27;1900-01-01&#x27;</span>)/<span class=\"number\">7</span>)*<span class=\"number\">7</span>+<span class=\"number\">6</span> day),<span class=\"string\">&#x27;%Y&#x27;</span>),<span class=\"title function_ invoke__\">concat</span>(<span class=\"title function_ invoke__\">date_format</span>(<span class=\"title function_ invoke__\">date_add</span>(<span class=\"string\">&#x27;1900-01-01&#x27;</span>,interval <span class=\"title function_ invoke__\">floor</span>(<span class=\"title function_ invoke__\">datediff</span>(date,<span class=\"string\">&#x27;1900-01-01&#x27;</span>)/<span class=\"number\">7</span>)*<span class=\"number\">7</span>+<span class=\"number\">6</span> day),<span class=\"string\">&#x27;%Y&#x27;</span>),<span class=\"string\">&#x27;-&#x27;</span>,<span class=\"title function_ invoke__\">DATE_FORMAT</span>(date,<span class=\"string\">&#x27;%v&#x27;</span>)),<span class=\"title function_ invoke__\">DATE_FORMAT</span>(date,<span class=\"string\">&#x27;%X-%v&#x27;</span>)) weeks</span><br><span class=\"line\"></span><br><span class=\"line\">,<span class=\"title function_ invoke__\">DATE_FORMAT</span>(date,<span class=\"string\">&#x27;%v&#x27;</span>) weeknum</span><br><span class=\"line\"></span><br><span class=\"line\">,<span class=\"title function_ invoke__\">date_add</span>(<span class=\"string\">&#x27;1900-01-01&#x27;</span>,interval <span class=\"title function_ invoke__\">floor</span>(<span class=\"title function_ invoke__\">datediff</span>(date,<span class=\"string\">&#x27;1900-01-01&#x27;</span>)/<span class=\"number\">7</span>)*<span class=\"number\">7</span> day) <span class=\"keyword\">as</span> week_start</span><br><span class=\"line\"></span><br><span class=\"line\">, <span class=\"title function_ invoke__\">date_add</span>(<span class=\"string\">&#x27;1900-01-01&#x27;</span>,interval <span class=\"title function_ invoke__\">floor</span>(<span class=\"title function_ invoke__\">datediff</span>(date,<span class=\"string\">&#x27;1900-01-01&#x27;</span>)/<span class=\"number\">7</span>)*<span class=\"number\">7</span>+<span class=\"number\">6</span> day) <span class=\"keyword\">as</span> week_end</span><br><span class=\"line\"></span><br><span class=\"line\">,<span class=\"title function_ invoke__\">count</span>(*) <span class=\"keyword\">as</span> count </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> resdata  where date &gt;<span class=\"string\">&#x27;2014-11-14 00:00:00&#x27;</span> <span class=\"keyword\">and</span> date&lt;<span class=\"string\">&#x27;2019-12-14 23:59:59&#x27;</span>  <span class=\"keyword\">and</span> location  = <span class=\"number\">5</span></span><br><span class=\"line\">  group by <span class=\"title function_ invoke__\">floor</span>(<span class=\"title function_ invoke__\">datediff</span>(date,<span class=\"string\">&#x27;1900-01-01&#x27;</span>)/<span class=\"number\">7</span>),location</span><br></pre></td></tr></table></figure>\n\n<p>如下图<br><img src=\"https://blog.hexiefamily.xin/assets/mysql1.jpg\" alt=\"avatar\">  </p>\n<h4 id=\"列出时间段中的所有周\"><a href=\"#列出时间段中的所有周\" class=\"headerlink\" title=\"列出时间段中的所有周\"></a>列出时间段中的所有周</h4><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">list_middle_weeks</span>(<span class=\"params\"><span class=\"variable\">$start</span>,<span class=\"variable\">$end</span></span>)</span>&#123;</span><br><span class=\"line\"><span class=\"comment\">//    $start = &quot;2014-10-14&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">//    $end = &quot;2019-12-14&quot;;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//$first =1 表示每周星期一为开始日期 0表示每周日为开始日期</span></span><br><span class=\"line\">    <span class=\"variable\">$first</span>=<span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"comment\">//获取当前周的第几天 周日是 0 周一到周六是 1 - 6</span></span><br><span class=\"line\">    <span class=\"variable\">$s_w</span>=<span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&#x27;w&#x27;</span>,<span class=\"title function_ invoke__\">strtotime</span>(<span class=\"variable\">$start</span>));</span><br><span class=\"line\">    <span class=\"comment\">//获取本周开始日期，如果$w是0，则表示周日，减去 6 天</span></span><br><span class=\"line\">    <span class=\"variable\">$s_week_start</span>=<span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&#x27;Y-m-d&#x27;</span>,<span class=\"title function_ invoke__\">strtotime</span>(<span class=\"string\">&quot;<span class=\"subst\">$start</span> -&quot;</span>.(<span class=\"variable\">$s_w</span> ? <span class=\"variable\">$s_w</span> - <span class=\"variable\">$first</span> : <span class=\"number\">6</span>).<span class=\"string\">&#x27; days&#x27;</span>));</span><br><span class=\"line\">    <span class=\"comment\">//本周结束日期</span></span><br><span class=\"line\">    <span class=\"variable\">$s_week_end</span>=<span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&#x27;Y-m-d&#x27;</span>,<span class=\"title function_ invoke__\">strtotime</span>(<span class=\"string\">&quot;<span class=\"subst\">$s_week_start</span> +6 days&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$weeknum</span> = <span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&#x27;W&#x27;</span>, <span class=\"title function_ invoke__\">strtotime</span>(<span class=\"variable\">$start</span>));</span><br><span class=\"line\">    <span class=\"comment\">// echo &quot;week start:&quot;.$s_week_start.&quot;,week end:&quot;.$s_week_end.&quot;,weeks num is:&quot;.$weeknum;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$e_w</span>=<span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&#x27;w&#x27;</span>,<span class=\"title function_ invoke__\">strtotime</span>(<span class=\"variable\">$end</span>));</span><br><span class=\"line\">    <span class=\"variable\">$e_week_start</span>=<span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&#x27;Y-m-d&#x27;</span>,<span class=\"title function_ invoke__\">strtotime</span>(<span class=\"string\">&quot;<span class=\"subst\">$end</span> -&quot;</span>.(<span class=\"variable\">$e_w</span> ? <span class=\"variable\">$e_w</span> - <span class=\"variable\">$first</span> : <span class=\"number\">6</span>).<span class=\"string\">&#x27; days&#x27;</span>));</span><br><span class=\"line\">    <span class=\"variable\">$e_week_end</span>=<span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&#x27;Y-m-d&#x27;</span>,<span class=\"title function_ invoke__\">strtotime</span>(<span class=\"string\">&quot;<span class=\"subst\">$e_week_start</span> +6 days&quot;</span>));</span><br><span class=\"line\">    <span class=\"variable\">$weeknum</span> = <span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&#x27;W&#x27;</span>, <span class=\"title function_ invoke__\">strtotime</span>(<span class=\"variable\">$end</span>));</span><br><span class=\"line\">    <span class=\"comment\">// echo &quot;week start:&quot;.$e_week_start.&quot;,week end:&quot;.$e_week_end.&quot;,weeks num is:&quot;.$weeknum;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$weeks</span> = [];</span><br><span class=\"line\">    <span class=\"variable\">$startdate</span> = <span class=\"variable\">$s_week_start</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(<span class=\"title function_ invoke__\">strtotime</span>(<span class=\"variable\">$startdate</span>)&lt;=<span class=\"title function_ invoke__\">strtotime</span>(<span class=\"variable\">$e_week_start</span>))&#123;</span><br><span class=\"line\">        <span class=\"variable\">$starttime</span> = <span class=\"title function_ invoke__\">strtotime</span>(<span class=\"variable\">$startdate</span>);</span><br><span class=\"line\">        <span class=\"variable\">$endtime</span> =  <span class=\"title function_ invoke__\">strtotime</span>(<span class=\"string\">&quot;<span class=\"subst\">$startdate</span> +6 days&quot;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$enddate</span> = <span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&quot;Y-m-d&quot;</span>,<span class=\"variable\">$endtime</span>);</span><br><span class=\"line\">        <span class=\"comment\">//startdate enddate</span></span><br><span class=\"line\">        <span class=\"variable\">$weeknum</span> = <span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&#x27;W&#x27;</span>, <span class=\"variable\">$starttime</span>);</span><br><span class=\"line\">        <span class=\"variable\">$firsty</span> = <span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&#x27;Y&#x27;</span>,<span class=\"variable\">$starttime</span>);</span><br><span class=\"line\">        <span class=\"variable\">$lasty</span> = <span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&#x27;Y&#x27;</span>,<span class=\"variable\">$endtime</span>);</span><br><span class=\"line\">        <span class=\"variable\">$year</span> = <span class=\"variable\">$firsty</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"variable\">$weeknum</span>==<span class=\"string\">&quot;01&quot;</span> &amp;&amp; <span class=\"variable\">$firsty</span>!=<span class=\"variable\">$lasty</span>)&#123;</span><br><span class=\"line\">            <span class=\"variable\">$year</span> = <span class=\"variable\">$lasty</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"variable\">$c</span> = [];</span><br><span class=\"line\">        <span class=\"variable\">$c</span>[<span class=\"string\">&#x27;week_start&#x27;</span>] = <span class=\"variable\">$startdate</span>;</span><br><span class=\"line\">        <span class=\"variable\">$c</span>[<span class=\"string\">&#x27;week_end&#x27;</span>] = <span class=\"variable\">$enddate</span>;</span><br><span class=\"line\">        <span class=\"variable\">$weeks</span>[<span class=\"variable\">$year</span>.<span class=\"string\">&quot;-&quot;</span>.<span class=\"variable\">$weeknum</span>] = <span class=\"variable\">$c</span>;</span><br><span class=\"line\">        <span class=\"variable\">$startdate</span> = <span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&quot;Y-m-d&quot;</span>,<span class=\"title function_ invoke__\">strtotime</span>(<span class=\"string\">&quot;<span class=\"subst\">$startdate</span> +7 days&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//    echo json_encode($weeks);</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable\">$weeks</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"length":2813,"excerpt":"","more":"<h4 id=\"到年底了，都需要统计下报表，mysql统计的时候有点问题，尤其是到12-31-到01-01-有问题\"><a href=\"#到年底了，都需要统计下报表，mysql统计的时候有点问题，尤其是到12-31-到01-01-有问题\" class=\"headerlink\" title=\"到年底了，都需要统计下报表，mysql统计的时候有点问题，尤其是到12-31 到01-01 有问题\"></a>到年底了，都需要统计下报表，mysql统计的时候有点问题，尤其是到12-31 到01-01 有问题</h4><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select location <span class=\"keyword\">as</span> locationid</span><br><span class=\"line\">,<span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">DATE_FORMAT</span>(date,<span class=\"string\">&#x27;%v&#x27;</span>)=<span class=\"string\">&#x27;01&#x27;</span> <span class=\"keyword\">and</span> <span class=\"title function_ invoke__\">date_format</span>(<span class=\"title function_ invoke__\">date_add</span>(<span class=\"string\">&#x27;1900-01-01&#x27;</span>,interval <span class=\"title function_ invoke__\">floor</span>(<span class=\"title function_ invoke__\">datediff</span>(date,<span class=\"string\">&#x27;1900-01-01&#x27;</span>)/<span class=\"number\">7</span>)*<span class=\"number\">7</span> day),<span class=\"string\">&#x27;%Y&#x27;</span>)!=<span class=\"title function_ invoke__\">date_format</span>(<span class=\"title function_ invoke__\">date_add</span>(<span class=\"string\">&#x27;1900-01-01&#x27;</span>,interval <span class=\"title function_ invoke__\">floor</span>(<span class=\"title function_ invoke__\">datediff</span>(date,<span class=\"string\">&#x27;1900-01-01&#x27;</span>)/<span class=\"number\">7</span>)*<span class=\"number\">7</span>+<span class=\"number\">6</span> day),<span class=\"string\">&#x27;%Y&#x27;</span>),<span class=\"title function_ invoke__\">concat</span>(<span class=\"title function_ invoke__\">date_format</span>(<span class=\"title function_ invoke__\">date_add</span>(<span class=\"string\">&#x27;1900-01-01&#x27;</span>,interval <span class=\"title function_ invoke__\">floor</span>(<span class=\"title function_ invoke__\">datediff</span>(date,<span class=\"string\">&#x27;1900-01-01&#x27;</span>)/<span class=\"number\">7</span>)*<span class=\"number\">7</span>+<span class=\"number\">6</span> day),<span class=\"string\">&#x27;%Y&#x27;</span>),<span class=\"string\">&#x27;-&#x27;</span>,<span class=\"title function_ invoke__\">DATE_FORMAT</span>(date,<span class=\"string\">&#x27;%v&#x27;</span>)),<span class=\"title function_ invoke__\">DATE_FORMAT</span>(date,<span class=\"string\">&#x27;%X-%v&#x27;</span>)) weeks</span><br><span class=\"line\"></span><br><span class=\"line\">,<span class=\"title function_ invoke__\">DATE_FORMAT</span>(date,<span class=\"string\">&#x27;%v&#x27;</span>) weeknum</span><br><span class=\"line\"></span><br><span class=\"line\">,<span class=\"title function_ invoke__\">date_add</span>(<span class=\"string\">&#x27;1900-01-01&#x27;</span>,interval <span class=\"title function_ invoke__\">floor</span>(<span class=\"title function_ invoke__\">datediff</span>(date,<span class=\"string\">&#x27;1900-01-01&#x27;</span>)/<span class=\"number\">7</span>)*<span class=\"number\">7</span> day) <span class=\"keyword\">as</span> week_start</span><br><span class=\"line\"></span><br><span class=\"line\">, <span class=\"title function_ invoke__\">date_add</span>(<span class=\"string\">&#x27;1900-01-01&#x27;</span>,interval <span class=\"title function_ invoke__\">floor</span>(<span class=\"title function_ invoke__\">datediff</span>(date,<span class=\"string\">&#x27;1900-01-01&#x27;</span>)/<span class=\"number\">7</span>)*<span class=\"number\">7</span>+<span class=\"number\">6</span> day) <span class=\"keyword\">as</span> week_end</span><br><span class=\"line\"></span><br><span class=\"line\">,<span class=\"title function_ invoke__\">count</span>(*) <span class=\"keyword\">as</span> count </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> resdata  where date &gt;<span class=\"string\">&#x27;2014-11-14 00:00:00&#x27;</span> <span class=\"keyword\">and</span> date&lt;<span class=\"string\">&#x27;2019-12-14 23:59:59&#x27;</span>  <span class=\"keyword\">and</span> location  = <span class=\"number\">5</span></span><br><span class=\"line\">  group by <span class=\"title function_ invoke__\">floor</span>(<span class=\"title function_ invoke__\">datediff</span>(date,<span class=\"string\">&#x27;1900-01-01&#x27;</span>)/<span class=\"number\">7</span>),location</span><br></pre></td></tr></table></figure>\n\n<p>如下图<br><img src=\"https://blog.hexiefamily.xin/assets/mysql1.jpg\" alt=\"avatar\">  </p>\n<h4 id=\"列出时间段中的所有周\"><a href=\"#列出时间段中的所有周\" class=\"headerlink\" title=\"列出时间段中的所有周\"></a>列出时间段中的所有周</h4><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">list_middle_weeks</span>(<span class=\"params\"><span class=\"variable\">$start</span>,<span class=\"variable\">$end</span></span>)</span>&#123;</span><br><span class=\"line\"><span class=\"comment\">//    $start = &quot;2014-10-14&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">//    $end = &quot;2019-12-14&quot;;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//$first =1 表示每周星期一为开始日期 0表示每周日为开始日期</span></span><br><span class=\"line\">    <span class=\"variable\">$first</span>=<span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"comment\">//获取当前周的第几天 周日是 0 周一到周六是 1 - 6</span></span><br><span class=\"line\">    <span class=\"variable\">$s_w</span>=<span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&#x27;w&#x27;</span>,<span class=\"title function_ invoke__\">strtotime</span>(<span class=\"variable\">$start</span>));</span><br><span class=\"line\">    <span class=\"comment\">//获取本周开始日期，如果$w是0，则表示周日，减去 6 天</span></span><br><span class=\"line\">    <span class=\"variable\">$s_week_start</span>=<span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&#x27;Y-m-d&#x27;</span>,<span class=\"title function_ invoke__\">strtotime</span>(<span class=\"string\">&quot;<span class=\"subst\">$start</span> -&quot;</span>.(<span class=\"variable\">$s_w</span> ? <span class=\"variable\">$s_w</span> - <span class=\"variable\">$first</span> : <span class=\"number\">6</span>).<span class=\"string\">&#x27; days&#x27;</span>));</span><br><span class=\"line\">    <span class=\"comment\">//本周结束日期</span></span><br><span class=\"line\">    <span class=\"variable\">$s_week_end</span>=<span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&#x27;Y-m-d&#x27;</span>,<span class=\"title function_ invoke__\">strtotime</span>(<span class=\"string\">&quot;<span class=\"subst\">$s_week_start</span> +6 days&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$weeknum</span> = <span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&#x27;W&#x27;</span>, <span class=\"title function_ invoke__\">strtotime</span>(<span class=\"variable\">$start</span>));</span><br><span class=\"line\">    <span class=\"comment\">// echo &quot;week start:&quot;.$s_week_start.&quot;,week end:&quot;.$s_week_end.&quot;,weeks num is:&quot;.$weeknum;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$e_w</span>=<span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&#x27;w&#x27;</span>,<span class=\"title function_ invoke__\">strtotime</span>(<span class=\"variable\">$end</span>));</span><br><span class=\"line\">    <span class=\"variable\">$e_week_start</span>=<span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&#x27;Y-m-d&#x27;</span>,<span class=\"title function_ invoke__\">strtotime</span>(<span class=\"string\">&quot;<span class=\"subst\">$end</span> -&quot;</span>.(<span class=\"variable\">$e_w</span> ? <span class=\"variable\">$e_w</span> - <span class=\"variable\">$first</span> : <span class=\"number\">6</span>).<span class=\"string\">&#x27; days&#x27;</span>));</span><br><span class=\"line\">    <span class=\"variable\">$e_week_end</span>=<span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&#x27;Y-m-d&#x27;</span>,<span class=\"title function_ invoke__\">strtotime</span>(<span class=\"string\">&quot;<span class=\"subst\">$e_week_start</span> +6 days&quot;</span>));</span><br><span class=\"line\">    <span class=\"variable\">$weeknum</span> = <span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&#x27;W&#x27;</span>, <span class=\"title function_ invoke__\">strtotime</span>(<span class=\"variable\">$end</span>));</span><br><span class=\"line\">    <span class=\"comment\">// echo &quot;week start:&quot;.$e_week_start.&quot;,week end:&quot;.$e_week_end.&quot;,weeks num is:&quot;.$weeknum;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$weeks</span> = [];</span><br><span class=\"line\">    <span class=\"variable\">$startdate</span> = <span class=\"variable\">$s_week_start</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(<span class=\"title function_ invoke__\">strtotime</span>(<span class=\"variable\">$startdate</span>)&lt;=<span class=\"title function_ invoke__\">strtotime</span>(<span class=\"variable\">$e_week_start</span>))&#123;</span><br><span class=\"line\">        <span class=\"variable\">$starttime</span> = <span class=\"title function_ invoke__\">strtotime</span>(<span class=\"variable\">$startdate</span>);</span><br><span class=\"line\">        <span class=\"variable\">$endtime</span> =  <span class=\"title function_ invoke__\">strtotime</span>(<span class=\"string\">&quot;<span class=\"subst\">$startdate</span> +6 days&quot;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$enddate</span> = <span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&quot;Y-m-d&quot;</span>,<span class=\"variable\">$endtime</span>);</span><br><span class=\"line\">        <span class=\"comment\">//startdate enddate</span></span><br><span class=\"line\">        <span class=\"variable\">$weeknum</span> = <span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&#x27;W&#x27;</span>, <span class=\"variable\">$starttime</span>);</span><br><span class=\"line\">        <span class=\"variable\">$firsty</span> = <span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&#x27;Y&#x27;</span>,<span class=\"variable\">$starttime</span>);</span><br><span class=\"line\">        <span class=\"variable\">$lasty</span> = <span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&#x27;Y&#x27;</span>,<span class=\"variable\">$endtime</span>);</span><br><span class=\"line\">        <span class=\"variable\">$year</span> = <span class=\"variable\">$firsty</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"variable\">$weeknum</span>==<span class=\"string\">&quot;01&quot;</span> &amp;&amp; <span class=\"variable\">$firsty</span>!=<span class=\"variable\">$lasty</span>)&#123;</span><br><span class=\"line\">            <span class=\"variable\">$year</span> = <span class=\"variable\">$lasty</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"variable\">$c</span> = [];</span><br><span class=\"line\">        <span class=\"variable\">$c</span>[<span class=\"string\">&#x27;week_start&#x27;</span>] = <span class=\"variable\">$startdate</span>;</span><br><span class=\"line\">        <span class=\"variable\">$c</span>[<span class=\"string\">&#x27;week_end&#x27;</span>] = <span class=\"variable\">$enddate</span>;</span><br><span class=\"line\">        <span class=\"variable\">$weeks</span>[<span class=\"variable\">$year</span>.<span class=\"string\">&quot;-&quot;</span>.<span class=\"variable\">$weeknum</span>] = <span class=\"variable\">$c</span>;</span><br><span class=\"line\">        <span class=\"variable\">$startdate</span> = <span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&quot;Y-m-d&quot;</span>,<span class=\"title function_ invoke__\">strtotime</span>(<span class=\"string\">&quot;<span class=\"subst\">$startdate</span> +7 days&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//    echo json_encode($weeks);</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable\">$weeks</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n"},{"_content":"\n### 一、背景\n最近去面试，去了一家游戏公司面试，由于公司不用框架，并且没有深入理解laravel，导致面试吃亏：\n* 1.解释下laravel的服务容器，控制反转IOC？\n* 2.说下laravel的队列？\n* 3.之前公司是如何解耦的？\n\n\n### 二、答案\n* 1.\n依赖注入:通过构造注入，函数调用或者属性的设置来提供组件的依赖关系\n一开始我们代码依赖关系可能是如图这样的:\n![avatar](https://blog.hexiefamily.xin/assets/ioc1.jpg)\n由于不可抗拒的原因，PHP版本升级，需求更改等等，要把α对象替换掉，把β对象删掉\n![avatar](https://blog.hexiefamily.xin/assets/ioc2.jpg)\n\nIOC容器在全局维持一个对象实例集合和类名集合，我们在写某个类的时候把这个类依赖的对象注册到容器里，调用这个类的时候再实例化拿出来。\n这个就是IOC的思想，一个系统通过组织控制和对象的完全分离来实现”控制反转”。对于依赖注入，这就意味着通过在系统的其他地方控制和实例化依赖对象，从而实现了解耦。  \n\n* 2.\nLaravel可配置多种队列驱动，包括 \"sync\", \"database\", \"beanstalkd\", \"sqs\", \"redis\", \"null\"\n比如向用户发送邮件的场景：现在有10w封邮件需要发送，最简单的，我们需要有一个方法将邮件的收件人、内容等，拆分成10w条任务放在队列中，同时需要设置一个回调方法负责处理每条任务。当队列中有邮件发送任务时，队列会主动调用回调方法，并传递任务详情进去。回调方法处理完成后，单条邮件即发送完毕。其他邮件依样处理。\n![avatar](https://blog.hexiefamily.xin/assets/ioc3.jpg)\n![avatar](https://blog.hexiefamily.xin/assets/ioc4.jpg)\n\n\n##### 结论\n* 好好总结","source":"_posts/PHP/laravel面试.md","raw":"---\ncategories:\n  - PHP\n---\n\n### 一、背景\n最近去面试，去了一家游戏公司面试，由于公司不用框架，并且没有深入理解laravel，导致面试吃亏：\n* 1.解释下laravel的服务容器，控制反转IOC？\n* 2.说下laravel的队列？\n* 3.之前公司是如何解耦的？\n\n\n### 二、答案\n* 1.\n依赖注入:通过构造注入，函数调用或者属性的设置来提供组件的依赖关系\n一开始我们代码依赖关系可能是如图这样的:\n![avatar](https://blog.hexiefamily.xin/assets/ioc1.jpg)\n由于不可抗拒的原因，PHP版本升级，需求更改等等，要把α对象替换掉，把β对象删掉\n![avatar](https://blog.hexiefamily.xin/assets/ioc2.jpg)\n\nIOC容器在全局维持一个对象实例集合和类名集合，我们在写某个类的时候把这个类依赖的对象注册到容器里，调用这个类的时候再实例化拿出来。\n这个就是IOC的思想，一个系统通过组织控制和对象的完全分离来实现”控制反转”。对于依赖注入，这就意味着通过在系统的其他地方控制和实例化依赖对象，从而实现了解耦。  \n\n* 2.\nLaravel可配置多种队列驱动，包括 \"sync\", \"database\", \"beanstalkd\", \"sqs\", \"redis\", \"null\"\n比如向用户发送邮件的场景：现在有10w封邮件需要发送，最简单的，我们需要有一个方法将邮件的收件人、内容等，拆分成10w条任务放在队列中，同时需要设置一个回调方法负责处理每条任务。当队列中有邮件发送任务时，队列会主动调用回调方法，并传递任务详情进去。回调方法处理完成后，单条邮件即发送完毕。其他邮件依样处理。\n![avatar](https://blog.hexiefamily.xin/assets/ioc3.jpg)\n![avatar](https://blog.hexiefamily.xin/assets/ioc4.jpg)\n\n\n##### 结论\n* 好好总结","slug":"laravel面试","published":1,"category":"PHP","date":"2023-06-08T23:03:56.097Z","updated":"2023-06-08T23:12:13.672Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5seb0010dxjch0n9715l","content":"<h3 id=\"一、背景\"><a href=\"#一、背景\" class=\"headerlink\" title=\"一、背景\"></a>一、背景</h3><p>最近去面试，去了一家游戏公司面试，由于公司不用框架，并且没有深入理解laravel，导致面试吃亏：</p>\n<ul>\n<li>1.解释下laravel的服务容器，控制反转IOC？</li>\n<li>2.说下laravel的队列？</li>\n<li>3.之前公司是如何解耦的？</li>\n</ul>\n<h3 id=\"二、答案\"><a href=\"#二、答案\" class=\"headerlink\" title=\"二、答案\"></a>二、答案</h3><ul>\n<li><ol>\n<li>依赖注入:通过构造注入，函数调用或者属性的设置来提供组件的依赖关系<br>一开始我们代码依赖关系可能是如图这样的:<br><img src=\"https://blog.hexiefamily.xin/assets/ioc1.jpg\" alt=\"avatar\"><br>由于不可抗拒的原因，PHP版本升级，需求更改等等，要把α对象替换掉，把β对象删掉<br><img src=\"https://blog.hexiefamily.xin/assets/ioc2.jpg\" alt=\"avatar\"></li>\n</ol>\n</li>\n</ul>\n<p>IOC容器在全局维持一个对象实例集合和类名集合，我们在写某个类的时候把这个类依赖的对象注册到容器里，调用这个类的时候再实例化拿出来。<br>这个就是IOC的思想，一个系统通过组织控制和对象的完全分离来实现”控制反转”。对于依赖注入，这就意味着通过在系统的其他地方控制和实例化依赖对象，从而实现了解耦。  </p>\n<ul>\n<li><ol start=\"2\">\n<li>Laravel可配置多种队列驱动，包括 “sync”, “database”, “beanstalkd”, “sqs”, “redis”, “null”<br>比如向用户发送邮件的场景：现在有10w封邮件需要发送，最简单的，我们需要有一个方法将邮件的收件人、内容等，拆分成10w条任务放在队列中，同时需要设置一个回调方法负责处理每条任务。当队列中有邮件发送任务时，队列会主动调用回调方法，并传递任务详情进去。回调方法处理完成后，单条邮件即发送完毕。其他邮件依样处理。<br><img src=\"https://blog.hexiefamily.xin/assets/ioc3.jpg\" alt=\"avatar\"><br><img src=\"https://blog.hexiefamily.xin/assets/ioc4.jpg\" alt=\"avatar\"></li>\n</ol>\n</li>\n</ul>\n<h5 id=\"结论\"><a href=\"#结论\" class=\"headerlink\" title=\"结论\"></a>结论</h5><ul>\n<li>好好总结</li>\n</ul>\n","site":{"data":{}},"length":579,"excerpt":"","more":"<h3 id=\"一、背景\"><a href=\"#一、背景\" class=\"headerlink\" title=\"一、背景\"></a>一、背景</h3><p>最近去面试，去了一家游戏公司面试，由于公司不用框架，并且没有深入理解laravel，导致面试吃亏：</p>\n<ul>\n<li>1.解释下laravel的服务容器，控制反转IOC？</li>\n<li>2.说下laravel的队列？</li>\n<li>3.之前公司是如何解耦的？</li>\n</ul>\n<h3 id=\"二、答案\"><a href=\"#二、答案\" class=\"headerlink\" title=\"二、答案\"></a>二、答案</h3><ul>\n<li><ol>\n<li>依赖注入:通过构造注入，函数调用或者属性的设置来提供组件的依赖关系<br>一开始我们代码依赖关系可能是如图这样的:<br><img src=\"https://blog.hexiefamily.xin/assets/ioc1.jpg\" alt=\"avatar\"><br>由于不可抗拒的原因，PHP版本升级，需求更改等等，要把α对象替换掉，把β对象删掉<br><img src=\"https://blog.hexiefamily.xin/assets/ioc2.jpg\" alt=\"avatar\"></li>\n</ol>\n</li>\n</ul>\n<p>IOC容器在全局维持一个对象实例集合和类名集合，我们在写某个类的时候把这个类依赖的对象注册到容器里，调用这个类的时候再实例化拿出来。<br>这个就是IOC的思想，一个系统通过组织控制和对象的完全分离来实现”控制反转”。对于依赖注入，这就意味着通过在系统的其他地方控制和实例化依赖对象，从而实现了解耦。  </p>\n<ul>\n<li><ol start=\"2\">\n<li>Laravel可配置多种队列驱动，包括 “sync”, “database”, “beanstalkd”, “sqs”, “redis”, “null”<br>比如向用户发送邮件的场景：现在有10w封邮件需要发送，最简单的，我们需要有一个方法将邮件的收件人、内容等，拆分成10w条任务放在队列中，同时需要设置一个回调方法负责处理每条任务。当队列中有邮件发送任务时，队列会主动调用回调方法，并传递任务详情进去。回调方法处理完成后，单条邮件即发送完毕。其他邮件依样处理。<br><img src=\"https://blog.hexiefamily.xin/assets/ioc3.jpg\" alt=\"avatar\"><br><img src=\"https://blog.hexiefamily.xin/assets/ioc4.jpg\" alt=\"avatar\"></li>\n</ol>\n</li>\n</ul>\n<h5 id=\"结论\"><a href=\"#结论\" class=\"headerlink\" title=\"结论\"></a>结论</h5><ul>\n<li>好好总结</li>\n</ul>\n"},{"_content":"### 利用server酱\n地址：http://sc.ftqq.com/3.version  \n\n1.查看上方网址，github授权登录，并且微信绑定即可获取key值\n2.利用方糖微信公众号来返回模板消息，可以是告警信息，这里我处理成打卡时间\n\n##### 用php处理的方法\n```php\nfunction sc_send(  $text , $desp = '' , $key = '2121212adwadwadwa'  )\n{\n\t$postdata = http_build_query(\n        array(\n            'text' => $text,\n            'desp' => $desp\n        )\n    );\n\n    $opts = array('http' =>\n        array(\n            'method'  => 'POST',\n            'header'  => 'Content-type: application/x-www-form-urlencoded',\n            'content' => $postdata\n        )\n    );\n    $context  = stream_context_create($opts);\n    return $result = file_get_contents('https://sc.ftqq.com/'.$key.'.send', false, $context);\n\n}\n```","source":"_posts/PUSH/消息快速告警.md","raw":"---\ncategories:\n  - PUSH\n---\n### 利用server酱\n地址：http://sc.ftqq.com/3.version  \n\n1.查看上方网址，github授权登录，并且微信绑定即可获取key值\n2.利用方糖微信公众号来返回模板消息，可以是告警信息，这里我处理成打卡时间\n\n##### 用php处理的方法\n```php\nfunction sc_send(  $text , $desp = '' , $key = '2121212adwadwadwa'  )\n{\n\t$postdata = http_build_query(\n        array(\n            'text' => $text,\n            'desp' => $desp\n        )\n    );\n\n    $opts = array('http' =>\n        array(\n            'method'  => 'POST',\n            'header'  => 'Content-type: application/x-www-form-urlencoded',\n            'content' => $postdata\n        )\n    );\n    $context  = stream_context_create($opts);\n    return $result = file_get_contents('https://sc.ftqq.com/'.$key.'.send', false, $context);\n\n}\n```","slug":"消息快速告警","published":1,"category":"PUSH","date":"2023-06-08T23:03:56.100Z","updated":"2023-06-08T23:12:13.739Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5sec0013dxjch6jt2zhy","content":"<h3 id=\"利用server酱\"><a href=\"#利用server酱\" class=\"headerlink\" title=\"利用server酱\"></a>利用server酱</h3><p>地址：<a href=\"http://sc.ftqq.com/3.version\">http://sc.ftqq.com/3.version</a>  </p>\n<p>1.查看上方网址，github授权登录，并且微信绑定即可获取key值<br>2.利用方糖微信公众号来返回模板消息，可以是告警信息，这里我处理成打卡时间</p>\n<h5 id=\"用php处理的方法\"><a href=\"#用php处理的方法\" class=\"headerlink\" title=\"用php处理的方法\"></a>用php处理的方法</h5><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sc_send</span>(<span class=\"params\">  <span class=\"variable\">$text</span> , <span class=\"variable\">$desp</span> = <span class=\"string\">&#x27;&#x27;</span> , <span class=\"variable\">$key</span> = <span class=\"string\">&#x27;2121212adwadwadwa&#x27;</span>  </span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"variable\">$postdata</span> = <span class=\"title function_ invoke__\">http_build_query</span>(</span><br><span class=\"line\">        <span class=\"keyword\">array</span>(</span><br><span class=\"line\">            <span class=\"string\">&#x27;text&#x27;</span> =&gt; <span class=\"variable\">$text</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;desp&#x27;</span> =&gt; <span class=\"variable\">$desp</span></span><br><span class=\"line\">        )</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$opts</span> = <span class=\"keyword\">array</span>(<span class=\"string\">&#x27;http&#x27;</span> =&gt;</span><br><span class=\"line\">        <span class=\"keyword\">array</span>(</span><br><span class=\"line\">            <span class=\"string\">&#x27;method&#x27;</span>  =&gt; <span class=\"string\">&#x27;POST&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;header&#x27;</span>  =&gt; <span class=\"string\">&#x27;Content-type: application/x-www-form-urlencoded&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;content&#x27;</span> =&gt; <span class=\"variable\">$postdata</span></span><br><span class=\"line\">        )</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"variable\">$context</span>  = <span class=\"title function_ invoke__\">stream_context_create</span>(<span class=\"variable\">$opts</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable\">$result</span> = <span class=\"title function_ invoke__\">file_get_contents</span>(<span class=\"string\">&#x27;https://sc.ftqq.com/&#x27;</span>.<span class=\"variable\">$key</span>.<span class=\"string\">&#x27;.send&#x27;</span>, <span class=\"literal\">false</span>, <span class=\"variable\">$context</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"length":667,"excerpt":"","more":"<h3 id=\"利用server酱\"><a href=\"#利用server酱\" class=\"headerlink\" title=\"利用server酱\"></a>利用server酱</h3><p>地址：<a href=\"http://sc.ftqq.com/3.version\">http://sc.ftqq.com/3.version</a>  </p>\n<p>1.查看上方网址，github授权登录，并且微信绑定即可获取key值<br>2.利用方糖微信公众号来返回模板消息，可以是告警信息，这里我处理成打卡时间</p>\n<h5 id=\"用php处理的方法\"><a href=\"#用php处理的方法\" class=\"headerlink\" title=\"用php处理的方法\"></a>用php处理的方法</h5><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sc_send</span>(<span class=\"params\">  <span class=\"variable\">$text</span> , <span class=\"variable\">$desp</span> = <span class=\"string\">&#x27;&#x27;</span> , <span class=\"variable\">$key</span> = <span class=\"string\">&#x27;2121212adwadwadwa&#x27;</span>  </span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"variable\">$postdata</span> = <span class=\"title function_ invoke__\">http_build_query</span>(</span><br><span class=\"line\">        <span class=\"keyword\">array</span>(</span><br><span class=\"line\">            <span class=\"string\">&#x27;text&#x27;</span> =&gt; <span class=\"variable\">$text</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;desp&#x27;</span> =&gt; <span class=\"variable\">$desp</span></span><br><span class=\"line\">        )</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$opts</span> = <span class=\"keyword\">array</span>(<span class=\"string\">&#x27;http&#x27;</span> =&gt;</span><br><span class=\"line\">        <span class=\"keyword\">array</span>(</span><br><span class=\"line\">            <span class=\"string\">&#x27;method&#x27;</span>  =&gt; <span class=\"string\">&#x27;POST&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;header&#x27;</span>  =&gt; <span class=\"string\">&#x27;Content-type: application/x-www-form-urlencoded&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;content&#x27;</span> =&gt; <span class=\"variable\">$postdata</span></span><br><span class=\"line\">        )</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"variable\">$context</span>  = <span class=\"title function_ invoke__\">stream_context_create</span>(<span class=\"variable\">$opts</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable\">$result</span> = <span class=\"title function_ invoke__\">file_get_contents</span>(<span class=\"string\">&#x27;https://sc.ftqq.com/&#x27;</span>.<span class=\"variable\">$key</span>.<span class=\"string\">&#x27;.send&#x27;</span>, <span class=\"literal\">false</span>, <span class=\"variable\">$context</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"_content":"### 网站出现502\n- 杀死进程\n``` shell\n    #!/bin/sh\n    pids=$(ps -e -o 'pid,comm,args,pcpu,rsz,vsz,stime,user,uid' | sort -nrk5 | grep www | grep -v grep|awk ' $2!=\"nginx\" {print $1}')\n    #echo $pids\n    if [ \"$pids\" != \"\" ];then\n    for  pid  in   $pids;\n    do\n    echo $pid\n    kill -9 $pid\n    done\n    fi\n```\n- 调高进程数  \n使用 netstat -napo |grep \"php-fpm\" | wc -l 查看一下当前 fastcgi 进程个数，如果个数接近 conf 里配置的上限，就需要调高进程数。\n但也不能无休止调高，可以根据服务器内存情况，可以把 php-fpm 子进程数调到 100 或以上，在 4G 内存的服务器上 200 就可以。\n- 调高 linux 内核打开文件数量  \n可以使用这些命令 ( 必须是 root 帐号 )  \necho 'ulimit -HSn 65536'>> /etc/profile  \necho 'ulimit -HSn 65536'>> /etc/rc.local  \nsource /etc/profile  \n- 调整脚本执行时间  \n如果脚本因为某种原因长时间等待不返回 ，导致新来的请求不能得到处理，可以适当调小如下配置。\nnginx.conf 里面主要是如下：  \nfastcgi_connect_timeout 300;  \nfastcgi_send_timeout 300;  \nfastcgi_read_timeout 300;  \nphp-fpm.conf 里如要是如下  \nrequest_terminate_timeout =10s  \n- 增加缓存  \n修改或增加配置到 nginx.conf  \nproxy_buffer_size 64k;  \nproxy_buffers  512k;  \nproxy_busy_buffers_size 128k;  \n\n### php-fpm理解\nwebserver每收到一个请求，都会去fork一个cgi进程，请求结束再kill掉这个进程。这样有10000个请求，就需要fork、kill php-cgi进程10000次,很浪费资源？于是，出现了cgi的改良版本，fast-cgi。fast-cgi每次处理完请求后，不会kill掉这个进程，而是保留这个进程，使这个进程可以一次处理多个请求。这样每次就不用重新fork一个进程了，大大提高了效率。    \n\nphp-fpm是什么\nphp-fpm即php-Fastcgi Process Manager. php-fpm是 FastCGI 的实现，并提供了进程管理的功能。 进程包含 master 进程和 worker 进程两种进程。 master 进程只有一个，负责监听端口，接收来自 Web Server 的请求，而 worker 进程则一般有多个(具体数量根据实际需要配置)，每个进程内部都嵌入了一个 PHP 解释器，是 PHP 代码真正执行的地方。\n\n#### php-fpm.conf\n``` conf\n* pid = /usr/local/var/run/php-fpm.pid\n* #pid设置，一定要开启,上面是Mac平台的。默认在php安装目录中的var/run/php-fpm.pid。比如centos的在: /usr/local/php/var/run/php-fpm.pid\n* \n* error_log = /usr/local/var/log/php-fpm.log\n* #错误日志，上面是Mac平台的，默认在php安装目录中的var/log/php-fpm.log，比如centos的在: /usr/local/php/var/log/php-fpm.log\n* \n* log_level = notice\n* #错误级别. 上面的php-fpm.log纪录的登记。可用级别为: alert（必须立即处理）, error（错误情况）, warning（警告情况）, notice（一般重要信息）, debug（调试信息）. 默认: notice.\n* \n* emergency_restart_threshold = 60\n* emergency_restart_interval = 60s\n* #表示在emergency_restart_interval所设值内出现SIGSEGV或者SIGBUS错误的php-cgi进程数如果超过 emergency_restart_threshold个，php-fpm就会优雅重启。这两个选项一般保持默认值。0 表示 '关闭该功能'. 默认值: 0 (关闭).\n* \n* process_control_timeout = 0\n* #设置子进程接受主进程复用信号的超时时间. 可用单位: s(秒), m(分), h(小时), 或者 d(天) 默认单位: s(秒). 默认值: 0.\n* \n* daemonize = yes\n* #后台执行fpm,默认值为yes，如果为了调试可以改为no。在FPM中，可以使用不同的设置来运行多个进程池。 这些设置可以针对每个进程池单独设置。\n* \n* listen = 127.0.0.1:9000\n* #fpm监听端口，即nginx中php处理的地址，一般默认值即可。可用格式为: 'ip:port', 'port', '/path/to/unix/socket'. 每个进程池都需要设置。如果nginx和php在不同的机器上，分布式处理，就设置ip这里就可以了。\n* \n* listen.backlog = -1\n* #backlog数，设置 listen 的半连接队列长度，-1表示无限制，由操作系统决定，此行注释掉就行。backlog含义参考：http://www.3gyou.cc/?p=41\n* \n* listen.allowed_clients = 127.0.0.1\n* #允许访问FastCGI进程的IP白名单，设置any为不限制IP，如果要设置其他主机的nginx也能访问这台FPM进程，listen处要设置成本地可被访问的IP。默认值是any。每个地址是用逗号分隔. 如果没有设置或者为空，则允许任何服务器请求连接。\n* \n* listen.owner = www\n* listen.group = www\n* listen.mode = 0666\n* #unix socket设置选项，如果使用tcp方式访问，这里注释即可。\n* \n* user = www\n* group = www\n* #启动进程的用户和用户组，FPM 进程运行的Unix用户, 必须要设置。用户组，如果没有设置，则默认用户的组被使用。\n* \n* pm = dynamic\n* #php-fpm进程启动模式，pm可以设置为static和dynamic和ondemand\n* #如果选择static，则进程数就数固定的，由pm.max_children指定固定的子进程数。\n* \n* #如果选择dynamic，则进程数是动态变化的,由以下参数决定：\n* pm.max_children = 50 #子进程最大数\n* pm.start_servers = 2 #启动时的进程数，默认值为: min_spare_servers + (max_spare_servers - min_spare_servers) / 2\n* pm.min_spare_servers = 1 #保证空闲进程数最小值，如果空闲进程小于此值，则创建新的子进程\n* pm.max_spare_servers = 3 #，保证空闲进程数最大值，如果空闲进程大于此值，此进行清理\n* \n* pm.max_requests = 500\n* #设置每个子进程重生之前服务的请求数. 对于可能存在内存泄漏的第三方模块来说是非常有用的. 如果设置为 '0' 则一直接受请求. 等同于 PHP_FCGI_MAX_REQUESTS 环境变量. 默认值: 0.\n* \n* pm.status_path = /status\n* #FPM状态页面的网址. 如果没有设置, 则无法访问状态页面. 默认值: none. munin监控会使用到\n* \n* ping.path = /ping\n* #FPM监控页面的ping网址. 如果没有设置, 则无法访问ping页面. 该页面用于外部检测FPM是否存活并且可以响应请求. 请注意必须以斜线开头 (/)。\n* \n* ping.response = pong\n* #用于定义ping请求的返回相应. 返回为 HTTP 200 的 text/plain 格式文本. 默认值: pong.\n* \n* access.log = log/$pool.access.log\n* #每一个请求的访问日志，默认是关闭的。\n* \n* access.format = \"%R - %u %t \\\"%m %r%Q%q\\\" %s %f %{mili}d %{kilo}M %C%%\"\n* #设定访问日志的格式。\n* \n* slowlog = log/$pool.log.slow\n* #慢请求的记录日志,配合request_slowlog_timeout使用，默认关闭\n* \n* request_slowlog_timeout = 10s\n* #当一个请求该设置的超时时间后，就会将对应的PHP调用堆栈信息完整写入到慢日志中. 设置为 '0' 表示 'Off'\n* \n* request_terminate_timeout = 0\n* #设置单个请求的超时中止时间. 该选项可能会对php.ini设置中的'max_execution_time'因为某些特殊原因没有中止运行的脚本有用. 设置为 '0' 表示 'Off'.当经常出现502错误时可以尝试更改此选项。\n* \n* rlimit_files = 1024\n* #设置文件打开描述符的rlimit限制. 默认值: 系统定义值默认可打开句柄是1024，可使用 ulimit -n查看，ulimit -n 2048修改。\n* \n* rlimit_core = 0\n* #设置核心rlimit最大限制值. 可用值: 'unlimited' 、0或者正整数. 默认值: 系统定义值.\n* \n* chroot =\n* #启动时的Chroot目录. 所定义的目录需要是绝对路径. 如果没有设置, 则chroot不被使用.\n* \n* chdir =\n* #设置启动目录，启动时会自动Chdir到该目录. 所定义的目录需要是绝对路径. 默认值: 当前目录，或者/目录（chroot时）\n* \n* catch_workers_output = yes\n* #重定向运行过程中的stdout和stderr到主要的错误日志文件中. 如果没有设置, stdout 和 stderr 将会根据FastCGI的规则被重定向到 /dev/null . 默认值: 空.\n```\n\n#### php-fpm进程分配\n在之前的文章中就说过了。在fasgcgi模式下，php会启动多个php-fpm进程，来接收nginx发来的请求，那是不是进程越多，速度就越快呢？这可不一定！得根据我们的机器配置和业务量来决定。  \n我们先来看下，设定进程的配置在哪里？  \npm = static | dynamic | ondemand  \npm可以设置成这样3种，我们用的最多的就上前面2种。  \npm = static 模式  \npm = static 表示我们创建的php-fpm子进程数量是固定的，那么就只有pm.max_children = 50这个参数生效。你启动php-fpm的时候就会一起全部启动51(1个主＋50个子)个进程，颇为壮观。  \npm = dynamic 模式  \npm = dynamic模式，表示启动进程是动态分配的，随着请求量动态变化的。他由 pm.max_children，pm.start_servers，pm.min_spare_servers，pm.max_spare_servers 这几个参数共同决定。  \n上面已经讲过，这里再重申一下吧：  \npm.max_children ＝ 50 是最大可创建的子进程的数量。必须设置。这里表示最多只能50个子进程。  \npm.start_servers = 20 随着php-fpm一起启动时创建的子进程数目。默认值：min_spare_servers + (max_spare_servers - min_spare_servers) / 2。这里表示，一起启动会有20个子进程。\npm.min_spare_servers = 10 设置服务器空闲时最小php-fpm进程数量。必须设置。如果空闲的时候，会检查如果少于10个，就会启动几个来补上。  \npm.max_spare_servers = 30 设置服务器空闲时最大php-fpm进程数量。必须设置。如果空闲时，会检查进程数，多于30个了，就会关闭几个，达到30个的状态。  \n到底选择static还数dynamic?  \n很多人恐惧症来袭，不知道选什么好？  \n一般原则是：动态适合小内存机器，灵活分配进程，省内存。静态适用于大内存机器，动态创建回收进程对服务器资源也是一种消耗。  \n如果你的内存很大，有8-20G，按照一个php-fpm进程20M算，100个就2G内存了，那就可以开启static模式。如果你的内存很小，比如才256M，那就要小心设置了，因为你的机器里面的其他的进程也算需要占用内存的，所以设置成dynamic是最好的，比如：pm.max_chindren = 8, 占用内存160M左右，而且可以随时变化，对于一半访问量的网站足够了。  \n慢日志查询  \n我们有时候会经常饱受500,502问题困扰。当nginx收到如上错误码时，可以确定后端php-fpm解析php出了某种问题，比如，执行错误，执行超时。  \n这个时候，我们是可以开启慢日志功能的。  \n\n* slowlog = /usr/local/var/log/php-fpm.log.slow  \n* request_slowlog_timeout = 15s  \n当一个请求该设置的超时时间15秒后，就会将对应的PHP调用堆栈信息完整写入到慢日志中。  \nphp-fpm慢日志会记录下进程号，脚本名称，具体哪个文件哪行代码的哪个函数执行时间过长：  \n\n* [21-Nov-2013 14:30:38] [pool www] pid 11877  \n* script_filename = /usr/local/lnmp/nginx/html/www.quancha.cn/www/fyzb.php  \n* [0xb70fb88c] file_get_contents() /usr/local/lnmp/nginx/html/www.quancha.cn/www/fyzb.php:2  \n通过日志，我们就可以知道第2行的file_get_contents 函数有点问题，这样我们就能追踪问题了。  \n\n转载：https://blog.csdn.net/ahaotata/article/details/83825977\n\n","source":"_posts/PHP/php-fpm理解以及处理502问题.md","raw":"---\ncategories:\n  - PHP\n---\n### 网站出现502\n- 杀死进程\n``` shell\n    #!/bin/sh\n    pids=$(ps -e -o 'pid,comm,args,pcpu,rsz,vsz,stime,user,uid' | sort -nrk5 | grep www | grep -v grep|awk ' $2!=\"nginx\" {print $1}')\n    #echo $pids\n    if [ \"$pids\" != \"\" ];then\n    for  pid  in   $pids;\n    do\n    echo $pid\n    kill -9 $pid\n    done\n    fi\n```\n- 调高进程数  \n使用 netstat -napo |grep \"php-fpm\" | wc -l 查看一下当前 fastcgi 进程个数，如果个数接近 conf 里配置的上限，就需要调高进程数。\n但也不能无休止调高，可以根据服务器内存情况，可以把 php-fpm 子进程数调到 100 或以上，在 4G 内存的服务器上 200 就可以。\n- 调高 linux 内核打开文件数量  \n可以使用这些命令 ( 必须是 root 帐号 )  \necho 'ulimit -HSn 65536'>> /etc/profile  \necho 'ulimit -HSn 65536'>> /etc/rc.local  \nsource /etc/profile  \n- 调整脚本执行时间  \n如果脚本因为某种原因长时间等待不返回 ，导致新来的请求不能得到处理，可以适当调小如下配置。\nnginx.conf 里面主要是如下：  \nfastcgi_connect_timeout 300;  \nfastcgi_send_timeout 300;  \nfastcgi_read_timeout 300;  \nphp-fpm.conf 里如要是如下  \nrequest_terminate_timeout =10s  \n- 增加缓存  \n修改或增加配置到 nginx.conf  \nproxy_buffer_size 64k;  \nproxy_buffers  512k;  \nproxy_busy_buffers_size 128k;  \n\n### php-fpm理解\nwebserver每收到一个请求，都会去fork一个cgi进程，请求结束再kill掉这个进程。这样有10000个请求，就需要fork、kill php-cgi进程10000次,很浪费资源？于是，出现了cgi的改良版本，fast-cgi。fast-cgi每次处理完请求后，不会kill掉这个进程，而是保留这个进程，使这个进程可以一次处理多个请求。这样每次就不用重新fork一个进程了，大大提高了效率。    \n\nphp-fpm是什么\nphp-fpm即php-Fastcgi Process Manager. php-fpm是 FastCGI 的实现，并提供了进程管理的功能。 进程包含 master 进程和 worker 进程两种进程。 master 进程只有一个，负责监听端口，接收来自 Web Server 的请求，而 worker 进程则一般有多个(具体数量根据实际需要配置)，每个进程内部都嵌入了一个 PHP 解释器，是 PHP 代码真正执行的地方。\n\n#### php-fpm.conf\n``` conf\n* pid = /usr/local/var/run/php-fpm.pid\n* #pid设置，一定要开启,上面是Mac平台的。默认在php安装目录中的var/run/php-fpm.pid。比如centos的在: /usr/local/php/var/run/php-fpm.pid\n* \n* error_log = /usr/local/var/log/php-fpm.log\n* #错误日志，上面是Mac平台的，默认在php安装目录中的var/log/php-fpm.log，比如centos的在: /usr/local/php/var/log/php-fpm.log\n* \n* log_level = notice\n* #错误级别. 上面的php-fpm.log纪录的登记。可用级别为: alert（必须立即处理）, error（错误情况）, warning（警告情况）, notice（一般重要信息）, debug（调试信息）. 默认: notice.\n* \n* emergency_restart_threshold = 60\n* emergency_restart_interval = 60s\n* #表示在emergency_restart_interval所设值内出现SIGSEGV或者SIGBUS错误的php-cgi进程数如果超过 emergency_restart_threshold个，php-fpm就会优雅重启。这两个选项一般保持默认值。0 表示 '关闭该功能'. 默认值: 0 (关闭).\n* \n* process_control_timeout = 0\n* #设置子进程接受主进程复用信号的超时时间. 可用单位: s(秒), m(分), h(小时), 或者 d(天) 默认单位: s(秒). 默认值: 0.\n* \n* daemonize = yes\n* #后台执行fpm,默认值为yes，如果为了调试可以改为no。在FPM中，可以使用不同的设置来运行多个进程池。 这些设置可以针对每个进程池单独设置。\n* \n* listen = 127.0.0.1:9000\n* #fpm监听端口，即nginx中php处理的地址，一般默认值即可。可用格式为: 'ip:port', 'port', '/path/to/unix/socket'. 每个进程池都需要设置。如果nginx和php在不同的机器上，分布式处理，就设置ip这里就可以了。\n* \n* listen.backlog = -1\n* #backlog数，设置 listen 的半连接队列长度，-1表示无限制，由操作系统决定，此行注释掉就行。backlog含义参考：http://www.3gyou.cc/?p=41\n* \n* listen.allowed_clients = 127.0.0.1\n* #允许访问FastCGI进程的IP白名单，设置any为不限制IP，如果要设置其他主机的nginx也能访问这台FPM进程，listen处要设置成本地可被访问的IP。默认值是any。每个地址是用逗号分隔. 如果没有设置或者为空，则允许任何服务器请求连接。\n* \n* listen.owner = www\n* listen.group = www\n* listen.mode = 0666\n* #unix socket设置选项，如果使用tcp方式访问，这里注释即可。\n* \n* user = www\n* group = www\n* #启动进程的用户和用户组，FPM 进程运行的Unix用户, 必须要设置。用户组，如果没有设置，则默认用户的组被使用。\n* \n* pm = dynamic\n* #php-fpm进程启动模式，pm可以设置为static和dynamic和ondemand\n* #如果选择static，则进程数就数固定的，由pm.max_children指定固定的子进程数。\n* \n* #如果选择dynamic，则进程数是动态变化的,由以下参数决定：\n* pm.max_children = 50 #子进程最大数\n* pm.start_servers = 2 #启动时的进程数，默认值为: min_spare_servers + (max_spare_servers - min_spare_servers) / 2\n* pm.min_spare_servers = 1 #保证空闲进程数最小值，如果空闲进程小于此值，则创建新的子进程\n* pm.max_spare_servers = 3 #，保证空闲进程数最大值，如果空闲进程大于此值，此进行清理\n* \n* pm.max_requests = 500\n* #设置每个子进程重生之前服务的请求数. 对于可能存在内存泄漏的第三方模块来说是非常有用的. 如果设置为 '0' 则一直接受请求. 等同于 PHP_FCGI_MAX_REQUESTS 环境变量. 默认值: 0.\n* \n* pm.status_path = /status\n* #FPM状态页面的网址. 如果没有设置, 则无法访问状态页面. 默认值: none. munin监控会使用到\n* \n* ping.path = /ping\n* #FPM监控页面的ping网址. 如果没有设置, 则无法访问ping页面. 该页面用于外部检测FPM是否存活并且可以响应请求. 请注意必须以斜线开头 (/)。\n* \n* ping.response = pong\n* #用于定义ping请求的返回相应. 返回为 HTTP 200 的 text/plain 格式文本. 默认值: pong.\n* \n* access.log = log/$pool.access.log\n* #每一个请求的访问日志，默认是关闭的。\n* \n* access.format = \"%R - %u %t \\\"%m %r%Q%q\\\" %s %f %{mili}d %{kilo}M %C%%\"\n* #设定访问日志的格式。\n* \n* slowlog = log/$pool.log.slow\n* #慢请求的记录日志,配合request_slowlog_timeout使用，默认关闭\n* \n* request_slowlog_timeout = 10s\n* #当一个请求该设置的超时时间后，就会将对应的PHP调用堆栈信息完整写入到慢日志中. 设置为 '0' 表示 'Off'\n* \n* request_terminate_timeout = 0\n* #设置单个请求的超时中止时间. 该选项可能会对php.ini设置中的'max_execution_time'因为某些特殊原因没有中止运行的脚本有用. 设置为 '0' 表示 'Off'.当经常出现502错误时可以尝试更改此选项。\n* \n* rlimit_files = 1024\n* #设置文件打开描述符的rlimit限制. 默认值: 系统定义值默认可打开句柄是1024，可使用 ulimit -n查看，ulimit -n 2048修改。\n* \n* rlimit_core = 0\n* #设置核心rlimit最大限制值. 可用值: 'unlimited' 、0或者正整数. 默认值: 系统定义值.\n* \n* chroot =\n* #启动时的Chroot目录. 所定义的目录需要是绝对路径. 如果没有设置, 则chroot不被使用.\n* \n* chdir =\n* #设置启动目录，启动时会自动Chdir到该目录. 所定义的目录需要是绝对路径. 默认值: 当前目录，或者/目录（chroot时）\n* \n* catch_workers_output = yes\n* #重定向运行过程中的stdout和stderr到主要的错误日志文件中. 如果没有设置, stdout 和 stderr 将会根据FastCGI的规则被重定向到 /dev/null . 默认值: 空.\n```\n\n#### php-fpm进程分配\n在之前的文章中就说过了。在fasgcgi模式下，php会启动多个php-fpm进程，来接收nginx发来的请求，那是不是进程越多，速度就越快呢？这可不一定！得根据我们的机器配置和业务量来决定。  \n我们先来看下，设定进程的配置在哪里？  \npm = static | dynamic | ondemand  \npm可以设置成这样3种，我们用的最多的就上前面2种。  \npm = static 模式  \npm = static 表示我们创建的php-fpm子进程数量是固定的，那么就只有pm.max_children = 50这个参数生效。你启动php-fpm的时候就会一起全部启动51(1个主＋50个子)个进程，颇为壮观。  \npm = dynamic 模式  \npm = dynamic模式，表示启动进程是动态分配的，随着请求量动态变化的。他由 pm.max_children，pm.start_servers，pm.min_spare_servers，pm.max_spare_servers 这几个参数共同决定。  \n上面已经讲过，这里再重申一下吧：  \npm.max_children ＝ 50 是最大可创建的子进程的数量。必须设置。这里表示最多只能50个子进程。  \npm.start_servers = 20 随着php-fpm一起启动时创建的子进程数目。默认值：min_spare_servers + (max_spare_servers - min_spare_servers) / 2。这里表示，一起启动会有20个子进程。\npm.min_spare_servers = 10 设置服务器空闲时最小php-fpm进程数量。必须设置。如果空闲的时候，会检查如果少于10个，就会启动几个来补上。  \npm.max_spare_servers = 30 设置服务器空闲时最大php-fpm进程数量。必须设置。如果空闲时，会检查进程数，多于30个了，就会关闭几个，达到30个的状态。  \n到底选择static还数dynamic?  \n很多人恐惧症来袭，不知道选什么好？  \n一般原则是：动态适合小内存机器，灵活分配进程，省内存。静态适用于大内存机器，动态创建回收进程对服务器资源也是一种消耗。  \n如果你的内存很大，有8-20G，按照一个php-fpm进程20M算，100个就2G内存了，那就可以开启static模式。如果你的内存很小，比如才256M，那就要小心设置了，因为你的机器里面的其他的进程也算需要占用内存的，所以设置成dynamic是最好的，比如：pm.max_chindren = 8, 占用内存160M左右，而且可以随时变化，对于一半访问量的网站足够了。  \n慢日志查询  \n我们有时候会经常饱受500,502问题困扰。当nginx收到如上错误码时，可以确定后端php-fpm解析php出了某种问题，比如，执行错误，执行超时。  \n这个时候，我们是可以开启慢日志功能的。  \n\n* slowlog = /usr/local/var/log/php-fpm.log.slow  \n* request_slowlog_timeout = 15s  \n当一个请求该设置的超时时间15秒后，就会将对应的PHP调用堆栈信息完整写入到慢日志中。  \nphp-fpm慢日志会记录下进程号，脚本名称，具体哪个文件哪行代码的哪个函数执行时间过长：  \n\n* [21-Nov-2013 14:30:38] [pool www] pid 11877  \n* script_filename = /usr/local/lnmp/nginx/html/www.quancha.cn/www/fyzb.php  \n* [0xb70fb88c] file_get_contents() /usr/local/lnmp/nginx/html/www.quancha.cn/www/fyzb.php:2  \n通过日志，我们就可以知道第2行的file_get_contents 函数有点问题，这样我们就能追踪问题了。  \n\n转载：https://blog.csdn.net/ahaotata/article/details/83825977\n\n","slug":"php-fpm理解以及处理502问题","published":1,"category":"PHP","date":"2023-06-08T23:03:56.099Z","updated":"2023-06-08T23:12:13.672Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5sed0015dxjc5nj48ssf","content":"<h3 id=\"网站出现502\"><a href=\"#网站出现502\" class=\"headerlink\" title=\"网站出现502\"></a>网站出现502</h3><ul>\n<li>杀死进程<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">!/bin/sh</span></span><br><span class=\"line\">pids=$(ps -e -o &#x27;pid,comm,args,pcpu,rsz,vsz,stime,user,uid&#x27; | sort -nrk5 | grep www | grep -v grep|awk &#x27; $2!=&quot;nginx&quot; &#123;print $1&#125;&#x27;)</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"built_in\">echo</span> <span class=\"variable\">$pids</span></span></span><br><span class=\"line\">if [ &quot;$pids&quot; != &quot;&quot; ];then</span><br><span class=\"line\">for  pid  in   $pids;</span><br><span class=\"line\">do</span><br><span class=\"line\">echo $pid</span><br><span class=\"line\">kill -9 $pid</span><br><span class=\"line\">done</span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure></li>\n<li>调高进程数<br>使用 netstat -napo |grep “php-fpm” | wc -l 查看一下当前 fastcgi 进程个数，如果个数接近 conf 里配置的上限，就需要调高进程数。<br>但也不能无休止调高，可以根据服务器内存情况，可以把 php-fpm 子进程数调到 100 或以上，在 4G 内存的服务器上 200 就可以。</li>\n<li>调高 linux 内核打开文件数量<br>可以使用这些命令 ( 必须是 root 帐号 )<br>echo ‘ulimit -HSn 65536’&gt;&gt; &#x2F;etc&#x2F;profile<br>echo ‘ulimit -HSn 65536’&gt;&gt; &#x2F;etc&#x2F;rc.local<br>source &#x2F;etc&#x2F;profile  </li>\n<li>调整脚本执行时间<br>如果脚本因为某种原因长时间等待不返回 ，导致新来的请求不能得到处理，可以适当调小如下配置。<br>nginx.conf 里面主要是如下：<br>fastcgi_connect_timeout 300;<br>fastcgi_send_timeout 300;<br>fastcgi_read_timeout 300;<br>php-fpm.conf 里如要是如下<br>request_terminate_timeout &#x3D;10s  </li>\n<li>增加缓存<br>修改或增加配置到 nginx.conf<br>proxy_buffer_size 64k;<br>proxy_buffers  512k;<br>proxy_busy_buffers_size 128k;</li>\n</ul>\n<h3 id=\"php-fpm理解\"><a href=\"#php-fpm理解\" class=\"headerlink\" title=\"php-fpm理解\"></a>php-fpm理解</h3><p>webserver每收到一个请求，都会去fork一个cgi进程，请求结束再kill掉这个进程。这样有10000个请求，就需要fork、kill php-cgi进程10000次,很浪费资源？于是，出现了cgi的改良版本，fast-cgi。fast-cgi每次处理完请求后，不会kill掉这个进程，而是保留这个进程，使这个进程可以一次处理多个请求。这样每次就不用重新fork一个进程了，大大提高了效率。    </p>\n<p>php-fpm是什么<br>php-fpm即php-Fastcgi Process Manager. php-fpm是 FastCGI 的实现，并提供了进程管理的功能。 进程包含 master 进程和 worker 进程两种进程。 master 进程只有一个，负责监听端口，接收来自 Web Server 的请求，而 worker 进程则一般有多个(具体数量根据实际需要配置)，每个进程内部都嵌入了一个 PHP 解释器，是 PHP 代码真正执行的地方。</p>\n<h4 id=\"php-fpm-conf\"><a href=\"#php-fpm-conf\" class=\"headerlink\" title=\"php-fpm.conf\"></a>php-fpm.conf</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* pid = /usr/local/var/run/php-fpm.pid</span><br><span class=\"line\">* #pid设置，一定要开启,上面是Mac平台的。默认在php安装目录中的var/run/php-fpm.pid。比如centos的在: /usr/local/php/var/run/php-fpm.pid</span><br><span class=\"line\">* </span><br><span class=\"line\">* error_log = /usr/local/var/log/php-fpm.log</span><br><span class=\"line\">* #错误日志，上面是Mac平台的，默认在php安装目录中的var/log/php-fpm.log，比如centos的在: /usr/local/php/var/log/php-fpm.log</span><br><span class=\"line\">* </span><br><span class=\"line\">* log_level = notice</span><br><span class=\"line\">* #错误级别. 上面的php-fpm.log纪录的登记。可用级别为: alert（必须立即处理）, error（错误情况）, warning（警告情况）, notice（一般重要信息）, debug（调试信息）. 默认: notice.</span><br><span class=\"line\">* </span><br><span class=\"line\">* emergency_restart_threshold = 60</span><br><span class=\"line\">* emergency_restart_interval = 60s</span><br><span class=\"line\">* #表示在emergency_restart_interval所设值内出现SIGSEGV或者SIGBUS错误的php-cgi进程数如果超过 emergency_restart_threshold个，php-fpm就会优雅重启。这两个选项一般保持默认值。0 表示 &#x27;关闭该功能&#x27;. 默认值: 0 (关闭).</span><br><span class=\"line\">* </span><br><span class=\"line\">* process_control_timeout = 0</span><br><span class=\"line\">* #设置子进程接受主进程复用信号的超时时间. 可用单位: s(秒), m(分), h(小时), 或者 d(天) 默认单位: s(秒). 默认值: 0.</span><br><span class=\"line\">* </span><br><span class=\"line\">* daemonize = yes</span><br><span class=\"line\">* #后台执行fpm,默认值为yes，如果为了调试可以改为no。在FPM中，可以使用不同的设置来运行多个进程池。 这些设置可以针对每个进程池单独设置。</span><br><span class=\"line\">* </span><br><span class=\"line\">* listen = 127.0.0.1:9000</span><br><span class=\"line\">* #fpm监听端口，即nginx中php处理的地址，一般默认值即可。可用格式为: &#x27;ip:port&#x27;, &#x27;port&#x27;, &#x27;/path/to/unix/socket&#x27;. 每个进程池都需要设置。如果nginx和php在不同的机器上，分布式处理，就设置ip这里就可以了。</span><br><span class=\"line\">* </span><br><span class=\"line\">* listen.backlog = -1</span><br><span class=\"line\">* #backlog数，设置 listen 的半连接队列长度，-1表示无限制，由操作系统决定，此行注释掉就行。backlog含义参考：http://www.3gyou.cc/?p=41</span><br><span class=\"line\">* </span><br><span class=\"line\">* listen.allowed_clients = 127.0.0.1</span><br><span class=\"line\">* #允许访问FastCGI进程的IP白名单，设置any为不限制IP，如果要设置其他主机的nginx也能访问这台FPM进程，listen处要设置成本地可被访问的IP。默认值是any。每个地址是用逗号分隔. 如果没有设置或者为空，则允许任何服务器请求连接。</span><br><span class=\"line\">* </span><br><span class=\"line\">* listen.owner = www</span><br><span class=\"line\">* listen.group = www</span><br><span class=\"line\">* listen.mode = 0666</span><br><span class=\"line\">* #unix socket设置选项，如果使用tcp方式访问，这里注释即可。</span><br><span class=\"line\">* </span><br><span class=\"line\">* user = www</span><br><span class=\"line\">* group = www</span><br><span class=\"line\">* #启动进程的用户和用户组，FPM 进程运行的Unix用户, 必须要设置。用户组，如果没有设置，则默认用户的组被使用。</span><br><span class=\"line\">* </span><br><span class=\"line\">* pm = dynamic</span><br><span class=\"line\">* #php-fpm进程启动模式，pm可以设置为static和dynamic和ondemand</span><br><span class=\"line\">* #如果选择static，则进程数就数固定的，由pm.max_children指定固定的子进程数。</span><br><span class=\"line\">* </span><br><span class=\"line\">* #如果选择dynamic，则进程数是动态变化的,由以下参数决定：</span><br><span class=\"line\">* pm.max_children = 50 #子进程最大数</span><br><span class=\"line\">* pm.start_servers = 2 #启动时的进程数，默认值为: min_spare_servers + (max_spare_servers - min_spare_servers) / 2</span><br><span class=\"line\">* pm.min_spare_servers = 1 #保证空闲进程数最小值，如果空闲进程小于此值，则创建新的子进程</span><br><span class=\"line\">* pm.max_spare_servers = 3 #，保证空闲进程数最大值，如果空闲进程大于此值，此进行清理</span><br><span class=\"line\">* </span><br><span class=\"line\">* pm.max_requests = 500</span><br><span class=\"line\">* #设置每个子进程重生之前服务的请求数. 对于可能存在内存泄漏的第三方模块来说是非常有用的. 如果设置为 &#x27;0&#x27; 则一直接受请求. 等同于 PHP_FCGI_MAX_REQUESTS 环境变量. 默认值: 0.</span><br><span class=\"line\">* </span><br><span class=\"line\">* pm.status_path = /status</span><br><span class=\"line\">* #FPM状态页面的网址. 如果没有设置, 则无法访问状态页面. 默认值: none. munin监控会使用到</span><br><span class=\"line\">* </span><br><span class=\"line\">* ping.path = /ping</span><br><span class=\"line\">* #FPM监控页面的ping网址. 如果没有设置, 则无法访问ping页面. 该页面用于外部检测FPM是否存活并且可以响应请求. 请注意必须以斜线开头 (/)。</span><br><span class=\"line\">* </span><br><span class=\"line\">* ping.response = pong</span><br><span class=\"line\">* #用于定义ping请求的返回相应. 返回为 HTTP 200 的 text/plain 格式文本. 默认值: pong.</span><br><span class=\"line\">* </span><br><span class=\"line\">* access.log = log/$pool.access.log</span><br><span class=\"line\">* #每一个请求的访问日志，默认是关闭的。</span><br><span class=\"line\">* </span><br><span class=\"line\">* access.format = &quot;%R - %u %t \\&quot;%m %r%Q%q\\&quot; %s %f %&#123;mili&#125;d %&#123;kilo&#125;M %C%%&quot;</span><br><span class=\"line\">* #设定访问日志的格式。</span><br><span class=\"line\">* </span><br><span class=\"line\">* slowlog = log/$pool.log.slow</span><br><span class=\"line\">* #慢请求的记录日志,配合request_slowlog_timeout使用，默认关闭</span><br><span class=\"line\">* </span><br><span class=\"line\">* request_slowlog_timeout = 10s</span><br><span class=\"line\">* #当一个请求该设置的超时时间后，就会将对应的PHP调用堆栈信息完整写入到慢日志中. 设置为 &#x27;0&#x27; 表示 &#x27;Off&#x27;</span><br><span class=\"line\">* </span><br><span class=\"line\">* request_terminate_timeout = 0</span><br><span class=\"line\">* #设置单个请求的超时中止时间. 该选项可能会对php.ini设置中的&#x27;max_execution_time&#x27;因为某些特殊原因没有中止运行的脚本有用. 设置为 &#x27;0&#x27; 表示 &#x27;Off&#x27;.当经常出现502错误时可以尝试更改此选项。</span><br><span class=\"line\">* </span><br><span class=\"line\">* rlimit_files = 1024</span><br><span class=\"line\">* #设置文件打开描述符的rlimit限制. 默认值: 系统定义值默认可打开句柄是1024，可使用 ulimit -n查看，ulimit -n 2048修改。</span><br><span class=\"line\">* </span><br><span class=\"line\">* rlimit_core = 0</span><br><span class=\"line\">* #设置核心rlimit最大限制值. 可用值: &#x27;unlimited&#x27; 、0或者正整数. 默认值: 系统定义值.</span><br><span class=\"line\">* </span><br><span class=\"line\">* chroot =</span><br><span class=\"line\">* #启动时的Chroot目录. 所定义的目录需要是绝对路径. 如果没有设置, 则chroot不被使用.</span><br><span class=\"line\">* </span><br><span class=\"line\">* chdir =</span><br><span class=\"line\">* #设置启动目录，启动时会自动Chdir到该目录. 所定义的目录需要是绝对路径. 默认值: 当前目录，或者/目录（chroot时）</span><br><span class=\"line\">* </span><br><span class=\"line\">* catch_workers_output = yes</span><br><span class=\"line\">* #重定向运行过程中的stdout和stderr到主要的错误日志文件中. 如果没有设置, stdout 和 stderr 将会根据FastCGI的规则被重定向到 /dev/null . 默认值: 空.</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"php-fpm进程分配\"><a href=\"#php-fpm进程分配\" class=\"headerlink\" title=\"php-fpm进程分配\"></a>php-fpm进程分配</h4><p>在之前的文章中就说过了。在fasgcgi模式下，php会启动多个php-fpm进程，来接收nginx发来的请求，那是不是进程越多，速度就越快呢？这可不一定！得根据我们的机器配置和业务量来决定。<br>我们先来看下，设定进程的配置在哪里？<br>pm &#x3D; static | dynamic | ondemand<br>pm可以设置成这样3种，我们用的最多的就上前面2种。<br>pm &#x3D; static 模式<br>pm &#x3D; static 表示我们创建的php-fpm子进程数量是固定的，那么就只有pm.max_children &#x3D; 50这个参数生效。你启动php-fpm的时候就会一起全部启动51(1个主＋50个子)个进程，颇为壮观。<br>pm &#x3D; dynamic 模式<br>pm &#x3D; dynamic模式，表示启动进程是动态分配的，随着请求量动态变化的。他由 pm.max_children，pm.start_servers，pm.min_spare_servers，pm.max_spare_servers 这几个参数共同决定。<br>上面已经讲过，这里再重申一下吧：<br>pm.max_children ＝ 50 是最大可创建的子进程的数量。必须设置。这里表示最多只能50个子进程。<br>pm.start_servers &#x3D; 20 随着php-fpm一起启动时创建的子进程数目。默认值：min_spare_servers + (max_spare_servers - min_spare_servers) &#x2F; 2。这里表示，一起启动会有20个子进程。<br>pm.min_spare_servers &#x3D; 10 设置服务器空闲时最小php-fpm进程数量。必须设置。如果空闲的时候，会检查如果少于10个，就会启动几个来补上。<br>pm.max_spare_servers &#x3D; 30 设置服务器空闲时最大php-fpm进程数量。必须设置。如果空闲时，会检查进程数，多于30个了，就会关闭几个，达到30个的状态。<br>到底选择static还数dynamic?<br>很多人恐惧症来袭，不知道选什么好？<br>一般原则是：动态适合小内存机器，灵活分配进程，省内存。静态适用于大内存机器，动态创建回收进程对服务器资源也是一种消耗。<br>如果你的内存很大，有8-20G，按照一个php-fpm进程20M算，100个就2G内存了，那就可以开启static模式。如果你的内存很小，比如才256M，那就要小心设置了，因为你的机器里面的其他的进程也算需要占用内存的，所以设置成dynamic是最好的，比如：pm.max_chindren &#x3D; 8, 占用内存160M左右，而且可以随时变化，对于一半访问量的网站足够了。<br>慢日志查询<br>我们有时候会经常饱受500,502问题困扰。当nginx收到如上错误码时，可以确定后端php-fpm解析php出了某种问题，比如，执行错误，执行超时。<br>这个时候，我们是可以开启慢日志功能的。  </p>\n<ul>\n<li><p>slowlog &#x3D; &#x2F;usr&#x2F;local&#x2F;var&#x2F;log&#x2F;php-fpm.log.slow  </p>\n</li>\n<li><p>request_slowlog_timeout &#x3D; 15s<br>当一个请求该设置的超时时间15秒后，就会将对应的PHP调用堆栈信息完整写入到慢日志中。<br>php-fpm慢日志会记录下进程号，脚本名称，具体哪个文件哪行代码的哪个函数执行时间过长：  </p>\n</li>\n<li><p>[21-Nov-2013 14:30:38] [pool www] pid 11877  </p>\n</li>\n<li><p>script_filename &#x3D; &#x2F;usr&#x2F;local&#x2F;lnmp&#x2F;nginx&#x2F;html&#x2F;<a href=\"http://www.quancha.cn/www/fyzb.php\">www.quancha.cn/www/fyzb.php</a>  </p>\n</li>\n<li><p>[0xb70fb88c] file_get_contents() &#x2F;usr&#x2F;local&#x2F;lnmp&#x2F;nginx&#x2F;html&#x2F;<a href=\"http://www.quancha.cn/www/fyzb.php:2\">www.quancha.cn/www/fyzb.php:2</a><br>通过日志，我们就可以知道第2行的file_get_contents 函数有点问题，这样我们就能追踪问题了。</p>\n</li>\n</ul>\n<p>转载：<a href=\"https://blog.csdn.net/ahaotata/article/details/83825977\">https://blog.csdn.net/ahaotata/article/details/83825977</a></p>\n","site":{"data":{}},"length":6294,"excerpt":"","more":"<h3 id=\"网站出现502\"><a href=\"#网站出现502\" class=\"headerlink\" title=\"网站出现502\"></a>网站出现502</h3><ul>\n<li>杀死进程<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">!/bin/sh</span></span><br><span class=\"line\">pids=$(ps -e -o &#x27;pid,comm,args,pcpu,rsz,vsz,stime,user,uid&#x27; | sort -nrk5 | grep www | grep -v grep|awk &#x27; $2!=&quot;nginx&quot; &#123;print $1&#125;&#x27;)</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"built_in\">echo</span> <span class=\"variable\">$pids</span></span></span><br><span class=\"line\">if [ &quot;$pids&quot; != &quot;&quot; ];then</span><br><span class=\"line\">for  pid  in   $pids;</span><br><span class=\"line\">do</span><br><span class=\"line\">echo $pid</span><br><span class=\"line\">kill -9 $pid</span><br><span class=\"line\">done</span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure></li>\n<li>调高进程数<br>使用 netstat -napo |grep “php-fpm” | wc -l 查看一下当前 fastcgi 进程个数，如果个数接近 conf 里配置的上限，就需要调高进程数。<br>但也不能无休止调高，可以根据服务器内存情况，可以把 php-fpm 子进程数调到 100 或以上，在 4G 内存的服务器上 200 就可以。</li>\n<li>调高 linux 内核打开文件数量<br>可以使用这些命令 ( 必须是 root 帐号 )<br>echo ‘ulimit -HSn 65536’&gt;&gt; &#x2F;etc&#x2F;profile<br>echo ‘ulimit -HSn 65536’&gt;&gt; &#x2F;etc&#x2F;rc.local<br>source &#x2F;etc&#x2F;profile  </li>\n<li>调整脚本执行时间<br>如果脚本因为某种原因长时间等待不返回 ，导致新来的请求不能得到处理，可以适当调小如下配置。<br>nginx.conf 里面主要是如下：<br>fastcgi_connect_timeout 300;<br>fastcgi_send_timeout 300;<br>fastcgi_read_timeout 300;<br>php-fpm.conf 里如要是如下<br>request_terminate_timeout &#x3D;10s  </li>\n<li>增加缓存<br>修改或增加配置到 nginx.conf<br>proxy_buffer_size 64k;<br>proxy_buffers  512k;<br>proxy_busy_buffers_size 128k;</li>\n</ul>\n<h3 id=\"php-fpm理解\"><a href=\"#php-fpm理解\" class=\"headerlink\" title=\"php-fpm理解\"></a>php-fpm理解</h3><p>webserver每收到一个请求，都会去fork一个cgi进程，请求结束再kill掉这个进程。这样有10000个请求，就需要fork、kill php-cgi进程10000次,很浪费资源？于是，出现了cgi的改良版本，fast-cgi。fast-cgi每次处理完请求后，不会kill掉这个进程，而是保留这个进程，使这个进程可以一次处理多个请求。这样每次就不用重新fork一个进程了，大大提高了效率。    </p>\n<p>php-fpm是什么<br>php-fpm即php-Fastcgi Process Manager. php-fpm是 FastCGI 的实现，并提供了进程管理的功能。 进程包含 master 进程和 worker 进程两种进程。 master 进程只有一个，负责监听端口，接收来自 Web Server 的请求，而 worker 进程则一般有多个(具体数量根据实际需要配置)，每个进程内部都嵌入了一个 PHP 解释器，是 PHP 代码真正执行的地方。</p>\n<h4 id=\"php-fpm-conf\"><a href=\"#php-fpm-conf\" class=\"headerlink\" title=\"php-fpm.conf\"></a>php-fpm.conf</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* pid = /usr/local/var/run/php-fpm.pid</span><br><span class=\"line\">* #pid设置，一定要开启,上面是Mac平台的。默认在php安装目录中的var/run/php-fpm.pid。比如centos的在: /usr/local/php/var/run/php-fpm.pid</span><br><span class=\"line\">* </span><br><span class=\"line\">* error_log = /usr/local/var/log/php-fpm.log</span><br><span class=\"line\">* #错误日志，上面是Mac平台的，默认在php安装目录中的var/log/php-fpm.log，比如centos的在: /usr/local/php/var/log/php-fpm.log</span><br><span class=\"line\">* </span><br><span class=\"line\">* log_level = notice</span><br><span class=\"line\">* #错误级别. 上面的php-fpm.log纪录的登记。可用级别为: alert（必须立即处理）, error（错误情况）, warning（警告情况）, notice（一般重要信息）, debug（调试信息）. 默认: notice.</span><br><span class=\"line\">* </span><br><span class=\"line\">* emergency_restart_threshold = 60</span><br><span class=\"line\">* emergency_restart_interval = 60s</span><br><span class=\"line\">* #表示在emergency_restart_interval所设值内出现SIGSEGV或者SIGBUS错误的php-cgi进程数如果超过 emergency_restart_threshold个，php-fpm就会优雅重启。这两个选项一般保持默认值。0 表示 &#x27;关闭该功能&#x27;. 默认值: 0 (关闭).</span><br><span class=\"line\">* </span><br><span class=\"line\">* process_control_timeout = 0</span><br><span class=\"line\">* #设置子进程接受主进程复用信号的超时时间. 可用单位: s(秒), m(分), h(小时), 或者 d(天) 默认单位: s(秒). 默认值: 0.</span><br><span class=\"line\">* </span><br><span class=\"line\">* daemonize = yes</span><br><span class=\"line\">* #后台执行fpm,默认值为yes，如果为了调试可以改为no。在FPM中，可以使用不同的设置来运行多个进程池。 这些设置可以针对每个进程池单独设置。</span><br><span class=\"line\">* </span><br><span class=\"line\">* listen = 127.0.0.1:9000</span><br><span class=\"line\">* #fpm监听端口，即nginx中php处理的地址，一般默认值即可。可用格式为: &#x27;ip:port&#x27;, &#x27;port&#x27;, &#x27;/path/to/unix/socket&#x27;. 每个进程池都需要设置。如果nginx和php在不同的机器上，分布式处理，就设置ip这里就可以了。</span><br><span class=\"line\">* </span><br><span class=\"line\">* listen.backlog = -1</span><br><span class=\"line\">* #backlog数，设置 listen 的半连接队列长度，-1表示无限制，由操作系统决定，此行注释掉就行。backlog含义参考：http://www.3gyou.cc/?p=41</span><br><span class=\"line\">* </span><br><span class=\"line\">* listen.allowed_clients = 127.0.0.1</span><br><span class=\"line\">* #允许访问FastCGI进程的IP白名单，设置any为不限制IP，如果要设置其他主机的nginx也能访问这台FPM进程，listen处要设置成本地可被访问的IP。默认值是any。每个地址是用逗号分隔. 如果没有设置或者为空，则允许任何服务器请求连接。</span><br><span class=\"line\">* </span><br><span class=\"line\">* listen.owner = www</span><br><span class=\"line\">* listen.group = www</span><br><span class=\"line\">* listen.mode = 0666</span><br><span class=\"line\">* #unix socket设置选项，如果使用tcp方式访问，这里注释即可。</span><br><span class=\"line\">* </span><br><span class=\"line\">* user = www</span><br><span class=\"line\">* group = www</span><br><span class=\"line\">* #启动进程的用户和用户组，FPM 进程运行的Unix用户, 必须要设置。用户组，如果没有设置，则默认用户的组被使用。</span><br><span class=\"line\">* </span><br><span class=\"line\">* pm = dynamic</span><br><span class=\"line\">* #php-fpm进程启动模式，pm可以设置为static和dynamic和ondemand</span><br><span class=\"line\">* #如果选择static，则进程数就数固定的，由pm.max_children指定固定的子进程数。</span><br><span class=\"line\">* </span><br><span class=\"line\">* #如果选择dynamic，则进程数是动态变化的,由以下参数决定：</span><br><span class=\"line\">* pm.max_children = 50 #子进程最大数</span><br><span class=\"line\">* pm.start_servers = 2 #启动时的进程数，默认值为: min_spare_servers + (max_spare_servers - min_spare_servers) / 2</span><br><span class=\"line\">* pm.min_spare_servers = 1 #保证空闲进程数最小值，如果空闲进程小于此值，则创建新的子进程</span><br><span class=\"line\">* pm.max_spare_servers = 3 #，保证空闲进程数最大值，如果空闲进程大于此值，此进行清理</span><br><span class=\"line\">* </span><br><span class=\"line\">* pm.max_requests = 500</span><br><span class=\"line\">* #设置每个子进程重生之前服务的请求数. 对于可能存在内存泄漏的第三方模块来说是非常有用的. 如果设置为 &#x27;0&#x27; 则一直接受请求. 等同于 PHP_FCGI_MAX_REQUESTS 环境变量. 默认值: 0.</span><br><span class=\"line\">* </span><br><span class=\"line\">* pm.status_path = /status</span><br><span class=\"line\">* #FPM状态页面的网址. 如果没有设置, 则无法访问状态页面. 默认值: none. munin监控会使用到</span><br><span class=\"line\">* </span><br><span class=\"line\">* ping.path = /ping</span><br><span class=\"line\">* #FPM监控页面的ping网址. 如果没有设置, 则无法访问ping页面. 该页面用于外部检测FPM是否存活并且可以响应请求. 请注意必须以斜线开头 (/)。</span><br><span class=\"line\">* </span><br><span class=\"line\">* ping.response = pong</span><br><span class=\"line\">* #用于定义ping请求的返回相应. 返回为 HTTP 200 的 text/plain 格式文本. 默认值: pong.</span><br><span class=\"line\">* </span><br><span class=\"line\">* access.log = log/$pool.access.log</span><br><span class=\"line\">* #每一个请求的访问日志，默认是关闭的。</span><br><span class=\"line\">* </span><br><span class=\"line\">* access.format = &quot;%R - %u %t \\&quot;%m %r%Q%q\\&quot; %s %f %&#123;mili&#125;d %&#123;kilo&#125;M %C%%&quot;</span><br><span class=\"line\">* #设定访问日志的格式。</span><br><span class=\"line\">* </span><br><span class=\"line\">* slowlog = log/$pool.log.slow</span><br><span class=\"line\">* #慢请求的记录日志,配合request_slowlog_timeout使用，默认关闭</span><br><span class=\"line\">* </span><br><span class=\"line\">* request_slowlog_timeout = 10s</span><br><span class=\"line\">* #当一个请求该设置的超时时间后，就会将对应的PHP调用堆栈信息完整写入到慢日志中. 设置为 &#x27;0&#x27; 表示 &#x27;Off&#x27;</span><br><span class=\"line\">* </span><br><span class=\"line\">* request_terminate_timeout = 0</span><br><span class=\"line\">* #设置单个请求的超时中止时间. 该选项可能会对php.ini设置中的&#x27;max_execution_time&#x27;因为某些特殊原因没有中止运行的脚本有用. 设置为 &#x27;0&#x27; 表示 &#x27;Off&#x27;.当经常出现502错误时可以尝试更改此选项。</span><br><span class=\"line\">* </span><br><span class=\"line\">* rlimit_files = 1024</span><br><span class=\"line\">* #设置文件打开描述符的rlimit限制. 默认值: 系统定义值默认可打开句柄是1024，可使用 ulimit -n查看，ulimit -n 2048修改。</span><br><span class=\"line\">* </span><br><span class=\"line\">* rlimit_core = 0</span><br><span class=\"line\">* #设置核心rlimit最大限制值. 可用值: &#x27;unlimited&#x27; 、0或者正整数. 默认值: 系统定义值.</span><br><span class=\"line\">* </span><br><span class=\"line\">* chroot =</span><br><span class=\"line\">* #启动时的Chroot目录. 所定义的目录需要是绝对路径. 如果没有设置, 则chroot不被使用.</span><br><span class=\"line\">* </span><br><span class=\"line\">* chdir =</span><br><span class=\"line\">* #设置启动目录，启动时会自动Chdir到该目录. 所定义的目录需要是绝对路径. 默认值: 当前目录，或者/目录（chroot时）</span><br><span class=\"line\">* </span><br><span class=\"line\">* catch_workers_output = yes</span><br><span class=\"line\">* #重定向运行过程中的stdout和stderr到主要的错误日志文件中. 如果没有设置, stdout 和 stderr 将会根据FastCGI的规则被重定向到 /dev/null . 默认值: 空.</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"php-fpm进程分配\"><a href=\"#php-fpm进程分配\" class=\"headerlink\" title=\"php-fpm进程分配\"></a>php-fpm进程分配</h4><p>在之前的文章中就说过了。在fasgcgi模式下，php会启动多个php-fpm进程，来接收nginx发来的请求，那是不是进程越多，速度就越快呢？这可不一定！得根据我们的机器配置和业务量来决定。<br>我们先来看下，设定进程的配置在哪里？<br>pm &#x3D; static | dynamic | ondemand<br>pm可以设置成这样3种，我们用的最多的就上前面2种。<br>pm &#x3D; static 模式<br>pm &#x3D; static 表示我们创建的php-fpm子进程数量是固定的，那么就只有pm.max_children &#x3D; 50这个参数生效。你启动php-fpm的时候就会一起全部启动51(1个主＋50个子)个进程，颇为壮观。<br>pm &#x3D; dynamic 模式<br>pm &#x3D; dynamic模式，表示启动进程是动态分配的，随着请求量动态变化的。他由 pm.max_children，pm.start_servers，pm.min_spare_servers，pm.max_spare_servers 这几个参数共同决定。<br>上面已经讲过，这里再重申一下吧：<br>pm.max_children ＝ 50 是最大可创建的子进程的数量。必须设置。这里表示最多只能50个子进程。<br>pm.start_servers &#x3D; 20 随着php-fpm一起启动时创建的子进程数目。默认值：min_spare_servers + (max_spare_servers - min_spare_servers) &#x2F; 2。这里表示，一起启动会有20个子进程。<br>pm.min_spare_servers &#x3D; 10 设置服务器空闲时最小php-fpm进程数量。必须设置。如果空闲的时候，会检查如果少于10个，就会启动几个来补上。<br>pm.max_spare_servers &#x3D; 30 设置服务器空闲时最大php-fpm进程数量。必须设置。如果空闲时，会检查进程数，多于30个了，就会关闭几个，达到30个的状态。<br>到底选择static还数dynamic?<br>很多人恐惧症来袭，不知道选什么好？<br>一般原则是：动态适合小内存机器，灵活分配进程，省内存。静态适用于大内存机器，动态创建回收进程对服务器资源也是一种消耗。<br>如果你的内存很大，有8-20G，按照一个php-fpm进程20M算，100个就2G内存了，那就可以开启static模式。如果你的内存很小，比如才256M，那就要小心设置了，因为你的机器里面的其他的进程也算需要占用内存的，所以设置成dynamic是最好的，比如：pm.max_chindren &#x3D; 8, 占用内存160M左右，而且可以随时变化，对于一半访问量的网站足够了。<br>慢日志查询<br>我们有时候会经常饱受500,502问题困扰。当nginx收到如上错误码时，可以确定后端php-fpm解析php出了某种问题，比如，执行错误，执行超时。<br>这个时候，我们是可以开启慢日志功能的。  </p>\n<ul>\n<li><p>slowlog &#x3D; &#x2F;usr&#x2F;local&#x2F;var&#x2F;log&#x2F;php-fpm.log.slow  </p>\n</li>\n<li><p>request_slowlog_timeout &#x3D; 15s<br>当一个请求该设置的超时时间15秒后，就会将对应的PHP调用堆栈信息完整写入到慢日志中。<br>php-fpm慢日志会记录下进程号，脚本名称，具体哪个文件哪行代码的哪个函数执行时间过长：  </p>\n</li>\n<li><p>[21-Nov-2013 14:30:38] [pool www] pid 11877  </p>\n</li>\n<li><p>script_filename &#x3D; &#x2F;usr&#x2F;local&#x2F;lnmp&#x2F;nginx&#x2F;html&#x2F;<a href=\"http://www.quancha.cn/www/fyzb.php\">www.quancha.cn/www/fyzb.php</a>  </p>\n</li>\n<li><p>[0xb70fb88c] file_get_contents() &#x2F;usr&#x2F;local&#x2F;lnmp&#x2F;nginx&#x2F;html&#x2F;<a href=\"http://www.quancha.cn/www/fyzb.php:2\">www.quancha.cn/www/fyzb.php:2</a><br>通过日志，我们就可以知道第2行的file_get_contents 函数有点问题，这样我们就能追踪问题了。</p>\n</li>\n</ul>\n<p>转载：<a href=\"https://blog.csdn.net/ahaotata/article/details/83825977\">https://blog.csdn.net/ahaotata/article/details/83825977</a></p>\n"},{"_content":"#### 二维数组分组\n```php\n$defaultrules = array(\n'id'=>1,'studioid'=>5,\n'id'=>2,'studioid'=>5,\n'id'=>3,'studioid'=>2,\n'id'=>4,'studioid'=>3\n);\n\n$rule = [];//rule 拆分数组\nforeach($defaultrules as $de){\n    if(isset($rule[$de['studioid']])){\n        array_push($rule[$de['studioid']],$de['id']);\n    }else{\n        $rule[$de['studioid']] = array($de['id']);\n    }\n}\n$rule = array(\n5=>array(1,2),\n2=>array(3),\n3=>array(4)\n);\n```","source":"_posts/PHP/二维数组分组.md","raw":"---\ncategories:\n  - PHP\n---\n#### 二维数组分组\n```php\n$defaultrules = array(\n'id'=>1,'studioid'=>5,\n'id'=>2,'studioid'=>5,\n'id'=>3,'studioid'=>2,\n'id'=>4,'studioid'=>3\n);\n\n$rule = [];//rule 拆分数组\nforeach($defaultrules as $de){\n    if(isset($rule[$de['studioid']])){\n        array_push($rule[$de['studioid']],$de['id']);\n    }else{\n        $rule[$de['studioid']] = array($de['id']);\n    }\n}\n$rule = array(\n5=>array(1,2),\n2=>array(3),\n3=>array(4)\n);\n```","slug":"二维数组分组","published":1,"category":"PHP","date":"2023-06-08T23:03:56.099Z","updated":"2023-06-08T23:12:13.673Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5see0018dxjc21ka8slk","content":"<h4 id=\"二维数组分组\"><a href=\"#二维数组分组\" class=\"headerlink\" title=\"二维数组分组\"></a>二维数组分组</h4><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$defaultrules</span> = <span class=\"keyword\">array</span>(</span><br><span class=\"line\"><span class=\"string\">&#x27;id&#x27;</span>=&gt;<span class=\"number\">1</span>,<span class=\"string\">&#x27;studioid&#x27;</span>=&gt;<span class=\"number\">5</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;id&#x27;</span>=&gt;<span class=\"number\">2</span>,<span class=\"string\">&#x27;studioid&#x27;</span>=&gt;<span class=\"number\">5</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;id&#x27;</span>=&gt;<span class=\"number\">3</span>,<span class=\"string\">&#x27;studioid&#x27;</span>=&gt;<span class=\"number\">2</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;id&#x27;</span>=&gt;<span class=\"number\">4</span>,<span class=\"string\">&#x27;studioid&#x27;</span>=&gt;<span class=\"number\">3</span></span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$rule</span> = [];<span class=\"comment\">//rule 拆分数组</span></span><br><span class=\"line\"><span class=\"keyword\">foreach</span>(<span class=\"variable\">$defaultrules</span> <span class=\"keyword\">as</span> <span class=\"variable\">$de</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>(<span class=\"variable\">$rule</span>[<span class=\"variable\">$de</span>[<span class=\"string\">&#x27;studioid&#x27;</span>]]))&#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$rule</span>[<span class=\"variable\">$de</span>[<span class=\"string\">&#x27;studioid&#x27;</span>]],<span class=\"variable\">$de</span>[<span class=\"string\">&#x27;id&#x27;</span>]);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$rule</span>[<span class=\"variable\">$de</span>[<span class=\"string\">&#x27;studioid&#x27;</span>]] = <span class=\"keyword\">array</span>(<span class=\"variable\">$de</span>[<span class=\"string\">&#x27;id&#x27;</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"variable\">$rule</span> = <span class=\"keyword\">array</span>(</span><br><span class=\"line\"><span class=\"number\">5</span>=&gt;<span class=\"keyword\">array</span>(<span class=\"number\">1</span>,<span class=\"number\">2</span>),</span><br><span class=\"line\"><span class=\"number\">2</span>=&gt;<span class=\"keyword\">array</span>(<span class=\"number\">3</span>),</span><br><span class=\"line\"><span class=\"number\">3</span>=&gt;<span class=\"keyword\">array</span>(<span class=\"number\">4</span>)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>","site":{"data":{}},"length":564,"excerpt":"","more":"<h4 id=\"二维数组分组\"><a href=\"#二维数组分组\" class=\"headerlink\" title=\"二维数组分组\"></a>二维数组分组</h4><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$defaultrules</span> = <span class=\"keyword\">array</span>(</span><br><span class=\"line\"><span class=\"string\">&#x27;id&#x27;</span>=&gt;<span class=\"number\">1</span>,<span class=\"string\">&#x27;studioid&#x27;</span>=&gt;<span class=\"number\">5</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;id&#x27;</span>=&gt;<span class=\"number\">2</span>,<span class=\"string\">&#x27;studioid&#x27;</span>=&gt;<span class=\"number\">5</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;id&#x27;</span>=&gt;<span class=\"number\">3</span>,<span class=\"string\">&#x27;studioid&#x27;</span>=&gt;<span class=\"number\">2</span>,</span><br><span class=\"line\"><span class=\"string\">&#x27;id&#x27;</span>=&gt;<span class=\"number\">4</span>,<span class=\"string\">&#x27;studioid&#x27;</span>=&gt;<span class=\"number\">3</span></span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$rule</span> = [];<span class=\"comment\">//rule 拆分数组</span></span><br><span class=\"line\"><span class=\"keyword\">foreach</span>(<span class=\"variable\">$defaultrules</span> <span class=\"keyword\">as</span> <span class=\"variable\">$de</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>(<span class=\"variable\">$rule</span>[<span class=\"variable\">$de</span>[<span class=\"string\">&#x27;studioid&#x27;</span>]]))&#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$rule</span>[<span class=\"variable\">$de</span>[<span class=\"string\">&#x27;studioid&#x27;</span>]],<span class=\"variable\">$de</span>[<span class=\"string\">&#x27;id&#x27;</span>]);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$rule</span>[<span class=\"variable\">$de</span>[<span class=\"string\">&#x27;studioid&#x27;</span>]] = <span class=\"keyword\">array</span>(<span class=\"variable\">$de</span>[<span class=\"string\">&#x27;id&#x27;</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"variable\">$rule</span> = <span class=\"keyword\">array</span>(</span><br><span class=\"line\"><span class=\"number\">5</span>=&gt;<span class=\"keyword\">array</span>(<span class=\"number\">1</span>,<span class=\"number\">2</span>),</span><br><span class=\"line\"><span class=\"number\">2</span>=&gt;<span class=\"keyword\">array</span>(<span class=\"number\">3</span>),</span><br><span class=\"line\"><span class=\"number\">3</span>=&gt;<span class=\"keyword\">array</span>(<span class=\"number\">4</span>)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>"},{"_content":"### a=none 后面为none解析不出来\n\nsample.ini\n\n```ini\n\n##\n\n[s1]\n\na=1\n\nb=1\n\nc=1\n\n#d=1\n\ne=fa#1\n\nh = kda dawda\n\nddaw=\n\ndwada\n\ndwaihduihawu=dwadwa #dwa\n\n[s2]\n\nf=1\n\n```\n\n```php\n\n//would see the version，php5.3 和大于php5.3  \n\n$ini_array = parse_ini_file(\"sample.ini\",true);   \n\n//parse_ini_file解析出来的数组不一致，使用以下方法可解决  \n\n$ini_array = parseconfig($ini_array);\n\nprint_r($ini_array);\n\nfunction parseconfig($arr){\n\n// print_r($arr);\n\nif(count($arr)>0){\n\n\tforeach ($arr as $k => $v) {\n\n\t\tif(is_array($v)){\n\n\t\t\t$arr[$k] = parseconfig($v);\n\n\t\t}else{\n\n\t\t\t$pos = stripos($v,\" #\");\n\n\t\t\tif($pos!==false){\n\n\t\t\t\t$arr[$k] = substr($v, 0,$pos);\n\n\t\t\t}\n\n\t\t\tif(substr(trim($k),0,1)=='#'){\n\n\t\t\t\tunset($arr[$k]);\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n}\n\nreturn $arr;\n\n}\n\n```\n\n","source":"_posts/PHP/解析ini文件.md","raw":"---\ncategories:\n  - PHP\n---\n### a=none 后面为none解析不出来\n\nsample.ini\n\n```ini\n\n##\n\n[s1]\n\na=1\n\nb=1\n\nc=1\n\n#d=1\n\ne=fa#1\n\nh = kda dawda\n\nddaw=\n\ndwada\n\ndwaihduihawu=dwadwa #dwa\n\n[s2]\n\nf=1\n\n```\n\n```php\n\n//would see the version，php5.3 和大于php5.3  \n\n$ini_array = parse_ini_file(\"sample.ini\",true);   \n\n//parse_ini_file解析出来的数组不一致，使用以下方法可解决  \n\n$ini_array = parseconfig($ini_array);\n\nprint_r($ini_array);\n\nfunction parseconfig($arr){\n\n// print_r($arr);\n\nif(count($arr)>0){\n\n\tforeach ($arr as $k => $v) {\n\n\t\tif(is_array($v)){\n\n\t\t\t$arr[$k] = parseconfig($v);\n\n\t\t}else{\n\n\t\t\t$pos = stripos($v,\" #\");\n\n\t\t\tif($pos!==false){\n\n\t\t\t\t$arr[$k] = substr($v, 0,$pos);\n\n\t\t\t}\n\n\t\t\tif(substr(trim($k),0,1)=='#'){\n\n\t\t\t\tunset($arr[$k]);\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n}\n\nreturn $arr;\n\n}\n\n```\n\n","slug":"解析ini文件","published":1,"category":"PHP","date":"2023-06-08T23:03:56.097Z","updated":"2023-06-08T23:12:13.672Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5sef001adxjc5ekkgfxk","content":"<h3 id=\"a-x3D-none-后面为none解析不出来\"><a href=\"#a-x3D-none-后面为none解析不出来\" class=\"headerlink\" title=\"a&#x3D;none 后面为none解析不出来\"></a>a&#x3D;none 后面为none解析不出来</h3><p>sample.ini</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">[s1]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">a</span>=<span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">b</span>=<span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">c</span>=<span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#d=1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">e</span>=fa<span class=\"comment\">#1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">h</span> = kda dawda</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">ddaw</span>=</span><br><span class=\"line\"></span><br><span class=\"line\">dwada</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">dwaihduihawu</span>=dwadwa <span class=\"comment\">#dwa</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">[s2]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">f</span>=<span class=\"number\">1</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//would see the version，php5.3 和大于php5.3  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$ini_array</span> = <span class=\"title function_ invoke__\">parse_ini_file</span>(<span class=\"string\">&quot;sample.ini&quot;</span>,<span class=\"literal\">true</span>);   </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//parse_ini_file解析出来的数组不一致，使用以下方法可解决  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$ini_array</span> = <span class=\"title function_ invoke__\">parseconfig</span>(<span class=\"variable\">$ini_array</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_ invoke__\">print_r</span>(<span class=\"variable\">$ini_array</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parseconfig</span>(<span class=\"params\"><span class=\"variable\">$arr</span></span>)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// print_r($arr);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$arr</span>)&gt;<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">foreach</span> (<span class=\"variable\">$arr</span> <span class=\"keyword\">as</span> <span class=\"variable\">$k</span> =&gt; <span class=\"variable\">$v</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">is_array</span>(<span class=\"variable\">$v</span>))&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"variable\">$arr</span>[<span class=\"variable\">$k</span>] = <span class=\"title function_ invoke__\">parseconfig</span>(<span class=\"variable\">$v</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"variable\">$pos</span> = <span class=\"title function_ invoke__\">stripos</span>(<span class=\"variable\">$v</span>,<span class=\"string\">&quot; #&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(<span class=\"variable\">$pos</span>!==<span class=\"literal\">false</span>)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"variable\">$arr</span>[<span class=\"variable\">$k</span>] = <span class=\"title function_ invoke__\">substr</span>(<span class=\"variable\">$v</span>, <span class=\"number\">0</span>,<span class=\"variable\">$pos</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">substr</span>(<span class=\"title function_ invoke__\">trim</span>(<span class=\"variable\">$k</span>),<span class=\"number\">0</span>,<span class=\"number\">1</span>)==<span class=\"string\">&#x27;#&#x27;</span>)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">unset</span>(<span class=\"variable\">$arr</span>[<span class=\"variable\">$k</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">return</span> <span class=\"variable\">$arr</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"length":778,"excerpt":"","more":"<h3 id=\"a-x3D-none-后面为none解析不出来\"><a href=\"#a-x3D-none-后面为none解析不出来\" class=\"headerlink\" title=\"a&#x3D;none 后面为none解析不出来\"></a>a&#x3D;none 后面为none解析不出来</h3><p>sample.ini</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">[s1]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">a</span>=<span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">b</span>=<span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">c</span>=<span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#d=1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">e</span>=fa<span class=\"comment\">#1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">h</span> = kda dawda</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">ddaw</span>=</span><br><span class=\"line\"></span><br><span class=\"line\">dwada</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">dwaihduihawu</span>=dwadwa <span class=\"comment\">#dwa</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">[s2]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">f</span>=<span class=\"number\">1</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//would see the version，php5.3 和大于php5.3  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$ini_array</span> = <span class=\"title function_ invoke__\">parse_ini_file</span>(<span class=\"string\">&quot;sample.ini&quot;</span>,<span class=\"literal\">true</span>);   </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//parse_ini_file解析出来的数组不一致，使用以下方法可解决  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$ini_array</span> = <span class=\"title function_ invoke__\">parseconfig</span>(<span class=\"variable\">$ini_array</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_ invoke__\">print_r</span>(<span class=\"variable\">$ini_array</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parseconfig</span>(<span class=\"params\"><span class=\"variable\">$arr</span></span>)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// print_r($arr);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$arr</span>)&gt;<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">foreach</span> (<span class=\"variable\">$arr</span> <span class=\"keyword\">as</span> <span class=\"variable\">$k</span> =&gt; <span class=\"variable\">$v</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">is_array</span>(<span class=\"variable\">$v</span>))&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"variable\">$arr</span>[<span class=\"variable\">$k</span>] = <span class=\"title function_ invoke__\">parseconfig</span>(<span class=\"variable\">$v</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"variable\">$pos</span> = <span class=\"title function_ invoke__\">stripos</span>(<span class=\"variable\">$v</span>,<span class=\"string\">&quot; #&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(<span class=\"variable\">$pos</span>!==<span class=\"literal\">false</span>)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"variable\">$arr</span>[<span class=\"variable\">$k</span>] = <span class=\"title function_ invoke__\">substr</span>(<span class=\"variable\">$v</span>, <span class=\"number\">0</span>,<span class=\"variable\">$pos</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">substr</span>(<span class=\"title function_ invoke__\">trim</span>(<span class=\"variable\">$k</span>),<span class=\"number\">0</span>,<span class=\"number\">1</span>)==<span class=\"string\">&#x27;#&#x27;</span>)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">unset</span>(<span class=\"variable\">$arr</span>[<span class=\"variable\">$k</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">return</span> <span class=\"variable\">$arr</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n"},{"_content":"- 这段时间一直在修自己写的bug，php部分分享之前对工资模块的理解，这里涉及到会有很多变量组成工资表达式，修改了一部分表达式的结构，变成公用的。\n\n```php\n<?php\n/**\n * Math::Rpn\n *\n * 作用:\n *     计算中缀表达式的值\n *     将表达式转换为逆波兰式，计算逆波兰式的值\n *     Change Expression To RPN (Reverse Polish Notation), Evaluate RPN Expression\n *\n * 示例:\n *    1、计算中缀表达式的值\n       $infix_expression = \"(255.3*2)+33.2\";\n       $rpn = new Math_Rpn();\n *     echo $rpn->calculate($infix_expression,false);\n *     //若表达式中包含角的计算，若需要定义角的单位（弧度:rad,度:deg.默认的角度为rad,即弧度)\n *     $expression = \"(2^3)+sin(30)-(!4)+(3/4)\";\n *     echo $rpn->calculate($expression,false,'deg');\n *\n *\n * @author   Maciej Szczytowski <admin@e-rower.pl>  kelite 修改 2013-2-23\n * @version  1.1.1\n * @package  math\n * @access   public\n */\n\nclass Math_Rpn\n{\n    /**\n     * Input expression\n     *\n     * @var    string\n     * @access private\n     */\n    public $_input = '';\n\n    /**\n     * Array with input expression\n     *\n     * @var    array\n     * @access private\n     */\n    public $_input_array = array();\n\n    /**\n     * Array with output expression in RPN\n     *\n     * @var    array\n     * @access private\n     */\n    public $_output = array();\n\n    /**\n     * Temporary stack\n     *\n     * @var    array\n     * @access private\n     */\n    public $_stack = array();\n\n    /**\n     * Value of expression\n     *\n     * @var    float\n     * @access private\n     */\n    public $_value = 0.0;\n\n    /**\n     * Angle's unit: rad - true, deg - false\n     *\n     * @var    boolean\n     * @access private\n     */\n    public $_angle = true;\n\n    /**\n     * PEAR Error\n     *\n     * @var    object PEAR\n     * @access private\n     */\n    public $_error = null;\n\n    /**\n     * Timer\n     *\n     * @var    float\n     * @access private\n     */\n    public $_timer = 0.0;\n\n    /**\n     * Array of operators whit priority and math function\n     * operator => (name, priority, number of arguments, function)\n     *\n     * @var    array\n     * @access private\n     */\n    public $_operation = array (\n        '('    => array ('left bracket', 0),\n        ')'    => array ('right bracket', 1),\n        '+'    => array ('sum', 1, 2, '_sum'),\n        '-'    => array ('difference', 1, 2, '_difference'),\n        '*'    => array ('multiplication', 2, 2, '_multiplication'),\n        '/'    => array ('division', 2, 2, '_division'),\n        'r'    => array ('root', 3, 2, '_root'),\n        '^'    => array ('power', 3, 2, '_power'),\n        'sin'  => array ('sine', 3, 1, '_sin'),\n        'cos'  => array ('cosine', 3, 1, '_cos'),\n        'tan'  => array ('tangent', 3, 1, '_tan'),\n        'asin' => array ('asine', 3, 1, '_asin'),\n        'acos' => array ('acosine', 3, 1, '_acos'),\n        'atan' => array ('atangent', 3, 1, '_atan'),\n        'sqrt' => array ('square root', 3, 1, '_sqrt'),\n        'exp'    => array ('power of e', 3, 1, '_exp'),\n        'log'  => array ('logarithm', 3, 1, '_log'),\n        'ln'   => array ('natural logarithm', 3, 1, '_ln'),\n        'E'  => array ('power of 10', 3, 1, '_E'),\n        'abs'  => array ('absolute value', 3, 1, '_abs'),\n        '!'    => array ('factorial', 3, 1, '_factorial'),\n        'pi'   => array ('value of pi', 4, 0, '_const_pi'),\n        'e'    => array ('value of e', 4, 0, '_const_e'),\n        'mod'    => array ('modulo', 3, 2, '_mod'),\n        'div'    => array ('integer division', 3, 2, '_div'),\n    );\n\n    /**\n     * Return a PEAR error\n     *\n     * @return object PEAR error\n     * @access private\n     */\n    function _raiseError ($error) {\n       // return PEAR::raiseError($error);\n       return ($error);\n    }\n\n    /**\n     * Return a operator's array\n     *\n     * @return array Array with operator's name, priority, arguments, function's name and syntax\n     * @access public\n     */\n    function getOperators () {\n        $return = array();\n        while(list($key, $val) = each($this->_operation)) {\n\n            if (array_key_exists (2, $val) && $val[2] == 2) {\n                $syntax = 'A ' . $key . ' B';\n                $arguments = 2;\n            } elseif (array_key_exists (2, $val) && $val[2] == 1) {\n                $syntax = $key . ' A';\n                $arguments = 1;\n            } else {\n                $syntax = $key;\n                $arguments = 0;\n            }\n\n            if(array_key_exists (3, $val)) $function = $val[3]; else $function = '';\n\n            $return[] = array (\n                'operator' => $key,\n                'name' => $val[0],\n                'priority' => $val[1],\n                'arguments' => $arguments,\n                'function' => $function,\n                'syntax' => $syntax\n            );\n        }\n\n        return $return;\n    }\n\n    /**\n     * Add new operator\n     *\n     * @param string $operator New operator\n     * @param string $function Function name\n     * @param integer $priority New operator's priority\n     * @param integer $no_of_arg Number of function's arguments\n     * @param string $text New operator's description\n     * @access public\n     */\n    function addOperator ($operator, $function_name, $priority = 3, $no_of_arg = 0, $text = '') {\n        if(preg_match(\"/^([\\W\\w]+)\\:\\:([\\W\\w]+)$/\",$function_name,$match)) {\n            $class = $match[1];\n            $method = $match[2];\n            $function = array (\n               'type' => 'userMethod',\n               'class' => $class,\n               'method' => $method\n            );\n        } else {\n            $function = array (\n               'type' => 'userFunction',\n               'function' => $function_name\n            );\n        }\n\n        $this->_operation[$operator] = array ($text, $priority, $no_of_arg, $function);\n    }\n\n    /**\n     * Calculate the $input expression\n     *\n     * @param mixed $input Infix expression string or RPN expression string 中缀表达式或逆波兰式\n     * @param string $angle Angle's unit - 'rad' or 'deg'  角的单位 rad表弧度，deg表示度\n     * @param boolean $is_rpn True if $input is RPN expression or false if $input is infix expression   \n     * @return mixed Value of $input expression or a PEAR error\n     * @access public\n     */\n    function calculate($input = '',$is_rpn = true,$angle = 'rad') {\n\n        $this->_angle = (boolean) ($angle == 'rad');\n\n        if($input == '') {\n            $this->_error = $this->_raiseError('Empty input expression');\n            return $this->_error;\n        }\n\n        if(!$is_rpn) {\n            $this->_input = $input;\n\n            $this->_stringToArray ();\n            if($this->_error <> null) return $this->_error;\n\n            $this->_arrayToRpn();\n            if($this->_error <> null) return $this->_error;\n        } else {\n            if (is_array($input)) {\n                $input = implode(' ', $input);\n            }\n\n            $this->_input = $input;\n            $this->_input_array = explode(' ',$input);\n            $this->_output = explode(' ',$input);\n        }\n\n        $this->_rpnToValue();\n        if($this->_error <> null) return $this->_error;\n\n        return $this->_value;\n    }\n\n    /**\n     * Calculate the $input expression (alias of calculate())\n     * @author  kelite 修改参数顺序\n     * @param mixed $input Infix expression string or RPN expression array\n     * @param string $angle Angle's unit - 'rad' or 'deg'\n     * @param boolean $is_rpn True if $input is RPN expression or false if $input is infix expression\n     * @return mixed Value of $input expression or a PEAR error\n     * @access public\n     */\n    function evaluate($input = '', $angle = 'rad', $is_rpn = false) {\n        //原顺序return $this-> calculate($input,$angle,$is_rpn);\n        return $this-> calculate($input,$is_rpn,$angle);\n    }\n\n    /**\n     * Return a input array\n     *\n     * @return array Input array\n     * @access public\n     */\n    function getInputArray() {\n        return $this->_input_array;\n    }\n\n    /**\n     * Return a RPN array\n     *\n     * @return array RPN array\n     * @access public\n     */\n    function getRpnArray() {\n        return $this->_output;\n    }\n\n    /**\n     * Return a counting time in second\n     *\n     * @return float Counting time in seconds\n     * @access public\n     */\n    function getTimer() {\n        return $this->_timer;\n    }\n\n    /**\n     * Check that $key is a key of $array (conformity to php<4.1.0)\n     *\n     * @param string $key\n     * @param array $array\n     * @param integer $type 0 - return true if $key is $array's key, 1 - return true if $key is $array's key and there isn't any occurrence of $key in another $array's key\n     * @return boolean true when $key is a key of $array, or false\n     * @access private\n     */\n\n    function _keyExists($key,$array,$type) {\n        $keys = array_keys($array);\n\n        if($type == 1) {\n            $count = 0;\n            while (list($keys_key, $keys_val) = each($keys)) {\n                if(is_integer(strpos($keys_val, $key)) && (strpos($keys_val, $key)==0)) $count++;\n            }\n            if(($count==1) && in_array($key,$keys)) return true;\n            else return false;\n        } else {\n            if(in_array($key,$keys)) return true;\n            else return false;\n        }\n    }\n\n    /**\n     * Check that $value is nan (conformity to php<4.2.0)\n     *\n     * @param float $value checking value\n     * @return boolean true when $value is nan, or false\n     * @access private\n     */\n    function _isNan($value) {\n        if(function_exists('is_nan')) {\n            return is_nan($value);\n        } else {\n            if((substr($value,-3) == 'IND') || (substr($value,-3) == 'NAN')) return true;\n            else return false;\n        }\n    }\n\n    /**\n     * Check that $value is infinite (conformity to php<4.2.0)\n     *\n     * @param float $value checking value\n     * @return boolean true when $value is infinite, or false\n     * @access private\n     */\n    function _isInfinite($value) {\n        if(function_exists('is_finite')) {\n            return !is_finite($value);\n        } else {\n            if(substr($value,-3) == 'INF') return true;\n            else return false;\n        }\n    }\n\n    /**\n     * Change input expression into array\n     *\n     * @return array Input expression changed into array\n     * @access private\n     */\n    function _stringToArray () {\n        $temp_operator = null;\n        $temp_value = null;\n\n        $this->_input = str_replace(\" \",\"\",$this->_input);\n\n\n        for($i = 0; $i < strlen($this->_input); $i++) {\n//             var_dump($this->_input[$i]);\n//            var_dump('temp_operator:'.$temp_operator.',team_value:'.$temp_value.',input:'.$this->_input[$i]);\n            if ($this->_input[$i] == ' ') {\n                if ($temp_operator != null) {\n                    array_push($this->_input_array, $temp_operator);\n                    $temp_operator = null;\n                }\n                if ($temp_value != null) {\n                    array_push($this->_input_array, $temp_value);\n                    $temp_value = null;\n                }\n            } elseif (($temp_value == null) && $temp_operator != ')' && (!array_key_exists($temp_operator,$this->_operation) || !array_key_exists(2,$this->_operation[$temp_operator]) || $this->_operation[$temp_operator][2]>0) && ($this->_input[$i] == '-')) {\n                if ($temp_operator != null) {\n                    array_push($this->_input_array, $temp_operator);\n                    $temp_operator = null;\n                }\n\n                array_push($this->_input_array, '-1');\n                array_push($this->_input_array, '*');\n            } elseif ((is_numeric($this->_input[$i])) || ($this->_input[$i] == '.')) {\n//            } elseif ((is_numeric($this->_input[$i])) || ($this->_input[$i] == '.') || ($this->_input[$i] == 'A')) {\n                if ($temp_operator != null) {\n                    array_push($this->_input_array, $temp_operator);\n                    $temp_operator = null;\n                }\n\n                $temp_value .= $this->_input[$i];\n            } else {\n                if ($this->_keyExists($temp_operator, $this->_operation, 1)) {\n                    array_push($this->_input_array, $temp_operator);\n                    $temp_operator = null;\n                }\n\n                if ($temp_value != null) {\n                    array_push($this->_input_array, $temp_value);\n                    $temp_value = null;\n                }\n\n                $temp_operator .= $this->_input[$i];\n            }\n        }\n\n        if ($temp_operator != null && $temp_operator != ' ') {\n            array_push($this->_input_array, $temp_operator);\n        } elseif($temp_value != null && $temp_value != ' ') {\n            array_push($this->_input_array, $temp_value);\n        }\n        // $this->_testInput();\n//        print_r($this->_expression_value);\n//        print_r($this->_input_array);\n//        die();\n        return $this->_input_array;\n    }\n\n    function _splitENstr($str,$arr) {\n        preg_match_all('/([a-zA-Z_]+)/',$str,$match);\n        $mat = array_unique($match[1]);\n        foreach ($mat as $v) {\n            $str = str_replace($v,$arr[$v],$str);\n        }\n        return $str;\n    }\n\n    /**\n     * Check input array and return correct array or a PEAR Error\n     *\n     * @return object Null or a PEAR Error\n     * @access private\n     */\n    function _testInput() {\n        if (!count($this->_input_array)) {\n            $this->_input_array = null;\n            $this->_error = $this->_raiseError('Undefined input array');\n            return $this->_error;\n        }\n\n        $bracket = 0;\n        for($i = 0; $i < count($this->_input_array); $i++) if ($this->_input_array[$i] == '(') $bracket++;\n        for($i = 0; $i < count($this->_input_array); $i++) if ($this->_input_array[$i] == ')') $bracket--;\n\n        if ($bracket <> 0) {\n                $this->_input_array = null;\n                $this->_error = $this->_raiseError('Syntax error');\n                return $this->_error;\n        }\n\n        for($i = 0; $i < count($this->_input_array); $i++) {\n            if ((!is_numeric($this->_input_array[$i])) && (!$this->_keyExists($this->_input_array[$i], $this->_operation, 0))) {\n                $error_operator = $this->_input_array[$i];\n                $this->_input_array = null;\n                $this->_error = $this->_raiseError('Undefined operator \\''. $error_operator.'\\'');\n                return $this->_error;\n            }\n        }\n\n        $this->_error = null;\n        return $this->_error;\n    }\n\n    /**\n     * Add value to the end of stack\n     *\n     * @param string $value Value to add into stack\n     * @access private\n     */\n    function _stackAdd($value) {\n        array_push($this->_stack, $value);\n    }\n\n    /**\n     * Delete and return value from the end of stack\n     *\n     * @return string Value deleted from stack\n     * @access private\n     */\n    function _stackDelete() {\n        return array_pop($this->_stack);\n    }\n\n    /**\n     * Return priority of value\n     *\n     * @param string $value Value to get priority\n     * @return integer Priority\n     * @access private\n     */\n    function _priority($value) {\n        return $this->_operation[$value][1];\n    }\n    /**\n     * Return priority of value from the end of stack\n     *\n     * @return integer Priority of operator from stack's top\n     * @access private\n     */\n    function _stackPriority() {\n        $value = $this->_stackDelete();\n        $this->_stackAdd($value);\n        return $this->_priority($value);\n    }\n\n    /**\n     * Return true whene the stack is empty\n     *\n     * @return boolean Stack is empty (true) or not (false)\n     * @access private\n     */\n    function _stackEmpty() {\n        if (count($this->_stack)) {\n            return false;\n        }\n        else return true;\n    }\n\n    /**\n     * Add value into output array\n     *\n     * @param string $value Value to add into output array\n     * @access private\n     */\n    function _outputAdd($value) {\n        if ($value<>'(') {\n            array_push($this->_output, $value);\n        }\n    }\n\n    /**\n     * Change input array into RPN array\n     *\n     * @return array Array with RPN expression\n     * @access private\n     */\n    function _arrayToRpn() {\n\n        if ($this->_error <> null) {\n            $this->_output = array();\n            return $this->_output;\n        }\n        for($i = 0; $i < count($this->_input_array); $i++) {\n\n            $temp = $this->_input_array[$i];\n\n            if (is_numeric($temp)) {\n                $this->_outputAdd($temp);\n            }else {\n                if ($temp == ')') {\n                    while(!$this->_stackEmpty() && ($this->_stackPriority() >= 1)) {\n                        $this->_outputAdd($this->_stackDelete());\n                    }\n                    if (!$this->_stackEmpty()) {\n                        $this->_stackDelete();\n                    }\n\n                } elseif ($temp=='(') {\n                    $this->_stackAdd($temp);\n                } elseif (($this->_stackEmpty()) || (($this->_priority($temp) > $this->_stackPriority()))) {\n                   $this-> _stackAdd($temp);\n                } else {\n                    while(!$this->_stackEmpty() && ($this->_priority($temp) <= $this->_stackPriority())) {\n                        $this->_outputAdd($this->_stackDelete());\n                    }\n                    $this->_stackAdd($temp);\n                }\n\n            }\n\n        }\n\n        while(!$this->_stackEmpty()) {\n            $this->_outputAdd($this->_stackDelete());\n        }\n        return $this->_output;\n    }\n\n    /**\n     * Return position of the first operator in array\n     *\n     * @param array $array Temporary array\n     * @return integer Position of the first operator\n     * @access private\n     */\n    function _nextOperator($array) {\n        $pos = 0;\n        while(is_numeric($array[$pos])) {\n            $pos++;\n            if ($pos >= count($array)) {\n                return -1;\n            }\n        }\n        return $pos;\n\n    }\n\n    /**\n     * Delete from array operator [posision $pos] and its argument and insert new value\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of the last operator\n     * @param integer $arg Number of last operator's arguments\n     * @param float $result Last operation result\n     * @return array New temporary array\n     * @access private\n     */\n    function _refresh($temp, $pos, $arg, $result) {\n        $temp1 = array_slice($temp, 0, $pos-$arg);\n        $temp1[] = $result;\n        $temp2 = array_slice($temp, $pos+1);\n        return array_merge($temp1, $temp2);\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _sum($temp, $pos) {\n        return $temp[$pos-2]+$temp[$pos-1];\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _difference($temp, $pos) {\n        return $temp[$pos-2]-$temp[$pos-1];\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _multiplication($temp, $pos) {\n        return $temp[$pos-2]*$temp[$pos-1];\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _division($temp, $pos) {\n        if ($temp[$pos-1]==0) {\n            $this->_error = $this->_raiseError('Division by 0');\n            $this->_value = null;\n            return $this->_value;\n        }\n        return $temp[$pos-2]/$temp[$pos-1];\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _root($temp, $pos) {\n        return pow($temp[$pos-1], (1/$temp[$pos-2]));\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _power($temp, $pos) {\n        return pow($temp[$pos-2], $temp[$pos-1]);\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _sin($temp, $pos) {\n        if ($this->_angle) {\n            $angle = $temp[$pos-1];\n        } else {\n            $angle = deg2rad($temp[$pos-1]);\n        }\n        return sin($angle);\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _cos($temp, $pos) {\n        if ($this->_angle) {\n            $angle = $temp[$pos-1];\n        } else {\n            $angle = deg2rad($temp[$pos-1]);\n        }\n        return cos($angle);\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _tan($temp, $pos) {\n        if ($this->_angle) {\n            $angle = $temp[$pos-1];\n        } else {\n            $angle = deg2rad($temp[$pos-1]);\n        }\n        return tan($angle);\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _asin($temp, $pos) {\n        $angle = asin($temp[$pos-1]);\n        if (!$this->_angle) {\n            $angle = rad2deg($angle);\n        }\n        return $angle;\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _acos($temp, $pos) {\n        $angle = acos($temp[$pos-1]);\n        if (!$this->_angle) {\n            $angle = rad2deg($angle);\n        }\n        return $angle;\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _atan($temp, $pos) {\n        $angle = atan($temp[$pos-1]);\n        if (!$this->_angle) {\n            $angle = rad2deg($angle);\n        }\n        return $angle;\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _sqrt($temp, $pos) {\n        return sqrt($temp[$pos-1]);\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _exp($temp, $pos) {\n        return exp($temp[$pos-1]);\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _log($temp, $pos) {\n        return log10($temp[$pos-1]);\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _ln($temp, $pos) {\n        return log($temp[$pos-1]);\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _const_pi($temp, $pos) {\n        return M_PI;\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _const_e($temp, $pos) {\n        return M_E;\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _E($temp, $pos) {\n        return pow(10, $temp[$pos-1]);\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _factorial($temp, $pos) {\n        $factorial = 1;\n        for($i=1;$i<=$temp[$pos-1];$i++) {\n            $factorial *= $i;\n        }\n        return $factorial;\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _abs($temp, $pos) {\n        return abs($temp[$pos-1]);\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _mod($temp, $pos) {\n        return $temp[$pos-2]%$temp[$pos-1];\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _div($temp, $pos) {\n        return floor($temp[$pos-2]/$temp[$pos-1]);\n    }\n\n    /**\n     * Calculate RPN Expression and return value\n     *\n     * @return float Result of input expression\n     * @access private\n     */\n    function _rpnToValue() {\n\n        $time1 = $this->_getMicroTime();\n\n        if ($this->_error <> null) {\n            $this->_value = null;\n            return $this->_value;\n        }\n\n        $this->_value = 0;\n        $temp = $this->_output;\n\n        do {\n            $pos = $this->_nextOperator($temp);\n\n            if ($pos == -1) {\n                $this->_error = $this->_raiseError('Syntax error');\n                $this->_value = null;\n                return $this->_value;\n            }\n\n            $operator = $this->_operation[$temp[$pos]];\n            $arg = $operator[2];\n            $function = $operator[3];\n\n            if (($arg==2) && (!isset($temp[$pos-1]) || !is_numeric($temp[$pos-1]) || !isset($temp[$pos-2]) || !is_numeric($temp[$pos-2]))) {\n                $this->_error = $this->_raiseError('Syntax error');\n                $this->_value = null;\n                return $this->_value;\n            } elseif (($arg==1) && (!isset($temp[$pos-1]) || !is_numeric($temp[$pos-1]))) {\n                $this->_error = $this->_raiseError('Syntax error');\n                $this->_value = null;\n                return $this->_value;\n            }\n\n            if(is_array($function)) {\n\n                if($arg==2) $arg_array = array($temp[$pos-2],$temp[$pos-1]);\n                elseif($arg==1) $arg_array = array($temp[$pos-1]);\n                else $arg_array = array();\n\n                if($function['type'] == 'userFunction') {\n                    $this->_value = call_user_func_array($function['function'], $arg_array);\n                } else {\n                    $function_array = array(&$function['class'], $function['method']);\n                    $this->_value = call_user_func_array($function_array, $arg_array);\n                }\n            } else {\n                $this->_value = $this->$function($temp, $pos);\n            }\n\n            if ($this->_isNan($this->_value)) {\n                $this->_error = $this->_raiseError('NAN value');\n                $this->_value = null;\n                return $this->_value;\n            } elseif ($this->_isInfinite($this->_value)) {\n                $this->_error = $this->_raiseError('Infinite value');\n                $this->_value = null;\n                return $this->_value;\n            } elseif (is_null($this->_value)) {\n                return $this->_value;\n            }\n\n            $temp = $this->_refresh($temp, $pos, $arg, $this->_value);\n        } while(count($temp) > 1);\n\n        $this->_value = $temp[0];\n\n        $time2 = $this->_getMicroTime();\n\n        $this->_timer = $time2 - $time1;\n\n        return $this->_value;\n    }\n\n    /**\n     * Return a time in second\n     *\n     * @return float Current time in seconds\n     * @access private\n     */\n    function _getMicroTime() {\n        list($usec, $sec) = explode(\" \", microtime());\n        return ((float)$usec + (float)$sec);\n    }\n\n}\nfield 不能含有数字加减乘除\n$rpn = new Math_Rpn();\n$infix_expression = \"(actual_calls*call_standard)+33.2\";\n$expression_value = array(\n    \"actual_calls\"=>'20',\n    \"call_standard\"=>'2',\n    \"amount\"=>'100',\n    \"actual_contacts\"=>'100',\n    \"contacts_standard\"=>'100'\n);\n$expression = $rpn->_splitENstr($infix_expression,$expression_value);\necho $rpn->calculate($expression,false);\n?>\n```\n","source":"_posts/PHP/逆波兰式计算工资.md","raw":"---\ncategories:\n  - PHP\n---\n- 这段时间一直在修自己写的bug，php部分分享之前对工资模块的理解，这里涉及到会有很多变量组成工资表达式，修改了一部分表达式的结构，变成公用的。\n\n```php\n<?php\n/**\n * Math::Rpn\n *\n * 作用:\n *     计算中缀表达式的值\n *     将表达式转换为逆波兰式，计算逆波兰式的值\n *     Change Expression To RPN (Reverse Polish Notation), Evaluate RPN Expression\n *\n * 示例:\n *    1、计算中缀表达式的值\n       $infix_expression = \"(255.3*2)+33.2\";\n       $rpn = new Math_Rpn();\n *     echo $rpn->calculate($infix_expression,false);\n *     //若表达式中包含角的计算，若需要定义角的单位（弧度:rad,度:deg.默认的角度为rad,即弧度)\n *     $expression = \"(2^3)+sin(30)-(!4)+(3/4)\";\n *     echo $rpn->calculate($expression,false,'deg');\n *\n *\n * @author   Maciej Szczytowski <admin@e-rower.pl>  kelite 修改 2013-2-23\n * @version  1.1.1\n * @package  math\n * @access   public\n */\n\nclass Math_Rpn\n{\n    /**\n     * Input expression\n     *\n     * @var    string\n     * @access private\n     */\n    public $_input = '';\n\n    /**\n     * Array with input expression\n     *\n     * @var    array\n     * @access private\n     */\n    public $_input_array = array();\n\n    /**\n     * Array with output expression in RPN\n     *\n     * @var    array\n     * @access private\n     */\n    public $_output = array();\n\n    /**\n     * Temporary stack\n     *\n     * @var    array\n     * @access private\n     */\n    public $_stack = array();\n\n    /**\n     * Value of expression\n     *\n     * @var    float\n     * @access private\n     */\n    public $_value = 0.0;\n\n    /**\n     * Angle's unit: rad - true, deg - false\n     *\n     * @var    boolean\n     * @access private\n     */\n    public $_angle = true;\n\n    /**\n     * PEAR Error\n     *\n     * @var    object PEAR\n     * @access private\n     */\n    public $_error = null;\n\n    /**\n     * Timer\n     *\n     * @var    float\n     * @access private\n     */\n    public $_timer = 0.0;\n\n    /**\n     * Array of operators whit priority and math function\n     * operator => (name, priority, number of arguments, function)\n     *\n     * @var    array\n     * @access private\n     */\n    public $_operation = array (\n        '('    => array ('left bracket', 0),\n        ')'    => array ('right bracket', 1),\n        '+'    => array ('sum', 1, 2, '_sum'),\n        '-'    => array ('difference', 1, 2, '_difference'),\n        '*'    => array ('multiplication', 2, 2, '_multiplication'),\n        '/'    => array ('division', 2, 2, '_division'),\n        'r'    => array ('root', 3, 2, '_root'),\n        '^'    => array ('power', 3, 2, '_power'),\n        'sin'  => array ('sine', 3, 1, '_sin'),\n        'cos'  => array ('cosine', 3, 1, '_cos'),\n        'tan'  => array ('tangent', 3, 1, '_tan'),\n        'asin' => array ('asine', 3, 1, '_asin'),\n        'acos' => array ('acosine', 3, 1, '_acos'),\n        'atan' => array ('atangent', 3, 1, '_atan'),\n        'sqrt' => array ('square root', 3, 1, '_sqrt'),\n        'exp'    => array ('power of e', 3, 1, '_exp'),\n        'log'  => array ('logarithm', 3, 1, '_log'),\n        'ln'   => array ('natural logarithm', 3, 1, '_ln'),\n        'E'  => array ('power of 10', 3, 1, '_E'),\n        'abs'  => array ('absolute value', 3, 1, '_abs'),\n        '!'    => array ('factorial', 3, 1, '_factorial'),\n        'pi'   => array ('value of pi', 4, 0, '_const_pi'),\n        'e'    => array ('value of e', 4, 0, '_const_e'),\n        'mod'    => array ('modulo', 3, 2, '_mod'),\n        'div'    => array ('integer division', 3, 2, '_div'),\n    );\n\n    /**\n     * Return a PEAR error\n     *\n     * @return object PEAR error\n     * @access private\n     */\n    function _raiseError ($error) {\n       // return PEAR::raiseError($error);\n       return ($error);\n    }\n\n    /**\n     * Return a operator's array\n     *\n     * @return array Array with operator's name, priority, arguments, function's name and syntax\n     * @access public\n     */\n    function getOperators () {\n        $return = array();\n        while(list($key, $val) = each($this->_operation)) {\n\n            if (array_key_exists (2, $val) && $val[2] == 2) {\n                $syntax = 'A ' . $key . ' B';\n                $arguments = 2;\n            } elseif (array_key_exists (2, $val) && $val[2] == 1) {\n                $syntax = $key . ' A';\n                $arguments = 1;\n            } else {\n                $syntax = $key;\n                $arguments = 0;\n            }\n\n            if(array_key_exists (3, $val)) $function = $val[3]; else $function = '';\n\n            $return[] = array (\n                'operator' => $key,\n                'name' => $val[0],\n                'priority' => $val[1],\n                'arguments' => $arguments,\n                'function' => $function,\n                'syntax' => $syntax\n            );\n        }\n\n        return $return;\n    }\n\n    /**\n     * Add new operator\n     *\n     * @param string $operator New operator\n     * @param string $function Function name\n     * @param integer $priority New operator's priority\n     * @param integer $no_of_arg Number of function's arguments\n     * @param string $text New operator's description\n     * @access public\n     */\n    function addOperator ($operator, $function_name, $priority = 3, $no_of_arg = 0, $text = '') {\n        if(preg_match(\"/^([\\W\\w]+)\\:\\:([\\W\\w]+)$/\",$function_name,$match)) {\n            $class = $match[1];\n            $method = $match[2];\n            $function = array (\n               'type' => 'userMethod',\n               'class' => $class,\n               'method' => $method\n            );\n        } else {\n            $function = array (\n               'type' => 'userFunction',\n               'function' => $function_name\n            );\n        }\n\n        $this->_operation[$operator] = array ($text, $priority, $no_of_arg, $function);\n    }\n\n    /**\n     * Calculate the $input expression\n     *\n     * @param mixed $input Infix expression string or RPN expression string 中缀表达式或逆波兰式\n     * @param string $angle Angle's unit - 'rad' or 'deg'  角的单位 rad表弧度，deg表示度\n     * @param boolean $is_rpn True if $input is RPN expression or false if $input is infix expression   \n     * @return mixed Value of $input expression or a PEAR error\n     * @access public\n     */\n    function calculate($input = '',$is_rpn = true,$angle = 'rad') {\n\n        $this->_angle = (boolean) ($angle == 'rad');\n\n        if($input == '') {\n            $this->_error = $this->_raiseError('Empty input expression');\n            return $this->_error;\n        }\n\n        if(!$is_rpn) {\n            $this->_input = $input;\n\n            $this->_stringToArray ();\n            if($this->_error <> null) return $this->_error;\n\n            $this->_arrayToRpn();\n            if($this->_error <> null) return $this->_error;\n        } else {\n            if (is_array($input)) {\n                $input = implode(' ', $input);\n            }\n\n            $this->_input = $input;\n            $this->_input_array = explode(' ',$input);\n            $this->_output = explode(' ',$input);\n        }\n\n        $this->_rpnToValue();\n        if($this->_error <> null) return $this->_error;\n\n        return $this->_value;\n    }\n\n    /**\n     * Calculate the $input expression (alias of calculate())\n     * @author  kelite 修改参数顺序\n     * @param mixed $input Infix expression string or RPN expression array\n     * @param string $angle Angle's unit - 'rad' or 'deg'\n     * @param boolean $is_rpn True if $input is RPN expression or false if $input is infix expression\n     * @return mixed Value of $input expression or a PEAR error\n     * @access public\n     */\n    function evaluate($input = '', $angle = 'rad', $is_rpn = false) {\n        //原顺序return $this-> calculate($input,$angle,$is_rpn);\n        return $this-> calculate($input,$is_rpn,$angle);\n    }\n\n    /**\n     * Return a input array\n     *\n     * @return array Input array\n     * @access public\n     */\n    function getInputArray() {\n        return $this->_input_array;\n    }\n\n    /**\n     * Return a RPN array\n     *\n     * @return array RPN array\n     * @access public\n     */\n    function getRpnArray() {\n        return $this->_output;\n    }\n\n    /**\n     * Return a counting time in second\n     *\n     * @return float Counting time in seconds\n     * @access public\n     */\n    function getTimer() {\n        return $this->_timer;\n    }\n\n    /**\n     * Check that $key is a key of $array (conformity to php<4.1.0)\n     *\n     * @param string $key\n     * @param array $array\n     * @param integer $type 0 - return true if $key is $array's key, 1 - return true if $key is $array's key and there isn't any occurrence of $key in another $array's key\n     * @return boolean true when $key is a key of $array, or false\n     * @access private\n     */\n\n    function _keyExists($key,$array,$type) {\n        $keys = array_keys($array);\n\n        if($type == 1) {\n            $count = 0;\n            while (list($keys_key, $keys_val) = each($keys)) {\n                if(is_integer(strpos($keys_val, $key)) && (strpos($keys_val, $key)==0)) $count++;\n            }\n            if(($count==1) && in_array($key,$keys)) return true;\n            else return false;\n        } else {\n            if(in_array($key,$keys)) return true;\n            else return false;\n        }\n    }\n\n    /**\n     * Check that $value is nan (conformity to php<4.2.0)\n     *\n     * @param float $value checking value\n     * @return boolean true when $value is nan, or false\n     * @access private\n     */\n    function _isNan($value) {\n        if(function_exists('is_nan')) {\n            return is_nan($value);\n        } else {\n            if((substr($value,-3) == 'IND') || (substr($value,-3) == 'NAN')) return true;\n            else return false;\n        }\n    }\n\n    /**\n     * Check that $value is infinite (conformity to php<4.2.0)\n     *\n     * @param float $value checking value\n     * @return boolean true when $value is infinite, or false\n     * @access private\n     */\n    function _isInfinite($value) {\n        if(function_exists('is_finite')) {\n            return !is_finite($value);\n        } else {\n            if(substr($value,-3) == 'INF') return true;\n            else return false;\n        }\n    }\n\n    /**\n     * Change input expression into array\n     *\n     * @return array Input expression changed into array\n     * @access private\n     */\n    function _stringToArray () {\n        $temp_operator = null;\n        $temp_value = null;\n\n        $this->_input = str_replace(\" \",\"\",$this->_input);\n\n\n        for($i = 0; $i < strlen($this->_input); $i++) {\n//             var_dump($this->_input[$i]);\n//            var_dump('temp_operator:'.$temp_operator.',team_value:'.$temp_value.',input:'.$this->_input[$i]);\n            if ($this->_input[$i] == ' ') {\n                if ($temp_operator != null) {\n                    array_push($this->_input_array, $temp_operator);\n                    $temp_operator = null;\n                }\n                if ($temp_value != null) {\n                    array_push($this->_input_array, $temp_value);\n                    $temp_value = null;\n                }\n            } elseif (($temp_value == null) && $temp_operator != ')' && (!array_key_exists($temp_operator,$this->_operation) || !array_key_exists(2,$this->_operation[$temp_operator]) || $this->_operation[$temp_operator][2]>0) && ($this->_input[$i] == '-')) {\n                if ($temp_operator != null) {\n                    array_push($this->_input_array, $temp_operator);\n                    $temp_operator = null;\n                }\n\n                array_push($this->_input_array, '-1');\n                array_push($this->_input_array, '*');\n            } elseif ((is_numeric($this->_input[$i])) || ($this->_input[$i] == '.')) {\n//            } elseif ((is_numeric($this->_input[$i])) || ($this->_input[$i] == '.') || ($this->_input[$i] == 'A')) {\n                if ($temp_operator != null) {\n                    array_push($this->_input_array, $temp_operator);\n                    $temp_operator = null;\n                }\n\n                $temp_value .= $this->_input[$i];\n            } else {\n                if ($this->_keyExists($temp_operator, $this->_operation, 1)) {\n                    array_push($this->_input_array, $temp_operator);\n                    $temp_operator = null;\n                }\n\n                if ($temp_value != null) {\n                    array_push($this->_input_array, $temp_value);\n                    $temp_value = null;\n                }\n\n                $temp_operator .= $this->_input[$i];\n            }\n        }\n\n        if ($temp_operator != null && $temp_operator != ' ') {\n            array_push($this->_input_array, $temp_operator);\n        } elseif($temp_value != null && $temp_value != ' ') {\n            array_push($this->_input_array, $temp_value);\n        }\n        // $this->_testInput();\n//        print_r($this->_expression_value);\n//        print_r($this->_input_array);\n//        die();\n        return $this->_input_array;\n    }\n\n    function _splitENstr($str,$arr) {\n        preg_match_all('/([a-zA-Z_]+)/',$str,$match);\n        $mat = array_unique($match[1]);\n        foreach ($mat as $v) {\n            $str = str_replace($v,$arr[$v],$str);\n        }\n        return $str;\n    }\n\n    /**\n     * Check input array and return correct array or a PEAR Error\n     *\n     * @return object Null or a PEAR Error\n     * @access private\n     */\n    function _testInput() {\n        if (!count($this->_input_array)) {\n            $this->_input_array = null;\n            $this->_error = $this->_raiseError('Undefined input array');\n            return $this->_error;\n        }\n\n        $bracket = 0;\n        for($i = 0; $i < count($this->_input_array); $i++) if ($this->_input_array[$i] == '(') $bracket++;\n        for($i = 0; $i < count($this->_input_array); $i++) if ($this->_input_array[$i] == ')') $bracket--;\n\n        if ($bracket <> 0) {\n                $this->_input_array = null;\n                $this->_error = $this->_raiseError('Syntax error');\n                return $this->_error;\n        }\n\n        for($i = 0; $i < count($this->_input_array); $i++) {\n            if ((!is_numeric($this->_input_array[$i])) && (!$this->_keyExists($this->_input_array[$i], $this->_operation, 0))) {\n                $error_operator = $this->_input_array[$i];\n                $this->_input_array = null;\n                $this->_error = $this->_raiseError('Undefined operator \\''. $error_operator.'\\'');\n                return $this->_error;\n            }\n        }\n\n        $this->_error = null;\n        return $this->_error;\n    }\n\n    /**\n     * Add value to the end of stack\n     *\n     * @param string $value Value to add into stack\n     * @access private\n     */\n    function _stackAdd($value) {\n        array_push($this->_stack, $value);\n    }\n\n    /**\n     * Delete and return value from the end of stack\n     *\n     * @return string Value deleted from stack\n     * @access private\n     */\n    function _stackDelete() {\n        return array_pop($this->_stack);\n    }\n\n    /**\n     * Return priority of value\n     *\n     * @param string $value Value to get priority\n     * @return integer Priority\n     * @access private\n     */\n    function _priority($value) {\n        return $this->_operation[$value][1];\n    }\n    /**\n     * Return priority of value from the end of stack\n     *\n     * @return integer Priority of operator from stack's top\n     * @access private\n     */\n    function _stackPriority() {\n        $value = $this->_stackDelete();\n        $this->_stackAdd($value);\n        return $this->_priority($value);\n    }\n\n    /**\n     * Return true whene the stack is empty\n     *\n     * @return boolean Stack is empty (true) or not (false)\n     * @access private\n     */\n    function _stackEmpty() {\n        if (count($this->_stack)) {\n            return false;\n        }\n        else return true;\n    }\n\n    /**\n     * Add value into output array\n     *\n     * @param string $value Value to add into output array\n     * @access private\n     */\n    function _outputAdd($value) {\n        if ($value<>'(') {\n            array_push($this->_output, $value);\n        }\n    }\n\n    /**\n     * Change input array into RPN array\n     *\n     * @return array Array with RPN expression\n     * @access private\n     */\n    function _arrayToRpn() {\n\n        if ($this->_error <> null) {\n            $this->_output = array();\n            return $this->_output;\n        }\n        for($i = 0; $i < count($this->_input_array); $i++) {\n\n            $temp = $this->_input_array[$i];\n\n            if (is_numeric($temp)) {\n                $this->_outputAdd($temp);\n            }else {\n                if ($temp == ')') {\n                    while(!$this->_stackEmpty() && ($this->_stackPriority() >= 1)) {\n                        $this->_outputAdd($this->_stackDelete());\n                    }\n                    if (!$this->_stackEmpty()) {\n                        $this->_stackDelete();\n                    }\n\n                } elseif ($temp=='(') {\n                    $this->_stackAdd($temp);\n                } elseif (($this->_stackEmpty()) || (($this->_priority($temp) > $this->_stackPriority()))) {\n                   $this-> _stackAdd($temp);\n                } else {\n                    while(!$this->_stackEmpty() && ($this->_priority($temp) <= $this->_stackPriority())) {\n                        $this->_outputAdd($this->_stackDelete());\n                    }\n                    $this->_stackAdd($temp);\n                }\n\n            }\n\n        }\n\n        while(!$this->_stackEmpty()) {\n            $this->_outputAdd($this->_stackDelete());\n        }\n        return $this->_output;\n    }\n\n    /**\n     * Return position of the first operator in array\n     *\n     * @param array $array Temporary array\n     * @return integer Position of the first operator\n     * @access private\n     */\n    function _nextOperator($array) {\n        $pos = 0;\n        while(is_numeric($array[$pos])) {\n            $pos++;\n            if ($pos >= count($array)) {\n                return -1;\n            }\n        }\n        return $pos;\n\n    }\n\n    /**\n     * Delete from array operator [posision $pos] and its argument and insert new value\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of the last operator\n     * @param integer $arg Number of last operator's arguments\n     * @param float $result Last operation result\n     * @return array New temporary array\n     * @access private\n     */\n    function _refresh($temp, $pos, $arg, $result) {\n        $temp1 = array_slice($temp, 0, $pos-$arg);\n        $temp1[] = $result;\n        $temp2 = array_slice($temp, $pos+1);\n        return array_merge($temp1, $temp2);\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _sum($temp, $pos) {\n        return $temp[$pos-2]+$temp[$pos-1];\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _difference($temp, $pos) {\n        return $temp[$pos-2]-$temp[$pos-1];\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _multiplication($temp, $pos) {\n        return $temp[$pos-2]*$temp[$pos-1];\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _division($temp, $pos) {\n        if ($temp[$pos-1]==0) {\n            $this->_error = $this->_raiseError('Division by 0');\n            $this->_value = null;\n            return $this->_value;\n        }\n        return $temp[$pos-2]/$temp[$pos-1];\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _root($temp, $pos) {\n        return pow($temp[$pos-1], (1/$temp[$pos-2]));\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _power($temp, $pos) {\n        return pow($temp[$pos-2], $temp[$pos-1]);\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _sin($temp, $pos) {\n        if ($this->_angle) {\n            $angle = $temp[$pos-1];\n        } else {\n            $angle = deg2rad($temp[$pos-1]);\n        }\n        return sin($angle);\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _cos($temp, $pos) {\n        if ($this->_angle) {\n            $angle = $temp[$pos-1];\n        } else {\n            $angle = deg2rad($temp[$pos-1]);\n        }\n        return cos($angle);\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _tan($temp, $pos) {\n        if ($this->_angle) {\n            $angle = $temp[$pos-1];\n        } else {\n            $angle = deg2rad($temp[$pos-1]);\n        }\n        return tan($angle);\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _asin($temp, $pos) {\n        $angle = asin($temp[$pos-1]);\n        if (!$this->_angle) {\n            $angle = rad2deg($angle);\n        }\n        return $angle;\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _acos($temp, $pos) {\n        $angle = acos($temp[$pos-1]);\n        if (!$this->_angle) {\n            $angle = rad2deg($angle);\n        }\n        return $angle;\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _atan($temp, $pos) {\n        $angle = atan($temp[$pos-1]);\n        if (!$this->_angle) {\n            $angle = rad2deg($angle);\n        }\n        return $angle;\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _sqrt($temp, $pos) {\n        return sqrt($temp[$pos-1]);\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _exp($temp, $pos) {\n        return exp($temp[$pos-1]);\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _log($temp, $pos) {\n        return log10($temp[$pos-1]);\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _ln($temp, $pos) {\n        return log($temp[$pos-1]);\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _const_pi($temp, $pos) {\n        return M_PI;\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _const_e($temp, $pos) {\n        return M_E;\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _E($temp, $pos) {\n        return pow(10, $temp[$pos-1]);\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _factorial($temp, $pos) {\n        $factorial = 1;\n        for($i=1;$i<=$temp[$pos-1];$i++) {\n            $factorial *= $i;\n        }\n        return $factorial;\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _abs($temp, $pos) {\n        return abs($temp[$pos-1]);\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _mod($temp, $pos) {\n        return $temp[$pos-2]%$temp[$pos-1];\n    }\n\n    /**\n     * Math function\n     *\n     * @param array $temp Temporary array\n     * @param integer $pos Position of operator\n     * @return float Function's relult\n     * @access private\n     */\n    function _div($temp, $pos) {\n        return floor($temp[$pos-2]/$temp[$pos-1]);\n    }\n\n    /**\n     * Calculate RPN Expression and return value\n     *\n     * @return float Result of input expression\n     * @access private\n     */\n    function _rpnToValue() {\n\n        $time1 = $this->_getMicroTime();\n\n        if ($this->_error <> null) {\n            $this->_value = null;\n            return $this->_value;\n        }\n\n        $this->_value = 0;\n        $temp = $this->_output;\n\n        do {\n            $pos = $this->_nextOperator($temp);\n\n            if ($pos == -1) {\n                $this->_error = $this->_raiseError('Syntax error');\n                $this->_value = null;\n                return $this->_value;\n            }\n\n            $operator = $this->_operation[$temp[$pos]];\n            $arg = $operator[2];\n            $function = $operator[3];\n\n            if (($arg==2) && (!isset($temp[$pos-1]) || !is_numeric($temp[$pos-1]) || !isset($temp[$pos-2]) || !is_numeric($temp[$pos-2]))) {\n                $this->_error = $this->_raiseError('Syntax error');\n                $this->_value = null;\n                return $this->_value;\n            } elseif (($arg==1) && (!isset($temp[$pos-1]) || !is_numeric($temp[$pos-1]))) {\n                $this->_error = $this->_raiseError('Syntax error');\n                $this->_value = null;\n                return $this->_value;\n            }\n\n            if(is_array($function)) {\n\n                if($arg==2) $arg_array = array($temp[$pos-2],$temp[$pos-1]);\n                elseif($arg==1) $arg_array = array($temp[$pos-1]);\n                else $arg_array = array();\n\n                if($function['type'] == 'userFunction') {\n                    $this->_value = call_user_func_array($function['function'], $arg_array);\n                } else {\n                    $function_array = array(&$function['class'], $function['method']);\n                    $this->_value = call_user_func_array($function_array, $arg_array);\n                }\n            } else {\n                $this->_value = $this->$function($temp, $pos);\n            }\n\n            if ($this->_isNan($this->_value)) {\n                $this->_error = $this->_raiseError('NAN value');\n                $this->_value = null;\n                return $this->_value;\n            } elseif ($this->_isInfinite($this->_value)) {\n                $this->_error = $this->_raiseError('Infinite value');\n                $this->_value = null;\n                return $this->_value;\n            } elseif (is_null($this->_value)) {\n                return $this->_value;\n            }\n\n            $temp = $this->_refresh($temp, $pos, $arg, $this->_value);\n        } while(count($temp) > 1);\n\n        $this->_value = $temp[0];\n\n        $time2 = $this->_getMicroTime();\n\n        $this->_timer = $time2 - $time1;\n\n        return $this->_value;\n    }\n\n    /**\n     * Return a time in second\n     *\n     * @return float Current time in seconds\n     * @access private\n     */\n    function _getMicroTime() {\n        list($usec, $sec) = explode(\" \", microtime());\n        return ((float)$usec + (float)$sec);\n    }\n\n}\nfield 不能含有数字加减乘除\n$rpn = new Math_Rpn();\n$infix_expression = \"(actual_calls*call_standard)+33.2\";\n$expression_value = array(\n    \"actual_calls\"=>'20',\n    \"call_standard\"=>'2',\n    \"amount\"=>'100',\n    \"actual_contacts\"=>'100',\n    \"contacts_standard\"=>'100'\n);\n$expression = $rpn->_splitENstr($infix_expression,$expression_value);\necho $rpn->calculate($expression,false);\n?>\n```\n","slug":"逆波兰式计算工资","published":1,"category":"PHP","date":"2023-06-08T23:03:56.098Z","updated":"2023-06-08T23:12:13.739Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5seg001ddxjcbxcs8t6u","content":"<ul>\n<li>这段时间一直在修自己写的bug，php部分分享之前对工资模块的理解，这里涉及到会有很多变量组成工资表达式，修改了一部分表达式的结构，变成公用的。</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br><span class=\"line\">637</span><br><span class=\"line\">638</span><br><span class=\"line\">639</span><br><span class=\"line\">640</span><br><span class=\"line\">641</span><br><span class=\"line\">642</span><br><span class=\"line\">643</span><br><span class=\"line\">644</span><br><span class=\"line\">645</span><br><span class=\"line\">646</span><br><span class=\"line\">647</span><br><span class=\"line\">648</span><br><span class=\"line\">649</span><br><span class=\"line\">650</span><br><span class=\"line\">651</span><br><span class=\"line\">652</span><br><span class=\"line\">653</span><br><span class=\"line\">654</span><br><span class=\"line\">655</span><br><span class=\"line\">656</span><br><span class=\"line\">657</span><br><span class=\"line\">658</span><br><span class=\"line\">659</span><br><span class=\"line\">660</span><br><span class=\"line\">661</span><br><span class=\"line\">662</span><br><span class=\"line\">663</span><br><span class=\"line\">664</span><br><span class=\"line\">665</span><br><span class=\"line\">666</span><br><span class=\"line\">667</span><br><span class=\"line\">668</span><br><span class=\"line\">669</span><br><span class=\"line\">670</span><br><span class=\"line\">671</span><br><span class=\"line\">672</span><br><span class=\"line\">673</span><br><span class=\"line\">674</span><br><span class=\"line\">675</span><br><span class=\"line\">676</span><br><span class=\"line\">677</span><br><span class=\"line\">678</span><br><span class=\"line\">679</span><br><span class=\"line\">680</span><br><span class=\"line\">681</span><br><span class=\"line\">682</span><br><span class=\"line\">683</span><br><span class=\"line\">684</span><br><span class=\"line\">685</span><br><span class=\"line\">686</span><br><span class=\"line\">687</span><br><span class=\"line\">688</span><br><span class=\"line\">689</span><br><span class=\"line\">690</span><br><span class=\"line\">691</span><br><span class=\"line\">692</span><br><span class=\"line\">693</span><br><span class=\"line\">694</span><br><span class=\"line\">695</span><br><span class=\"line\">696</span><br><span class=\"line\">697</span><br><span class=\"line\">698</span><br><span class=\"line\">699</span><br><span class=\"line\">700</span><br><span class=\"line\">701</span><br><span class=\"line\">702</span><br><span class=\"line\">703</span><br><span class=\"line\">704</span><br><span class=\"line\">705</span><br><span class=\"line\">706</span><br><span class=\"line\">707</span><br><span class=\"line\">708</span><br><span class=\"line\">709</span><br><span class=\"line\">710</span><br><span class=\"line\">711</span><br><span class=\"line\">712</span><br><span class=\"line\">713</span><br><span class=\"line\">714</span><br><span class=\"line\">715</span><br><span class=\"line\">716</span><br><span class=\"line\">717</span><br><span class=\"line\">718</span><br><span class=\"line\">719</span><br><span class=\"line\">720</span><br><span class=\"line\">721</span><br><span class=\"line\">722</span><br><span class=\"line\">723</span><br><span class=\"line\">724</span><br><span class=\"line\">725</span><br><span class=\"line\">726</span><br><span class=\"line\">727</span><br><span class=\"line\">728</span><br><span class=\"line\">729</span><br><span class=\"line\">730</span><br><span class=\"line\">731</span><br><span class=\"line\">732</span><br><span class=\"line\">733</span><br><span class=\"line\">734</span><br><span class=\"line\">735</span><br><span class=\"line\">736</span><br><span class=\"line\">737</span><br><span class=\"line\">738</span><br><span class=\"line\">739</span><br><span class=\"line\">740</span><br><span class=\"line\">741</span><br><span class=\"line\">742</span><br><span class=\"line\">743</span><br><span class=\"line\">744</span><br><span class=\"line\">745</span><br><span class=\"line\">746</span><br><span class=\"line\">747</span><br><span class=\"line\">748</span><br><span class=\"line\">749</span><br><span class=\"line\">750</span><br><span class=\"line\">751</span><br><span class=\"line\">752</span><br><span class=\"line\">753</span><br><span class=\"line\">754</span><br><span class=\"line\">755</span><br><span class=\"line\">756</span><br><span class=\"line\">757</span><br><span class=\"line\">758</span><br><span class=\"line\">759</span><br><span class=\"line\">760</span><br><span class=\"line\">761</span><br><span class=\"line\">762</span><br><span class=\"line\">763</span><br><span class=\"line\">764</span><br><span class=\"line\">765</span><br><span class=\"line\">766</span><br><span class=\"line\">767</span><br><span class=\"line\">768</span><br><span class=\"line\">769</span><br><span class=\"line\">770</span><br><span class=\"line\">771</span><br><span class=\"line\">772</span><br><span class=\"line\">773</span><br><span class=\"line\">774</span><br><span class=\"line\">775</span><br><span class=\"line\">776</span><br><span class=\"line\">777</span><br><span class=\"line\">778</span><br><span class=\"line\">779</span><br><span class=\"line\">780</span><br><span class=\"line\">781</span><br><span class=\"line\">782</span><br><span class=\"line\">783</span><br><span class=\"line\">784</span><br><span class=\"line\">785</span><br><span class=\"line\">786</span><br><span class=\"line\">787</span><br><span class=\"line\">788</span><br><span class=\"line\">789</span><br><span class=\"line\">790</span><br><span class=\"line\">791</span><br><span class=\"line\">792</span><br><span class=\"line\">793</span><br><span class=\"line\">794</span><br><span class=\"line\">795</span><br><span class=\"line\">796</span><br><span class=\"line\">797</span><br><span class=\"line\">798</span><br><span class=\"line\">799</span><br><span class=\"line\">800</span><br><span class=\"line\">801</span><br><span class=\"line\">802</span><br><span class=\"line\">803</span><br><span class=\"line\">804</span><br><span class=\"line\">805</span><br><span class=\"line\">806</span><br><span class=\"line\">807</span><br><span class=\"line\">808</span><br><span class=\"line\">809</span><br><span class=\"line\">810</span><br><span class=\"line\">811</span><br><span class=\"line\">812</span><br><span class=\"line\">813</span><br><span class=\"line\">814</span><br><span class=\"line\">815</span><br><span class=\"line\">816</span><br><span class=\"line\">817</span><br><span class=\"line\">818</span><br><span class=\"line\">819</span><br><span class=\"line\">820</span><br><span class=\"line\">821</span><br><span class=\"line\">822</span><br><span class=\"line\">823</span><br><span class=\"line\">824</span><br><span class=\"line\">825</span><br><span class=\"line\">826</span><br><span class=\"line\">827</span><br><span class=\"line\">828</span><br><span class=\"line\">829</span><br><span class=\"line\">830</span><br><span class=\"line\">831</span><br><span class=\"line\">832</span><br><span class=\"line\">833</span><br><span class=\"line\">834</span><br><span class=\"line\">835</span><br><span class=\"line\">836</span><br><span class=\"line\">837</span><br><span class=\"line\">838</span><br><span class=\"line\">839</span><br><span class=\"line\">840</span><br><span class=\"line\">841</span><br><span class=\"line\">842</span><br><span class=\"line\">843</span><br><span class=\"line\">844</span><br><span class=\"line\">845</span><br><span class=\"line\">846</span><br><span class=\"line\">847</span><br><span class=\"line\">848</span><br><span class=\"line\">849</span><br><span class=\"line\">850</span><br><span class=\"line\">851</span><br><span class=\"line\">852</span><br><span class=\"line\">853</span><br><span class=\"line\">854</span><br><span class=\"line\">855</span><br><span class=\"line\">856</span><br><span class=\"line\">857</span><br><span class=\"line\">858</span><br><span class=\"line\">859</span><br><span class=\"line\">860</span><br><span class=\"line\">861</span><br><span class=\"line\">862</span><br><span class=\"line\">863</span><br><span class=\"line\">864</span><br><span class=\"line\">865</span><br><span class=\"line\">866</span><br><span class=\"line\">867</span><br><span class=\"line\">868</span><br><span class=\"line\">869</span><br><span class=\"line\">870</span><br><span class=\"line\">871</span><br><span class=\"line\">872</span><br><span class=\"line\">873</span><br><span class=\"line\">874</span><br><span class=\"line\">875</span><br><span class=\"line\">876</span><br><span class=\"line\">877</span><br><span class=\"line\">878</span><br><span class=\"line\">879</span><br><span class=\"line\">880</span><br><span class=\"line\">881</span><br><span class=\"line\">882</span><br><span class=\"line\">883</span><br><span class=\"line\">884</span><br><span class=\"line\">885</span><br><span class=\"line\">886</span><br><span class=\"line\">887</span><br><span class=\"line\">888</span><br><span class=\"line\">889</span><br><span class=\"line\">890</span><br><span class=\"line\">891</span><br><span class=\"line\">892</span><br><span class=\"line\">893</span><br><span class=\"line\">894</span><br><span class=\"line\">895</span><br><span class=\"line\">896</span><br><span class=\"line\">897</span><br><span class=\"line\">898</span><br><span class=\"line\">899</span><br><span class=\"line\">900</span><br><span class=\"line\">901</span><br><span class=\"line\">902</span><br><span class=\"line\">903</span><br><span class=\"line\">904</span><br><span class=\"line\">905</span><br><span class=\"line\">906</span><br><span class=\"line\">907</span><br><span class=\"line\">908</span><br><span class=\"line\">909</span><br><span class=\"line\">910</span><br><span class=\"line\">911</span><br><span class=\"line\">912</span><br><span class=\"line\">913</span><br><span class=\"line\">914</span><br><span class=\"line\">915</span><br><span class=\"line\">916</span><br><span class=\"line\">917</span><br><span class=\"line\">918</span><br><span class=\"line\">919</span><br><span class=\"line\">920</span><br><span class=\"line\">921</span><br><span class=\"line\">922</span><br><span class=\"line\">923</span><br><span class=\"line\">924</span><br><span class=\"line\">925</span><br><span class=\"line\">926</span><br><span class=\"line\">927</span><br><span class=\"line\">928</span><br><span class=\"line\">929</span><br><span class=\"line\">930</span><br><span class=\"line\">931</span><br><span class=\"line\">932</span><br><span class=\"line\">933</span><br><span class=\"line\">934</span><br><span class=\"line\">935</span><br><span class=\"line\">936</span><br><span class=\"line\">937</span><br><span class=\"line\">938</span><br><span class=\"line\">939</span><br><span class=\"line\">940</span><br><span class=\"line\">941</span><br><span class=\"line\">942</span><br><span class=\"line\">943</span><br><span class=\"line\">944</span><br><span class=\"line\">945</span><br><span class=\"line\">946</span><br><span class=\"line\">947</span><br><span class=\"line\">948</span><br><span class=\"line\">949</span><br><span class=\"line\">950</span><br><span class=\"line\">951</span><br><span class=\"line\">952</span><br><span class=\"line\">953</span><br><span class=\"line\">954</span><br><span class=\"line\">955</span><br><span class=\"line\">956</span><br><span class=\"line\">957</span><br><span class=\"line\">958</span><br><span class=\"line\">959</span><br><span class=\"line\">960</span><br><span class=\"line\">961</span><br><span class=\"line\">962</span><br><span class=\"line\">963</span><br><span class=\"line\">964</span><br><span class=\"line\">965</span><br><span class=\"line\">966</span><br><span class=\"line\">967</span><br><span class=\"line\">968</span><br><span class=\"line\">969</span><br><span class=\"line\">970</span><br><span class=\"line\">971</span><br><span class=\"line\">972</span><br><span class=\"line\">973</span><br><span class=\"line\">974</span><br><span class=\"line\">975</span><br><span class=\"line\">976</span><br><span class=\"line\">977</span><br><span class=\"line\">978</span><br><span class=\"line\">979</span><br><span class=\"line\">980</span><br><span class=\"line\">981</span><br><span class=\"line\">982</span><br><span class=\"line\">983</span><br><span class=\"line\">984</span><br><span class=\"line\">985</span><br><span class=\"line\">986</span><br><span class=\"line\">987</span><br><span class=\"line\">988</span><br><span class=\"line\">989</span><br><span class=\"line\">990</span><br><span class=\"line\">991</span><br><span class=\"line\">992</span><br><span class=\"line\">993</span><br><span class=\"line\">994</span><br><span class=\"line\">995</span><br><span class=\"line\">996</span><br><span class=\"line\">997</span><br><span class=\"line\">998</span><br><span class=\"line\">999</span><br><span class=\"line\">1000</span><br><span class=\"line\">1001</span><br><span class=\"line\">1002</span><br><span class=\"line\">1003</span><br><span class=\"line\">1004</span><br><span class=\"line\">1005</span><br><span class=\"line\">1006</span><br><span class=\"line\">1007</span><br><span class=\"line\">1008</span><br><span class=\"line\">1009</span><br><span class=\"line\">1010</span><br><span class=\"line\">1011</span><br><span class=\"line\">1012</span><br><span class=\"line\">1013</span><br><span class=\"line\">1014</span><br><span class=\"line\">1015</span><br><span class=\"line\">1016</span><br><span class=\"line\">1017</span><br><span class=\"line\">1018</span><br><span class=\"line\">1019</span><br><span class=\"line\">1020</span><br><span class=\"line\">1021</span><br><span class=\"line\">1022</span><br><span class=\"line\">1023</span><br><span class=\"line\">1024</span><br><span class=\"line\">1025</span><br><span class=\"line\">1026</span><br><span class=\"line\">1027</span><br><span class=\"line\">1028</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Math::Rpn</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 作用:</span></span><br><span class=\"line\"><span class=\"comment\"> *     计算中缀表达式的值</span></span><br><span class=\"line\"><span class=\"comment\"> *     将表达式转换为逆波兰式，计算逆波兰式的值</span></span><br><span class=\"line\"><span class=\"comment\"> *     Change Expression To RPN (Reverse Polish Notation), Evaluate RPN Expression</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 示例:</span></span><br><span class=\"line\"><span class=\"comment\"> *    1、计算中缀表达式的值</span></span><br><span class=\"line\"><span class=\"comment\">       $infix_expression = &quot;(255.3*2)+33.2&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">       $rpn = new Math_Rpn();</span></span><br><span class=\"line\"><span class=\"comment\"> *     echo $rpn-&gt;calculate($infix_expression,false);</span></span><br><span class=\"line\"><span class=\"comment\"> *     //若表达式中包含角的计算，若需要定义角的单位（弧度:rad,度:deg.默认的角度为rad,即弧度)</span></span><br><span class=\"line\"><span class=\"comment\"> *     $expression = &quot;(2^3)+sin(30)-(!4)+(3/4)&quot;;</span></span><br><span class=\"line\"><span class=\"comment\"> *     echo $rpn-&gt;calculate($expression,false,&#x27;deg&#x27;);</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span>   Maciej Szczytowski &lt;admin<span class=\"doctag\">@e</span>-rower.pl&gt;  kelite 修改 2013-2-23</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@version</span>  1.1.1</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@package</span>  math</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@access</span>   public</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Math_Rpn</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Input expression</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span>    string</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$_input</span> = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Array with input expression</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span>    array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$_input_array</span> = <span class=\"keyword\">array</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Array with output expression in RPN</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span>    array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$_output</span> = <span class=\"keyword\">array</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Temporary stack</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span>    array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$_stack</span> = <span class=\"keyword\">array</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Value of expression</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span>    float</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$_value</span> = <span class=\"number\">0.0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Angle&#x27;s unit: rad - true, deg - false</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span>    boolean</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$_angle</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * PEAR Error</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span>    object PEAR</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$_error</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Timer</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span>    float</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$_timer</span> = <span class=\"number\">0.0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Array of operators whit priority and math function</span></span><br><span class=\"line\"><span class=\"comment\">     * operator =&gt; (name, priority, number of arguments, function)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span>    array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$_operation</span> = <span class=\"keyword\">array</span> (</span><br><span class=\"line\">        <span class=\"string\">&#x27;(&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;left bracket&#x27;</span>, <span class=\"number\">0</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;)&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;right bracket&#x27;</span>, <span class=\"number\">1</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;+&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;sum&#x27;</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"string\">&#x27;_sum&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;-&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;difference&#x27;</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"string\">&#x27;_difference&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;*&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;multiplication&#x27;</span>, <span class=\"number\">2</span>, <span class=\"number\">2</span>, <span class=\"string\">&#x27;_multiplication&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;/&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;division&#x27;</span>, <span class=\"number\">2</span>, <span class=\"number\">2</span>, <span class=\"string\">&#x27;_division&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;r&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;root&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">2</span>, <span class=\"string\">&#x27;_root&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;^&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;power&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">2</span>, <span class=\"string\">&#x27;_power&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;sin&#x27;</span>  =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;sine&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_sin&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;cos&#x27;</span>  =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;cosine&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_cos&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;tan&#x27;</span>  =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;tangent&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_tan&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;asin&#x27;</span> =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;asine&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_asin&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;acos&#x27;</span> =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;acosine&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_acos&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;atan&#x27;</span> =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;atangent&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_atan&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;sqrt&#x27;</span> =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;square root&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_sqrt&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;exp&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;power of e&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_exp&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;log&#x27;</span>  =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;logarithm&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_log&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;ln&#x27;</span>   =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;natural logarithm&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_ln&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;E&#x27;</span>  =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;power of 10&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_E&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;abs&#x27;</span>  =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;absolute value&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_abs&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;!&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;factorial&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_factorial&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;pi&#x27;</span>   =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;value of pi&#x27;</span>, <span class=\"number\">4</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;_const_pi&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;e&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;value of e&#x27;</span>, <span class=\"number\">4</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;_const_e&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;mod&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;modulo&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">2</span>, <span class=\"string\">&#x27;_mod&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;div&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;integer division&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">2</span>, <span class=\"string\">&#x27;_div&#x27;</span>),</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Return a PEAR error</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> object PEAR error</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_raiseError</span> (<span class=\"params\"><span class=\"variable\">$error</span></span>) </span>&#123;</span><br><span class=\"line\">       <span class=\"comment\">// return PEAR::raiseError($error);</span></span><br><span class=\"line\">       <span class=\"keyword\">return</span> (<span class=\"variable\">$error</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Return a operator&#x27;s array</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> array Array with operator&#x27;s name, priority, arguments, function&#x27;s name and syntax</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> public</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getOperators</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$return</span> = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(<span class=\"keyword\">list</span>(<span class=\"variable\">$key</span>, <span class=\"variable\">$val</span>) = <span class=\"title function_ invoke__\">each</span>(<span class=\"variable\">$this</span>-&gt;_operation)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">array_key_exists</span> (<span class=\"number\">2</span>, <span class=\"variable\">$val</span>) &amp;&amp; <span class=\"variable\">$val</span>[<span class=\"number\">2</span>] == <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">                <span class=\"variable\">$syntax</span> = <span class=\"string\">&#x27;A &#x27;</span> . <span class=\"variable\">$key</span> . <span class=\"string\">&#x27; B&#x27;</span>;</span><br><span class=\"line\">                <span class=\"variable\">$arguments</span> = <span class=\"number\">2</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">elseif</span> (<span class=\"title function_ invoke__\">array_key_exists</span> (<span class=\"number\">2</span>, <span class=\"variable\">$val</span>) &amp;&amp; <span class=\"variable\">$val</span>[<span class=\"number\">2</span>] == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                <span class=\"variable\">$syntax</span> = <span class=\"variable\">$key</span> . <span class=\"string\">&#x27; A&#x27;</span>;</span><br><span class=\"line\">                <span class=\"variable\">$arguments</span> = <span class=\"number\">1</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"variable\">$syntax</span> = <span class=\"variable\">$key</span>;</span><br><span class=\"line\">                <span class=\"variable\">$arguments</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">array_key_exists</span> (<span class=\"number\">3</span>, <span class=\"variable\">$val</span>)) <span class=\"variable\">$function</span> = <span class=\"variable\">$val</span>[<span class=\"number\">3</span>]; <span class=\"keyword\">else</span> <span class=\"variable\">$function</span> = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable\">$return</span>[] = <span class=\"keyword\">array</span> (</span><br><span class=\"line\">                <span class=\"string\">&#x27;operator&#x27;</span> =&gt; <span class=\"variable\">$key</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;name&#x27;</span> =&gt; <span class=\"variable\">$val</span>[<span class=\"number\">0</span>],</span><br><span class=\"line\">                <span class=\"string\">&#x27;priority&#x27;</span> =&gt; <span class=\"variable\">$val</span>[<span class=\"number\">1</span>],</span><br><span class=\"line\">                <span class=\"string\">&#x27;arguments&#x27;</span> =&gt; <span class=\"variable\">$arguments</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;function&#x27;</span> =&gt; <span class=\"variable\">$function</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;syntax&#x27;</span> =&gt; <span class=\"variable\">$syntax</span></span><br><span class=\"line\">            );</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Add new operator</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $operator New operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $function Function name</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $priority New operator&#x27;s priority</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $no_of_arg Number of function&#x27;s arguments</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $text New operator&#x27;s description</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> public</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addOperator</span> (<span class=\"params\"><span class=\"variable\">$operator</span>, <span class=\"variable\">$function_name</span>, <span class=\"variable\">$priority</span> = <span class=\"number\">3</span>, <span class=\"variable\">$no_of_arg</span> = <span class=\"number\">0</span>, <span class=\"variable\">$text</span> = <span class=\"string\">&#x27;&#x27;</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">preg_match</span>(<span class=\"string\">&quot;/^([\\W\\w]+)\\:\\:([\\W\\w]+)$/&quot;</span>,<span class=\"variable\">$function_name</span>,<span class=\"variable\">$match</span>)) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$class</span> = <span class=\"variable\">$match</span>[<span class=\"number\">1</span>];</span><br><span class=\"line\">            <span class=\"variable\">$method</span> = <span class=\"variable\">$match</span>[<span class=\"number\">2</span>];</span><br><span class=\"line\">            <span class=\"variable\">$function</span> = <span class=\"keyword\">array</span> (</span><br><span class=\"line\">               <span class=\"string\">&#x27;type&#x27;</span> =&gt; <span class=\"string\">&#x27;userMethod&#x27;</span>,</span><br><span class=\"line\">               <span class=\"string\">&#x27;class&#x27;</span> =&gt; <span class=\"variable\">$class</span>,</span><br><span class=\"line\">               <span class=\"string\">&#x27;method&#x27;</span> =&gt; <span class=\"variable\">$method</span></span><br><span class=\"line\">            );</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"variable\">$function</span> = <span class=\"keyword\">array</span> (</span><br><span class=\"line\">               <span class=\"string\">&#x27;type&#x27;</span> =&gt; <span class=\"string\">&#x27;userFunction&#x27;</span>,</span><br><span class=\"line\">               <span class=\"string\">&#x27;function&#x27;</span> =&gt; <span class=\"variable\">$function_name</span></span><br><span class=\"line\">            );</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;_operation[<span class=\"variable\">$operator</span>] = <span class=\"keyword\">array</span> (<span class=\"variable\">$text</span>, <span class=\"variable\">$priority</span>, <span class=\"variable\">$no_of_arg</span>, <span class=\"variable\">$function</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Calculate the $input expression</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> mixed $input Infix expression string or RPN expression string 中缀表达式或逆波兰式</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $angle Angle&#x27;s unit - &#x27;rad&#x27; or &#x27;deg&#x27;  角的单位 rad表弧度，deg表示度</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> boolean $is_rpn True if $input is RPN expression or false if $input is infix expression   </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed Value of $input expression or a PEAR error</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> public</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">calculate</span>(<span class=\"params\"><span class=\"variable\">$input</span> = <span class=\"string\">&#x27;&#x27;</span>,<span class=\"variable\">$is_rpn</span> = <span class=\"literal\">true</span>,<span class=\"variable\">$angle</span> = <span class=\"string\">&#x27;rad&#x27;</span></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;_angle = (<span class=\"keyword\">boolean</span>) (<span class=\"variable\">$angle</span> == <span class=\"string\">&#x27;rad&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"variable\">$input</span> == <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;_error = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_raiseError</span>(<span class=\"string\">&#x27;Empty input expression&#x27;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_error;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!<span class=\"variable\">$is_rpn</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;_input = <span class=\"variable\">$input</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stringToArray</span> ();</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"variable language_\">$this</span>-&gt;_error &lt;&gt; <span class=\"literal\">null</span>) <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_error;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_arrayToRpn</span>();</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"variable language_\">$this</span>-&gt;_error &lt;&gt; <span class=\"literal\">null</span>) <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_error;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">is_array</span>(<span class=\"variable\">$input</span>)) &#123;</span><br><span class=\"line\">                <span class=\"variable\">$input</span> = <span class=\"title function_ invoke__\">implode</span>(<span class=\"string\">&#x27; &#x27;</span>, <span class=\"variable\">$input</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;_input = <span class=\"variable\">$input</span>;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;_input_array = <span class=\"title function_ invoke__\">explode</span>(<span class=\"string\">&#x27; &#x27;</span>,<span class=\"variable\">$input</span>);</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;_output = <span class=\"title function_ invoke__\">explode</span>(<span class=\"string\">&#x27; &#x27;</span>,<span class=\"variable\">$input</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_rpnToValue</span>();</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"variable language_\">$this</span>-&gt;_error &lt;&gt; <span class=\"literal\">null</span>) <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_error;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Calculate the $input expression (alias of calculate())</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@author</span>  kelite 修改参数顺序</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> mixed $input Infix expression string or RPN expression array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $angle Angle&#x27;s unit - &#x27;rad&#x27; or &#x27;deg&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> boolean $is_rpn True if $input is RPN expression or false if $input is infix expression</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed Value of $input expression or a PEAR error</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> public</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">evaluate</span>(<span class=\"params\"><span class=\"variable\">$input</span> = <span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$angle</span> = <span class=\"string\">&#x27;rad&#x27;</span>, <span class=\"variable\">$is_rpn</span> = <span class=\"literal\">false</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//原顺序return $this-&gt; calculate($input,$angle,$is_rpn);</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt; <span class=\"title function_ invoke__\">calculate</span>(<span class=\"variable\">$input</span>,<span class=\"variable\">$is_rpn</span>,<span class=\"variable\">$angle</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Return a input array</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> array Input array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> public</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getInputArray</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_input_array;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Return a RPN array</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> array RPN array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> public</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getRpnArray</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_output;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Return a counting time in second</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Counting time in seconds</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> public</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getTimer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_timer;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Check that $key is a key of $array (conformity to php&lt;4.1.0)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $type 0 - return true if $key is $array&#x27;s key, 1 - return true if $key is $array&#x27;s key and there isn&#x27;t any occurrence of $key in another $array&#x27;s key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> boolean true when $key is a key of $array, or false</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_keyExists</span>(<span class=\"params\"><span class=\"variable\">$key</span>,<span class=\"variable\">$array</span>,<span class=\"variable\">$type</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$keys</span> = <span class=\"title function_ invoke__\">array_keys</span>(<span class=\"variable\">$array</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"variable\">$type</span> == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$count</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (<span class=\"keyword\">list</span>(<span class=\"variable\">$keys_key</span>, <span class=\"variable\">$keys_val</span>) = <span class=\"title function_ invoke__\">each</span>(<span class=\"variable\">$keys</span>)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">is_integer</span>(<span class=\"title function_ invoke__\">strpos</span>(<span class=\"variable\">$keys_val</span>, <span class=\"variable\">$key</span>)) &amp;&amp; (<span class=\"title function_ invoke__\">strpos</span>(<span class=\"variable\">$keys_val</span>, <span class=\"variable\">$key</span>)==<span class=\"number\">0</span>)) <span class=\"variable\">$count</span>++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>((<span class=\"variable\">$count</span>==<span class=\"number\">1</span>) &amp;&amp; <span class=\"title function_ invoke__\">in_array</span>(<span class=\"variable\">$key</span>,<span class=\"variable\">$keys</span>)) <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">in_array</span>(<span class=\"variable\">$key</span>,<span class=\"variable\">$keys</span>)) <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Check that $value is nan (conformity to php&lt;4.2.0)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> float $value checking value</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> boolean true when $value is nan, or false</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_isNan</span>(<span class=\"params\"><span class=\"variable\">$value</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">function_exists</span>(<span class=\"string\">&#x27;is_nan&#x27;</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">is_nan</span>(<span class=\"variable\">$value</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>((<span class=\"title function_ invoke__\">substr</span>(<span class=\"variable\">$value</span>,-<span class=\"number\">3</span>) == <span class=\"string\">&#x27;IND&#x27;</span>) || (<span class=\"title function_ invoke__\">substr</span>(<span class=\"variable\">$value</span>,-<span class=\"number\">3</span>) == <span class=\"string\">&#x27;NAN&#x27;</span>)) <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Check that $value is infinite (conformity to php&lt;4.2.0)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> float $value checking value</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> boolean true when $value is infinite, or false</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_isInfinite</span>(<span class=\"params\"><span class=\"variable\">$value</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">function_exists</span>(<span class=\"string\">&#x27;is_finite&#x27;</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> !<span class=\"title function_ invoke__\">is_finite</span>(<span class=\"variable\">$value</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">substr</span>(<span class=\"variable\">$value</span>,-<span class=\"number\">3</span>) == <span class=\"string\">&#x27;INF&#x27;</span>) <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Change input expression into array</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> array Input expression changed into array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_stringToArray</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$temp_operator</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"variable\">$temp_value</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;_input = <span class=\"title function_ invoke__\">str_replace</span>(<span class=\"string\">&quot; &quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"variable\">$this</span>-&gt;_input);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"variable\">$i</span> = <span class=\"number\">0</span>; <span class=\"variable\">$i</span> &lt; <span class=\"title function_ invoke__\">strlen</span>(<span class=\"variable\">$this</span>-&gt;_input); <span class=\"variable\">$i</span>++) &#123;</span><br><span class=\"line\"><span class=\"comment\">//             var_dump($this-&gt;_input[$i]);</span></span><br><span class=\"line\"><span class=\"comment\">//            var_dump(&#x27;temp_operator:&#x27;.$temp_operator.&#x27;,team_value:&#x27;.$temp_value.&#x27;,input:&#x27;.$this-&gt;_input[$i]);</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;_input[<span class=\"variable\">$i</span>] == <span class=\"string\">&#x27; &#x27;</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"variable\">$temp_operator</span> != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$this</span>-&gt;_input_array, <span class=\"variable\">$temp_operator</span>);</span><br><span class=\"line\">                    <span class=\"variable\">$temp_operator</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"variable\">$temp_value</span> != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$this</span>-&gt;_input_array, <span class=\"variable\">$temp_value</span>);</span><br><span class=\"line\">                    <span class=\"variable\">$temp_value</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">elseif</span> ((<span class=\"variable\">$temp_value</span> == <span class=\"literal\">null</span>) &amp;&amp; <span class=\"variable\">$temp_operator</span> != <span class=\"string\">&#x27;)&#x27;</span> &amp;&amp; (!<span class=\"title function_ invoke__\">array_key_exists</span>(<span class=\"variable\">$temp_operator</span>,<span class=\"variable\">$this</span>-&gt;_operation) || !<span class=\"title function_ invoke__\">array_key_exists</span>(<span class=\"number\">2</span>,<span class=\"variable\">$this</span>-&gt;_operation[<span class=\"variable\">$temp_operator</span>]) || <span class=\"variable language_\">$this</span>-&gt;_operation[<span class=\"variable\">$temp_operator</span>][<span class=\"number\">2</span>]&gt;<span class=\"number\">0</span>) &amp;&amp; (<span class=\"variable language_\">$this</span>-&gt;_input[<span class=\"variable\">$i</span>] == <span class=\"string\">&#x27;-&#x27;</span>)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"variable\">$temp_operator</span> != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$this</span>-&gt;_input_array, <span class=\"variable\">$temp_operator</span>);</span><br><span class=\"line\">                    <span class=\"variable\">$temp_operator</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$this</span>-&gt;_input_array, <span class=\"string\">&#x27;-1&#x27;</span>);</span><br><span class=\"line\">                <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$this</span>-&gt;_input_array, <span class=\"string\">&#x27;*&#x27;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">elseif</span> ((<span class=\"title function_ invoke__\">is_numeric</span>(<span class=\"variable\">$this</span>-&gt;_input[<span class=\"variable\">$i</span>])) || (<span class=\"variable language_\">$this</span>-&gt;_input[<span class=\"variable\">$i</span>] == <span class=\"string\">&#x27;.&#x27;</span>)) &#123;</span><br><span class=\"line\"><span class=\"comment\">//            &#125; elseif ((is_numeric($this-&gt;_input[$i])) || ($this-&gt;_input[$i] == &#x27;.&#x27;) || ($this-&gt;_input[$i] == &#x27;A&#x27;)) &#123;</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"variable\">$temp_operator</span> != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$this</span>-&gt;_input_array, <span class=\"variable\">$temp_operator</span>);</span><br><span class=\"line\">                    <span class=\"variable\">$temp_operator</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"variable\">$temp_value</span> .= <span class=\"variable language_\">$this</span>-&gt;_input[<span class=\"variable\">$i</span>];</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_keyExists</span>(<span class=\"variable\">$temp_operator</span>, <span class=\"variable\">$this</span>-&gt;_operation, <span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">                    <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$this</span>-&gt;_input_array, <span class=\"variable\">$temp_operator</span>);</span><br><span class=\"line\">                    <span class=\"variable\">$temp_operator</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"variable\">$temp_value</span> != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$this</span>-&gt;_input_array, <span class=\"variable\">$temp_value</span>);</span><br><span class=\"line\">                    <span class=\"variable\">$temp_value</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"variable\">$temp_operator</span> .= <span class=\"variable language_\">$this</span>-&gt;_input[<span class=\"variable\">$i</span>];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable\">$temp_operator</span> != <span class=\"literal\">null</span> &amp;&amp; <span class=\"variable\">$temp_operator</span> != <span class=\"string\">&#x27; &#x27;</span>) &#123;</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$this</span>-&gt;_input_array, <span class=\"variable\">$temp_operator</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">elseif</span>(<span class=\"variable\">$temp_value</span> != <span class=\"literal\">null</span> &amp;&amp; <span class=\"variable\">$temp_value</span> != <span class=\"string\">&#x27; &#x27;</span>) &#123;</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$this</span>-&gt;_input_array, <span class=\"variable\">$temp_value</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// $this-&gt;_testInput();</span></span><br><span class=\"line\"><span class=\"comment\">//        print_r($this-&gt;_expression_value);</span></span><br><span class=\"line\"><span class=\"comment\">//        print_r($this-&gt;_input_array);</span></span><br><span class=\"line\"><span class=\"comment\">//        die();</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_input_array;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_splitENstr</span>(<span class=\"params\"><span class=\"variable\">$str</span>,<span class=\"variable\">$arr</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">preg_match_all</span>(<span class=\"string\">&#x27;/([a-zA-Z_]+)/&#x27;</span>,<span class=\"variable\">$str</span>,<span class=\"variable\">$match</span>);</span><br><span class=\"line\">        <span class=\"variable\">$mat</span> = <span class=\"title function_ invoke__\">array_unique</span>(<span class=\"variable\">$match</span>[<span class=\"number\">1</span>]);</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"variable\">$mat</span> <span class=\"keyword\">as</span> <span class=\"variable\">$v</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$str</span> = <span class=\"title function_ invoke__\">str_replace</span>(<span class=\"variable\">$v</span>,<span class=\"variable\">$arr</span>[<span class=\"variable\">$v</span>],<span class=\"variable\">$str</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$str</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Check input array and return correct array or a PEAR Error</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> object Null or a PEAR Error</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_testInput</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$this</span>-&gt;_input_array)) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;_input_array = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;_error = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_raiseError</span>(<span class=\"string\">&#x27;Undefined input array&#x27;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_error;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$bracket</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"variable\">$i</span> = <span class=\"number\">0</span>; <span class=\"variable\">$i</span> &lt; <span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$this</span>-&gt;_input_array); <span class=\"variable\">$i</span>++) <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;_input_array[<span class=\"variable\">$i</span>] == <span class=\"string\">&#x27;(&#x27;</span>) <span class=\"variable\">$bracket</span>++;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"variable\">$i</span> = <span class=\"number\">0</span>; <span class=\"variable\">$i</span> &lt; <span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$this</span>-&gt;_input_array); <span class=\"variable\">$i</span>++) <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;_input_array[<span class=\"variable\">$i</span>] == <span class=\"string\">&#x27;)&#x27;</span>) <span class=\"variable\">$bracket</span>--;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable\">$bracket</span> &lt;&gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_input_array = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_error = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_raiseError</span>(<span class=\"string\">&#x27;Syntax error&#x27;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_error;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"variable\">$i</span> = <span class=\"number\">0</span>; <span class=\"variable\">$i</span> &lt; <span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$this</span>-&gt;_input_array); <span class=\"variable\">$i</span>++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((!<span class=\"title function_ invoke__\">is_numeric</span>(<span class=\"variable\">$this</span>-&gt;_input_array[<span class=\"variable\">$i</span>])) &amp;&amp; (!<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_keyExists</span>(<span class=\"variable\">$this</span>-&gt;_input_array[<span class=\"variable\">$i</span>], <span class=\"variable\">$this</span>-&gt;_operation, <span class=\"number\">0</span>))) &#123;</span><br><span class=\"line\">                <span class=\"variable\">$error_operator</span> = <span class=\"variable language_\">$this</span>-&gt;_input_array[<span class=\"variable\">$i</span>];</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_input_array = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_error = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_raiseError</span>(<span class=\"string\">&#x27;Undefined operator \\&#x27;&#x27;</span>. <span class=\"variable\">$error_operator</span>.<span class=\"string\">&#x27;\\&#x27;&#x27;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_error;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;_error = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_error;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Add value to the end of stack</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $value Value to add into stack</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_stackAdd</span>(<span class=\"params\"><span class=\"variable\">$value</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$this</span>-&gt;_stack, <span class=\"variable\">$value</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Delete and return value from the end of stack</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string Value deleted from stack</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_stackDelete</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">array_pop</span>(<span class=\"variable\">$this</span>-&gt;_stack);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Return priority of value</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $value Value to get priority</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> integer Priority</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_priority</span>(<span class=\"params\"><span class=\"variable\">$value</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_operation[<span class=\"variable\">$value</span>][<span class=\"number\">1</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Return priority of value from the end of stack</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> integer Priority of operator from stack&#x27;s top</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_stackPriority</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$value</span> = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackDelete</span>();</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackAdd</span>(<span class=\"variable\">$value</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_priority</span>(<span class=\"variable\">$value</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Return true whene the stack is empty</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> boolean Stack is empty (true) or not (false)</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_stackEmpty</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$this</span>-&gt;_stack)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Add value into output array</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $value Value to add into output array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_outputAdd</span>(<span class=\"params\"><span class=\"variable\">$value</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable\">$value</span>&lt;&gt;<span class=\"string\">&#x27;(&#x27;</span>) &#123;</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$this</span>-&gt;_output, <span class=\"variable\">$value</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Change input array into RPN array</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> array Array with RPN expression</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_arrayToRpn</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;_error &lt;&gt; <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;_output = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_output;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"variable\">$i</span> = <span class=\"number\">0</span>; <span class=\"variable\">$i</span> &lt; <span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$this</span>-&gt;_input_array); <span class=\"variable\">$i</span>++) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable\">$temp</span> = <span class=\"variable language_\">$this</span>-&gt;_input_array[<span class=\"variable\">$i</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">is_numeric</span>(<span class=\"variable\">$temp</span>)) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_outputAdd</span>(<span class=\"variable\">$temp</span>);</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"variable\">$temp</span> == <span class=\"string\">&#x27;)&#x27;</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">while</span>(!<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackEmpty</span>() &amp;&amp; (<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackPriority</span>() &gt;= <span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">                        <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_outputAdd</span>(<span class=\"variable\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackDelete</span>());</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (!<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackEmpty</span>()) &#123;</span><br><span class=\"line\">                        <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackDelete</span>();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                &#125; <span class=\"keyword\">elseif</span> (<span class=\"variable\">$temp</span>==<span class=\"string\">&#x27;(&#x27;</span>) &#123;</span><br><span class=\"line\">                    <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackAdd</span>(<span class=\"variable\">$temp</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">elseif</span> ((<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackEmpty</span>()) || ((<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_priority</span>(<span class=\"variable\">$temp</span>) &gt; <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackPriority</span>()))) &#123;</span><br><span class=\"line\">                   <span class=\"variable language_\">$this</span>-&gt; <span class=\"title function_ invoke__\">_stackAdd</span>(<span class=\"variable\">$temp</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">while</span>(!<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackEmpty</span>() &amp;&amp; (<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_priority</span>(<span class=\"variable\">$temp</span>) &lt;= <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackPriority</span>())) &#123;</span><br><span class=\"line\">                        <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_outputAdd</span>(<span class=\"variable\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackDelete</span>());</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackAdd</span>(<span class=\"variable\">$temp</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span>(!<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackEmpty</span>()) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_outputAdd</span>(<span class=\"variable\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackDelete</span>());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_output;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Return position of the first operator in array</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $array Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> integer Position of the first operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_nextOperator</span>(<span class=\"params\"><span class=\"variable\">$array</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$pos</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(<span class=\"title function_ invoke__\">is_numeric</span>(<span class=\"variable\">$array</span>[<span class=\"variable\">$pos</span>])) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$pos</span>++;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"variable\">$pos</span> &gt;= <span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$array</span>)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$pos</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Delete from array operator [posision $pos] and its argument and insert new value</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of the last operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $arg Number of last operator&#x27;s arguments</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> float $result Last operation result</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> array New temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_refresh</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span>, <span class=\"variable\">$arg</span>, <span class=\"variable\">$result</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$temp1</span> = <span class=\"title function_ invoke__\">array_slice</span>(<span class=\"variable\">$temp</span>, <span class=\"number\">0</span>, <span class=\"variable\">$pos</span>-<span class=\"variable\">$arg</span>);</span><br><span class=\"line\">        <span class=\"variable\">$temp1</span>[] = <span class=\"variable\">$result</span>;</span><br><span class=\"line\">        <span class=\"variable\">$temp2</span> = <span class=\"title function_ invoke__\">array_slice</span>(<span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span>+<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">array_merge</span>(<span class=\"variable\">$temp1</span>, <span class=\"variable\">$temp2</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_sum</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">2</span>]+<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_difference</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">2</span>]-<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_multiplication</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">2</span>]*<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_division</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]==<span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;_error = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_raiseError</span>(<span class=\"string\">&#x27;Division by 0&#x27;</span>);</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;_value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_value;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">2</span>]/<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_root</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">pow</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>], (<span class=\"number\">1</span>/<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">2</span>]));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_power</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">pow</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">2</span>], <span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_sin</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;_angle) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$angle</span> = <span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>];</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"variable\">$angle</span> = <span class=\"title function_ invoke__\">deg2rad</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">sin</span>(<span class=\"variable\">$angle</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_cos</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;_angle) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$angle</span> = <span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>];</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"variable\">$angle</span> = <span class=\"title function_ invoke__\">deg2rad</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">cos</span>(<span class=\"variable\">$angle</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_tan</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;_angle) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$angle</span> = <span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>];</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"variable\">$angle</span> = <span class=\"title function_ invoke__\">deg2rad</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">tan</span>(<span class=\"variable\">$angle</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_asin</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$angle</span> = <span class=\"title function_ invoke__\">asin</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"variable language_\">$this</span>-&gt;_angle) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$angle</span> = <span class=\"title function_ invoke__\">rad2deg</span>(<span class=\"variable\">$angle</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$angle</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_acos</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$angle</span> = <span class=\"title function_ invoke__\">acos</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"variable language_\">$this</span>-&gt;_angle) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$angle</span> = <span class=\"title function_ invoke__\">rad2deg</span>(<span class=\"variable\">$angle</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$angle</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_atan</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$angle</span> = <span class=\"title function_ invoke__\">atan</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"variable language_\">$this</span>-&gt;_angle) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$angle</span> = <span class=\"title function_ invoke__\">rad2deg</span>(<span class=\"variable\">$angle</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$angle</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_sqrt</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">sqrt</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_exp</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">exp</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_log</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">log10</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_ln</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">log</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_const_pi</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> M_PI;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_const_e</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> M_E;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_E</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">pow</span>(<span class=\"number\">10</span>, <span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_factorial</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$factorial</span> = <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"variable\">$i</span>=<span class=\"number\">1</span>;<span class=\"variable\">$i</span>&lt;=<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>];<span class=\"variable\">$i</span>++) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$factorial</span> *= <span class=\"variable\">$i</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$factorial</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_abs</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">abs</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_mod</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">2</span>]%<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_div</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">floor</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">2</span>]/<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Calculate RPN Expression and return value</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Result of input expression</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_rpnToValue</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$time1</span> = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_getMicroTime</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;_error &lt;&gt; <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;_value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_value;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;_value = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"variable\">$temp</span> = <span class=\"variable language_\">$this</span>-&gt;_output;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">            <span class=\"variable\">$pos</span> = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_nextOperator</span>(<span class=\"variable\">$temp</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"variable\">$pos</span> == -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_error = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_raiseError</span>(<span class=\"string\">&#x27;Syntax error&#x27;</span>);</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_value;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable\">$operator</span> = <span class=\"variable language_\">$this</span>-&gt;_operation[<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>]];</span><br><span class=\"line\">            <span class=\"variable\">$arg</span> = <span class=\"variable\">$operator</span>[<span class=\"number\">2</span>];</span><br><span class=\"line\">            <span class=\"variable\">$function</span> = <span class=\"variable\">$operator</span>[<span class=\"number\">3</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((<span class=\"variable\">$arg</span>==<span class=\"number\">2</span>) &amp;&amp; (!<span class=\"keyword\">isset</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]) || !<span class=\"title function_ invoke__\">is_numeric</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]) || !<span class=\"keyword\">isset</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">2</span>]) || !<span class=\"title function_ invoke__\">is_numeric</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">2</span>]))) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_error = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_raiseError</span>(<span class=\"string\">&#x27;Syntax error&#x27;</span>);</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_value;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">elseif</span> ((<span class=\"variable\">$arg</span>==<span class=\"number\">1</span>) &amp;&amp; (!<span class=\"keyword\">isset</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]) || !<span class=\"title function_ invoke__\">is_numeric</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]))) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_error = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_raiseError</span>(<span class=\"string\">&#x27;Syntax error&#x27;</span>);</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_value;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">is_array</span>(<span class=\"variable\">$function</span>)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span>(<span class=\"variable\">$arg</span>==<span class=\"number\">2</span>) <span class=\"variable\">$arg_array</span> = <span class=\"keyword\">array</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">2</span>],<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">                <span class=\"keyword\">elseif</span>(<span class=\"variable\">$arg</span>==<span class=\"number\">1</span>) <span class=\"variable\">$arg_array</span> = <span class=\"keyword\">array</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">                <span class=\"keyword\">else</span> <span class=\"variable\">$arg_array</span> = <span class=\"keyword\">array</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span>(<span class=\"variable\">$function</span>[<span class=\"string\">&#x27;type&#x27;</span>] == <span class=\"string\">&#x27;userFunction&#x27;</span>) &#123;</span><br><span class=\"line\">                    <span class=\"variable language_\">$this</span>-&gt;_value = <span class=\"title function_ invoke__\">call_user_func_array</span>(<span class=\"variable\">$function</span>[<span class=\"string\">&#x27;function&#x27;</span>], <span class=\"variable\">$arg_array</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"variable\">$function_array</span> = <span class=\"keyword\">array</span>(&amp;<span class=\"variable\">$function</span>[<span class=\"string\">&#x27;class&#x27;</span>], <span class=\"variable\">$function</span>[<span class=\"string\">&#x27;method&#x27;</span>]);</span><br><span class=\"line\">                    <span class=\"variable language_\">$this</span>-&gt;_value = <span class=\"title function_ invoke__\">call_user_func_array</span>(<span class=\"variable\">$function_array</span>, <span class=\"variable\">$arg_array</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_value = <span class=\"variable language_\">$this</span>-&gt;<span class=\"variable\">$function</span>(<span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_isNan</span>(<span class=\"variable\">$this</span>-&gt;_value)) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_error = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_raiseError</span>(<span class=\"string\">&#x27;NAN value&#x27;</span>);</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_value;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">elseif</span> (<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_isInfinite</span>(<span class=\"variable\">$this</span>-&gt;_value)) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_error = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_raiseError</span>(<span class=\"string\">&#x27;Infinite value&#x27;</span>);</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_value;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">elseif</span> (<span class=\"title function_ invoke__\">is_null</span>(<span class=\"variable\">$this</span>-&gt;_value)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_value;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable\">$temp</span> = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_refresh</span>(<span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span>, <span class=\"variable\">$arg</span>, <span class=\"variable\">$this</span>-&gt;_value);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">while</span>(<span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$temp</span>) &gt; <span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;_value = <span class=\"variable\">$temp</span>[<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$time2</span> = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_getMicroTime</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;_timer = <span class=\"variable\">$time2</span> - <span class=\"variable\">$time1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Return a time in second</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Current time in seconds</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_getMicroTime</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">list</span>(<span class=\"variable\">$usec</span>, <span class=\"variable\">$sec</span>) = <span class=\"title function_ invoke__\">explode</span>(<span class=\"string\">&quot; &quot;</span>, <span class=\"title function_ invoke__\">microtime</span>());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ((<span class=\"keyword\">float</span>)<span class=\"variable\">$usec</span> + (<span class=\"keyword\">float</span>)<span class=\"variable\">$sec</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">field 不能含有数字加减乘除</span><br><span class=\"line\"><span class=\"variable\">$rpn</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Math_Rpn</span>();</span><br><span class=\"line\"><span class=\"variable\">$infix_expression</span> = <span class=\"string\">&quot;(actual_calls*call_standard)+33.2&quot;</span>;</span><br><span class=\"line\"><span class=\"variable\">$expression_value</span> = <span class=\"keyword\">array</span>(</span><br><span class=\"line\">    <span class=\"string\">&quot;actual_calls&quot;</span>=&gt;<span class=\"string\">&#x27;20&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;call_standard&quot;</span>=&gt;<span class=\"string\">&#x27;2&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;amount&quot;</span>=&gt;<span class=\"string\">&#x27;100&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;actual_contacts&quot;</span>=&gt;<span class=\"string\">&#x27;100&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;contacts_standard&quot;</span>=&gt;<span class=\"string\">&#x27;100&#x27;</span></span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"variable\">$expression</span> = <span class=\"variable\">$rpn</span>-&gt;<span class=\"title function_ invoke__\">_splitENstr</span>(<span class=\"variable\">$infix_expression</span>,<span class=\"variable\">$expression_value</span>);</span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"variable\">$rpn</span>-&gt;<span class=\"title function_ invoke__\">calculate</span>(<span class=\"variable\">$expression</span>,<span class=\"literal\">false</span>);</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"length":26020,"excerpt":"","more":"<ul>\n<li>这段时间一直在修自己写的bug，php部分分享之前对工资模块的理解，这里涉及到会有很多变量组成工资表达式，修改了一部分表达式的结构，变成公用的。</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br><span class=\"line\">637</span><br><span class=\"line\">638</span><br><span class=\"line\">639</span><br><span class=\"line\">640</span><br><span class=\"line\">641</span><br><span class=\"line\">642</span><br><span class=\"line\">643</span><br><span class=\"line\">644</span><br><span class=\"line\">645</span><br><span class=\"line\">646</span><br><span class=\"line\">647</span><br><span class=\"line\">648</span><br><span class=\"line\">649</span><br><span class=\"line\">650</span><br><span class=\"line\">651</span><br><span class=\"line\">652</span><br><span class=\"line\">653</span><br><span class=\"line\">654</span><br><span class=\"line\">655</span><br><span class=\"line\">656</span><br><span class=\"line\">657</span><br><span class=\"line\">658</span><br><span class=\"line\">659</span><br><span class=\"line\">660</span><br><span class=\"line\">661</span><br><span class=\"line\">662</span><br><span class=\"line\">663</span><br><span class=\"line\">664</span><br><span class=\"line\">665</span><br><span class=\"line\">666</span><br><span class=\"line\">667</span><br><span class=\"line\">668</span><br><span class=\"line\">669</span><br><span class=\"line\">670</span><br><span class=\"line\">671</span><br><span class=\"line\">672</span><br><span class=\"line\">673</span><br><span class=\"line\">674</span><br><span class=\"line\">675</span><br><span class=\"line\">676</span><br><span class=\"line\">677</span><br><span class=\"line\">678</span><br><span class=\"line\">679</span><br><span class=\"line\">680</span><br><span class=\"line\">681</span><br><span class=\"line\">682</span><br><span class=\"line\">683</span><br><span class=\"line\">684</span><br><span class=\"line\">685</span><br><span class=\"line\">686</span><br><span class=\"line\">687</span><br><span class=\"line\">688</span><br><span class=\"line\">689</span><br><span class=\"line\">690</span><br><span class=\"line\">691</span><br><span class=\"line\">692</span><br><span class=\"line\">693</span><br><span class=\"line\">694</span><br><span class=\"line\">695</span><br><span class=\"line\">696</span><br><span class=\"line\">697</span><br><span class=\"line\">698</span><br><span class=\"line\">699</span><br><span class=\"line\">700</span><br><span class=\"line\">701</span><br><span class=\"line\">702</span><br><span class=\"line\">703</span><br><span class=\"line\">704</span><br><span class=\"line\">705</span><br><span class=\"line\">706</span><br><span class=\"line\">707</span><br><span class=\"line\">708</span><br><span class=\"line\">709</span><br><span class=\"line\">710</span><br><span class=\"line\">711</span><br><span class=\"line\">712</span><br><span class=\"line\">713</span><br><span class=\"line\">714</span><br><span class=\"line\">715</span><br><span class=\"line\">716</span><br><span class=\"line\">717</span><br><span class=\"line\">718</span><br><span class=\"line\">719</span><br><span class=\"line\">720</span><br><span class=\"line\">721</span><br><span class=\"line\">722</span><br><span class=\"line\">723</span><br><span class=\"line\">724</span><br><span class=\"line\">725</span><br><span class=\"line\">726</span><br><span class=\"line\">727</span><br><span class=\"line\">728</span><br><span class=\"line\">729</span><br><span class=\"line\">730</span><br><span class=\"line\">731</span><br><span class=\"line\">732</span><br><span class=\"line\">733</span><br><span class=\"line\">734</span><br><span class=\"line\">735</span><br><span class=\"line\">736</span><br><span class=\"line\">737</span><br><span class=\"line\">738</span><br><span class=\"line\">739</span><br><span class=\"line\">740</span><br><span class=\"line\">741</span><br><span class=\"line\">742</span><br><span class=\"line\">743</span><br><span class=\"line\">744</span><br><span class=\"line\">745</span><br><span class=\"line\">746</span><br><span class=\"line\">747</span><br><span class=\"line\">748</span><br><span class=\"line\">749</span><br><span class=\"line\">750</span><br><span class=\"line\">751</span><br><span class=\"line\">752</span><br><span class=\"line\">753</span><br><span class=\"line\">754</span><br><span class=\"line\">755</span><br><span class=\"line\">756</span><br><span class=\"line\">757</span><br><span class=\"line\">758</span><br><span class=\"line\">759</span><br><span class=\"line\">760</span><br><span class=\"line\">761</span><br><span class=\"line\">762</span><br><span class=\"line\">763</span><br><span class=\"line\">764</span><br><span class=\"line\">765</span><br><span class=\"line\">766</span><br><span class=\"line\">767</span><br><span class=\"line\">768</span><br><span class=\"line\">769</span><br><span class=\"line\">770</span><br><span class=\"line\">771</span><br><span class=\"line\">772</span><br><span class=\"line\">773</span><br><span class=\"line\">774</span><br><span class=\"line\">775</span><br><span class=\"line\">776</span><br><span class=\"line\">777</span><br><span class=\"line\">778</span><br><span class=\"line\">779</span><br><span class=\"line\">780</span><br><span class=\"line\">781</span><br><span class=\"line\">782</span><br><span class=\"line\">783</span><br><span class=\"line\">784</span><br><span class=\"line\">785</span><br><span class=\"line\">786</span><br><span class=\"line\">787</span><br><span class=\"line\">788</span><br><span class=\"line\">789</span><br><span class=\"line\">790</span><br><span class=\"line\">791</span><br><span class=\"line\">792</span><br><span class=\"line\">793</span><br><span class=\"line\">794</span><br><span class=\"line\">795</span><br><span class=\"line\">796</span><br><span class=\"line\">797</span><br><span class=\"line\">798</span><br><span class=\"line\">799</span><br><span class=\"line\">800</span><br><span class=\"line\">801</span><br><span class=\"line\">802</span><br><span class=\"line\">803</span><br><span class=\"line\">804</span><br><span class=\"line\">805</span><br><span class=\"line\">806</span><br><span class=\"line\">807</span><br><span class=\"line\">808</span><br><span class=\"line\">809</span><br><span class=\"line\">810</span><br><span class=\"line\">811</span><br><span class=\"line\">812</span><br><span class=\"line\">813</span><br><span class=\"line\">814</span><br><span class=\"line\">815</span><br><span class=\"line\">816</span><br><span class=\"line\">817</span><br><span class=\"line\">818</span><br><span class=\"line\">819</span><br><span class=\"line\">820</span><br><span class=\"line\">821</span><br><span class=\"line\">822</span><br><span class=\"line\">823</span><br><span class=\"line\">824</span><br><span class=\"line\">825</span><br><span class=\"line\">826</span><br><span class=\"line\">827</span><br><span class=\"line\">828</span><br><span class=\"line\">829</span><br><span class=\"line\">830</span><br><span class=\"line\">831</span><br><span class=\"line\">832</span><br><span class=\"line\">833</span><br><span class=\"line\">834</span><br><span class=\"line\">835</span><br><span class=\"line\">836</span><br><span class=\"line\">837</span><br><span class=\"line\">838</span><br><span class=\"line\">839</span><br><span class=\"line\">840</span><br><span class=\"line\">841</span><br><span class=\"line\">842</span><br><span class=\"line\">843</span><br><span class=\"line\">844</span><br><span class=\"line\">845</span><br><span class=\"line\">846</span><br><span class=\"line\">847</span><br><span class=\"line\">848</span><br><span class=\"line\">849</span><br><span class=\"line\">850</span><br><span class=\"line\">851</span><br><span class=\"line\">852</span><br><span class=\"line\">853</span><br><span class=\"line\">854</span><br><span class=\"line\">855</span><br><span class=\"line\">856</span><br><span class=\"line\">857</span><br><span class=\"line\">858</span><br><span class=\"line\">859</span><br><span class=\"line\">860</span><br><span class=\"line\">861</span><br><span class=\"line\">862</span><br><span class=\"line\">863</span><br><span class=\"line\">864</span><br><span class=\"line\">865</span><br><span class=\"line\">866</span><br><span class=\"line\">867</span><br><span class=\"line\">868</span><br><span class=\"line\">869</span><br><span class=\"line\">870</span><br><span class=\"line\">871</span><br><span class=\"line\">872</span><br><span class=\"line\">873</span><br><span class=\"line\">874</span><br><span class=\"line\">875</span><br><span class=\"line\">876</span><br><span class=\"line\">877</span><br><span class=\"line\">878</span><br><span class=\"line\">879</span><br><span class=\"line\">880</span><br><span class=\"line\">881</span><br><span class=\"line\">882</span><br><span class=\"line\">883</span><br><span class=\"line\">884</span><br><span class=\"line\">885</span><br><span class=\"line\">886</span><br><span class=\"line\">887</span><br><span class=\"line\">888</span><br><span class=\"line\">889</span><br><span class=\"line\">890</span><br><span class=\"line\">891</span><br><span class=\"line\">892</span><br><span class=\"line\">893</span><br><span class=\"line\">894</span><br><span class=\"line\">895</span><br><span class=\"line\">896</span><br><span class=\"line\">897</span><br><span class=\"line\">898</span><br><span class=\"line\">899</span><br><span class=\"line\">900</span><br><span class=\"line\">901</span><br><span class=\"line\">902</span><br><span class=\"line\">903</span><br><span class=\"line\">904</span><br><span class=\"line\">905</span><br><span class=\"line\">906</span><br><span class=\"line\">907</span><br><span class=\"line\">908</span><br><span class=\"line\">909</span><br><span class=\"line\">910</span><br><span class=\"line\">911</span><br><span class=\"line\">912</span><br><span class=\"line\">913</span><br><span class=\"line\">914</span><br><span class=\"line\">915</span><br><span class=\"line\">916</span><br><span class=\"line\">917</span><br><span class=\"line\">918</span><br><span class=\"line\">919</span><br><span class=\"line\">920</span><br><span class=\"line\">921</span><br><span class=\"line\">922</span><br><span class=\"line\">923</span><br><span class=\"line\">924</span><br><span class=\"line\">925</span><br><span class=\"line\">926</span><br><span class=\"line\">927</span><br><span class=\"line\">928</span><br><span class=\"line\">929</span><br><span class=\"line\">930</span><br><span class=\"line\">931</span><br><span class=\"line\">932</span><br><span class=\"line\">933</span><br><span class=\"line\">934</span><br><span class=\"line\">935</span><br><span class=\"line\">936</span><br><span class=\"line\">937</span><br><span class=\"line\">938</span><br><span class=\"line\">939</span><br><span class=\"line\">940</span><br><span class=\"line\">941</span><br><span class=\"line\">942</span><br><span class=\"line\">943</span><br><span class=\"line\">944</span><br><span class=\"line\">945</span><br><span class=\"line\">946</span><br><span class=\"line\">947</span><br><span class=\"line\">948</span><br><span class=\"line\">949</span><br><span class=\"line\">950</span><br><span class=\"line\">951</span><br><span class=\"line\">952</span><br><span class=\"line\">953</span><br><span class=\"line\">954</span><br><span class=\"line\">955</span><br><span class=\"line\">956</span><br><span class=\"line\">957</span><br><span class=\"line\">958</span><br><span class=\"line\">959</span><br><span class=\"line\">960</span><br><span class=\"line\">961</span><br><span class=\"line\">962</span><br><span class=\"line\">963</span><br><span class=\"line\">964</span><br><span class=\"line\">965</span><br><span class=\"line\">966</span><br><span class=\"line\">967</span><br><span class=\"line\">968</span><br><span class=\"line\">969</span><br><span class=\"line\">970</span><br><span class=\"line\">971</span><br><span class=\"line\">972</span><br><span class=\"line\">973</span><br><span class=\"line\">974</span><br><span class=\"line\">975</span><br><span class=\"line\">976</span><br><span class=\"line\">977</span><br><span class=\"line\">978</span><br><span class=\"line\">979</span><br><span class=\"line\">980</span><br><span class=\"line\">981</span><br><span class=\"line\">982</span><br><span class=\"line\">983</span><br><span class=\"line\">984</span><br><span class=\"line\">985</span><br><span class=\"line\">986</span><br><span class=\"line\">987</span><br><span class=\"line\">988</span><br><span class=\"line\">989</span><br><span class=\"line\">990</span><br><span class=\"line\">991</span><br><span class=\"line\">992</span><br><span class=\"line\">993</span><br><span class=\"line\">994</span><br><span class=\"line\">995</span><br><span class=\"line\">996</span><br><span class=\"line\">997</span><br><span class=\"line\">998</span><br><span class=\"line\">999</span><br><span class=\"line\">1000</span><br><span class=\"line\">1001</span><br><span class=\"line\">1002</span><br><span class=\"line\">1003</span><br><span class=\"line\">1004</span><br><span class=\"line\">1005</span><br><span class=\"line\">1006</span><br><span class=\"line\">1007</span><br><span class=\"line\">1008</span><br><span class=\"line\">1009</span><br><span class=\"line\">1010</span><br><span class=\"line\">1011</span><br><span class=\"line\">1012</span><br><span class=\"line\">1013</span><br><span class=\"line\">1014</span><br><span class=\"line\">1015</span><br><span class=\"line\">1016</span><br><span class=\"line\">1017</span><br><span class=\"line\">1018</span><br><span class=\"line\">1019</span><br><span class=\"line\">1020</span><br><span class=\"line\">1021</span><br><span class=\"line\">1022</span><br><span class=\"line\">1023</span><br><span class=\"line\">1024</span><br><span class=\"line\">1025</span><br><span class=\"line\">1026</span><br><span class=\"line\">1027</span><br><span class=\"line\">1028</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Math::Rpn</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 作用:</span></span><br><span class=\"line\"><span class=\"comment\"> *     计算中缀表达式的值</span></span><br><span class=\"line\"><span class=\"comment\"> *     将表达式转换为逆波兰式，计算逆波兰式的值</span></span><br><span class=\"line\"><span class=\"comment\"> *     Change Expression To RPN (Reverse Polish Notation), Evaluate RPN Expression</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 示例:</span></span><br><span class=\"line\"><span class=\"comment\"> *    1、计算中缀表达式的值</span></span><br><span class=\"line\"><span class=\"comment\">       $infix_expression = &quot;(255.3*2)+33.2&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">       $rpn = new Math_Rpn();</span></span><br><span class=\"line\"><span class=\"comment\"> *     echo $rpn-&gt;calculate($infix_expression,false);</span></span><br><span class=\"line\"><span class=\"comment\"> *     //若表达式中包含角的计算，若需要定义角的单位（弧度:rad,度:deg.默认的角度为rad,即弧度)</span></span><br><span class=\"line\"><span class=\"comment\"> *     $expression = &quot;(2^3)+sin(30)-(!4)+(3/4)&quot;;</span></span><br><span class=\"line\"><span class=\"comment\"> *     echo $rpn-&gt;calculate($expression,false,&#x27;deg&#x27;);</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span>   Maciej Szczytowski &lt;admin<span class=\"doctag\">@e</span>-rower.pl&gt;  kelite 修改 2013-2-23</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@version</span>  1.1.1</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@package</span>  math</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@access</span>   public</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Math_Rpn</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Input expression</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span>    string</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$_input</span> = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Array with input expression</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span>    array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$_input_array</span> = <span class=\"keyword\">array</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Array with output expression in RPN</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span>    array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$_output</span> = <span class=\"keyword\">array</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Temporary stack</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span>    array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$_stack</span> = <span class=\"keyword\">array</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Value of expression</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span>    float</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$_value</span> = <span class=\"number\">0.0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Angle&#x27;s unit: rad - true, deg - false</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span>    boolean</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$_angle</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * PEAR Error</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span>    object PEAR</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$_error</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Timer</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span>    float</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$_timer</span> = <span class=\"number\">0.0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Array of operators whit priority and math function</span></span><br><span class=\"line\"><span class=\"comment\">     * operator =&gt; (name, priority, number of arguments, function)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span>    array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$_operation</span> = <span class=\"keyword\">array</span> (</span><br><span class=\"line\">        <span class=\"string\">&#x27;(&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;left bracket&#x27;</span>, <span class=\"number\">0</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;)&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;right bracket&#x27;</span>, <span class=\"number\">1</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;+&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;sum&#x27;</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"string\">&#x27;_sum&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;-&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;difference&#x27;</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"string\">&#x27;_difference&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;*&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;multiplication&#x27;</span>, <span class=\"number\">2</span>, <span class=\"number\">2</span>, <span class=\"string\">&#x27;_multiplication&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;/&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;division&#x27;</span>, <span class=\"number\">2</span>, <span class=\"number\">2</span>, <span class=\"string\">&#x27;_division&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;r&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;root&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">2</span>, <span class=\"string\">&#x27;_root&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;^&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;power&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">2</span>, <span class=\"string\">&#x27;_power&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;sin&#x27;</span>  =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;sine&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_sin&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;cos&#x27;</span>  =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;cosine&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_cos&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;tan&#x27;</span>  =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;tangent&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_tan&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;asin&#x27;</span> =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;asine&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_asin&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;acos&#x27;</span> =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;acosine&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_acos&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;atan&#x27;</span> =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;atangent&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_atan&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;sqrt&#x27;</span> =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;square root&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_sqrt&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;exp&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;power of e&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_exp&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;log&#x27;</span>  =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;logarithm&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_log&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;ln&#x27;</span>   =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;natural logarithm&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_ln&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;E&#x27;</span>  =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;power of 10&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_E&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;abs&#x27;</span>  =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;absolute value&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_abs&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;!&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;factorial&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"string\">&#x27;_factorial&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;pi&#x27;</span>   =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;value of pi&#x27;</span>, <span class=\"number\">4</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;_const_pi&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;e&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;value of e&#x27;</span>, <span class=\"number\">4</span>, <span class=\"number\">0</span>, <span class=\"string\">&#x27;_const_e&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;mod&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;modulo&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">2</span>, <span class=\"string\">&#x27;_mod&#x27;</span>),</span><br><span class=\"line\">        <span class=\"string\">&#x27;div&#x27;</span>    =&gt; <span class=\"keyword\">array</span> (<span class=\"string\">&#x27;integer division&#x27;</span>, <span class=\"number\">3</span>, <span class=\"number\">2</span>, <span class=\"string\">&#x27;_div&#x27;</span>),</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Return a PEAR error</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> object PEAR error</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_raiseError</span> (<span class=\"params\"><span class=\"variable\">$error</span></span>) </span>&#123;</span><br><span class=\"line\">       <span class=\"comment\">// return PEAR::raiseError($error);</span></span><br><span class=\"line\">       <span class=\"keyword\">return</span> (<span class=\"variable\">$error</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Return a operator&#x27;s array</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> array Array with operator&#x27;s name, priority, arguments, function&#x27;s name and syntax</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> public</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getOperators</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$return</span> = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(<span class=\"keyword\">list</span>(<span class=\"variable\">$key</span>, <span class=\"variable\">$val</span>) = <span class=\"title function_ invoke__\">each</span>(<span class=\"variable\">$this</span>-&gt;_operation)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">array_key_exists</span> (<span class=\"number\">2</span>, <span class=\"variable\">$val</span>) &amp;&amp; <span class=\"variable\">$val</span>[<span class=\"number\">2</span>] == <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">                <span class=\"variable\">$syntax</span> = <span class=\"string\">&#x27;A &#x27;</span> . <span class=\"variable\">$key</span> . <span class=\"string\">&#x27; B&#x27;</span>;</span><br><span class=\"line\">                <span class=\"variable\">$arguments</span> = <span class=\"number\">2</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">elseif</span> (<span class=\"title function_ invoke__\">array_key_exists</span> (<span class=\"number\">2</span>, <span class=\"variable\">$val</span>) &amp;&amp; <span class=\"variable\">$val</span>[<span class=\"number\">2</span>] == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                <span class=\"variable\">$syntax</span> = <span class=\"variable\">$key</span> . <span class=\"string\">&#x27; A&#x27;</span>;</span><br><span class=\"line\">                <span class=\"variable\">$arguments</span> = <span class=\"number\">1</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"variable\">$syntax</span> = <span class=\"variable\">$key</span>;</span><br><span class=\"line\">                <span class=\"variable\">$arguments</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">array_key_exists</span> (<span class=\"number\">3</span>, <span class=\"variable\">$val</span>)) <span class=\"variable\">$function</span> = <span class=\"variable\">$val</span>[<span class=\"number\">3</span>]; <span class=\"keyword\">else</span> <span class=\"variable\">$function</span> = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable\">$return</span>[] = <span class=\"keyword\">array</span> (</span><br><span class=\"line\">                <span class=\"string\">&#x27;operator&#x27;</span> =&gt; <span class=\"variable\">$key</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;name&#x27;</span> =&gt; <span class=\"variable\">$val</span>[<span class=\"number\">0</span>],</span><br><span class=\"line\">                <span class=\"string\">&#x27;priority&#x27;</span> =&gt; <span class=\"variable\">$val</span>[<span class=\"number\">1</span>],</span><br><span class=\"line\">                <span class=\"string\">&#x27;arguments&#x27;</span> =&gt; <span class=\"variable\">$arguments</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;function&#x27;</span> =&gt; <span class=\"variable\">$function</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;syntax&#x27;</span> =&gt; <span class=\"variable\">$syntax</span></span><br><span class=\"line\">            );</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Add new operator</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $operator New operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $function Function name</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $priority New operator&#x27;s priority</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $no_of_arg Number of function&#x27;s arguments</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $text New operator&#x27;s description</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> public</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addOperator</span> (<span class=\"params\"><span class=\"variable\">$operator</span>, <span class=\"variable\">$function_name</span>, <span class=\"variable\">$priority</span> = <span class=\"number\">3</span>, <span class=\"variable\">$no_of_arg</span> = <span class=\"number\">0</span>, <span class=\"variable\">$text</span> = <span class=\"string\">&#x27;&#x27;</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">preg_match</span>(<span class=\"string\">&quot;/^([\\W\\w]+)\\:\\:([\\W\\w]+)$/&quot;</span>,<span class=\"variable\">$function_name</span>,<span class=\"variable\">$match</span>)) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$class</span> = <span class=\"variable\">$match</span>[<span class=\"number\">1</span>];</span><br><span class=\"line\">            <span class=\"variable\">$method</span> = <span class=\"variable\">$match</span>[<span class=\"number\">2</span>];</span><br><span class=\"line\">            <span class=\"variable\">$function</span> = <span class=\"keyword\">array</span> (</span><br><span class=\"line\">               <span class=\"string\">&#x27;type&#x27;</span> =&gt; <span class=\"string\">&#x27;userMethod&#x27;</span>,</span><br><span class=\"line\">               <span class=\"string\">&#x27;class&#x27;</span> =&gt; <span class=\"variable\">$class</span>,</span><br><span class=\"line\">               <span class=\"string\">&#x27;method&#x27;</span> =&gt; <span class=\"variable\">$method</span></span><br><span class=\"line\">            );</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"variable\">$function</span> = <span class=\"keyword\">array</span> (</span><br><span class=\"line\">               <span class=\"string\">&#x27;type&#x27;</span> =&gt; <span class=\"string\">&#x27;userFunction&#x27;</span>,</span><br><span class=\"line\">               <span class=\"string\">&#x27;function&#x27;</span> =&gt; <span class=\"variable\">$function_name</span></span><br><span class=\"line\">            );</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;_operation[<span class=\"variable\">$operator</span>] = <span class=\"keyword\">array</span> (<span class=\"variable\">$text</span>, <span class=\"variable\">$priority</span>, <span class=\"variable\">$no_of_arg</span>, <span class=\"variable\">$function</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Calculate the $input expression</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> mixed $input Infix expression string or RPN expression string 中缀表达式或逆波兰式</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $angle Angle&#x27;s unit - &#x27;rad&#x27; or &#x27;deg&#x27;  角的单位 rad表弧度，deg表示度</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> boolean $is_rpn True if $input is RPN expression or false if $input is infix expression   </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed Value of $input expression or a PEAR error</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> public</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">calculate</span>(<span class=\"params\"><span class=\"variable\">$input</span> = <span class=\"string\">&#x27;&#x27;</span>,<span class=\"variable\">$is_rpn</span> = <span class=\"literal\">true</span>,<span class=\"variable\">$angle</span> = <span class=\"string\">&#x27;rad&#x27;</span></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;_angle = (<span class=\"keyword\">boolean</span>) (<span class=\"variable\">$angle</span> == <span class=\"string\">&#x27;rad&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"variable\">$input</span> == <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;_error = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_raiseError</span>(<span class=\"string\">&#x27;Empty input expression&#x27;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_error;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!<span class=\"variable\">$is_rpn</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;_input = <span class=\"variable\">$input</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stringToArray</span> ();</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"variable language_\">$this</span>-&gt;_error &lt;&gt; <span class=\"literal\">null</span>) <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_error;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_arrayToRpn</span>();</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"variable language_\">$this</span>-&gt;_error &lt;&gt; <span class=\"literal\">null</span>) <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_error;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">is_array</span>(<span class=\"variable\">$input</span>)) &#123;</span><br><span class=\"line\">                <span class=\"variable\">$input</span> = <span class=\"title function_ invoke__\">implode</span>(<span class=\"string\">&#x27; &#x27;</span>, <span class=\"variable\">$input</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;_input = <span class=\"variable\">$input</span>;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;_input_array = <span class=\"title function_ invoke__\">explode</span>(<span class=\"string\">&#x27; &#x27;</span>,<span class=\"variable\">$input</span>);</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;_output = <span class=\"title function_ invoke__\">explode</span>(<span class=\"string\">&#x27; &#x27;</span>,<span class=\"variable\">$input</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_rpnToValue</span>();</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"variable language_\">$this</span>-&gt;_error &lt;&gt; <span class=\"literal\">null</span>) <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_error;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Calculate the $input expression (alias of calculate())</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@author</span>  kelite 修改参数顺序</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> mixed $input Infix expression string or RPN expression array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $angle Angle&#x27;s unit - &#x27;rad&#x27; or &#x27;deg&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> boolean $is_rpn True if $input is RPN expression or false if $input is infix expression</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed Value of $input expression or a PEAR error</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> public</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">evaluate</span>(<span class=\"params\"><span class=\"variable\">$input</span> = <span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$angle</span> = <span class=\"string\">&#x27;rad&#x27;</span>, <span class=\"variable\">$is_rpn</span> = <span class=\"literal\">false</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//原顺序return $this-&gt; calculate($input,$angle,$is_rpn);</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt; <span class=\"title function_ invoke__\">calculate</span>(<span class=\"variable\">$input</span>,<span class=\"variable\">$is_rpn</span>,<span class=\"variable\">$angle</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Return a input array</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> array Input array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> public</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getInputArray</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_input_array;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Return a RPN array</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> array RPN array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> public</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getRpnArray</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_output;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Return a counting time in second</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Counting time in seconds</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> public</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getTimer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_timer;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Check that $key is a key of $array (conformity to php&lt;4.1.0)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $type 0 - return true if $key is $array&#x27;s key, 1 - return true if $key is $array&#x27;s key and there isn&#x27;t any occurrence of $key in another $array&#x27;s key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> boolean true when $key is a key of $array, or false</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_keyExists</span>(<span class=\"params\"><span class=\"variable\">$key</span>,<span class=\"variable\">$array</span>,<span class=\"variable\">$type</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$keys</span> = <span class=\"title function_ invoke__\">array_keys</span>(<span class=\"variable\">$array</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"variable\">$type</span> == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$count</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (<span class=\"keyword\">list</span>(<span class=\"variable\">$keys_key</span>, <span class=\"variable\">$keys_val</span>) = <span class=\"title function_ invoke__\">each</span>(<span class=\"variable\">$keys</span>)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">is_integer</span>(<span class=\"title function_ invoke__\">strpos</span>(<span class=\"variable\">$keys_val</span>, <span class=\"variable\">$key</span>)) &amp;&amp; (<span class=\"title function_ invoke__\">strpos</span>(<span class=\"variable\">$keys_val</span>, <span class=\"variable\">$key</span>)==<span class=\"number\">0</span>)) <span class=\"variable\">$count</span>++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>((<span class=\"variable\">$count</span>==<span class=\"number\">1</span>) &amp;&amp; <span class=\"title function_ invoke__\">in_array</span>(<span class=\"variable\">$key</span>,<span class=\"variable\">$keys</span>)) <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">in_array</span>(<span class=\"variable\">$key</span>,<span class=\"variable\">$keys</span>)) <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Check that $value is nan (conformity to php&lt;4.2.0)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> float $value checking value</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> boolean true when $value is nan, or false</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_isNan</span>(<span class=\"params\"><span class=\"variable\">$value</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">function_exists</span>(<span class=\"string\">&#x27;is_nan&#x27;</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">is_nan</span>(<span class=\"variable\">$value</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>((<span class=\"title function_ invoke__\">substr</span>(<span class=\"variable\">$value</span>,-<span class=\"number\">3</span>) == <span class=\"string\">&#x27;IND&#x27;</span>) || (<span class=\"title function_ invoke__\">substr</span>(<span class=\"variable\">$value</span>,-<span class=\"number\">3</span>) == <span class=\"string\">&#x27;NAN&#x27;</span>)) <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Check that $value is infinite (conformity to php&lt;4.2.0)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> float $value checking value</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> boolean true when $value is infinite, or false</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_isInfinite</span>(<span class=\"params\"><span class=\"variable\">$value</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">function_exists</span>(<span class=\"string\">&#x27;is_finite&#x27;</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> !<span class=\"title function_ invoke__\">is_finite</span>(<span class=\"variable\">$value</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">substr</span>(<span class=\"variable\">$value</span>,-<span class=\"number\">3</span>) == <span class=\"string\">&#x27;INF&#x27;</span>) <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Change input expression into array</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> array Input expression changed into array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_stringToArray</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$temp_operator</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"variable\">$temp_value</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;_input = <span class=\"title function_ invoke__\">str_replace</span>(<span class=\"string\">&quot; &quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"variable\">$this</span>-&gt;_input);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"variable\">$i</span> = <span class=\"number\">0</span>; <span class=\"variable\">$i</span> &lt; <span class=\"title function_ invoke__\">strlen</span>(<span class=\"variable\">$this</span>-&gt;_input); <span class=\"variable\">$i</span>++) &#123;</span><br><span class=\"line\"><span class=\"comment\">//             var_dump($this-&gt;_input[$i]);</span></span><br><span class=\"line\"><span class=\"comment\">//            var_dump(&#x27;temp_operator:&#x27;.$temp_operator.&#x27;,team_value:&#x27;.$temp_value.&#x27;,input:&#x27;.$this-&gt;_input[$i]);</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;_input[<span class=\"variable\">$i</span>] == <span class=\"string\">&#x27; &#x27;</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"variable\">$temp_operator</span> != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$this</span>-&gt;_input_array, <span class=\"variable\">$temp_operator</span>);</span><br><span class=\"line\">                    <span class=\"variable\">$temp_operator</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"variable\">$temp_value</span> != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$this</span>-&gt;_input_array, <span class=\"variable\">$temp_value</span>);</span><br><span class=\"line\">                    <span class=\"variable\">$temp_value</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">elseif</span> ((<span class=\"variable\">$temp_value</span> == <span class=\"literal\">null</span>) &amp;&amp; <span class=\"variable\">$temp_operator</span> != <span class=\"string\">&#x27;)&#x27;</span> &amp;&amp; (!<span class=\"title function_ invoke__\">array_key_exists</span>(<span class=\"variable\">$temp_operator</span>,<span class=\"variable\">$this</span>-&gt;_operation) || !<span class=\"title function_ invoke__\">array_key_exists</span>(<span class=\"number\">2</span>,<span class=\"variable\">$this</span>-&gt;_operation[<span class=\"variable\">$temp_operator</span>]) || <span class=\"variable language_\">$this</span>-&gt;_operation[<span class=\"variable\">$temp_operator</span>][<span class=\"number\">2</span>]&gt;<span class=\"number\">0</span>) &amp;&amp; (<span class=\"variable language_\">$this</span>-&gt;_input[<span class=\"variable\">$i</span>] == <span class=\"string\">&#x27;-&#x27;</span>)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"variable\">$temp_operator</span> != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$this</span>-&gt;_input_array, <span class=\"variable\">$temp_operator</span>);</span><br><span class=\"line\">                    <span class=\"variable\">$temp_operator</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$this</span>-&gt;_input_array, <span class=\"string\">&#x27;-1&#x27;</span>);</span><br><span class=\"line\">                <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$this</span>-&gt;_input_array, <span class=\"string\">&#x27;*&#x27;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">elseif</span> ((<span class=\"title function_ invoke__\">is_numeric</span>(<span class=\"variable\">$this</span>-&gt;_input[<span class=\"variable\">$i</span>])) || (<span class=\"variable language_\">$this</span>-&gt;_input[<span class=\"variable\">$i</span>] == <span class=\"string\">&#x27;.&#x27;</span>)) &#123;</span><br><span class=\"line\"><span class=\"comment\">//            &#125; elseif ((is_numeric($this-&gt;_input[$i])) || ($this-&gt;_input[$i] == &#x27;.&#x27;) || ($this-&gt;_input[$i] == &#x27;A&#x27;)) &#123;</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"variable\">$temp_operator</span> != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$this</span>-&gt;_input_array, <span class=\"variable\">$temp_operator</span>);</span><br><span class=\"line\">                    <span class=\"variable\">$temp_operator</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"variable\">$temp_value</span> .= <span class=\"variable language_\">$this</span>-&gt;_input[<span class=\"variable\">$i</span>];</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_keyExists</span>(<span class=\"variable\">$temp_operator</span>, <span class=\"variable\">$this</span>-&gt;_operation, <span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">                    <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$this</span>-&gt;_input_array, <span class=\"variable\">$temp_operator</span>);</span><br><span class=\"line\">                    <span class=\"variable\">$temp_operator</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"variable\">$temp_value</span> != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$this</span>-&gt;_input_array, <span class=\"variable\">$temp_value</span>);</span><br><span class=\"line\">                    <span class=\"variable\">$temp_value</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"variable\">$temp_operator</span> .= <span class=\"variable language_\">$this</span>-&gt;_input[<span class=\"variable\">$i</span>];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable\">$temp_operator</span> != <span class=\"literal\">null</span> &amp;&amp; <span class=\"variable\">$temp_operator</span> != <span class=\"string\">&#x27; &#x27;</span>) &#123;</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$this</span>-&gt;_input_array, <span class=\"variable\">$temp_operator</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">elseif</span>(<span class=\"variable\">$temp_value</span> != <span class=\"literal\">null</span> &amp;&amp; <span class=\"variable\">$temp_value</span> != <span class=\"string\">&#x27; &#x27;</span>) &#123;</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$this</span>-&gt;_input_array, <span class=\"variable\">$temp_value</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// $this-&gt;_testInput();</span></span><br><span class=\"line\"><span class=\"comment\">//        print_r($this-&gt;_expression_value);</span></span><br><span class=\"line\"><span class=\"comment\">//        print_r($this-&gt;_input_array);</span></span><br><span class=\"line\"><span class=\"comment\">//        die();</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_input_array;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_splitENstr</span>(<span class=\"params\"><span class=\"variable\">$str</span>,<span class=\"variable\">$arr</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">preg_match_all</span>(<span class=\"string\">&#x27;/([a-zA-Z_]+)/&#x27;</span>,<span class=\"variable\">$str</span>,<span class=\"variable\">$match</span>);</span><br><span class=\"line\">        <span class=\"variable\">$mat</span> = <span class=\"title function_ invoke__\">array_unique</span>(<span class=\"variable\">$match</span>[<span class=\"number\">1</span>]);</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"variable\">$mat</span> <span class=\"keyword\">as</span> <span class=\"variable\">$v</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$str</span> = <span class=\"title function_ invoke__\">str_replace</span>(<span class=\"variable\">$v</span>,<span class=\"variable\">$arr</span>[<span class=\"variable\">$v</span>],<span class=\"variable\">$str</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$str</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Check input array and return correct array or a PEAR Error</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> object Null or a PEAR Error</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_testInput</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$this</span>-&gt;_input_array)) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;_input_array = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;_error = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_raiseError</span>(<span class=\"string\">&#x27;Undefined input array&#x27;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_error;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$bracket</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"variable\">$i</span> = <span class=\"number\">0</span>; <span class=\"variable\">$i</span> &lt; <span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$this</span>-&gt;_input_array); <span class=\"variable\">$i</span>++) <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;_input_array[<span class=\"variable\">$i</span>] == <span class=\"string\">&#x27;(&#x27;</span>) <span class=\"variable\">$bracket</span>++;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"variable\">$i</span> = <span class=\"number\">0</span>; <span class=\"variable\">$i</span> &lt; <span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$this</span>-&gt;_input_array); <span class=\"variable\">$i</span>++) <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;_input_array[<span class=\"variable\">$i</span>] == <span class=\"string\">&#x27;)&#x27;</span>) <span class=\"variable\">$bracket</span>--;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable\">$bracket</span> &lt;&gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_input_array = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_error = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_raiseError</span>(<span class=\"string\">&#x27;Syntax error&#x27;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_error;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"variable\">$i</span> = <span class=\"number\">0</span>; <span class=\"variable\">$i</span> &lt; <span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$this</span>-&gt;_input_array); <span class=\"variable\">$i</span>++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((!<span class=\"title function_ invoke__\">is_numeric</span>(<span class=\"variable\">$this</span>-&gt;_input_array[<span class=\"variable\">$i</span>])) &amp;&amp; (!<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_keyExists</span>(<span class=\"variable\">$this</span>-&gt;_input_array[<span class=\"variable\">$i</span>], <span class=\"variable\">$this</span>-&gt;_operation, <span class=\"number\">0</span>))) &#123;</span><br><span class=\"line\">                <span class=\"variable\">$error_operator</span> = <span class=\"variable language_\">$this</span>-&gt;_input_array[<span class=\"variable\">$i</span>];</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_input_array = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_error = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_raiseError</span>(<span class=\"string\">&#x27;Undefined operator \\&#x27;&#x27;</span>. <span class=\"variable\">$error_operator</span>.<span class=\"string\">&#x27;\\&#x27;&#x27;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_error;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;_error = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_error;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Add value to the end of stack</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $value Value to add into stack</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_stackAdd</span>(<span class=\"params\"><span class=\"variable\">$value</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$this</span>-&gt;_stack, <span class=\"variable\">$value</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Delete and return value from the end of stack</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string Value deleted from stack</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_stackDelete</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">array_pop</span>(<span class=\"variable\">$this</span>-&gt;_stack);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Return priority of value</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $value Value to get priority</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> integer Priority</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_priority</span>(<span class=\"params\"><span class=\"variable\">$value</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_operation[<span class=\"variable\">$value</span>][<span class=\"number\">1</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Return priority of value from the end of stack</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> integer Priority of operator from stack&#x27;s top</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_stackPriority</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$value</span> = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackDelete</span>();</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackAdd</span>(<span class=\"variable\">$value</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_priority</span>(<span class=\"variable\">$value</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Return true whene the stack is empty</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> boolean Stack is empty (true) or not (false)</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_stackEmpty</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$this</span>-&gt;_stack)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Add value into output array</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $value Value to add into output array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_outputAdd</span>(<span class=\"params\"><span class=\"variable\">$value</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable\">$value</span>&lt;&gt;<span class=\"string\">&#x27;(&#x27;</span>) &#123;</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$this</span>-&gt;_output, <span class=\"variable\">$value</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Change input array into RPN array</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> array Array with RPN expression</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_arrayToRpn</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;_error &lt;&gt; <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;_output = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_output;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"variable\">$i</span> = <span class=\"number\">0</span>; <span class=\"variable\">$i</span> &lt; <span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$this</span>-&gt;_input_array); <span class=\"variable\">$i</span>++) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable\">$temp</span> = <span class=\"variable language_\">$this</span>-&gt;_input_array[<span class=\"variable\">$i</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">is_numeric</span>(<span class=\"variable\">$temp</span>)) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_outputAdd</span>(<span class=\"variable\">$temp</span>);</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"variable\">$temp</span> == <span class=\"string\">&#x27;)&#x27;</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">while</span>(!<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackEmpty</span>() &amp;&amp; (<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackPriority</span>() &gt;= <span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">                        <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_outputAdd</span>(<span class=\"variable\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackDelete</span>());</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (!<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackEmpty</span>()) &#123;</span><br><span class=\"line\">                        <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackDelete</span>();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                &#125; <span class=\"keyword\">elseif</span> (<span class=\"variable\">$temp</span>==<span class=\"string\">&#x27;(&#x27;</span>) &#123;</span><br><span class=\"line\">                    <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackAdd</span>(<span class=\"variable\">$temp</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">elseif</span> ((<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackEmpty</span>()) || ((<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_priority</span>(<span class=\"variable\">$temp</span>) &gt; <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackPriority</span>()))) &#123;</span><br><span class=\"line\">                   <span class=\"variable language_\">$this</span>-&gt; <span class=\"title function_ invoke__\">_stackAdd</span>(<span class=\"variable\">$temp</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">while</span>(!<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackEmpty</span>() &amp;&amp; (<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_priority</span>(<span class=\"variable\">$temp</span>) &lt;= <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackPriority</span>())) &#123;</span><br><span class=\"line\">                        <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_outputAdd</span>(<span class=\"variable\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackDelete</span>());</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackAdd</span>(<span class=\"variable\">$temp</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span>(!<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackEmpty</span>()) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_outputAdd</span>(<span class=\"variable\">$this</span>-&gt;<span class=\"title function_ invoke__\">_stackDelete</span>());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_output;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Return position of the first operator in array</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $array Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> integer Position of the first operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_nextOperator</span>(<span class=\"params\"><span class=\"variable\">$array</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$pos</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(<span class=\"title function_ invoke__\">is_numeric</span>(<span class=\"variable\">$array</span>[<span class=\"variable\">$pos</span>])) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$pos</span>++;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"variable\">$pos</span> &gt;= <span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$array</span>)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$pos</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Delete from array operator [posision $pos] and its argument and insert new value</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of the last operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $arg Number of last operator&#x27;s arguments</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> float $result Last operation result</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> array New temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_refresh</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span>, <span class=\"variable\">$arg</span>, <span class=\"variable\">$result</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$temp1</span> = <span class=\"title function_ invoke__\">array_slice</span>(<span class=\"variable\">$temp</span>, <span class=\"number\">0</span>, <span class=\"variable\">$pos</span>-<span class=\"variable\">$arg</span>);</span><br><span class=\"line\">        <span class=\"variable\">$temp1</span>[] = <span class=\"variable\">$result</span>;</span><br><span class=\"line\">        <span class=\"variable\">$temp2</span> = <span class=\"title function_ invoke__\">array_slice</span>(<span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span>+<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">array_merge</span>(<span class=\"variable\">$temp1</span>, <span class=\"variable\">$temp2</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_sum</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">2</span>]+<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_difference</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">2</span>]-<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_multiplication</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">2</span>]*<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_division</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]==<span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;_error = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_raiseError</span>(<span class=\"string\">&#x27;Division by 0&#x27;</span>);</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;_value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_value;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">2</span>]/<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_root</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">pow</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>], (<span class=\"number\">1</span>/<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">2</span>]));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_power</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">pow</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">2</span>], <span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_sin</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;_angle) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$angle</span> = <span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>];</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"variable\">$angle</span> = <span class=\"title function_ invoke__\">deg2rad</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">sin</span>(<span class=\"variable\">$angle</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_cos</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;_angle) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$angle</span> = <span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>];</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"variable\">$angle</span> = <span class=\"title function_ invoke__\">deg2rad</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">cos</span>(<span class=\"variable\">$angle</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_tan</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;_angle) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$angle</span> = <span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>];</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"variable\">$angle</span> = <span class=\"title function_ invoke__\">deg2rad</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">tan</span>(<span class=\"variable\">$angle</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_asin</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$angle</span> = <span class=\"title function_ invoke__\">asin</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"variable language_\">$this</span>-&gt;_angle) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$angle</span> = <span class=\"title function_ invoke__\">rad2deg</span>(<span class=\"variable\">$angle</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$angle</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_acos</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$angle</span> = <span class=\"title function_ invoke__\">acos</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"variable language_\">$this</span>-&gt;_angle) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$angle</span> = <span class=\"title function_ invoke__\">rad2deg</span>(<span class=\"variable\">$angle</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$angle</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_atan</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$angle</span> = <span class=\"title function_ invoke__\">atan</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"variable language_\">$this</span>-&gt;_angle) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$angle</span> = <span class=\"title function_ invoke__\">rad2deg</span>(<span class=\"variable\">$angle</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$angle</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_sqrt</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">sqrt</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_exp</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">exp</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_log</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">log10</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_ln</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">log</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_const_pi</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> M_PI;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_const_e</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> M_E;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_E</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">pow</span>(<span class=\"number\">10</span>, <span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_factorial</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$factorial</span> = <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"variable\">$i</span>=<span class=\"number\">1</span>;<span class=\"variable\">$i</span>&lt;=<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>];<span class=\"variable\">$i</span>++) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$factorial</span> *= <span class=\"variable\">$i</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$factorial</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_abs</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">abs</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_mod</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">2</span>]%<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Math function</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $temp Temporary array</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> integer $pos Position of operator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Function&#x27;s relult</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_div</span>(<span class=\"params\"><span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">floor</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">2</span>]/<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Calculate RPN Expression and return value</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Result of input expression</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_rpnToValue</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$time1</span> = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_getMicroTime</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;_error &lt;&gt; <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;_value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_value;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;_value = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"variable\">$temp</span> = <span class=\"variable language_\">$this</span>-&gt;_output;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">            <span class=\"variable\">$pos</span> = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_nextOperator</span>(<span class=\"variable\">$temp</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"variable\">$pos</span> == -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_error = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_raiseError</span>(<span class=\"string\">&#x27;Syntax error&#x27;</span>);</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_value;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable\">$operator</span> = <span class=\"variable language_\">$this</span>-&gt;_operation[<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>]];</span><br><span class=\"line\">            <span class=\"variable\">$arg</span> = <span class=\"variable\">$operator</span>[<span class=\"number\">2</span>];</span><br><span class=\"line\">            <span class=\"variable\">$function</span> = <span class=\"variable\">$operator</span>[<span class=\"number\">3</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((<span class=\"variable\">$arg</span>==<span class=\"number\">2</span>) &amp;&amp; (!<span class=\"keyword\">isset</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]) || !<span class=\"title function_ invoke__\">is_numeric</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]) || !<span class=\"keyword\">isset</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">2</span>]) || !<span class=\"title function_ invoke__\">is_numeric</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">2</span>]))) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_error = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_raiseError</span>(<span class=\"string\">&#x27;Syntax error&#x27;</span>);</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_value;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">elseif</span> ((<span class=\"variable\">$arg</span>==<span class=\"number\">1</span>) &amp;&amp; (!<span class=\"keyword\">isset</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]) || !<span class=\"title function_ invoke__\">is_numeric</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]))) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_error = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_raiseError</span>(<span class=\"string\">&#x27;Syntax error&#x27;</span>);</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_value;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">is_array</span>(<span class=\"variable\">$function</span>)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span>(<span class=\"variable\">$arg</span>==<span class=\"number\">2</span>) <span class=\"variable\">$arg_array</span> = <span class=\"keyword\">array</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">2</span>],<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">                <span class=\"keyword\">elseif</span>(<span class=\"variable\">$arg</span>==<span class=\"number\">1</span>) <span class=\"variable\">$arg_array</span> = <span class=\"keyword\">array</span>(<span class=\"variable\">$temp</span>[<span class=\"variable\">$pos</span>-<span class=\"number\">1</span>]);</span><br><span class=\"line\">                <span class=\"keyword\">else</span> <span class=\"variable\">$arg_array</span> = <span class=\"keyword\">array</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span>(<span class=\"variable\">$function</span>[<span class=\"string\">&#x27;type&#x27;</span>] == <span class=\"string\">&#x27;userFunction&#x27;</span>) &#123;</span><br><span class=\"line\">                    <span class=\"variable language_\">$this</span>-&gt;_value = <span class=\"title function_ invoke__\">call_user_func_array</span>(<span class=\"variable\">$function</span>[<span class=\"string\">&#x27;function&#x27;</span>], <span class=\"variable\">$arg_array</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"variable\">$function_array</span> = <span class=\"keyword\">array</span>(&amp;<span class=\"variable\">$function</span>[<span class=\"string\">&#x27;class&#x27;</span>], <span class=\"variable\">$function</span>[<span class=\"string\">&#x27;method&#x27;</span>]);</span><br><span class=\"line\">                    <span class=\"variable language_\">$this</span>-&gt;_value = <span class=\"title function_ invoke__\">call_user_func_array</span>(<span class=\"variable\">$function_array</span>, <span class=\"variable\">$arg_array</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_value = <span class=\"variable language_\">$this</span>-&gt;<span class=\"variable\">$function</span>(<span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_isNan</span>(<span class=\"variable\">$this</span>-&gt;_value)) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_error = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_raiseError</span>(<span class=\"string\">&#x27;NAN value&#x27;</span>);</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_value;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">elseif</span> (<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_isInfinite</span>(<span class=\"variable\">$this</span>-&gt;_value)) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_error = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_raiseError</span>(<span class=\"string\">&#x27;Infinite value&#x27;</span>);</span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;_value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_value;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">elseif</span> (<span class=\"title function_ invoke__\">is_null</span>(<span class=\"variable\">$this</span>-&gt;_value)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_value;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable\">$temp</span> = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_refresh</span>(<span class=\"variable\">$temp</span>, <span class=\"variable\">$pos</span>, <span class=\"variable\">$arg</span>, <span class=\"variable\">$this</span>-&gt;_value);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">while</span>(<span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$temp</span>) &gt; <span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;_value = <span class=\"variable\">$temp</span>[<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$time2</span> = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">_getMicroTime</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;_timer = <span class=\"variable\">$time2</span> - <span class=\"variable\">$time1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;_value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Return a time in second</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> float Current time in seconds</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@access</span> private</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_getMicroTime</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">list</span>(<span class=\"variable\">$usec</span>, <span class=\"variable\">$sec</span>) = <span class=\"title function_ invoke__\">explode</span>(<span class=\"string\">&quot; &quot;</span>, <span class=\"title function_ invoke__\">microtime</span>());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ((<span class=\"keyword\">float</span>)<span class=\"variable\">$usec</span> + (<span class=\"keyword\">float</span>)<span class=\"variable\">$sec</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">field 不能含有数字加减乘除</span><br><span class=\"line\"><span class=\"variable\">$rpn</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Math_Rpn</span>();</span><br><span class=\"line\"><span class=\"variable\">$infix_expression</span> = <span class=\"string\">&quot;(actual_calls*call_standard)+33.2&quot;</span>;</span><br><span class=\"line\"><span class=\"variable\">$expression_value</span> = <span class=\"keyword\">array</span>(</span><br><span class=\"line\">    <span class=\"string\">&quot;actual_calls&quot;</span>=&gt;<span class=\"string\">&#x27;20&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;call_standard&quot;</span>=&gt;<span class=\"string\">&#x27;2&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;amount&quot;</span>=&gt;<span class=\"string\">&#x27;100&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;actual_contacts&quot;</span>=&gt;<span class=\"string\">&#x27;100&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;contacts_standard&quot;</span>=&gt;<span class=\"string\">&#x27;100&#x27;</span></span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"variable\">$expression</span> = <span class=\"variable\">$rpn</span>-&gt;<span class=\"title function_ invoke__\">_splitENstr</span>(<span class=\"variable\">$infix_expression</span>,<span class=\"variable\">$expression_value</span>);</span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"variable\">$rpn</span>-&gt;<span class=\"title function_ invoke__\">calculate</span>(<span class=\"variable\">$expression</span>,<span class=\"literal\">false</span>);</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n"},{"_content":"### Redis安装\n- pecl install redis\n- nano /etc/php/7.0/mods-available/redis.ini\nextension=redis.so\nFpm 软连接\n- ln -s /etc/php/7.0/mods-available/redis.ini\n /etc/php/7.0/fpm/conf.d/20-redis.ini\nCli同样也需要\n- ln -s /etc/php/7.0/mods-available/redis.ini\n /etc/php/7.0/cli/conf.d/20-redis.ini\n- php -m 即有\n### Redis应用\n[<font color=#0099ff>转发链接地址</font>](https://www.liaotaoo.cn/358.html)  \n\n```php\n\n<?php \nnamespace app\\controller;\n \n \nuse think\\facade\\Cache;\nuse think\\facade\\Db;\n \nclass Zan\n{\n    public $redis = null;\n \n    //60*60*24/20=4320,每个点赞得到的分数。\n    public $score = 0;\n \n    //点赞增加数，或者\n    public $num = 1;\n \n \n    //init redis\n    const COMMENT_RECORD = 'comment:record';\n \n    public function __construct()\n    {\n        $this->redis = Cache::store('redis');\n//        $this->redis->connect($this->redis_host,$this->redis_port);\n//        $this->redis->auth($this->redis_pass);\n    }\n \n    /**\n     * @param int $user_id 用户id\n     * @param int $type 点击的类型 1.点like，2.点hate\n     * @param int $comment_id 文章id\n     * @return string json;\n     */\n    public function click($user_id,$type,$comment_id)\n    {\n        //判断是否需要更新数据\n        if (!$this->ifUploadList($comment_id)) {\n            return ['code'=>400,'msg'=>'文章不存在'];\n        }\n        $type == 1 ? $key = \"like\" : $key = \"hate\";\n        //判断redis是否已经缓存了该文章数据\n        //使用：分隔符对redis管理是友好的\n        //这里使用redis zset-> zscore()方法\n        $data = [];\n        if ($this->redis->zscore(\"comment:like\", $comment_id) || \n            $this->redis->zscore(\"comment:hate\", $comment_id)) {\n            //已经存在\n            //判断点的是什么\n            $rel = $this->redis->hget(self::COMMENT_RECORD, $user_id . \":\" . $comment_id);\n            //redis hash-> hget()\n            //判断以前是否点过，点的是什么？\n            switch ($rel) {\n                case '':\n                    //什么都没点过\n                    //点赞加1\n                    $this->redis->zincrby(\"comment:\".$key, $this->num, $comment_id);\n                    //记录上次操作\n                    $this->redis->hset(self::COMMENT_RECORD, $user_id . \":\" . $comment_id, $type);\n \n                    $data = [\"code\" => 1,\"msg\" => $key.\"+1\"];\n                    break;\n                case $type:\n                    //点过赞了\n                    //点赞减1\n                    $this->redis->zincrby(\"comment:\".$key, -($this->num), $comment_id);\n                    //删除记录\n                    $this->redis->hDel(self::COMMENT_RECORD, $user_id . \":\" . $comment_id, $type);\n                    //删除缓存 数据库再-1\n                    $data = [\"code\" => 2,\"msg\" => $key.\"-1\"];\n                    break;\n                case $type == 1 ? 2 : 1:\n                    //点赞加1\n                    $this->redis->zincrby(\"comment:\".$key, $this->num, $comment_id);\n                    //记录上次操作\n                    $this->redis->hset(self::COMMENT_RECORD, $user_id . \":\" . $comment_id, $type);\n                    $data = [\"code\" => 1,\"msg\" => $key.\"+1\"];\n                    break;\n \n            }\n        } else {\n            //未存在\n            //点赞加一\n            $this->redis->zincrby(\"comment:\".$key, $this->num, $comment_id);\n            $data = [\"code\" => 1,\"msg\" => $key.\"+1\"];\n            //记录\n            $this->redis->hset(self::COMMENT_RECORD, $user_id . \":\" . $comment_id, $type);\n        }\n        $list = $this->redis->zRange(\"comment:like\",0,-1,1);\n        foreach ($list as $k =>$v){if ($k==$comment_id){$data['like']=$v;}}\n        return $data;\n    }\n \n    /**\n     * 获取文章点赞数\n     * @param $cid\n     * @return mixed\n     */\n    public function getVodZanNum($cid)\n    {\n        $data = $this->redis->zRange(\"comment:like\",0,-1,'WITHSCORES');\n        if(empty($data)){\n            $this->redis->zincrby(\"comment:like\", $this->num, $cid);\n            $data = Db::name('user_info_0')->where('id',$cid)->value('comic_id');\n        }\n        return $data;\n    }\n \n    /**\n     * 点赞\n     * @param $uid\n     * @param $cid\n     * @param int $type\n     * @return bool\n     */\n    public function uidZan($uid,$cid)\n    {\n        $bool = $this->redis->sismember('zan'.$uid,$cid);\n        if(!$bool){\n            $this->redis->sadd('zan'.$uid,$cid);\n            return true;\n        }else{\n            $this->redis->spop('zan'.$uid);\n            return false;\n        }\n    }\n \n    /**\n     * 判断是否点过赞\n     * @param $uid\n     * @param $cid\n     * @return bool\n     */\n    public function checkZan($uid,$cid)\n    {\n        $bool = $this->redis->sismember('zan'.$uid,$cid);\n        if($bool) return true;\n        return false;\n    }\n \n    /**\n     * 取消点赞\n     * @param $uid\n     * @return bool\n     */\n    public function delZan($uid)\n    {\n        $this->redis->spop('zan'.$uid);\n        return false;\n    }\n \n    /**\n     * 判断文章是否存在\n     * @param $comment_id\n     * @return string\n     */\n    public function ifUploadList($comment_id)\n    {\n        date_default_timezone_set(\"Asia/Shanghai\");\n        $time = strtotime(date('Y-m-d H:i:s'));\n        if(!$this->redis->sismember(\"comment:uploadset\",$comment_id))\n        {\n            //文章不存在集合里，需要更新\n            $this->redis->sadd(\"comment:uploadset\",$comment_id);\n            //更新到队列\n            $data = [\"id\" => $comment_id,\"time\" => $time];\n            $json = json_encode($data);\n            $this->redis->lpush(\"comment:uploadlist\",$json);\n            return true;\n        }\n        return true;\n    }\n \n    public function dell(){\n        $this->redis->flushAll();\n    }\n \n}\n```\n#### 调用\n```php\n$user_id = $_GET['uid'] ??25;\n$comment_id= $_GET['cid'] ?? 1;\n$like = 'like';\nif (isset($like))\n    $type = 1;\nif ($user_id && $comment_id){\n    $good = new Zan();\n    $rel = $good->click($user_id,$type,$comment_id);\n    if($rel['code'] == 1 || $rel['code'] == 7){\n \n        Db::name('user_info_0')->where('id',$comment_id)->inc('comic_id')->update();\n        echo '点赞成功';exit;\n    }else{\n        $where[] = ['id','=',$comment_id];\n        $where[] = ['comic_id','>',0];\n        Db::name('user_info_0')->where($where)->dec('comic_id')->update();\n        $good->delZan($user_id);\n        echo '取消点赞成功';\n    }\n \n}else{\n    echo '用户ID和文章id不能为空';\n}\n```\n","source":"_posts/REDIS/REDIS安装及应用.md","raw":"---\ncategories:\n  - REDIS\n---\n### Redis安装\n- pecl install redis\n- nano /etc/php/7.0/mods-available/redis.ini\nextension=redis.so\nFpm 软连接\n- ln -s /etc/php/7.0/mods-available/redis.ini\n /etc/php/7.0/fpm/conf.d/20-redis.ini\nCli同样也需要\n- ln -s /etc/php/7.0/mods-available/redis.ini\n /etc/php/7.0/cli/conf.d/20-redis.ini\n- php -m 即有\n### Redis应用\n[<font color=#0099ff>转发链接地址</font>](https://www.liaotaoo.cn/358.html)  \n\n```php\n\n<?php \nnamespace app\\controller;\n \n \nuse think\\facade\\Cache;\nuse think\\facade\\Db;\n \nclass Zan\n{\n    public $redis = null;\n \n    //60*60*24/20=4320,每个点赞得到的分数。\n    public $score = 0;\n \n    //点赞增加数，或者\n    public $num = 1;\n \n \n    //init redis\n    const COMMENT_RECORD = 'comment:record';\n \n    public function __construct()\n    {\n        $this->redis = Cache::store('redis');\n//        $this->redis->connect($this->redis_host,$this->redis_port);\n//        $this->redis->auth($this->redis_pass);\n    }\n \n    /**\n     * @param int $user_id 用户id\n     * @param int $type 点击的类型 1.点like，2.点hate\n     * @param int $comment_id 文章id\n     * @return string json;\n     */\n    public function click($user_id,$type,$comment_id)\n    {\n        //判断是否需要更新数据\n        if (!$this->ifUploadList($comment_id)) {\n            return ['code'=>400,'msg'=>'文章不存在'];\n        }\n        $type == 1 ? $key = \"like\" : $key = \"hate\";\n        //判断redis是否已经缓存了该文章数据\n        //使用：分隔符对redis管理是友好的\n        //这里使用redis zset-> zscore()方法\n        $data = [];\n        if ($this->redis->zscore(\"comment:like\", $comment_id) || \n            $this->redis->zscore(\"comment:hate\", $comment_id)) {\n            //已经存在\n            //判断点的是什么\n            $rel = $this->redis->hget(self::COMMENT_RECORD, $user_id . \":\" . $comment_id);\n            //redis hash-> hget()\n            //判断以前是否点过，点的是什么？\n            switch ($rel) {\n                case '':\n                    //什么都没点过\n                    //点赞加1\n                    $this->redis->zincrby(\"comment:\".$key, $this->num, $comment_id);\n                    //记录上次操作\n                    $this->redis->hset(self::COMMENT_RECORD, $user_id . \":\" . $comment_id, $type);\n \n                    $data = [\"code\" => 1,\"msg\" => $key.\"+1\"];\n                    break;\n                case $type:\n                    //点过赞了\n                    //点赞减1\n                    $this->redis->zincrby(\"comment:\".$key, -($this->num), $comment_id);\n                    //删除记录\n                    $this->redis->hDel(self::COMMENT_RECORD, $user_id . \":\" . $comment_id, $type);\n                    //删除缓存 数据库再-1\n                    $data = [\"code\" => 2,\"msg\" => $key.\"-1\"];\n                    break;\n                case $type == 1 ? 2 : 1:\n                    //点赞加1\n                    $this->redis->zincrby(\"comment:\".$key, $this->num, $comment_id);\n                    //记录上次操作\n                    $this->redis->hset(self::COMMENT_RECORD, $user_id . \":\" . $comment_id, $type);\n                    $data = [\"code\" => 1,\"msg\" => $key.\"+1\"];\n                    break;\n \n            }\n        } else {\n            //未存在\n            //点赞加一\n            $this->redis->zincrby(\"comment:\".$key, $this->num, $comment_id);\n            $data = [\"code\" => 1,\"msg\" => $key.\"+1\"];\n            //记录\n            $this->redis->hset(self::COMMENT_RECORD, $user_id . \":\" . $comment_id, $type);\n        }\n        $list = $this->redis->zRange(\"comment:like\",0,-1,1);\n        foreach ($list as $k =>$v){if ($k==$comment_id){$data['like']=$v;}}\n        return $data;\n    }\n \n    /**\n     * 获取文章点赞数\n     * @param $cid\n     * @return mixed\n     */\n    public function getVodZanNum($cid)\n    {\n        $data = $this->redis->zRange(\"comment:like\",0,-1,'WITHSCORES');\n        if(empty($data)){\n            $this->redis->zincrby(\"comment:like\", $this->num, $cid);\n            $data = Db::name('user_info_0')->where('id',$cid)->value('comic_id');\n        }\n        return $data;\n    }\n \n    /**\n     * 点赞\n     * @param $uid\n     * @param $cid\n     * @param int $type\n     * @return bool\n     */\n    public function uidZan($uid,$cid)\n    {\n        $bool = $this->redis->sismember('zan'.$uid,$cid);\n        if(!$bool){\n            $this->redis->sadd('zan'.$uid,$cid);\n            return true;\n        }else{\n            $this->redis->spop('zan'.$uid);\n            return false;\n        }\n    }\n \n    /**\n     * 判断是否点过赞\n     * @param $uid\n     * @param $cid\n     * @return bool\n     */\n    public function checkZan($uid,$cid)\n    {\n        $bool = $this->redis->sismember('zan'.$uid,$cid);\n        if($bool) return true;\n        return false;\n    }\n \n    /**\n     * 取消点赞\n     * @param $uid\n     * @return bool\n     */\n    public function delZan($uid)\n    {\n        $this->redis->spop('zan'.$uid);\n        return false;\n    }\n \n    /**\n     * 判断文章是否存在\n     * @param $comment_id\n     * @return string\n     */\n    public function ifUploadList($comment_id)\n    {\n        date_default_timezone_set(\"Asia/Shanghai\");\n        $time = strtotime(date('Y-m-d H:i:s'));\n        if(!$this->redis->sismember(\"comment:uploadset\",$comment_id))\n        {\n            //文章不存在集合里，需要更新\n            $this->redis->sadd(\"comment:uploadset\",$comment_id);\n            //更新到队列\n            $data = [\"id\" => $comment_id,\"time\" => $time];\n            $json = json_encode($data);\n            $this->redis->lpush(\"comment:uploadlist\",$json);\n            return true;\n        }\n        return true;\n    }\n \n    public function dell(){\n        $this->redis->flushAll();\n    }\n \n}\n```\n#### 调用\n```php\n$user_id = $_GET['uid'] ??25;\n$comment_id= $_GET['cid'] ?? 1;\n$like = 'like';\nif (isset($like))\n    $type = 1;\nif ($user_id && $comment_id){\n    $good = new Zan();\n    $rel = $good->click($user_id,$type,$comment_id);\n    if($rel['code'] == 1 || $rel['code'] == 7){\n \n        Db::name('user_info_0')->where('id',$comment_id)->inc('comic_id')->update();\n        echo '点赞成功';exit;\n    }else{\n        $where[] = ['id','=',$comment_id];\n        $where[] = ['comic_id','>',0];\n        Db::name('user_info_0')->where($where)->dec('comic_id')->update();\n        $good->delZan($user_id);\n        echo '取消点赞成功';\n    }\n \n}else{\n    echo '用户ID和文章id不能为空';\n}\n```\n","slug":"REDIS安装及应用","published":1,"category":"REDIS","date":"2023-06-08T23:03:56.102Z","updated":"2023-06-08T23:12:13.739Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5seh001edxjccj379u6n","content":"<h3 id=\"Redis安装\"><a href=\"#Redis安装\" class=\"headerlink\" title=\"Redis安装\"></a>Redis安装</h3><ul>\n<li>pecl install redis</li>\n<li>nano &#x2F;etc&#x2F;php&#x2F;7.0&#x2F;mods-available&#x2F;redis.ini<br>extension&#x3D;redis.so<br>Fpm 软连接</li>\n<li>ln -s &#x2F;etc&#x2F;php&#x2F;7.0&#x2F;mods-available&#x2F;redis.ini<br> &#x2F;etc&#x2F;php&#x2F;7.0&#x2F;fpm&#x2F;conf.d&#x2F;20-redis.ini<br>Cli同样也需要</li>\n<li>ln -s &#x2F;etc&#x2F;php&#x2F;7.0&#x2F;mods-available&#x2F;redis.ini<br> &#x2F;etc&#x2F;php&#x2F;7.0&#x2F;cli&#x2F;conf.d&#x2F;20-redis.ini</li>\n<li>php -m 即有</li>\n</ul>\n<h3 id=\"Redis应用\"><a href=\"#Redis应用\" class=\"headerlink\" title=\"Redis应用\"></a>Redis应用</h3><p><a href=\"https://www.liaotaoo.cn/358.html\"><font color=#0099ff>转发链接地址</font></a>  </p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title class_\">app</span>\\<span class=\"title class_\">controller</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">use</span> <span class=\"title\">think</span>\\<span class=\"title\">facade</span>\\<span class=\"title\">Cache</span>;</span><br><span class=\"line\"><span class=\"keyword\">use</span> <span class=\"title\">think</span>\\<span class=\"title\">facade</span>\\<span class=\"title\">Db</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Zan</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$redis</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">//60*60*24/20=4320,每个点赞得到的分数。</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$score</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">//点赞增加数，或者</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$num</span> = <span class=\"number\">1</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">//init redis</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"variable constant_\">COMMENT_RECORD</span> = <span class=\"string\">&#x27;comment:record&#x27;</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;redis = <span class=\"title class_\">Cache</span>::<span class=\"title function_ invoke__\">store</span>(<span class=\"string\">&#x27;redis&#x27;</span>);</span><br><span class=\"line\"><span class=\"comment\">//        $this-&gt;redis-&gt;connect($this-&gt;redis_host,$this-&gt;redis_port);</span></span><br><span class=\"line\"><span class=\"comment\">//        $this-&gt;redis-&gt;auth($this-&gt;redis_pass);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> int $user_id 用户id</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> int $type 点击的类型 1.点like，2.点hate</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> int $comment_id 文章id</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string json;</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">click</span>(<span class=\"params\"><span class=\"variable\">$user_id</span>,<span class=\"variable\">$type</span>,<span class=\"variable\">$comment_id</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//判断是否需要更新数据</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">ifUploadList</span>(<span class=\"variable\">$comment_id</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [<span class=\"string\">&#x27;code&#x27;</span>=&gt;<span class=\"number\">400</span>,<span class=\"string\">&#x27;msg&#x27;</span>=&gt;<span class=\"string\">&#x27;文章不存在&#x27;</span>];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"variable\">$type</span> == <span class=\"number\">1</span> ? <span class=\"variable\">$key</span> = <span class=\"string\">&quot;like&quot;</span> : <span class=\"variable\">$key</span> = <span class=\"string\">&quot;hate&quot;</span>;</span><br><span class=\"line\">        <span class=\"comment\">//判断redis是否已经缓存了该文章数据</span></span><br><span class=\"line\">        <span class=\"comment\">//使用：分隔符对redis管理是友好的</span></span><br><span class=\"line\">        <span class=\"comment\">//这里使用redis zset-&gt; zscore()方法</span></span><br><span class=\"line\">        <span class=\"variable\">$data</span> = [];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">zscore</span>(<span class=\"string\">&quot;comment:like&quot;</span>, <span class=\"variable\">$comment_id</span>) || </span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">zscore</span>(<span class=\"string\">&quot;comment:hate&quot;</span>, <span class=\"variable\">$comment_id</span>)) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//已经存在</span></span><br><span class=\"line\">            <span class=\"comment\">//判断点的是什么</span></span><br><span class=\"line\">            <span class=\"variable\">$rel</span> = <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">hget</span>(<span class=\"built_in\">self</span>::<span class=\"variable constant_\">COMMENT_RECORD</span>, <span class=\"variable\">$user_id</span> . <span class=\"string\">&quot;:&quot;</span> . <span class=\"variable\">$comment_id</span>);</span><br><span class=\"line\">            <span class=\"comment\">//redis hash-&gt; hget()</span></span><br><span class=\"line\">            <span class=\"comment\">//判断以前是否点过，点的是什么？</span></span><br><span class=\"line\">            <span class=\"keyword\">switch</span> (<span class=\"variable\">$rel</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"string\">&#x27;&#x27;</span>:</span><br><span class=\"line\">                    <span class=\"comment\">//什么都没点过</span></span><br><span class=\"line\">                    <span class=\"comment\">//点赞加1</span></span><br><span class=\"line\">                    <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">zincrby</span>(<span class=\"string\">&quot;comment:&quot;</span>.<span class=\"variable\">$key</span>, <span class=\"variable\">$this</span>-&gt;num, <span class=\"variable\">$comment_id</span>);</span><br><span class=\"line\">                    <span class=\"comment\">//记录上次操作</span></span><br><span class=\"line\">                    <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">hset</span>(<span class=\"built_in\">self</span>::<span class=\"variable constant_\">COMMENT_RECORD</span>, <span class=\"variable\">$user_id</span> . <span class=\"string\">&quot;:&quot;</span> . <span class=\"variable\">$comment_id</span>, <span class=\"variable\">$type</span>);</span><br><span class=\"line\"> </span><br><span class=\"line\">                    <span class=\"variable\">$data</span> = [<span class=\"string\">&quot;code&quot;</span> =&gt; <span class=\"number\">1</span>,<span class=\"string\">&quot;msg&quot;</span> =&gt; <span class=\"variable\">$key</span>.<span class=\"string\">&quot;+1&quot;</span>];</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"variable\">$type</span>:</span><br><span class=\"line\">                    <span class=\"comment\">//点过赞了</span></span><br><span class=\"line\">                    <span class=\"comment\">//点赞减1</span></span><br><span class=\"line\">                    <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">zincrby</span>(<span class=\"string\">&quot;comment:&quot;</span>.<span class=\"variable\">$key</span>, -(<span class=\"variable\">$this</span>-&gt;num), <span class=\"variable\">$comment_id</span>);</span><br><span class=\"line\">                    <span class=\"comment\">//删除记录</span></span><br><span class=\"line\">                    <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">hDel</span>(<span class=\"built_in\">self</span>::<span class=\"variable constant_\">COMMENT_RECORD</span>, <span class=\"variable\">$user_id</span> . <span class=\"string\">&quot;:&quot;</span> . <span class=\"variable\">$comment_id</span>, <span class=\"variable\">$type</span>);</span><br><span class=\"line\">                    <span class=\"comment\">//删除缓存 数据库再-1</span></span><br><span class=\"line\">                    <span class=\"variable\">$data</span> = [<span class=\"string\">&quot;code&quot;</span> =&gt; <span class=\"number\">2</span>,<span class=\"string\">&quot;msg&quot;</span> =&gt; <span class=\"variable\">$key</span>.<span class=\"string\">&quot;-1&quot;</span>];</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"variable\">$type</span> == <span class=\"number\">1</span> ? <span class=\"number\">2</span> : <span class=\"number\">1</span>:</span><br><span class=\"line\">                    <span class=\"comment\">//点赞加1</span></span><br><span class=\"line\">                    <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">zincrby</span>(<span class=\"string\">&quot;comment:&quot;</span>.<span class=\"variable\">$key</span>, <span class=\"variable\">$this</span>-&gt;num, <span class=\"variable\">$comment_id</span>);</span><br><span class=\"line\">                    <span class=\"comment\">//记录上次操作</span></span><br><span class=\"line\">                    <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">hset</span>(<span class=\"built_in\">self</span>::<span class=\"variable constant_\">COMMENT_RECORD</span>, <span class=\"variable\">$user_id</span> . <span class=\"string\">&quot;:&quot;</span> . <span class=\"variable\">$comment_id</span>, <span class=\"variable\">$type</span>);</span><br><span class=\"line\">                    <span class=\"variable\">$data</span> = [<span class=\"string\">&quot;code&quot;</span> =&gt; <span class=\"number\">1</span>,<span class=\"string\">&quot;msg&quot;</span> =&gt; <span class=\"variable\">$key</span>.<span class=\"string\">&quot;+1&quot;</span>];</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//未存在</span></span><br><span class=\"line\">            <span class=\"comment\">//点赞加一</span></span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">zincrby</span>(<span class=\"string\">&quot;comment:&quot;</span>.<span class=\"variable\">$key</span>, <span class=\"variable\">$this</span>-&gt;num, <span class=\"variable\">$comment_id</span>);</span><br><span class=\"line\">            <span class=\"variable\">$data</span> = [<span class=\"string\">&quot;code&quot;</span> =&gt; <span class=\"number\">1</span>,<span class=\"string\">&quot;msg&quot;</span> =&gt; <span class=\"variable\">$key</span>.<span class=\"string\">&quot;+1&quot;</span>];</span><br><span class=\"line\">            <span class=\"comment\">//记录</span></span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">hset</span>(<span class=\"built_in\">self</span>::<span class=\"variable constant_\">COMMENT_RECORD</span>, <span class=\"variable\">$user_id</span> . <span class=\"string\">&quot;:&quot;</span> . <span class=\"variable\">$comment_id</span>, <span class=\"variable\">$type</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"variable\">$list</span> = <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">zRange</span>(<span class=\"string\">&quot;comment:like&quot;</span>,<span class=\"number\">0</span>,-<span class=\"number\">1</span>,<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"variable\">$list</span> <span class=\"keyword\">as</span> <span class=\"variable\">$k</span> =&gt;<span class=\"variable\">$v</span>)&#123;<span class=\"keyword\">if</span> (<span class=\"variable\">$k</span>==<span class=\"variable\">$comment_id</span>)&#123;<span class=\"variable\">$data</span>[<span class=\"string\">&#x27;like&#x27;</span>]=<span class=\"variable\">$v</span>;&#125;&#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$data</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取文章点赞数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $cid</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getVodZanNum</span>(<span class=\"params\"><span class=\"variable\">$cid</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$data</span> = <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">zRange</span>(<span class=\"string\">&quot;comment:like&quot;</span>,<span class=\"number\">0</span>,-<span class=\"number\">1</span>,<span class=\"string\">&#x27;WITHSCORES&#x27;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">empty</span>(<span class=\"variable\">$data</span>))&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">zincrby</span>(<span class=\"string\">&quot;comment:like&quot;</span>, <span class=\"variable\">$this</span>-&gt;num, <span class=\"variable\">$cid</span>);</span><br><span class=\"line\">            <span class=\"variable\">$data</span> = <span class=\"title class_\">Db</span>::<span class=\"title function_ invoke__\">name</span>(<span class=\"string\">&#x27;user_info_0&#x27;</span>)-&gt;<span class=\"title function_ invoke__\">where</span>(<span class=\"string\">&#x27;id&#x27;</span>,<span class=\"variable\">$cid</span>)-&gt;<span class=\"title function_ invoke__\">value</span>(<span class=\"string\">&#x27;comic_id&#x27;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$data</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 点赞</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $uid</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $cid</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> int $type</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> bool</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">uidZan</span>(<span class=\"params\"><span class=\"variable\">$uid</span>,<span class=\"variable\">$cid</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$bool</span> = <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">sismember</span>(<span class=\"string\">&#x27;zan&#x27;</span>.<span class=\"variable\">$uid</span>,<span class=\"variable\">$cid</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!<span class=\"variable\">$bool</span>)&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">sadd</span>(<span class=\"string\">&#x27;zan&#x27;</span>.<span class=\"variable\">$uid</span>,<span class=\"variable\">$cid</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">spop</span>(<span class=\"string\">&#x27;zan&#x27;</span>.<span class=\"variable\">$uid</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 判断是否点过赞</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $uid</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $cid</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> bool</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">checkZan</span>(<span class=\"params\"><span class=\"variable\">$uid</span>,<span class=\"variable\">$cid</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$bool</span> = <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">sismember</span>(<span class=\"string\">&#x27;zan&#x27;</span>.<span class=\"variable\">$uid</span>,<span class=\"variable\">$cid</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"variable\">$bool</span>) <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 取消点赞</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $uid</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> bool</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">delZan</span>(<span class=\"params\"><span class=\"variable\">$uid</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">spop</span>(<span class=\"string\">&#x27;zan&#x27;</span>.<span class=\"variable\">$uid</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 判断文章是否存在</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $comment_id</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ifUploadList</span>(<span class=\"params\"><span class=\"variable\">$comment_id</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">date_default_timezone_set</span>(<span class=\"string\">&quot;Asia/Shanghai&quot;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$time</span> = <span class=\"title function_ invoke__\">strtotime</span>(<span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&#x27;Y-m-d H:i:s&#x27;</span>));</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!<span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">sismember</span>(<span class=\"string\">&quot;comment:uploadset&quot;</span>,<span class=\"variable\">$comment_id</span>))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"comment\">//文章不存在集合里，需要更新</span></span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">sadd</span>(<span class=\"string\">&quot;comment:uploadset&quot;</span>,<span class=\"variable\">$comment_id</span>);</span><br><span class=\"line\">            <span class=\"comment\">//更新到队列</span></span><br><span class=\"line\">            <span class=\"variable\">$data</span> = [<span class=\"string\">&quot;id&quot;</span> =&gt; <span class=\"variable\">$comment_id</span>,<span class=\"string\">&quot;time&quot;</span> =&gt; <span class=\"variable\">$time</span>];</span><br><span class=\"line\">            <span class=\"variable\">$json</span> = <span class=\"title function_ invoke__\">json_encode</span>(<span class=\"variable\">$data</span>);</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">lpush</span>(<span class=\"string\">&quot;comment:uploadlist&quot;</span>,<span class=\"variable\">$json</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">dell</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">flushAll</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"调用\"><a href=\"#调用\" class=\"headerlink\" title=\"调用\"></a>调用</h4><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$user_id</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;uid&#x27;</span>] ??<span class=\"number\">25</span>;</span><br><span class=\"line\"><span class=\"variable\">$comment_id</span>= <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;cid&#x27;</span>] ?? <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"variable\">$like</span> = <span class=\"string\">&#x27;like&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$like</span>))</span><br><span class=\"line\">    <span class=\"variable\">$type</span> = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"variable\">$user_id</span> &amp;&amp; <span class=\"variable\">$comment_id</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable\">$good</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Zan</span>();</span><br><span class=\"line\">    <span class=\"variable\">$rel</span> = <span class=\"variable\">$good</span>-&gt;<span class=\"title function_ invoke__\">click</span>(<span class=\"variable\">$user_id</span>,<span class=\"variable\">$type</span>,<span class=\"variable\">$comment_id</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"variable\">$rel</span>[<span class=\"string\">&#x27;code&#x27;</span>] == <span class=\"number\">1</span> || <span class=\"variable\">$rel</span>[<span class=\"string\">&#x27;code&#x27;</span>] == <span class=\"number\">7</span>)&#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"title class_\">Db</span>::<span class=\"title function_ invoke__\">name</span>(<span class=\"string\">&#x27;user_info_0&#x27;</span>)-&gt;<span class=\"title function_ invoke__\">where</span>(<span class=\"string\">&#x27;id&#x27;</span>,<span class=\"variable\">$comment_id</span>)-&gt;<span class=\"title function_ invoke__\">inc</span>(<span class=\"string\">&#x27;comic_id&#x27;</span>)-&gt;<span class=\"title function_ invoke__\">update</span>();</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;点赞成功&#x27;</span>;<span class=\"keyword\">exit</span>;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$where</span>[] = [<span class=\"string\">&#x27;id&#x27;</span>,<span class=\"string\">&#x27;=&#x27;</span>,<span class=\"variable\">$comment_id</span>];</span><br><span class=\"line\">        <span class=\"variable\">$where</span>[] = [<span class=\"string\">&#x27;comic_id&#x27;</span>,<span class=\"string\">&#x27;&gt;&#x27;</span>,<span class=\"number\">0</span>];</span><br><span class=\"line\">        <span class=\"title class_\">Db</span>::<span class=\"title function_ invoke__\">name</span>(<span class=\"string\">&#x27;user_info_0&#x27;</span>)-&gt;<span class=\"title function_ invoke__\">where</span>(<span class=\"variable\">$where</span>)-&gt;<span class=\"title function_ invoke__\">dec</span>(<span class=\"string\">&#x27;comic_id&#x27;</span>)-&gt;<span class=\"title function_ invoke__\">update</span>();</span><br><span class=\"line\">        <span class=\"variable\">$good</span>-&gt;<span class=\"title function_ invoke__\">delZan</span>(<span class=\"variable\">$user_id</span>);</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;取消点赞成功&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;用户ID和文章id不能为空&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"length":5750,"excerpt":"","more":"<h3 id=\"Redis安装\"><a href=\"#Redis安装\" class=\"headerlink\" title=\"Redis安装\"></a>Redis安装</h3><ul>\n<li>pecl install redis</li>\n<li>nano &#x2F;etc&#x2F;php&#x2F;7.0&#x2F;mods-available&#x2F;redis.ini<br>extension&#x3D;redis.so<br>Fpm 软连接</li>\n<li>ln -s &#x2F;etc&#x2F;php&#x2F;7.0&#x2F;mods-available&#x2F;redis.ini<br> &#x2F;etc&#x2F;php&#x2F;7.0&#x2F;fpm&#x2F;conf.d&#x2F;20-redis.ini<br>Cli同样也需要</li>\n<li>ln -s &#x2F;etc&#x2F;php&#x2F;7.0&#x2F;mods-available&#x2F;redis.ini<br> &#x2F;etc&#x2F;php&#x2F;7.0&#x2F;cli&#x2F;conf.d&#x2F;20-redis.ini</li>\n<li>php -m 即有</li>\n</ul>\n<h3 id=\"Redis应用\"><a href=\"#Redis应用\" class=\"headerlink\" title=\"Redis应用\"></a>Redis应用</h3><p><a href=\"https://www.liaotaoo.cn/358.html\"><font color=#0099ff>转发链接地址</font></a>  </p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title class_\">app</span>\\<span class=\"title class_\">controller</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">use</span> <span class=\"title\">think</span>\\<span class=\"title\">facade</span>\\<span class=\"title\">Cache</span>;</span><br><span class=\"line\"><span class=\"keyword\">use</span> <span class=\"title\">think</span>\\<span class=\"title\">facade</span>\\<span class=\"title\">Db</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Zan</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$redis</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">//60*60*24/20=4320,每个点赞得到的分数。</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$score</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">//点赞增加数，或者</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$num</span> = <span class=\"number\">1</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">//init redis</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"variable constant_\">COMMENT_RECORD</span> = <span class=\"string\">&#x27;comment:record&#x27;</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;redis = <span class=\"title class_\">Cache</span>::<span class=\"title function_ invoke__\">store</span>(<span class=\"string\">&#x27;redis&#x27;</span>);</span><br><span class=\"line\"><span class=\"comment\">//        $this-&gt;redis-&gt;connect($this-&gt;redis_host,$this-&gt;redis_port);</span></span><br><span class=\"line\"><span class=\"comment\">//        $this-&gt;redis-&gt;auth($this-&gt;redis_pass);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> int $user_id 用户id</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> int $type 点击的类型 1.点like，2.点hate</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> int $comment_id 文章id</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string json;</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">click</span>(<span class=\"params\"><span class=\"variable\">$user_id</span>,<span class=\"variable\">$type</span>,<span class=\"variable\">$comment_id</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//判断是否需要更新数据</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">ifUploadList</span>(<span class=\"variable\">$comment_id</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [<span class=\"string\">&#x27;code&#x27;</span>=&gt;<span class=\"number\">400</span>,<span class=\"string\">&#x27;msg&#x27;</span>=&gt;<span class=\"string\">&#x27;文章不存在&#x27;</span>];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"variable\">$type</span> == <span class=\"number\">1</span> ? <span class=\"variable\">$key</span> = <span class=\"string\">&quot;like&quot;</span> : <span class=\"variable\">$key</span> = <span class=\"string\">&quot;hate&quot;</span>;</span><br><span class=\"line\">        <span class=\"comment\">//判断redis是否已经缓存了该文章数据</span></span><br><span class=\"line\">        <span class=\"comment\">//使用：分隔符对redis管理是友好的</span></span><br><span class=\"line\">        <span class=\"comment\">//这里使用redis zset-&gt; zscore()方法</span></span><br><span class=\"line\">        <span class=\"variable\">$data</span> = [];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">zscore</span>(<span class=\"string\">&quot;comment:like&quot;</span>, <span class=\"variable\">$comment_id</span>) || </span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">zscore</span>(<span class=\"string\">&quot;comment:hate&quot;</span>, <span class=\"variable\">$comment_id</span>)) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//已经存在</span></span><br><span class=\"line\">            <span class=\"comment\">//判断点的是什么</span></span><br><span class=\"line\">            <span class=\"variable\">$rel</span> = <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">hget</span>(<span class=\"built_in\">self</span>::<span class=\"variable constant_\">COMMENT_RECORD</span>, <span class=\"variable\">$user_id</span> . <span class=\"string\">&quot;:&quot;</span> . <span class=\"variable\">$comment_id</span>);</span><br><span class=\"line\">            <span class=\"comment\">//redis hash-&gt; hget()</span></span><br><span class=\"line\">            <span class=\"comment\">//判断以前是否点过，点的是什么？</span></span><br><span class=\"line\">            <span class=\"keyword\">switch</span> (<span class=\"variable\">$rel</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"string\">&#x27;&#x27;</span>:</span><br><span class=\"line\">                    <span class=\"comment\">//什么都没点过</span></span><br><span class=\"line\">                    <span class=\"comment\">//点赞加1</span></span><br><span class=\"line\">                    <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">zincrby</span>(<span class=\"string\">&quot;comment:&quot;</span>.<span class=\"variable\">$key</span>, <span class=\"variable\">$this</span>-&gt;num, <span class=\"variable\">$comment_id</span>);</span><br><span class=\"line\">                    <span class=\"comment\">//记录上次操作</span></span><br><span class=\"line\">                    <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">hset</span>(<span class=\"built_in\">self</span>::<span class=\"variable constant_\">COMMENT_RECORD</span>, <span class=\"variable\">$user_id</span> . <span class=\"string\">&quot;:&quot;</span> . <span class=\"variable\">$comment_id</span>, <span class=\"variable\">$type</span>);</span><br><span class=\"line\"> </span><br><span class=\"line\">                    <span class=\"variable\">$data</span> = [<span class=\"string\">&quot;code&quot;</span> =&gt; <span class=\"number\">1</span>,<span class=\"string\">&quot;msg&quot;</span> =&gt; <span class=\"variable\">$key</span>.<span class=\"string\">&quot;+1&quot;</span>];</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"variable\">$type</span>:</span><br><span class=\"line\">                    <span class=\"comment\">//点过赞了</span></span><br><span class=\"line\">                    <span class=\"comment\">//点赞减1</span></span><br><span class=\"line\">                    <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">zincrby</span>(<span class=\"string\">&quot;comment:&quot;</span>.<span class=\"variable\">$key</span>, -(<span class=\"variable\">$this</span>-&gt;num), <span class=\"variable\">$comment_id</span>);</span><br><span class=\"line\">                    <span class=\"comment\">//删除记录</span></span><br><span class=\"line\">                    <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">hDel</span>(<span class=\"built_in\">self</span>::<span class=\"variable constant_\">COMMENT_RECORD</span>, <span class=\"variable\">$user_id</span> . <span class=\"string\">&quot;:&quot;</span> . <span class=\"variable\">$comment_id</span>, <span class=\"variable\">$type</span>);</span><br><span class=\"line\">                    <span class=\"comment\">//删除缓存 数据库再-1</span></span><br><span class=\"line\">                    <span class=\"variable\">$data</span> = [<span class=\"string\">&quot;code&quot;</span> =&gt; <span class=\"number\">2</span>,<span class=\"string\">&quot;msg&quot;</span> =&gt; <span class=\"variable\">$key</span>.<span class=\"string\">&quot;-1&quot;</span>];</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"variable\">$type</span> == <span class=\"number\">1</span> ? <span class=\"number\">2</span> : <span class=\"number\">1</span>:</span><br><span class=\"line\">                    <span class=\"comment\">//点赞加1</span></span><br><span class=\"line\">                    <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">zincrby</span>(<span class=\"string\">&quot;comment:&quot;</span>.<span class=\"variable\">$key</span>, <span class=\"variable\">$this</span>-&gt;num, <span class=\"variable\">$comment_id</span>);</span><br><span class=\"line\">                    <span class=\"comment\">//记录上次操作</span></span><br><span class=\"line\">                    <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">hset</span>(<span class=\"built_in\">self</span>::<span class=\"variable constant_\">COMMENT_RECORD</span>, <span class=\"variable\">$user_id</span> . <span class=\"string\">&quot;:&quot;</span> . <span class=\"variable\">$comment_id</span>, <span class=\"variable\">$type</span>);</span><br><span class=\"line\">                    <span class=\"variable\">$data</span> = [<span class=\"string\">&quot;code&quot;</span> =&gt; <span class=\"number\">1</span>,<span class=\"string\">&quot;msg&quot;</span> =&gt; <span class=\"variable\">$key</span>.<span class=\"string\">&quot;+1&quot;</span>];</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//未存在</span></span><br><span class=\"line\">            <span class=\"comment\">//点赞加一</span></span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">zincrby</span>(<span class=\"string\">&quot;comment:&quot;</span>.<span class=\"variable\">$key</span>, <span class=\"variable\">$this</span>-&gt;num, <span class=\"variable\">$comment_id</span>);</span><br><span class=\"line\">            <span class=\"variable\">$data</span> = [<span class=\"string\">&quot;code&quot;</span> =&gt; <span class=\"number\">1</span>,<span class=\"string\">&quot;msg&quot;</span> =&gt; <span class=\"variable\">$key</span>.<span class=\"string\">&quot;+1&quot;</span>];</span><br><span class=\"line\">            <span class=\"comment\">//记录</span></span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">hset</span>(<span class=\"built_in\">self</span>::<span class=\"variable constant_\">COMMENT_RECORD</span>, <span class=\"variable\">$user_id</span> . <span class=\"string\">&quot;:&quot;</span> . <span class=\"variable\">$comment_id</span>, <span class=\"variable\">$type</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"variable\">$list</span> = <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">zRange</span>(<span class=\"string\">&quot;comment:like&quot;</span>,<span class=\"number\">0</span>,-<span class=\"number\">1</span>,<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"variable\">$list</span> <span class=\"keyword\">as</span> <span class=\"variable\">$k</span> =&gt;<span class=\"variable\">$v</span>)&#123;<span class=\"keyword\">if</span> (<span class=\"variable\">$k</span>==<span class=\"variable\">$comment_id</span>)&#123;<span class=\"variable\">$data</span>[<span class=\"string\">&#x27;like&#x27;</span>]=<span class=\"variable\">$v</span>;&#125;&#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$data</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取文章点赞数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $cid</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getVodZanNum</span>(<span class=\"params\"><span class=\"variable\">$cid</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$data</span> = <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">zRange</span>(<span class=\"string\">&quot;comment:like&quot;</span>,<span class=\"number\">0</span>,-<span class=\"number\">1</span>,<span class=\"string\">&#x27;WITHSCORES&#x27;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">empty</span>(<span class=\"variable\">$data</span>))&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">zincrby</span>(<span class=\"string\">&quot;comment:like&quot;</span>, <span class=\"variable\">$this</span>-&gt;num, <span class=\"variable\">$cid</span>);</span><br><span class=\"line\">            <span class=\"variable\">$data</span> = <span class=\"title class_\">Db</span>::<span class=\"title function_ invoke__\">name</span>(<span class=\"string\">&#x27;user_info_0&#x27;</span>)-&gt;<span class=\"title function_ invoke__\">where</span>(<span class=\"string\">&#x27;id&#x27;</span>,<span class=\"variable\">$cid</span>)-&gt;<span class=\"title function_ invoke__\">value</span>(<span class=\"string\">&#x27;comic_id&#x27;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$data</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 点赞</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $uid</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $cid</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> int $type</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> bool</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">uidZan</span>(<span class=\"params\"><span class=\"variable\">$uid</span>,<span class=\"variable\">$cid</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$bool</span> = <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">sismember</span>(<span class=\"string\">&#x27;zan&#x27;</span>.<span class=\"variable\">$uid</span>,<span class=\"variable\">$cid</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!<span class=\"variable\">$bool</span>)&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">sadd</span>(<span class=\"string\">&#x27;zan&#x27;</span>.<span class=\"variable\">$uid</span>,<span class=\"variable\">$cid</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">spop</span>(<span class=\"string\">&#x27;zan&#x27;</span>.<span class=\"variable\">$uid</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 判断是否点过赞</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $uid</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $cid</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> bool</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">checkZan</span>(<span class=\"params\"><span class=\"variable\">$uid</span>,<span class=\"variable\">$cid</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$bool</span> = <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">sismember</span>(<span class=\"string\">&#x27;zan&#x27;</span>.<span class=\"variable\">$uid</span>,<span class=\"variable\">$cid</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"variable\">$bool</span>) <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 取消点赞</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $uid</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> bool</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">delZan</span>(<span class=\"params\"><span class=\"variable\">$uid</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">spop</span>(<span class=\"string\">&#x27;zan&#x27;</span>.<span class=\"variable\">$uid</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 判断文章是否存在</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $comment_id</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ifUploadList</span>(<span class=\"params\"><span class=\"variable\">$comment_id</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">date_default_timezone_set</span>(<span class=\"string\">&quot;Asia/Shanghai&quot;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$time</span> = <span class=\"title function_ invoke__\">strtotime</span>(<span class=\"title function_ invoke__\">date</span>(<span class=\"string\">&#x27;Y-m-d H:i:s&#x27;</span>));</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!<span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">sismember</span>(<span class=\"string\">&quot;comment:uploadset&quot;</span>,<span class=\"variable\">$comment_id</span>))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"comment\">//文章不存在集合里，需要更新</span></span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">sadd</span>(<span class=\"string\">&quot;comment:uploadset&quot;</span>,<span class=\"variable\">$comment_id</span>);</span><br><span class=\"line\">            <span class=\"comment\">//更新到队列</span></span><br><span class=\"line\">            <span class=\"variable\">$data</span> = [<span class=\"string\">&quot;id&quot;</span> =&gt; <span class=\"variable\">$comment_id</span>,<span class=\"string\">&quot;time&quot;</span> =&gt; <span class=\"variable\">$time</span>];</span><br><span class=\"line\">            <span class=\"variable\">$json</span> = <span class=\"title function_ invoke__\">json_encode</span>(<span class=\"variable\">$data</span>);</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">lpush</span>(<span class=\"string\">&quot;comment:uploadlist&quot;</span>,<span class=\"variable\">$json</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">dell</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;redis-&gt;<span class=\"title function_ invoke__\">flushAll</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"调用\"><a href=\"#调用\" class=\"headerlink\" title=\"调用\"></a>调用</h4><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$user_id</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;uid&#x27;</span>] ??<span class=\"number\">25</span>;</span><br><span class=\"line\"><span class=\"variable\">$comment_id</span>= <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;cid&#x27;</span>] ?? <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"variable\">$like</span> = <span class=\"string\">&#x27;like&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$like</span>))</span><br><span class=\"line\">    <span class=\"variable\">$type</span> = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"variable\">$user_id</span> &amp;&amp; <span class=\"variable\">$comment_id</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable\">$good</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Zan</span>();</span><br><span class=\"line\">    <span class=\"variable\">$rel</span> = <span class=\"variable\">$good</span>-&gt;<span class=\"title function_ invoke__\">click</span>(<span class=\"variable\">$user_id</span>,<span class=\"variable\">$type</span>,<span class=\"variable\">$comment_id</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"variable\">$rel</span>[<span class=\"string\">&#x27;code&#x27;</span>] == <span class=\"number\">1</span> || <span class=\"variable\">$rel</span>[<span class=\"string\">&#x27;code&#x27;</span>] == <span class=\"number\">7</span>)&#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"title class_\">Db</span>::<span class=\"title function_ invoke__\">name</span>(<span class=\"string\">&#x27;user_info_0&#x27;</span>)-&gt;<span class=\"title function_ invoke__\">where</span>(<span class=\"string\">&#x27;id&#x27;</span>,<span class=\"variable\">$comment_id</span>)-&gt;<span class=\"title function_ invoke__\">inc</span>(<span class=\"string\">&#x27;comic_id&#x27;</span>)-&gt;<span class=\"title function_ invoke__\">update</span>();</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;点赞成功&#x27;</span>;<span class=\"keyword\">exit</span>;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$where</span>[] = [<span class=\"string\">&#x27;id&#x27;</span>,<span class=\"string\">&#x27;=&#x27;</span>,<span class=\"variable\">$comment_id</span>];</span><br><span class=\"line\">        <span class=\"variable\">$where</span>[] = [<span class=\"string\">&#x27;comic_id&#x27;</span>,<span class=\"string\">&#x27;&gt;&#x27;</span>,<span class=\"number\">0</span>];</span><br><span class=\"line\">        <span class=\"title class_\">Db</span>::<span class=\"title function_ invoke__\">name</span>(<span class=\"string\">&#x27;user_info_0&#x27;</span>)-&gt;<span class=\"title function_ invoke__\">where</span>(<span class=\"variable\">$where</span>)-&gt;<span class=\"title function_ invoke__\">dec</span>(<span class=\"string\">&#x27;comic_id&#x27;</span>)-&gt;<span class=\"title function_ invoke__\">update</span>();</span><br><span class=\"line\">        <span class=\"variable\">$good</span>-&gt;<span class=\"title function_ invoke__\">delZan</span>(<span class=\"variable\">$user_id</span>);</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;取消点赞成功&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;用户ID和文章id不能为空&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"_content":"\n### 一、背景\n先看看一下业务场景：\n* 1.会员过期前3天发送召回通知\n* 2.订单支付成功后，5分钟后检测下游环节是否都正常，比如用户购买会员后，各种会员状态是否都设置成功\n* 3.如何定期检查处于退款状态的订单是否已经退款成功？\n* 4.实现通知失败，1，3，5，7分钟重复通知，直到对方回复？\n* 5.抽奖活动定时发送通知？\n\n\n通常解决以上问题，最简单直接的办法就是定时去扫表。\n\n扫表存在的问题是：\n\n* 1.扫表与数据库长时间连接，在数量量大的情况容易出现连接异常中断，需要更多的异常处理，对程序健壮性要求高\n* 2.在数据量大的情况下延时较高，规定内处理不完，影响业务，虽然可以启动多个进程来处理，这样会带来额外的维护成本，不能从根本上解决。\n* 3.每个业务都要维护一个自己的扫表逻辑。 当业务越来越多时，发现扫表部分的逻辑会重复开发，但是非常类似\n\n延时队列能对于上述需求能很好的解决\n\n### 二、调研\n调研了市场上一些开源的方案，以下：\n* 1.有赞科技：只有原理，没有开源代码\n* 2.github个人的：https://github.com/ouqiang/delay-queue\n\n      1.基于redis实现，redis只能配置一个,如果redis挂了整个服务不可用，可用性差点\n      2.消费端实现的是拉模式，接入成本大，每个项目都得去实现一遍接入代码\n      3.在star使用的人数不多，放在生产环境，存在风险，加之对go语言不了解，出了问题难以维护\n      4.有空之后可以研究下\n\n\n最后采用\nhttps://github.com/chenlinzhong/php-delayqueue  \n大佬的，简直顶礼膜拜，现在还没研究源码，只是在应用层次，之后和go版本一起看，应该是类似go的协程池处理\n\n\n整个延迟队列主要由4个部分\n\n  * JobPool用来存放所有Job的元信息。\n  * DelayBucket是一组以时间为维度的有序队列，用来存放所有需要延迟的Job（这里只存放Job Id）。\n  * Timer负责实时扫描各个Bucket，并将delay时间大于等于当前时间的Job放入到对应的Ready Queue。\n  * ReadyQueue存放处于Ready状态的Job（这里只存放JobId），以供消费程序消费。\n\n\n消息结构\n每个Job必须包含一下几个属性：\n\n  1. topic：Job类型。可以理解成具体的业务名称。\n  2. id：Job的唯一标识。用来检索和删除指定的Job信息。\n  3. delayTime：jod延迟执行的时间，13位时间戳\n  4. ttr（time-to-run)：Job执行超时时间。\n  5. body：Job的内容，供消费者做具体的业务处理，以json格式存储。\n\n\n对于同一类的topic delaytime,ttr一般是固定，job可以在精简一下属性\n\n  1.topic：Job类型。可以理解成具体的业务名称\n  \n  2.id：Job的唯一标识。用来检索和删除指定的Job信息。\n  \n  3.body：Job的内容，供消费者做具体的业务处理，以json格式存储。\n\ndelaytime,ttr在topicadmin后台配置\n\n\n\n### 三、目标\n\n* 轻量级：有较少的php的拓展就能直接运行，不需要引入网络框架，比如swoole，workman之类的\n* 稳定性：采用master-work架构，master不做业务处理，只负责管理子进程，子进程异常退出时自动拉起\n* 可用性：\n     * 1.支持多实例部署，每个实例无状态，一个实例挂掉不影响服务\n     * 2.支持配置多个redis，一个redis挂了只影响部分消息\n     * 3.业务方接入方便，在后台只需填写相关消息类型和回调接口\n* 拓展性:  当消费进程存在瓶颈时，可以配置加大消费进程数，当写入存在瓶颈时，可增加实例数写入性能可线性提高\n* 实时性：允许存在一定的时间误差。\n* 支持消息删除：业务使用方，可以随时删除指定消息。\n* 消息传输可靠性：消息进入到延迟队列后，保证至少被消费一次。\n* 写入性能：qps>1000+\n\n#### 四、架构设计与说明\n\n总体架构\n![image](./images/jiagou.png)\n采用master-work架构模式，主要包括6个模块：\n\n* 1.dq-mster:  主进程，负责管理子进程的创建，销毁，回收以及信号通知\n* 2.dq-server: 负责消息写入，读取，删除功能以及维护redis连接池\n* 3.dq-timer-N: 负责从redis的zset结构中扫描到期的消息，并负责写入ready 队列，个数可配置，一般2个就行了，因为消息在zset结构是按时间有序的\n* 4.dq-consume-N: 负责从ready队列中读取消息并通知给对应回调接口，个数可配置\n* 5.dq-redis-checker: 负责检查redis的服务状态，如果redis宕机，发送告警邮件\n* 6.dq-http-server: 提供web后台界面，用于注册topic\n\n#### 五、安装扩展\n环境依赖：`PHP 5.5+  安装sockets，redis，pcntl,pdo_mysql 拓展`   \n##### 一、docker容器安装扩展\n1.docker exec -it myFpm bash\n\n2.curl -L -o /tmp/redis.tar.gz\nhttps://github.com/phpredis/phpredis/archive/3.1.3.tar.gz\n\n3.tar xfz /tmp/redis.tar.gz\n\n4.rm -r /tmp/redis.tar.gz\n\n5.mkdir -p /usr/src/php/ext\n\n6.mv phpredis-3.1.3 /usr/src/php/ext/redis\n\n7.docker-php-ext-install redis\n\n##### 二、ubutu16.04 php7安装扩展\n1.参考：  https://blog.csdn.net/woqianduo/article/details/89405240\n\n2.按照上述不知道为什么一致不可以，只能直接使用apt-get install php7.0-redis一次性成功\n\n#### 六、部署\n\n\n##### step1:安装数据库用于存储一些topic以及告警信息\n执行:\n\n> mysql> source dq.sql\n\n\n##### step2:在DqConfg.文件中配置数据库信息： DqConf::$db\n\n##### step3: 启动http服务\n在DqConf.php文件中修改php了路径 $phpBin\n\n命令：\n> php DqHttpServer.php --port 8088\n\n访问:http://127.0.0.1:8088,出现配置界面\n\nredis信息格式：host:port:auth 比如 127.0.0.1:6379:12345\n\n\n##### stop4:配置告信息(比如redis宕机)\n\n\n##### stop5:注册topic\n\n\n重试标记说明:\n\n    1.接口返回为空默认重试\n    2.满足指定返回表达会重试，res表示返回的json数组，比如:\n    回调接口返回json串：{\"code\":200,\"data\":{\"status\":2,\"msg\":\"返回失败\"}}，重试条件可以这样写\n        {res.code}!=200 \n        {res.code}!=200 && {res.data.status}!=2 \n        {res.code}==200 && {res.data.status}==2 || {res.data.msg}=='返回失败'\n\n\n##### step6:启动服务进程:   \n\n> php DqInit.php --port 6789 &\n\n\n执行 ps -ef | grep dq 看到如下信息说明启动成功\n\n\n##### step7: 写入数据，参考demo.php \n\n##### step8:查看日志\n默认日志目录在项目目录的logs目录下，在DqConf.php修改$logPath\n\n* 1.请求日志：request_ymd.txt\n* 2.通知日志：notify_ymd.txt \n* 3.错误日志：err_ymd.txt\n\n##### step9:如果配置文件有改动\n\n* 1.系统会自动检测配置文件新，如果有改动，会自动退出(没有找到较好的热更新的方案)，需要重启，可以在crontab里面建个任务,1分钟执行一次，程序有check_self的判断\n* 2.优雅退出命令:  master检测侦听了USR2信号，收到信号后会通知所有子进程，子进程完成当前任务后会自动退出\n\n> ps -ef | grep dq-master| grep -v grep | head -n 1 | awk '{print $2}' | xargs kill -USR2\n\n\n\n### 七、性能测试\n需要安装pthreads拓展：\n\n测试原理：使用多线程模拟并发，在1s内能成功返回请求成功的个数\n\n```\nphp DqBench  concurrency  requests\nconcurrency:并发数\nrequests： 每个并发产生的请求数\n\n测试环境：内存 8G ，8核cpu，2个redis和1个dq-server 部署在一个机器上，数据包64字节\nqps：2400\n```\n\n### 八、值得一提的性能优化点：\n\n* 1.redis multi命令：将多个对redis的操作打包成一个减少网络开销\n* 2.计数的操作异步处理，在异步逻辑里面用函数的static变量来保存，当写入redis成功后释放static变量，可以在redis出现异常时计数仍能保持一致，除非进程退出\n* 3.内存泄露检测有必要:  所有的内存分配在底层都是调用了brk或者mmap，只要程序只有大量brk或者mmap的系统调用，内存泄露可能性非常高 ,检测命令: strace -c -p pid | grep -P 'mmap| brk'\n* 4.检测程序的系统调用情况：strace -c -p pid  ，发现某个系统函数调用是其他的数倍，可能大概率程序存在问题\n* 消息返回的是true，我改成返回success，同时我使用的是phalapi框架，改成回调通知了，具体参考：http://docs.phalapi.net/#/v2.0/api?id=%e5%a6%82%e4%bd%95%e7%bc%96%e5%86%99%e6%94%af%e4%bb%98%e7%ad%89%e5%9b%9e%e8%b0%83%e6%8e%a5%e5%8f%a3%ef%bc%9f\n\n### 九、异常处理\n\n1.如果调用通知接口在超时时间内，没有收到回复认为通知失败，系统会重新把数据放入队列，重新通知，系统默认最大通知10次(可以在Dqconf.php文件中修改$notify_exp_nums)通知间隔为2n+1，比如第一次1分钟，通知失败，第二次3分钟后，直到收到回复，超出最大通知次数后系统自动丢弃，同时发邮件通知\n\n\n\n2.线上redis每隔1s持久化一次，存在丢失1s数据的情况，出现这种情况可以对比request_ymd.txt和notify_ymd.txt日志手动恢复过来\n\n3.redis宕机通知:\n\n\n`ps:网络抖动在所难免，通知接口如果涉及到核心的服务,一定要保证幂等！！`\n\n### 十、主要接入业务\n\n* 订单10分钟召回通知\n* 调用接口超时或者失败时做补偿\n* 会员过期前3天召回通知\n* 抽奖定时推送生成抽奖记录。\n\n### 十一、不足与展望\n\n\n1.由于团队使用的镜像缺少libevent拓展，所以dq-server基于select模型，并发高的场景下性能存在瓶颈，后续可以改为基于libevent事件模型，提升并发性能\n\n2.timer和consumer目前是采用多进程来做的，这个粒度感觉有点粗，可以考虑使用多线程模式，并且支持动态创建线程数来提高consumer的性能，最大程度保证消费及时\n\n\n3.dq-server与redis是同步调用，这也是性能的瓶颈点，计划基于swoole_redis来异步处理\n\n4.邮件配置未使用，计划改成server酱或者钉钉推送通知\n\n5.消息删除这里还未很明确，并且在回调通知里修改能再处理比如删除不用的消息\n\n6.热更新不了，只能手动关掉再开启\n\n7.增加如果根据按人头抽奖自动发送通知","source":"_posts/REDIS/REDIS延迟任务队列应用.md","raw":"---\ncategories:\n  - REDIS\n---\n\n### 一、背景\n先看看一下业务场景：\n* 1.会员过期前3天发送召回通知\n* 2.订单支付成功后，5分钟后检测下游环节是否都正常，比如用户购买会员后，各种会员状态是否都设置成功\n* 3.如何定期检查处于退款状态的订单是否已经退款成功？\n* 4.实现通知失败，1，3，5，7分钟重复通知，直到对方回复？\n* 5.抽奖活动定时发送通知？\n\n\n通常解决以上问题，最简单直接的办法就是定时去扫表。\n\n扫表存在的问题是：\n\n* 1.扫表与数据库长时间连接，在数量量大的情况容易出现连接异常中断，需要更多的异常处理，对程序健壮性要求高\n* 2.在数据量大的情况下延时较高，规定内处理不完，影响业务，虽然可以启动多个进程来处理，这样会带来额外的维护成本，不能从根本上解决。\n* 3.每个业务都要维护一个自己的扫表逻辑。 当业务越来越多时，发现扫表部分的逻辑会重复开发，但是非常类似\n\n延时队列能对于上述需求能很好的解决\n\n### 二、调研\n调研了市场上一些开源的方案，以下：\n* 1.有赞科技：只有原理，没有开源代码\n* 2.github个人的：https://github.com/ouqiang/delay-queue\n\n      1.基于redis实现，redis只能配置一个,如果redis挂了整个服务不可用，可用性差点\n      2.消费端实现的是拉模式，接入成本大，每个项目都得去实现一遍接入代码\n      3.在star使用的人数不多，放在生产环境，存在风险，加之对go语言不了解，出了问题难以维护\n      4.有空之后可以研究下\n\n\n最后采用\nhttps://github.com/chenlinzhong/php-delayqueue  \n大佬的，简直顶礼膜拜，现在还没研究源码，只是在应用层次，之后和go版本一起看，应该是类似go的协程池处理\n\n\n整个延迟队列主要由4个部分\n\n  * JobPool用来存放所有Job的元信息。\n  * DelayBucket是一组以时间为维度的有序队列，用来存放所有需要延迟的Job（这里只存放Job Id）。\n  * Timer负责实时扫描各个Bucket，并将delay时间大于等于当前时间的Job放入到对应的Ready Queue。\n  * ReadyQueue存放处于Ready状态的Job（这里只存放JobId），以供消费程序消费。\n\n\n消息结构\n每个Job必须包含一下几个属性：\n\n  1. topic：Job类型。可以理解成具体的业务名称。\n  2. id：Job的唯一标识。用来检索和删除指定的Job信息。\n  3. delayTime：jod延迟执行的时间，13位时间戳\n  4. ttr（time-to-run)：Job执行超时时间。\n  5. body：Job的内容，供消费者做具体的业务处理，以json格式存储。\n\n\n对于同一类的topic delaytime,ttr一般是固定，job可以在精简一下属性\n\n  1.topic：Job类型。可以理解成具体的业务名称\n  \n  2.id：Job的唯一标识。用来检索和删除指定的Job信息。\n  \n  3.body：Job的内容，供消费者做具体的业务处理，以json格式存储。\n\ndelaytime,ttr在topicadmin后台配置\n\n\n\n### 三、目标\n\n* 轻量级：有较少的php的拓展就能直接运行，不需要引入网络框架，比如swoole，workman之类的\n* 稳定性：采用master-work架构，master不做业务处理，只负责管理子进程，子进程异常退出时自动拉起\n* 可用性：\n     * 1.支持多实例部署，每个实例无状态，一个实例挂掉不影响服务\n     * 2.支持配置多个redis，一个redis挂了只影响部分消息\n     * 3.业务方接入方便，在后台只需填写相关消息类型和回调接口\n* 拓展性:  当消费进程存在瓶颈时，可以配置加大消费进程数，当写入存在瓶颈时，可增加实例数写入性能可线性提高\n* 实时性：允许存在一定的时间误差。\n* 支持消息删除：业务使用方，可以随时删除指定消息。\n* 消息传输可靠性：消息进入到延迟队列后，保证至少被消费一次。\n* 写入性能：qps>1000+\n\n#### 四、架构设计与说明\n\n总体架构\n![image](./images/jiagou.png)\n采用master-work架构模式，主要包括6个模块：\n\n* 1.dq-mster:  主进程，负责管理子进程的创建，销毁，回收以及信号通知\n* 2.dq-server: 负责消息写入，读取，删除功能以及维护redis连接池\n* 3.dq-timer-N: 负责从redis的zset结构中扫描到期的消息，并负责写入ready 队列，个数可配置，一般2个就行了，因为消息在zset结构是按时间有序的\n* 4.dq-consume-N: 负责从ready队列中读取消息并通知给对应回调接口，个数可配置\n* 5.dq-redis-checker: 负责检查redis的服务状态，如果redis宕机，发送告警邮件\n* 6.dq-http-server: 提供web后台界面，用于注册topic\n\n#### 五、安装扩展\n环境依赖：`PHP 5.5+  安装sockets，redis，pcntl,pdo_mysql 拓展`   \n##### 一、docker容器安装扩展\n1.docker exec -it myFpm bash\n\n2.curl -L -o /tmp/redis.tar.gz\nhttps://github.com/phpredis/phpredis/archive/3.1.3.tar.gz\n\n3.tar xfz /tmp/redis.tar.gz\n\n4.rm -r /tmp/redis.tar.gz\n\n5.mkdir -p /usr/src/php/ext\n\n6.mv phpredis-3.1.3 /usr/src/php/ext/redis\n\n7.docker-php-ext-install redis\n\n##### 二、ubutu16.04 php7安装扩展\n1.参考：  https://blog.csdn.net/woqianduo/article/details/89405240\n\n2.按照上述不知道为什么一致不可以，只能直接使用apt-get install php7.0-redis一次性成功\n\n#### 六、部署\n\n\n##### step1:安装数据库用于存储一些topic以及告警信息\n执行:\n\n> mysql> source dq.sql\n\n\n##### step2:在DqConfg.文件中配置数据库信息： DqConf::$db\n\n##### step3: 启动http服务\n在DqConf.php文件中修改php了路径 $phpBin\n\n命令：\n> php DqHttpServer.php --port 8088\n\n访问:http://127.0.0.1:8088,出现配置界面\n\nredis信息格式：host:port:auth 比如 127.0.0.1:6379:12345\n\n\n##### stop4:配置告信息(比如redis宕机)\n\n\n##### stop5:注册topic\n\n\n重试标记说明:\n\n    1.接口返回为空默认重试\n    2.满足指定返回表达会重试，res表示返回的json数组，比如:\n    回调接口返回json串：{\"code\":200,\"data\":{\"status\":2,\"msg\":\"返回失败\"}}，重试条件可以这样写\n        {res.code}!=200 \n        {res.code}!=200 && {res.data.status}!=2 \n        {res.code}==200 && {res.data.status}==2 || {res.data.msg}=='返回失败'\n\n\n##### step6:启动服务进程:   \n\n> php DqInit.php --port 6789 &\n\n\n执行 ps -ef | grep dq 看到如下信息说明启动成功\n\n\n##### step7: 写入数据，参考demo.php \n\n##### step8:查看日志\n默认日志目录在项目目录的logs目录下，在DqConf.php修改$logPath\n\n* 1.请求日志：request_ymd.txt\n* 2.通知日志：notify_ymd.txt \n* 3.错误日志：err_ymd.txt\n\n##### step9:如果配置文件有改动\n\n* 1.系统会自动检测配置文件新，如果有改动，会自动退出(没有找到较好的热更新的方案)，需要重启，可以在crontab里面建个任务,1分钟执行一次，程序有check_self的判断\n* 2.优雅退出命令:  master检测侦听了USR2信号，收到信号后会通知所有子进程，子进程完成当前任务后会自动退出\n\n> ps -ef | grep dq-master| grep -v grep | head -n 1 | awk '{print $2}' | xargs kill -USR2\n\n\n\n### 七、性能测试\n需要安装pthreads拓展：\n\n测试原理：使用多线程模拟并发，在1s内能成功返回请求成功的个数\n\n```\nphp DqBench  concurrency  requests\nconcurrency:并发数\nrequests： 每个并发产生的请求数\n\n测试环境：内存 8G ，8核cpu，2个redis和1个dq-server 部署在一个机器上，数据包64字节\nqps：2400\n```\n\n### 八、值得一提的性能优化点：\n\n* 1.redis multi命令：将多个对redis的操作打包成一个减少网络开销\n* 2.计数的操作异步处理，在异步逻辑里面用函数的static变量来保存，当写入redis成功后释放static变量，可以在redis出现异常时计数仍能保持一致，除非进程退出\n* 3.内存泄露检测有必要:  所有的内存分配在底层都是调用了brk或者mmap，只要程序只有大量brk或者mmap的系统调用，内存泄露可能性非常高 ,检测命令: strace -c -p pid | grep -P 'mmap| brk'\n* 4.检测程序的系统调用情况：strace -c -p pid  ，发现某个系统函数调用是其他的数倍，可能大概率程序存在问题\n* 消息返回的是true，我改成返回success，同时我使用的是phalapi框架，改成回调通知了，具体参考：http://docs.phalapi.net/#/v2.0/api?id=%e5%a6%82%e4%bd%95%e7%bc%96%e5%86%99%e6%94%af%e4%bb%98%e7%ad%89%e5%9b%9e%e8%b0%83%e6%8e%a5%e5%8f%a3%ef%bc%9f\n\n### 九、异常处理\n\n1.如果调用通知接口在超时时间内，没有收到回复认为通知失败，系统会重新把数据放入队列，重新通知，系统默认最大通知10次(可以在Dqconf.php文件中修改$notify_exp_nums)通知间隔为2n+1，比如第一次1分钟，通知失败，第二次3分钟后，直到收到回复，超出最大通知次数后系统自动丢弃，同时发邮件通知\n\n\n\n2.线上redis每隔1s持久化一次，存在丢失1s数据的情况，出现这种情况可以对比request_ymd.txt和notify_ymd.txt日志手动恢复过来\n\n3.redis宕机通知:\n\n\n`ps:网络抖动在所难免，通知接口如果涉及到核心的服务,一定要保证幂等！！`\n\n### 十、主要接入业务\n\n* 订单10分钟召回通知\n* 调用接口超时或者失败时做补偿\n* 会员过期前3天召回通知\n* 抽奖定时推送生成抽奖记录。\n\n### 十一、不足与展望\n\n\n1.由于团队使用的镜像缺少libevent拓展，所以dq-server基于select模型，并发高的场景下性能存在瓶颈，后续可以改为基于libevent事件模型，提升并发性能\n\n2.timer和consumer目前是采用多进程来做的，这个粒度感觉有点粗，可以考虑使用多线程模式，并且支持动态创建线程数来提高consumer的性能，最大程度保证消费及时\n\n\n3.dq-server与redis是同步调用，这也是性能的瓶颈点，计划基于swoole_redis来异步处理\n\n4.邮件配置未使用，计划改成server酱或者钉钉推送通知\n\n5.消息删除这里还未很明确，并且在回调通知里修改能再处理比如删除不用的消息\n\n6.热更新不了，只能手动关掉再开启\n\n7.增加如果根据按人头抽奖自动发送通知","slug":"REDIS延迟任务队列应用","published":1,"category":"REDIS","date":"2023-06-08T23:03:56.102Z","updated":"2023-06-08T23:12:13.739Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5seh001hdxjc4pdyg6oj","content":"<h3 id=\"一、背景\"><a href=\"#一、背景\" class=\"headerlink\" title=\"一、背景\"></a>一、背景</h3><p>先看看一下业务场景：</p>\n<ul>\n<li>1.会员过期前3天发送召回通知</li>\n<li>2.订单支付成功后，5分钟后检测下游环节是否都正常，比如用户购买会员后，各种会员状态是否都设置成功</li>\n<li>3.如何定期检查处于退款状态的订单是否已经退款成功？</li>\n<li>4.实现通知失败，1，3，5，7分钟重复通知，直到对方回复？</li>\n<li>5.抽奖活动定时发送通知？</li>\n</ul>\n<p>通常解决以上问题，最简单直接的办法就是定时去扫表。</p>\n<p>扫表存在的问题是：</p>\n<ul>\n<li>1.扫表与数据库长时间连接，在数量量大的情况容易出现连接异常中断，需要更多的异常处理，对程序健壮性要求高</li>\n<li>2.在数据量大的情况下延时较高，规定内处理不完，影响业务，虽然可以启动多个进程来处理，这样会带来额外的维护成本，不能从根本上解决。</li>\n<li>3.每个业务都要维护一个自己的扫表逻辑。 当业务越来越多时，发现扫表部分的逻辑会重复开发，但是非常类似</li>\n</ul>\n<p>延时队列能对于上述需求能很好的解决</p>\n<h3 id=\"二、调研\"><a href=\"#二、调研\" class=\"headerlink\" title=\"二、调研\"></a>二、调研</h3><p>调研了市场上一些开源的方案，以下：</p>\n<ul>\n<li><p>1.有赞科技：只有原理，没有开源代码</p>\n</li>\n<li><p>2.github个人的：<a href=\"https://github.com/ouqiang/delay-queue\">https://github.com/ouqiang/delay-queue</a></p>\n<pre><code>1.基于redis实现，redis只能配置一个,如果redis挂了整个服务不可用，可用性差点\n2.消费端实现的是拉模式，接入成本大，每个项目都得去实现一遍接入代码\n3.在star使用的人数不多，放在生产环境，存在风险，加之对go语言不了解，出了问题难以维护\n4.有空之后可以研究下\n</code></pre>\n</li>\n</ul>\n<p>最后采用<br><a href=\"https://github.com/chenlinzhong/php-delayqueue\">https://github.com/chenlinzhong/php-delayqueue</a><br>大佬的，简直顶礼膜拜，现在还没研究源码，只是在应用层次，之后和go版本一起看，应该是类似go的协程池处理</p>\n<p>整个延迟队列主要由4个部分</p>\n<ul>\n<li>JobPool用来存放所有Job的元信息。</li>\n<li>DelayBucket是一组以时间为维度的有序队列，用来存放所有需要延迟的Job（这里只存放Job Id）。</li>\n<li>Timer负责实时扫描各个Bucket，并将delay时间大于等于当前时间的Job放入到对应的Ready Queue。</li>\n<li>ReadyQueue存放处于Ready状态的Job（这里只存放JobId），以供消费程序消费。</li>\n</ul>\n<p>消息结构<br>每个Job必须包含一下几个属性：</p>\n<ol>\n<li>topic：Job类型。可以理解成具体的业务名称。</li>\n<li>id：Job的唯一标识。用来检索和删除指定的Job信息。</li>\n<li>delayTime：jod延迟执行的时间，13位时间戳</li>\n<li>ttr（time-to-run)：Job执行超时时间。</li>\n<li>body：Job的内容，供消费者做具体的业务处理，以json格式存储。</li>\n</ol>\n<p>对于同一类的topic delaytime,ttr一般是固定，job可以在精简一下属性</p>\n<p>  1.topic：Job类型。可以理解成具体的业务名称</p>\n<p>  2.id：Job的唯一标识。用来检索和删除指定的Job信息。</p>\n<p>  3.body：Job的内容，供消费者做具体的业务处理，以json格式存储。</p>\n<p>delaytime,ttr在topicadmin后台配置</p>\n<h3 id=\"三、目标\"><a href=\"#三、目标\" class=\"headerlink\" title=\"三、目标\"></a>三、目标</h3><ul>\n<li>轻量级：有较少的php的拓展就能直接运行，不需要引入网络框架，比如swoole，workman之类的</li>\n<li>稳定性：采用master-work架构，master不做业务处理，只负责管理子进程，子进程异常退出时自动拉起</li>\n<li>可用性：<ul>\n<li>1.支持多实例部署，每个实例无状态，一个实例挂掉不影响服务</li>\n<li>2.支持配置多个redis，一个redis挂了只影响部分消息</li>\n<li>3.业务方接入方便，在后台只需填写相关消息类型和回调接口</li>\n</ul>\n</li>\n<li>拓展性:  当消费进程存在瓶颈时，可以配置加大消费进程数，当写入存在瓶颈时，可增加实例数写入性能可线性提高</li>\n<li>实时性：允许存在一定的时间误差。</li>\n<li>支持消息删除：业务使用方，可以随时删除指定消息。</li>\n<li>消息传输可靠性：消息进入到延迟队列后，保证至少被消费一次。</li>\n<li>写入性能：qps&gt;1000+</li>\n</ul>\n<h4 id=\"四、架构设计与说明\"><a href=\"#四、架构设计与说明\" class=\"headerlink\" title=\"四、架构设计与说明\"></a>四、架构设计与说明</h4><p>总体架构<br><img src=\"/./images/jiagou.png\" alt=\"image\"><br>采用master-work架构模式，主要包括6个模块：</p>\n<ul>\n<li>1.dq-mster:  主进程，负责管理子进程的创建，销毁，回收以及信号通知</li>\n<li>2.dq-server: 负责消息写入，读取，删除功能以及维护redis连接池</li>\n<li>3.dq-timer-N: 负责从redis的zset结构中扫描到期的消息，并负责写入ready 队列，个数可配置，一般2个就行了，因为消息在zset结构是按时间有序的</li>\n<li>4.dq-consume-N: 负责从ready队列中读取消息并通知给对应回调接口，个数可配置</li>\n<li>5.dq-redis-checker: 负责检查redis的服务状态，如果redis宕机，发送告警邮件</li>\n<li>6.dq-http-server: 提供web后台界面，用于注册topic</li>\n</ul>\n<h4 id=\"五、安装扩展\"><a href=\"#五、安装扩展\" class=\"headerlink\" title=\"五、安装扩展\"></a>五、安装扩展</h4><p>环境依赖：<code>PHP 5.5+  安装sockets，redis，pcntl,pdo_mysql 拓展</code>   </p>\n<h5 id=\"一、docker容器安装扩展\"><a href=\"#一、docker容器安装扩展\" class=\"headerlink\" title=\"一、docker容器安装扩展\"></a>一、docker容器安装扩展</h5><p>1.docker exec -it myFpm bash</p>\n<p>2.curl -L -o &#x2F;tmp&#x2F;redis.tar.gz<br><a href=\"https://github.com/phpredis/phpredis/archive/3.1.3.tar.gz\">https://github.com/phpredis/phpredis/archive/3.1.3.tar.gz</a></p>\n<p>3.tar xfz &#x2F;tmp&#x2F;redis.tar.gz</p>\n<p>4.rm -r &#x2F;tmp&#x2F;redis.tar.gz</p>\n<p>5.mkdir -p &#x2F;usr&#x2F;src&#x2F;php&#x2F;ext</p>\n<p>6.mv phpredis-3.1.3 &#x2F;usr&#x2F;src&#x2F;php&#x2F;ext&#x2F;redis</p>\n<p>7.docker-php-ext-install redis</p>\n<h5 id=\"二、ubutu16-04-php7安装扩展\"><a href=\"#二、ubutu16-04-php7安装扩展\" class=\"headerlink\" title=\"二、ubutu16.04 php7安装扩展\"></a>二、ubutu16.04 php7安装扩展</h5><p>1.参考：  <a href=\"https://blog.csdn.net/woqianduo/article/details/89405240\">https://blog.csdn.net/woqianduo/article/details/89405240</a></p>\n<p>2.按照上述不知道为什么一致不可以，只能直接使用apt-get install php7.0-redis一次性成功</p>\n<h4 id=\"六、部署\"><a href=\"#六、部署\" class=\"headerlink\" title=\"六、部署\"></a>六、部署</h4><h5 id=\"step1-安装数据库用于存储一些topic以及告警信息\"><a href=\"#step1-安装数据库用于存储一些topic以及告警信息\" class=\"headerlink\" title=\"step1:安装数据库用于存储一些topic以及告警信息\"></a>step1:安装数据库用于存储一些topic以及告警信息</h5><p>执行:</p>\n<blockquote>\n<p>mysql&gt; source dq.sql</p>\n</blockquote>\n<h5 id=\"step2-在DqConfg-文件中配置数据库信息：-DqConf-db\"><a href=\"#step2-在DqConfg-文件中配置数据库信息：-DqConf-db\" class=\"headerlink\" title=\"step2:在DqConfg.文件中配置数据库信息： DqConf::$db\"></a>step2:在DqConfg.文件中配置数据库信息： DqConf::$db</h5><h5 id=\"step3-启动http服务\"><a href=\"#step3-启动http服务\" class=\"headerlink\" title=\"step3: 启动http服务\"></a>step3: 启动http服务</h5><p>在DqConf.php文件中修改php了路径 $phpBin</p>\n<p>命令：</p>\n<blockquote>\n<p>php DqHttpServer.php –port 8088</p>\n</blockquote>\n<p>访问:<a href=\"http://127.0.0.1:8088,出现配置界面\">http://127.0.0.1:8088,出现配置界面</a></p>\n<p>redis信息格式：host:port:auth 比如 127.0.0.1:6379:12345</p>\n<h5 id=\"stop4-配置告信息-比如redis宕机\"><a href=\"#stop4-配置告信息-比如redis宕机\" class=\"headerlink\" title=\"stop4:配置告信息(比如redis宕机)\"></a>stop4:配置告信息(比如redis宕机)</h5><h5 id=\"stop5-注册topic\"><a href=\"#stop5-注册topic\" class=\"headerlink\" title=\"stop5:注册topic\"></a>stop5:注册topic</h5><p>重试标记说明:</p>\n<pre><code>1.接口返回为空默认重试\n2.满足指定返回表达会重试，res表示返回的json数组，比如:\n回调接口返回json串：&#123;&quot;code&quot;:200,&quot;data&quot;:&#123;&quot;status&quot;:2,&quot;msg&quot;:&quot;返回失败&quot;&#125;&#125;，重试条件可以这样写\n    &#123;res.code&#125;!=200 \n    &#123;res.code&#125;!=200 &amp;&amp; &#123;res.data.status&#125;!=2 \n    &#123;res.code&#125;==200 &amp;&amp; &#123;res.data.status&#125;==2 || &#123;res.data.msg&#125;==&#39;返回失败&#39;\n</code></pre>\n<h5 id=\"step6-启动服务进程\"><a href=\"#step6-启动服务进程\" class=\"headerlink\" title=\"step6:启动服务进程:\"></a>step6:启动服务进程:</h5><blockquote>\n<p>php DqInit.php –port 6789 &amp;</p>\n</blockquote>\n<p>执行 ps -ef | grep dq 看到如下信息说明启动成功</p>\n<h5 id=\"step7-写入数据，参考demo-php\"><a href=\"#step7-写入数据，参考demo-php\" class=\"headerlink\" title=\"step7: 写入数据，参考demo.php\"></a>step7: 写入数据，参考demo.php</h5><h5 id=\"step8-查看日志\"><a href=\"#step8-查看日志\" class=\"headerlink\" title=\"step8:查看日志\"></a>step8:查看日志</h5><p>默认日志目录在项目目录的logs目录下，在DqConf.php修改$logPath</p>\n<ul>\n<li>1.请求日志：request_ymd.txt</li>\n<li>2.通知日志：notify_ymd.txt </li>\n<li>3.错误日志：err_ymd.txt</li>\n</ul>\n<h5 id=\"step9-如果配置文件有改动\"><a href=\"#step9-如果配置文件有改动\" class=\"headerlink\" title=\"step9:如果配置文件有改动\"></a>step9:如果配置文件有改动</h5><ul>\n<li>1.系统会自动检测配置文件新，如果有改动，会自动退出(没有找到较好的热更新的方案)，需要重启，可以在crontab里面建个任务,1分钟执行一次，程序有check_self的判断</li>\n<li>2.优雅退出命令:  master检测侦听了USR2信号，收到信号后会通知所有子进程，子进程完成当前任务后会自动退出</li>\n</ul>\n<blockquote>\n<p>ps -ef | grep dq-master| grep -v grep | head -n 1 | awk ‘{print $2}’ | xargs kill -USR2</p>\n</blockquote>\n<h3 id=\"七、性能测试\"><a href=\"#七、性能测试\" class=\"headerlink\" title=\"七、性能测试\"></a>七、性能测试</h3><p>需要安装pthreads拓展：</p>\n<p>测试原理：使用多线程模拟并发，在1s内能成功返回请求成功的个数</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php DqBench  concurrency  requests</span><br><span class=\"line\">concurrency:并发数</span><br><span class=\"line\">requests： 每个并发产生的请求数</span><br><span class=\"line\"></span><br><span class=\"line\">测试环境：内存 8G ，8核cpu，2个redis和1个dq-server 部署在一个机器上，数据包64字节</span><br><span class=\"line\">qps：2400</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"八、值得一提的性能优化点：\"><a href=\"#八、值得一提的性能优化点：\" class=\"headerlink\" title=\"八、值得一提的性能优化点：\"></a>八、值得一提的性能优化点：</h3><ul>\n<li>1.redis multi命令：将多个对redis的操作打包成一个减少网络开销</li>\n<li>2.计数的操作异步处理，在异步逻辑里面用函数的static变量来保存，当写入redis成功后释放static变量，可以在redis出现异常时计数仍能保持一致，除非进程退出</li>\n<li>3.内存泄露检测有必要:  所有的内存分配在底层都是调用了brk或者mmap，只要程序只有大量brk或者mmap的系统调用，内存泄露可能性非常高 ,检测命令: strace -c -p pid | grep -P ‘mmap| brk’</li>\n<li>4.检测程序的系统调用情况：strace -c -p pid  ，发现某个系统函数调用是其他的数倍，可能大概率程序存在问题</li>\n<li>消息返回的是true，我改成返回success，同时我使用的是phalapi框架，改成回调通知了，具体参考：<a href=\"http://docs.phalapi.net/#/v2.0/api?id=%e5%a6%82%e4%bd%95%e7%bc%96%e5%86%99%e6%94%af%e4%bb%98%e7%ad%89%e5%9b%9e%e8%b0%83%e6%8e%a5%e5%8f%a3%ef%bc%9f\">http://docs.phalapi.net/#/v2.0/api?id=%e5%a6%82%e4%bd%95%e7%bc%96%e5%86%99%e6%94%af%e4%bb%98%e7%ad%89%e5%9b%9e%e8%b0%83%e6%8e%a5%e5%8f%a3%ef%bc%9f</a></li>\n</ul>\n<h3 id=\"九、异常处理\"><a href=\"#九、异常处理\" class=\"headerlink\" title=\"九、异常处理\"></a>九、异常处理</h3><p>1.如果调用通知接口在超时时间内，没有收到回复认为通知失败，系统会重新把数据放入队列，重新通知，系统默认最大通知10次(可以在Dqconf.php文件中修改$notify_exp_nums)通知间隔为2n+1，比如第一次1分钟，通知失败，第二次3分钟后，直到收到回复，超出最大通知次数后系统自动丢弃，同时发邮件通知</p>\n<p>2.线上redis每隔1s持久化一次，存在丢失1s数据的情况，出现这种情况可以对比request_ymd.txt和notify_ymd.txt日志手动恢复过来</p>\n<p>3.redis宕机通知:</p>\n<p><code>ps:网络抖动在所难免，通知接口如果涉及到核心的服务,一定要保证幂等！！</code></p>\n<h3 id=\"十、主要接入业务\"><a href=\"#十、主要接入业务\" class=\"headerlink\" title=\"十、主要接入业务\"></a>十、主要接入业务</h3><ul>\n<li>订单10分钟召回通知</li>\n<li>调用接口超时或者失败时做补偿</li>\n<li>会员过期前3天召回通知</li>\n<li>抽奖定时推送生成抽奖记录。</li>\n</ul>\n<h3 id=\"十一、不足与展望\"><a href=\"#十一、不足与展望\" class=\"headerlink\" title=\"十一、不足与展望\"></a>十一、不足与展望</h3><p>1.由于团队使用的镜像缺少libevent拓展，所以dq-server基于select模型，并发高的场景下性能存在瓶颈，后续可以改为基于libevent事件模型，提升并发性能</p>\n<p>2.timer和consumer目前是采用多进程来做的，这个粒度感觉有点粗，可以考虑使用多线程模式，并且支持动态创建线程数来提高consumer的性能，最大程度保证消费及时</p>\n<p>3.dq-server与redis是同步调用，这也是性能的瓶颈点，计划基于swoole_redis来异步处理</p>\n<p>4.邮件配置未使用，计划改成server酱或者钉钉推送通知</p>\n<p>5.消息删除这里还未很明确，并且在回调通知里修改能再处理比如删除不用的消息</p>\n<p>6.热更新不了，只能手动关掉再开启</p>\n<p>7.增加如果根据按人头抽奖自动发送通知</p>\n","site":{"data":{}},"length":4852,"excerpt":"","more":"<h3 id=\"一、背景\"><a href=\"#一、背景\" class=\"headerlink\" title=\"一、背景\"></a>一、背景</h3><p>先看看一下业务场景：</p>\n<ul>\n<li>1.会员过期前3天发送召回通知</li>\n<li>2.订单支付成功后，5分钟后检测下游环节是否都正常，比如用户购买会员后，各种会员状态是否都设置成功</li>\n<li>3.如何定期检查处于退款状态的订单是否已经退款成功？</li>\n<li>4.实现通知失败，1，3，5，7分钟重复通知，直到对方回复？</li>\n<li>5.抽奖活动定时发送通知？</li>\n</ul>\n<p>通常解决以上问题，最简单直接的办法就是定时去扫表。</p>\n<p>扫表存在的问题是：</p>\n<ul>\n<li>1.扫表与数据库长时间连接，在数量量大的情况容易出现连接异常中断，需要更多的异常处理，对程序健壮性要求高</li>\n<li>2.在数据量大的情况下延时较高，规定内处理不完，影响业务，虽然可以启动多个进程来处理，这样会带来额外的维护成本，不能从根本上解决。</li>\n<li>3.每个业务都要维护一个自己的扫表逻辑。 当业务越来越多时，发现扫表部分的逻辑会重复开发，但是非常类似</li>\n</ul>\n<p>延时队列能对于上述需求能很好的解决</p>\n<h3 id=\"二、调研\"><a href=\"#二、调研\" class=\"headerlink\" title=\"二、调研\"></a>二、调研</h3><p>调研了市场上一些开源的方案，以下：</p>\n<ul>\n<li><p>1.有赞科技：只有原理，没有开源代码</p>\n</li>\n<li><p>2.github个人的：<a href=\"https://github.com/ouqiang/delay-queue\">https://github.com/ouqiang/delay-queue</a></p>\n<pre><code>1.基于redis实现，redis只能配置一个,如果redis挂了整个服务不可用，可用性差点\n2.消费端实现的是拉模式，接入成本大，每个项目都得去实现一遍接入代码\n3.在star使用的人数不多，放在生产环境，存在风险，加之对go语言不了解，出了问题难以维护\n4.有空之后可以研究下\n</code></pre>\n</li>\n</ul>\n<p>最后采用<br><a href=\"https://github.com/chenlinzhong/php-delayqueue\">https://github.com/chenlinzhong/php-delayqueue</a><br>大佬的，简直顶礼膜拜，现在还没研究源码，只是在应用层次，之后和go版本一起看，应该是类似go的协程池处理</p>\n<p>整个延迟队列主要由4个部分</p>\n<ul>\n<li>JobPool用来存放所有Job的元信息。</li>\n<li>DelayBucket是一组以时间为维度的有序队列，用来存放所有需要延迟的Job（这里只存放Job Id）。</li>\n<li>Timer负责实时扫描各个Bucket，并将delay时间大于等于当前时间的Job放入到对应的Ready Queue。</li>\n<li>ReadyQueue存放处于Ready状态的Job（这里只存放JobId），以供消费程序消费。</li>\n</ul>\n<p>消息结构<br>每个Job必须包含一下几个属性：</p>\n<ol>\n<li>topic：Job类型。可以理解成具体的业务名称。</li>\n<li>id：Job的唯一标识。用来检索和删除指定的Job信息。</li>\n<li>delayTime：jod延迟执行的时间，13位时间戳</li>\n<li>ttr（time-to-run)：Job执行超时时间。</li>\n<li>body：Job的内容，供消费者做具体的业务处理，以json格式存储。</li>\n</ol>\n<p>对于同一类的topic delaytime,ttr一般是固定，job可以在精简一下属性</p>\n<p>  1.topic：Job类型。可以理解成具体的业务名称</p>\n<p>  2.id：Job的唯一标识。用来检索和删除指定的Job信息。</p>\n<p>  3.body：Job的内容，供消费者做具体的业务处理，以json格式存储。</p>\n<p>delaytime,ttr在topicadmin后台配置</p>\n<h3 id=\"三、目标\"><a href=\"#三、目标\" class=\"headerlink\" title=\"三、目标\"></a>三、目标</h3><ul>\n<li>轻量级：有较少的php的拓展就能直接运行，不需要引入网络框架，比如swoole，workman之类的</li>\n<li>稳定性：采用master-work架构，master不做业务处理，只负责管理子进程，子进程异常退出时自动拉起</li>\n<li>可用性：<ul>\n<li>1.支持多实例部署，每个实例无状态，一个实例挂掉不影响服务</li>\n<li>2.支持配置多个redis，一个redis挂了只影响部分消息</li>\n<li>3.业务方接入方便，在后台只需填写相关消息类型和回调接口</li>\n</ul>\n</li>\n<li>拓展性:  当消费进程存在瓶颈时，可以配置加大消费进程数，当写入存在瓶颈时，可增加实例数写入性能可线性提高</li>\n<li>实时性：允许存在一定的时间误差。</li>\n<li>支持消息删除：业务使用方，可以随时删除指定消息。</li>\n<li>消息传输可靠性：消息进入到延迟队列后，保证至少被消费一次。</li>\n<li>写入性能：qps&gt;1000+</li>\n</ul>\n<h4 id=\"四、架构设计与说明\"><a href=\"#四、架构设计与说明\" class=\"headerlink\" title=\"四、架构设计与说明\"></a>四、架构设计与说明</h4><p>总体架构<br><img src=\"/./images/jiagou.png\" alt=\"image\"><br>采用master-work架构模式，主要包括6个模块：</p>\n<ul>\n<li>1.dq-mster:  主进程，负责管理子进程的创建，销毁，回收以及信号通知</li>\n<li>2.dq-server: 负责消息写入，读取，删除功能以及维护redis连接池</li>\n<li>3.dq-timer-N: 负责从redis的zset结构中扫描到期的消息，并负责写入ready 队列，个数可配置，一般2个就行了，因为消息在zset结构是按时间有序的</li>\n<li>4.dq-consume-N: 负责从ready队列中读取消息并通知给对应回调接口，个数可配置</li>\n<li>5.dq-redis-checker: 负责检查redis的服务状态，如果redis宕机，发送告警邮件</li>\n<li>6.dq-http-server: 提供web后台界面，用于注册topic</li>\n</ul>\n<h4 id=\"五、安装扩展\"><a href=\"#五、安装扩展\" class=\"headerlink\" title=\"五、安装扩展\"></a>五、安装扩展</h4><p>环境依赖：<code>PHP 5.5+  安装sockets，redis，pcntl,pdo_mysql 拓展</code>   </p>\n<h5 id=\"一、docker容器安装扩展\"><a href=\"#一、docker容器安装扩展\" class=\"headerlink\" title=\"一、docker容器安装扩展\"></a>一、docker容器安装扩展</h5><p>1.docker exec -it myFpm bash</p>\n<p>2.curl -L -o &#x2F;tmp&#x2F;redis.tar.gz<br><a href=\"https://github.com/phpredis/phpredis/archive/3.1.3.tar.gz\">https://github.com/phpredis/phpredis/archive/3.1.3.tar.gz</a></p>\n<p>3.tar xfz &#x2F;tmp&#x2F;redis.tar.gz</p>\n<p>4.rm -r &#x2F;tmp&#x2F;redis.tar.gz</p>\n<p>5.mkdir -p &#x2F;usr&#x2F;src&#x2F;php&#x2F;ext</p>\n<p>6.mv phpredis-3.1.3 &#x2F;usr&#x2F;src&#x2F;php&#x2F;ext&#x2F;redis</p>\n<p>7.docker-php-ext-install redis</p>\n<h5 id=\"二、ubutu16-04-php7安装扩展\"><a href=\"#二、ubutu16-04-php7安装扩展\" class=\"headerlink\" title=\"二、ubutu16.04 php7安装扩展\"></a>二、ubutu16.04 php7安装扩展</h5><p>1.参考：  <a href=\"https://blog.csdn.net/woqianduo/article/details/89405240\">https://blog.csdn.net/woqianduo/article/details/89405240</a></p>\n<p>2.按照上述不知道为什么一致不可以，只能直接使用apt-get install php7.0-redis一次性成功</p>\n<h4 id=\"六、部署\"><a href=\"#六、部署\" class=\"headerlink\" title=\"六、部署\"></a>六、部署</h4><h5 id=\"step1-安装数据库用于存储一些topic以及告警信息\"><a href=\"#step1-安装数据库用于存储一些topic以及告警信息\" class=\"headerlink\" title=\"step1:安装数据库用于存储一些topic以及告警信息\"></a>step1:安装数据库用于存储一些topic以及告警信息</h5><p>执行:</p>\n<blockquote>\n<p>mysql&gt; source dq.sql</p>\n</blockquote>\n<h5 id=\"step2-在DqConfg-文件中配置数据库信息：-DqConf-db\"><a href=\"#step2-在DqConfg-文件中配置数据库信息：-DqConf-db\" class=\"headerlink\" title=\"step2:在DqConfg.文件中配置数据库信息： DqConf::$db\"></a>step2:在DqConfg.文件中配置数据库信息： DqConf::$db</h5><h5 id=\"step3-启动http服务\"><a href=\"#step3-启动http服务\" class=\"headerlink\" title=\"step3: 启动http服务\"></a>step3: 启动http服务</h5><p>在DqConf.php文件中修改php了路径 $phpBin</p>\n<p>命令：</p>\n<blockquote>\n<p>php DqHttpServer.php –port 8088</p>\n</blockquote>\n<p>访问:<a href=\"http://127.0.0.1:8088,出现配置界面\">http://127.0.0.1:8088,出现配置界面</a></p>\n<p>redis信息格式：host:port:auth 比如 127.0.0.1:6379:12345</p>\n<h5 id=\"stop4-配置告信息-比如redis宕机\"><a href=\"#stop4-配置告信息-比如redis宕机\" class=\"headerlink\" title=\"stop4:配置告信息(比如redis宕机)\"></a>stop4:配置告信息(比如redis宕机)</h5><h5 id=\"stop5-注册topic\"><a href=\"#stop5-注册topic\" class=\"headerlink\" title=\"stop5:注册topic\"></a>stop5:注册topic</h5><p>重试标记说明:</p>\n<pre><code>1.接口返回为空默认重试\n2.满足指定返回表达会重试，res表示返回的json数组，比如:\n回调接口返回json串：&#123;&quot;code&quot;:200,&quot;data&quot;:&#123;&quot;status&quot;:2,&quot;msg&quot;:&quot;返回失败&quot;&#125;&#125;，重试条件可以这样写\n    &#123;res.code&#125;!=200 \n    &#123;res.code&#125;!=200 &amp;&amp; &#123;res.data.status&#125;!=2 \n    &#123;res.code&#125;==200 &amp;&amp; &#123;res.data.status&#125;==2 || &#123;res.data.msg&#125;==&#39;返回失败&#39;\n</code></pre>\n<h5 id=\"step6-启动服务进程\"><a href=\"#step6-启动服务进程\" class=\"headerlink\" title=\"step6:启动服务进程:\"></a>step6:启动服务进程:</h5><blockquote>\n<p>php DqInit.php –port 6789 &amp;</p>\n</blockquote>\n<p>执行 ps -ef | grep dq 看到如下信息说明启动成功</p>\n<h5 id=\"step7-写入数据，参考demo-php\"><a href=\"#step7-写入数据，参考demo-php\" class=\"headerlink\" title=\"step7: 写入数据，参考demo.php\"></a>step7: 写入数据，参考demo.php</h5><h5 id=\"step8-查看日志\"><a href=\"#step8-查看日志\" class=\"headerlink\" title=\"step8:查看日志\"></a>step8:查看日志</h5><p>默认日志目录在项目目录的logs目录下，在DqConf.php修改$logPath</p>\n<ul>\n<li>1.请求日志：request_ymd.txt</li>\n<li>2.通知日志：notify_ymd.txt </li>\n<li>3.错误日志：err_ymd.txt</li>\n</ul>\n<h5 id=\"step9-如果配置文件有改动\"><a href=\"#step9-如果配置文件有改动\" class=\"headerlink\" title=\"step9:如果配置文件有改动\"></a>step9:如果配置文件有改动</h5><ul>\n<li>1.系统会自动检测配置文件新，如果有改动，会自动退出(没有找到较好的热更新的方案)，需要重启，可以在crontab里面建个任务,1分钟执行一次，程序有check_self的判断</li>\n<li>2.优雅退出命令:  master检测侦听了USR2信号，收到信号后会通知所有子进程，子进程完成当前任务后会自动退出</li>\n</ul>\n<blockquote>\n<p>ps -ef | grep dq-master| grep -v grep | head -n 1 | awk ‘{print $2}’ | xargs kill -USR2</p>\n</blockquote>\n<h3 id=\"七、性能测试\"><a href=\"#七、性能测试\" class=\"headerlink\" title=\"七、性能测试\"></a>七、性能测试</h3><p>需要安装pthreads拓展：</p>\n<p>测试原理：使用多线程模拟并发，在1s内能成功返回请求成功的个数</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php DqBench  concurrency  requests</span><br><span class=\"line\">concurrency:并发数</span><br><span class=\"line\">requests： 每个并发产生的请求数</span><br><span class=\"line\"></span><br><span class=\"line\">测试环境：内存 8G ，8核cpu，2个redis和1个dq-server 部署在一个机器上，数据包64字节</span><br><span class=\"line\">qps：2400</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"八、值得一提的性能优化点：\"><a href=\"#八、值得一提的性能优化点：\" class=\"headerlink\" title=\"八、值得一提的性能优化点：\"></a>八、值得一提的性能优化点：</h3><ul>\n<li>1.redis multi命令：将多个对redis的操作打包成一个减少网络开销</li>\n<li>2.计数的操作异步处理，在异步逻辑里面用函数的static变量来保存，当写入redis成功后释放static变量，可以在redis出现异常时计数仍能保持一致，除非进程退出</li>\n<li>3.内存泄露检测有必要:  所有的内存分配在底层都是调用了brk或者mmap，只要程序只有大量brk或者mmap的系统调用，内存泄露可能性非常高 ,检测命令: strace -c -p pid | grep -P ‘mmap| brk’</li>\n<li>4.检测程序的系统调用情况：strace -c -p pid  ，发现某个系统函数调用是其他的数倍，可能大概率程序存在问题</li>\n<li>消息返回的是true，我改成返回success，同时我使用的是phalapi框架，改成回调通知了，具体参考：<a href=\"http://docs.phalapi.net/#/v2.0/api?id=%e5%a6%82%e4%bd%95%e7%bc%96%e5%86%99%e6%94%af%e4%bb%98%e7%ad%89%e5%9b%9e%e8%b0%83%e6%8e%a5%e5%8f%a3%ef%bc%9f\">http://docs.phalapi.net/#/v2.0/api?id=%e5%a6%82%e4%bd%95%e7%bc%96%e5%86%99%e6%94%af%e4%bb%98%e7%ad%89%e5%9b%9e%e8%b0%83%e6%8e%a5%e5%8f%a3%ef%bc%9f</a></li>\n</ul>\n<h3 id=\"九、异常处理\"><a href=\"#九、异常处理\" class=\"headerlink\" title=\"九、异常处理\"></a>九、异常处理</h3><p>1.如果调用通知接口在超时时间内，没有收到回复认为通知失败，系统会重新把数据放入队列，重新通知，系统默认最大通知10次(可以在Dqconf.php文件中修改$notify_exp_nums)通知间隔为2n+1，比如第一次1分钟，通知失败，第二次3分钟后，直到收到回复，超出最大通知次数后系统自动丢弃，同时发邮件通知</p>\n<p>2.线上redis每隔1s持久化一次，存在丢失1s数据的情况，出现这种情况可以对比request_ymd.txt和notify_ymd.txt日志手动恢复过来</p>\n<p>3.redis宕机通知:</p>\n<p><code>ps:网络抖动在所难免，通知接口如果涉及到核心的服务,一定要保证幂等！！</code></p>\n<h3 id=\"十、主要接入业务\"><a href=\"#十、主要接入业务\" class=\"headerlink\" title=\"十、主要接入业务\"></a>十、主要接入业务</h3><ul>\n<li>订单10分钟召回通知</li>\n<li>调用接口超时或者失败时做补偿</li>\n<li>会员过期前3天召回通知</li>\n<li>抽奖定时推送生成抽奖记录。</li>\n</ul>\n<h3 id=\"十一、不足与展望\"><a href=\"#十一、不足与展望\" class=\"headerlink\" title=\"十一、不足与展望\"></a>十一、不足与展望</h3><p>1.由于团队使用的镜像缺少libevent拓展，所以dq-server基于select模型，并发高的场景下性能存在瓶颈，后续可以改为基于libevent事件模型，提升并发性能</p>\n<p>2.timer和consumer目前是采用多进程来做的，这个粒度感觉有点粗，可以考虑使用多线程模式，并且支持动态创建线程数来提高consumer的性能，最大程度保证消费及时</p>\n<p>3.dq-server与redis是同步调用，这也是性能的瓶颈点，计划基于swoole_redis来异步处理</p>\n<p>4.邮件配置未使用，计划改成server酱或者钉钉推送通知</p>\n<p>5.消息删除这里还未很明确，并且在回调通知里修改能再处理比如删除不用的消息</p>\n<p>6.热更新不了，只能手动关掉再开启</p>\n<p>7.增加如果根据按人头抽奖自动发送通知</p>\n"},{"_content":"### 阿里云服务器添加秘钥\n1.登录控制台，创建秘钥对，并下载为a.pem  \n2.ssh-keygen -y -f a.pem会返回ssh-rsa  \n如果该命令失败，请运行chmod 400 my-key-pair.pem命令更改权限  \n3.登录到服务器a.com中，echo >> ~/.ssh/authorized_keys  \n4.nano /etc/ssh/sshd_config\nPermitRootLogin yes\n当你完成全部设置，并以密钥方式登录成功后，再禁用密码登录：\nPasswordAuthentication no  \n5.service sshd restart\n\n#### 访问：\nssh -i a.pem root@a.com 访问\n如果想省事的话，ssh-add -k a.pem，重启之后需要重新添加\n直接ssh root@a.com 即可访问\n#### 出现 Could not open a connection to your authentication agent解决办法或者Permission denied (publickey).：\n>eval `ssh-agent -s`  ","source":"_posts/SSH/SSH添加阿里云秘钥.md","raw":"---\ncategories:\n  - SSH\n---\n### 阿里云服务器添加秘钥\n1.登录控制台，创建秘钥对，并下载为a.pem  \n2.ssh-keygen -y -f a.pem会返回ssh-rsa  \n如果该命令失败，请运行chmod 400 my-key-pair.pem命令更改权限  \n3.登录到服务器a.com中，echo >> ~/.ssh/authorized_keys  \n4.nano /etc/ssh/sshd_config\nPermitRootLogin yes\n当你完成全部设置，并以密钥方式登录成功后，再禁用密码登录：\nPasswordAuthentication no  \n5.service sshd restart\n\n#### 访问：\nssh -i a.pem root@a.com 访问\n如果想省事的话，ssh-add -k a.pem，重启之后需要重新添加\n直接ssh root@a.com 即可访问\n#### 出现 Could not open a connection to your authentication agent解决办法或者Permission denied (publickey).：\n>eval `ssh-agent -s`  ","slug":"SSH添加阿里云秘钥","published":1,"category":"SSH","date":"2023-06-08T23:03:56.106Z","updated":"2023-06-08T23:12:13.739Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5sei001idxjc1wqsg9pp","content":"<h3 id=\"阿里云服务器添加秘钥\"><a href=\"#阿里云服务器添加秘钥\" class=\"headerlink\" title=\"阿里云服务器添加秘钥\"></a>阿里云服务器添加秘钥</h3><p>1.登录控制台，创建秘钥对，并下载为a.pem<br>2.ssh-keygen -y -f a.pem会返回ssh-rsa<br>如果该命令失败，请运行chmod 400 my-key-pair.pem命令更改权限<br>3.登录到服务器a.com中，echo &gt;&gt; ~&#x2F;.ssh&#x2F;authorized_keys<br>4.nano &#x2F;etc&#x2F;ssh&#x2F;sshd_config<br>PermitRootLogin yes<br>当你完成全部设置，并以密钥方式登录成功后，再禁用密码登录：<br>PasswordAuthentication no<br>5.service sshd restart</p>\n<h4 id=\"访问：\"><a href=\"#访问：\" class=\"headerlink\" title=\"访问：\"></a>访问：</h4><p>ssh -i a.pem <a href=\"mailto:&#114;&#111;&#111;&#116;&#64;&#97;&#46;&#x63;&#111;&#x6d;\">&#114;&#111;&#111;&#116;&#64;&#97;&#46;&#x63;&#111;&#x6d;</a> 访问<br>如果想省事的话，ssh-add -k a.pem，重启之后需要重新添加<br>直接ssh <a href=\"mailto:&#114;&#x6f;&#x6f;&#116;&#x40;&#97;&#x2e;&#99;&#x6f;&#109;\">&#114;&#x6f;&#x6f;&#116;&#x40;&#97;&#x2e;&#99;&#x6f;&#109;</a> 即可访问</p>\n<h4 id=\"出现-Could-not-open-a-connection-to-your-authentication-agent解决办法或者Permission-denied-publickey-：\"><a href=\"#出现-Could-not-open-a-connection-to-your-authentication-agent解决办法或者Permission-denied-publickey-：\" class=\"headerlink\" title=\"出现 Could not open a connection to your authentication agent解决办法或者Permission denied (publickey).：\"></a>出现 Could not open a connection to your authentication agent解决办法或者Permission denied (publickey).：</h4><blockquote>\n<p>eval <code>ssh-agent -s</code>  </p>\n</blockquote>\n","site":{"data":{}},"length":567,"excerpt":"","more":"<h3 id=\"阿里云服务器添加秘钥\"><a href=\"#阿里云服务器添加秘钥\" class=\"headerlink\" title=\"阿里云服务器添加秘钥\"></a>阿里云服务器添加秘钥</h3><p>1.登录控制台，创建秘钥对，并下载为a.pem<br>2.ssh-keygen -y -f a.pem会返回ssh-rsa<br>如果该命令失败，请运行chmod 400 my-key-pair.pem命令更改权限<br>3.登录到服务器a.com中，echo &gt;&gt; ~&#x2F;.ssh&#x2F;authorized_keys<br>4.nano &#x2F;etc&#x2F;ssh&#x2F;sshd_config<br>PermitRootLogin yes<br>当你完成全部设置，并以密钥方式登录成功后，再禁用密码登录：<br>PasswordAuthentication no<br>5.service sshd restart</p>\n<h4 id=\"访问：\"><a href=\"#访问：\" class=\"headerlink\" title=\"访问：\"></a>访问：</h4><p>ssh -i a.pem <a href=\"mailto:&#114;&#111;&#111;&#116;&#64;&#97;&#46;&#x63;&#111;&#x6d;\">&#114;&#111;&#111;&#116;&#64;&#97;&#46;&#x63;&#111;&#x6d;</a> 访问<br>如果想省事的话，ssh-add -k a.pem，重启之后需要重新添加<br>直接ssh <a href=\"mailto:&#114;&#x6f;&#x6f;&#116;&#x40;&#97;&#x2e;&#99;&#x6f;&#109;\">&#114;&#x6f;&#x6f;&#116;&#x40;&#97;&#x2e;&#99;&#x6f;&#109;</a> 即可访问</p>\n<h4 id=\"出现-Could-not-open-a-connection-to-your-authentication-agent解决办法或者Permission-denied-publickey-：\"><a href=\"#出现-Could-not-open-a-connection-to-your-authentication-agent解决办法或者Permission-denied-publickey-：\" class=\"headerlink\" title=\"出现 Could not open a connection to your authentication agent解决办法或者Permission denied (publickey).：\"></a>出现 Could not open a connection to your authentication agent解决办法或者Permission denied (publickey).：</h4><blockquote>\n<p>eval <code>ssh-agent -s</code>  </p>\n</blockquote>\n"},{"_content":"#### 访问内网局域网网站\n目的是想用在家的mac访问到公司的电话机所在的网址，首先自行搭建vpn，这个网上教程还蛮多。   \n本人用的是mac，公司的电脑大多数是win10  \nwin10 连接vpn方法如下图：  \n![avatar](https://blog.hexiefamily.xin/assets/ssh3.png)  \n#### ssh 连接win10：   \n1. win10 开启openssh 服务端：http://jingyan.baidu.com/article/455a995057a191a1662778a3.html 百度教程你值得拥有  \n2. ssh -D 4567 -N root@192.168.12.1 输入密码，即可停留   \n3. 打开chrome神奇插件SwitchyOmega,配置一个这样的代理  \n![avatar](https://blog.hexiefamily.xin/assets/ssh1.png)\n4. 即可打开win10 所在的局域网的网站，如下图所示\n![avatar](https://blog.hexiefamily.xin/assets/ssh2.png)","source":"_posts/SSH/SSH访问局域网网站.md","raw":"---\ncategories:\n  - SSH\n---\n#### 访问内网局域网网站\n目的是想用在家的mac访问到公司的电话机所在的网址，首先自行搭建vpn，这个网上教程还蛮多。   \n本人用的是mac，公司的电脑大多数是win10  \nwin10 连接vpn方法如下图：  \n![avatar](https://blog.hexiefamily.xin/assets/ssh3.png)  \n#### ssh 连接win10：   \n1. win10 开启openssh 服务端：http://jingyan.baidu.com/article/455a995057a191a1662778a3.html 百度教程你值得拥有  \n2. ssh -D 4567 -N root@192.168.12.1 输入密码，即可停留   \n3. 打开chrome神奇插件SwitchyOmega,配置一个这样的代理  \n![avatar](https://blog.hexiefamily.xin/assets/ssh1.png)\n4. 即可打开win10 所在的局域网的网站，如下图所示\n![avatar](https://blog.hexiefamily.xin/assets/ssh2.png)","slug":"SSH访问局域网网站","published":1,"category":"SSH","date":"2023-06-08T23:03:56.104Z","updated":"2023-06-08T23:12:13.739Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5sej001ldxjcha5qhiox","content":"<h4 id=\"访问内网局域网网站\"><a href=\"#访问内网局域网网站\" class=\"headerlink\" title=\"访问内网局域网网站\"></a>访问内网局域网网站</h4><p>目的是想用在家的mac访问到公司的电话机所在的网址，首先自行搭建vpn，这个网上教程还蛮多。<br>本人用的是mac，公司的电脑大多数是win10<br>win10 连接vpn方法如下图：<br><img src=\"https://blog.hexiefamily.xin/assets/ssh3.png\" alt=\"avatar\">  </p>\n<h4 id=\"ssh-连接win10：\"><a href=\"#ssh-连接win10：\" class=\"headerlink\" title=\"ssh 连接win10：\"></a>ssh 连接win10：</h4><ol>\n<li>win10 开启openssh 服务端：<a href=\"http://jingyan.baidu.com/article/455a995057a191a1662778a3.html\">http://jingyan.baidu.com/article/455a995057a191a1662778a3.html</a> 百度教程你值得拥有  </li>\n<li>ssh -D 4567 -N <a href=\"mailto:&#x72;&#x6f;&#x6f;&#x74;&#x40;&#x31;&#57;&#50;&#x2e;&#49;&#54;&#56;&#x2e;&#x31;&#x32;&#x2e;&#49;\">&#x72;&#x6f;&#x6f;&#x74;&#x40;&#x31;&#57;&#50;&#x2e;&#49;&#54;&#56;&#x2e;&#x31;&#x32;&#x2e;&#49;</a> 输入密码，即可停留   </li>\n<li>打开chrome神奇插件SwitchyOmega,配置一个这样的代理<br><img src=\"https://blog.hexiefamily.xin/assets/ssh1.png\" alt=\"avatar\"></li>\n<li>即可打开win10 所在的局域网的网站，如下图所示<br><img src=\"https://blog.hexiefamily.xin/assets/ssh2.png\" alt=\"avatar\"></li>\n</ol>\n","site":{"data":{}},"length":368,"excerpt":"","more":"<h4 id=\"访问内网局域网网站\"><a href=\"#访问内网局域网网站\" class=\"headerlink\" title=\"访问内网局域网网站\"></a>访问内网局域网网站</h4><p>目的是想用在家的mac访问到公司的电话机所在的网址，首先自行搭建vpn，这个网上教程还蛮多。<br>本人用的是mac，公司的电脑大多数是win10<br>win10 连接vpn方法如下图：<br><img src=\"https://blog.hexiefamily.xin/assets/ssh3.png\" alt=\"avatar\">  </p>\n<h4 id=\"ssh-连接win10：\"><a href=\"#ssh-连接win10：\" class=\"headerlink\" title=\"ssh 连接win10：\"></a>ssh 连接win10：</h4><ol>\n<li>win10 开启openssh 服务端：<a href=\"http://jingyan.baidu.com/article/455a995057a191a1662778a3.html\">http://jingyan.baidu.com/article/455a995057a191a1662778a3.html</a> 百度教程你值得拥有  </li>\n<li>ssh -D 4567 -N <a href=\"mailto:&#x72;&#x6f;&#x6f;&#x74;&#x40;&#x31;&#57;&#50;&#x2e;&#49;&#54;&#56;&#x2e;&#x31;&#x32;&#x2e;&#49;\">&#x72;&#x6f;&#x6f;&#x74;&#x40;&#x31;&#57;&#50;&#x2e;&#49;&#54;&#56;&#x2e;&#x31;&#x32;&#x2e;&#49;</a> 输入密码，即可停留   </li>\n<li>打开chrome神奇插件SwitchyOmega,配置一个这样的代理<br><img src=\"https://blog.hexiefamily.xin/assets/ssh1.png\" alt=\"avatar\"></li>\n<li>即可打开win10 所在的局域网的网站，如下图所示<br><img src=\"https://blog.hexiefamily.xin/assets/ssh2.png\" alt=\"avatar\"></li>\n</ol>\n"},{"_content":"### 利用acme 生成https协议\n\n##### 手动https\n1.curl  https://get.acme.sh | sh  \n2.cd ~/.acme.sh/  \n3.alias acme.sh=~/.acme.sh/acme.sh  \n4.acme.sh --issue --force  -d a.test.com --webroot /var/www/html/a/  \n5.mkdir -p /etc/nginx/ssl_cert/a.test.com  \n6.acme.sh --install-cert -d a.test.com --key-file /etc/nginx/ssl_cert/a.test.com/key.pem --fullchain-file /etc/nginx/ssl_cert/a.test.com/cert.pem --reloadcmd     \"service nginx force-reload\"\n\n##### 手动dns\n1.acme.sh --issue -d a.test.com --dns --yes-I-know-dns-manual-mode-enough-go-ahead-please  \n2.nslookup -q=TXT _acme-challenge.a.test.com \n3.acme.sh --renew -d a.test.com --yes-I-know-dns-manual-mode-enough-go-ahead-please  \n4.mkdir -p /etc/nginx/ssl_cert/a.test.com \n5.acme.sh --install-cert -d a.test.com --key-file /etc/nginx/ssl_cert/a.test.com/key.pem --fullchain-file /etc/nginx/ssl_cert/a.test.com/cert.pem --reloadcmd     \"service nginx force-reload\"  \n###### Nginx 配置：\n6.listen 443;  \n  ssl_certificate /etc/nginx/ssl_cert/a.test.com/cert.pem;  \n  ssl_certificate_key /etc/nginx/ssl_cert/a.test.com/key.pem;  \n  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;  \n  ssl_prefer_server_ciphers on;  ","source":"_posts/SSH/acme生成https协议操作方法.md","raw":"---\ncategories:\n  - SSH\n---\n### 利用acme 生成https协议\n\n##### 手动https\n1.curl  https://get.acme.sh | sh  \n2.cd ~/.acme.sh/  \n3.alias acme.sh=~/.acme.sh/acme.sh  \n4.acme.sh --issue --force  -d a.test.com --webroot /var/www/html/a/  \n5.mkdir -p /etc/nginx/ssl_cert/a.test.com  \n6.acme.sh --install-cert -d a.test.com --key-file /etc/nginx/ssl_cert/a.test.com/key.pem --fullchain-file /etc/nginx/ssl_cert/a.test.com/cert.pem --reloadcmd     \"service nginx force-reload\"\n\n##### 手动dns\n1.acme.sh --issue -d a.test.com --dns --yes-I-know-dns-manual-mode-enough-go-ahead-please  \n2.nslookup -q=TXT _acme-challenge.a.test.com \n3.acme.sh --renew -d a.test.com --yes-I-know-dns-manual-mode-enough-go-ahead-please  \n4.mkdir -p /etc/nginx/ssl_cert/a.test.com \n5.acme.sh --install-cert -d a.test.com --key-file /etc/nginx/ssl_cert/a.test.com/key.pem --fullchain-file /etc/nginx/ssl_cert/a.test.com/cert.pem --reloadcmd     \"service nginx force-reload\"  \n###### Nginx 配置：\n6.listen 443;  \n  ssl_certificate /etc/nginx/ssl_cert/a.test.com/cert.pem;  \n  ssl_certificate_key /etc/nginx/ssl_cert/a.test.com/key.pem;  \n  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;  \n  ssl_prefer_server_ciphers on;  ","slug":"acme生成https协议操作方法","published":1,"category":"SSH","date":"2023-06-08T23:03:56.106Z","updated":"2023-06-08T23:12:13.743Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5sek001mdxjc38ar7rr4","content":"<h3 id=\"利用acme-生成https协议\"><a href=\"#利用acme-生成https协议\" class=\"headerlink\" title=\"利用acme 生成https协议\"></a>利用acme 生成https协议</h3><h5 id=\"手动https\"><a href=\"#手动https\" class=\"headerlink\" title=\"手动https\"></a>手动https</h5><p>1.curl  <a href=\"https://get.acme.sh/\">https://get.acme.sh</a> | sh<br>2.cd <del>&#x2F;.acme.sh&#x2F;<br>3.alias acme.sh&#x3D;</del>&#x2F;.acme.sh&#x2F;acme.sh<br>4.acme.sh –issue –force  -d a.test.com –webroot &#x2F;var&#x2F;www&#x2F;html&#x2F;a&#x2F;<br>5.mkdir -p &#x2F;etc&#x2F;nginx&#x2F;ssl_cert&#x2F;a.test.com<br>6.acme.sh –install-cert -d a.test.com –key-file &#x2F;etc&#x2F;nginx&#x2F;ssl_cert&#x2F;a.test.com&#x2F;key.pem –fullchain-file &#x2F;etc&#x2F;nginx&#x2F;ssl_cert&#x2F;a.test.com&#x2F;cert.pem –reloadcmd     “service nginx force-reload”</p>\n<h5 id=\"手动dns\"><a href=\"#手动dns\" class=\"headerlink\" title=\"手动dns\"></a>手动dns</h5><p>1.acme.sh –issue -d a.test.com –dns –yes-I-know-dns-manual-mode-enough-go-ahead-please<br>2.nslookup -q&#x3D;TXT _acme-challenge.a.test.com<br>3.acme.sh –renew -d a.test.com –yes-I-know-dns-manual-mode-enough-go-ahead-please<br>4.mkdir -p &#x2F;etc&#x2F;nginx&#x2F;ssl_cert&#x2F;a.test.com<br>5.acme.sh –install-cert -d a.test.com –key-file &#x2F;etc&#x2F;nginx&#x2F;ssl_cert&#x2F;a.test.com&#x2F;key.pem –fullchain-file &#x2F;etc&#x2F;nginx&#x2F;ssl_cert&#x2F;a.test.com&#x2F;cert.pem –reloadcmd     “service nginx force-reload”  </p>\n<h6 id=\"Nginx-配置：\"><a href=\"#Nginx-配置：\" class=\"headerlink\" title=\"Nginx 配置：\"></a>Nginx 配置：</h6><p>6.listen 443;<br>  ssl_certificate &#x2F;etc&#x2F;nginx&#x2F;ssl_cert&#x2F;a.test.com&#x2F;cert.pem;<br>  ssl_certificate_key &#x2F;etc&#x2F;nginx&#x2F;ssl_cert&#x2F;a.test.com&#x2F;key.pem;<br>  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;<br>  ssl_prefer_server_ciphers on;  </p>\n","site":{"data":{}},"length":1217,"excerpt":"","more":"<h3 id=\"利用acme-生成https协议\"><a href=\"#利用acme-生成https协议\" class=\"headerlink\" title=\"利用acme 生成https协议\"></a>利用acme 生成https协议</h3><h5 id=\"手动https\"><a href=\"#手动https\" class=\"headerlink\" title=\"手动https\"></a>手动https</h5><p>1.curl  <a href=\"https://get.acme.sh/\">https://get.acme.sh</a> | sh<br>2.cd <del>&#x2F;.acme.sh&#x2F;<br>3.alias acme.sh&#x3D;</del>&#x2F;.acme.sh&#x2F;acme.sh<br>4.acme.sh –issue –force  -d a.test.com –webroot &#x2F;var&#x2F;www&#x2F;html&#x2F;a&#x2F;<br>5.mkdir -p &#x2F;etc&#x2F;nginx&#x2F;ssl_cert&#x2F;a.test.com<br>6.acme.sh –install-cert -d a.test.com –key-file &#x2F;etc&#x2F;nginx&#x2F;ssl_cert&#x2F;a.test.com&#x2F;key.pem –fullchain-file &#x2F;etc&#x2F;nginx&#x2F;ssl_cert&#x2F;a.test.com&#x2F;cert.pem –reloadcmd     “service nginx force-reload”</p>\n<h5 id=\"手动dns\"><a href=\"#手动dns\" class=\"headerlink\" title=\"手动dns\"></a>手动dns</h5><p>1.acme.sh –issue -d a.test.com –dns –yes-I-know-dns-manual-mode-enough-go-ahead-please<br>2.nslookup -q&#x3D;TXT _acme-challenge.a.test.com<br>3.acme.sh –renew -d a.test.com –yes-I-know-dns-manual-mode-enough-go-ahead-please<br>4.mkdir -p &#x2F;etc&#x2F;nginx&#x2F;ssl_cert&#x2F;a.test.com<br>5.acme.sh –install-cert -d a.test.com –key-file &#x2F;etc&#x2F;nginx&#x2F;ssl_cert&#x2F;a.test.com&#x2F;key.pem –fullchain-file &#x2F;etc&#x2F;nginx&#x2F;ssl_cert&#x2F;a.test.com&#x2F;cert.pem –reloadcmd     “service nginx force-reload”  </p>\n<h6 id=\"Nginx-配置：\"><a href=\"#Nginx-配置：\" class=\"headerlink\" title=\"Nginx 配置：\"></a>Nginx 配置：</h6><p>6.listen 443;<br>  ssl_certificate &#x2F;etc&#x2F;nginx&#x2F;ssl_cert&#x2F;a.test.com&#x2F;cert.pem;<br>  ssl_certificate_key &#x2F;etc&#x2F;nginx&#x2F;ssl_cert&#x2F;a.test.com&#x2F;key.pem;<br>  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;<br>  ssl_prefer_server_ciphers on;  </p>\n"},{"_content":"## 背景\n最近因为在做公众号自动同步的开发，每次一push代码，服务器的webhook就会不生效，同时会停止运行，导致博客网站停止，必须得手动取开启。\n\n### 原因\n初步判断是阿里云在git pull github的代码时，一直不执行，可能是外网的问题。\n\n### 解决思路\n想到之前国内的gitee也存在代码，考虑同步github,再通过webhook 更新\n\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203131218367.png)\n\n### 步骤\n\n#### **实时同步github到gitee**\n1.ssh-keygen -t rsa -C \"youremail@example.com\"\n生成的 id_rsa 是私钥，id_rsa.pub 是公钥。(注意此处不要设置密码，生成的公私钥用于下面 GitHub / Gitee 的配置，以保证公私钥成对，否则从 GitHub -%3E Gitee 的同步将会失败。)\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203131223319.png)\n\n2.在 GitHub 项目的「**Settings**  ->  **Secrets**  →  **New repository secret**」路径下配置好命名为 **GITEE_RSA_PRIVATE_KEY**，value值填写 **id_rsa 私钥**的内容。\n\n3.在 GitHub 的个人设置页面「**Settings** ->  **SSH and GPG keys**」配置 SSH Keys 公钥（即：**id_rsa.pub**），命名随意。\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203131227576.png)\n\n4.在 Gitee 的个人设置页面「**安全设置** -> **SSH公钥**」配置 SSH 公钥（即：**id_rsa.pub**），命名随意。\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203131228907.png)\n\n5.创建 workflow\n\n```yaml\nname: SyncToGitee\n\non:\n  push:\n    branches: [master]\n  workflow_dispatch:\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Github Sync to Gitee\n        uses: wearerequired/git-mirror-action@master\n        env:\n          # 注意在 Settings->Secrets 配置 GITEE_RSA_PRIVATE_KEY\n          SSH_PRIVATE_KEY: ${{ secrets.GITEE_RSA_PRIVATE_KEY }}\n        with:\n          # 注意替换为你的 GitHub 源仓库地址\n          source-repo: git@github.com:cjyzwg/cjblog.git\n          # 注意替换为你的 Gitee 目标仓库地址\n          destination-repo: git@gitee.com:cjyzwg/cjblog.git\n          \n```\n\n6.执行同步,修改代码（如修改 README），提交，成功触发同步！\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203131231561.png)\n\n#### **配置gitee webhook**\n1.在 Gitee 项目的「**管理** -> **WebHooks** 」路径下配置好url和webhook密码。\n\n2.在 Github 项目的「**Settings** -> **Webhooks** 」路径下删除对应的webhook。\n\n**如果克隆的地址是github，则要执行此步**\n\n3.在对应的执行的项目目录下切换成gitee：  \n\n> git remote set-url origin https://gitee.com/cjyzwg/cjblog.git\n\n##### 同步操作结束，愉快的执行go run main.go吧～","source":"_posts/SSH/gitee同步github.md","raw":"---\ncategories:\n  - SSH\n---\n## 背景\n最近因为在做公众号自动同步的开发，每次一push代码，服务器的webhook就会不生效，同时会停止运行，导致博客网站停止，必须得手动取开启。\n\n### 原因\n初步判断是阿里云在git pull github的代码时，一直不执行，可能是外网的问题。\n\n### 解决思路\n想到之前国内的gitee也存在代码，考虑同步github,再通过webhook 更新\n\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203131218367.png)\n\n### 步骤\n\n#### **实时同步github到gitee**\n1.ssh-keygen -t rsa -C \"youremail@example.com\"\n生成的 id_rsa 是私钥，id_rsa.pub 是公钥。(注意此处不要设置密码，生成的公私钥用于下面 GitHub / Gitee 的配置，以保证公私钥成对，否则从 GitHub -%3E Gitee 的同步将会失败。)\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203131223319.png)\n\n2.在 GitHub 项目的「**Settings**  ->  **Secrets**  →  **New repository secret**」路径下配置好命名为 **GITEE_RSA_PRIVATE_KEY**，value值填写 **id_rsa 私钥**的内容。\n\n3.在 GitHub 的个人设置页面「**Settings** ->  **SSH and GPG keys**」配置 SSH Keys 公钥（即：**id_rsa.pub**），命名随意。\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203131227576.png)\n\n4.在 Gitee 的个人设置页面「**安全设置** -> **SSH公钥**」配置 SSH 公钥（即：**id_rsa.pub**），命名随意。\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203131228907.png)\n\n5.创建 workflow\n\n```yaml\nname: SyncToGitee\n\non:\n  push:\n    branches: [master]\n  workflow_dispatch:\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Github Sync to Gitee\n        uses: wearerequired/git-mirror-action@master\n        env:\n          # 注意在 Settings->Secrets 配置 GITEE_RSA_PRIVATE_KEY\n          SSH_PRIVATE_KEY: ${{ secrets.GITEE_RSA_PRIVATE_KEY }}\n        with:\n          # 注意替换为你的 GitHub 源仓库地址\n          source-repo: git@github.com:cjyzwg/cjblog.git\n          # 注意替换为你的 Gitee 目标仓库地址\n          destination-repo: git@gitee.com:cjyzwg/cjblog.git\n          \n```\n\n6.执行同步,修改代码（如修改 README），提交，成功触发同步！\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203131231561.png)\n\n#### **配置gitee webhook**\n1.在 Gitee 项目的「**管理** -> **WebHooks** 」路径下配置好url和webhook密码。\n\n2.在 Github 项目的「**Settings** -> **Webhooks** 」路径下删除对应的webhook。\n\n**如果克隆的地址是github，则要执行此步**\n\n3.在对应的执行的项目目录下切换成gitee：  \n\n> git remote set-url origin https://gitee.com/cjyzwg/cjblog.git\n\n##### 同步操作结束，愉快的执行go run main.go吧～","slug":"gitee同步github","published":1,"category":"SSH","date":"2023-06-08T23:03:56.105Z","updated":"2023-06-08T23:12:13.740Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5sel001pdxjc1ryqg281","content":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>最近因为在做公众号自动同步的开发，每次一push代码，服务器的webhook就会不生效，同时会停止运行，导致博客网站停止，必须得手动取开启。</p>\n<h3 id=\"原因\"><a href=\"#原因\" class=\"headerlink\" title=\"原因\"></a>原因</h3><p>初步判断是阿里云在git pull github的代码时，一直不执行，可能是外网的问题。</p>\n<h3 id=\"解决思路\"><a href=\"#解决思路\" class=\"headerlink\" title=\"解决思路\"></a>解决思路</h3><p>想到之前国内的gitee也存在代码，考虑同步github,再通过webhook 更新</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203131218367.png\"></p>\n<h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3><h4 id=\"实时同步github到gitee\"><a href=\"#实时同步github到gitee\" class=\"headerlink\" title=\"实时同步github到gitee\"></a><strong>实时同步github到gitee</strong></h4><p>1.ssh-keygen -t rsa -C “<a href=\"mailto:&#x79;&#111;&#x75;&#114;&#101;&#109;&#x61;&#105;&#108;&#x40;&#101;&#x78;&#97;&#x6d;&#112;&#108;&#x65;&#x2e;&#x63;&#111;&#x6d;\">&#x79;&#111;&#x75;&#114;&#101;&#109;&#x61;&#105;&#108;&#x40;&#101;&#x78;&#97;&#x6d;&#112;&#108;&#x65;&#x2e;&#x63;&#111;&#x6d;</a>“<br>生成的 id_rsa 是私钥，id_rsa.pub 是公钥。(注意此处不要设置密码，生成的公私钥用于下面 GitHub &#x2F; Gitee 的配置，以保证公私钥成对，否则从 GitHub -%3E Gitee 的同步将会失败。)</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203131223319.png\"></p>\n<p>2.在 GitHub 项目的「<strong>Settings</strong>  -&gt;  <strong>Secrets</strong>  →  <strong>New repository secret</strong>」路径下配置好命名为 <strong>GITEE_RSA_PRIVATE_KEY</strong>，value值填写 <strong>id_rsa 私钥</strong>的内容。</p>\n<p>3.在 GitHub 的个人设置页面「<strong>Settings</strong> -&gt;  <strong>SSH and GPG keys</strong>」配置 SSH Keys 公钥（即：<strong>id_rsa.pub</strong>），命名随意。</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203131227576.png\"></p>\n<p>4.在 Gitee 的个人设置页面「<strong>安全设置</strong> -&gt; <strong>SSH公钥</strong>」配置 SSH 公钥（即：<strong>id_rsa.pub</strong>），命名随意。</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203131228907.png\"></p>\n<p>5.创建 workflow</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">name:</span> <span class=\"string\">SyncToGitee</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">on:</span></span><br><span class=\"line\">  <span class=\"attr\">push:</span></span><br><span class=\"line\">    <span class=\"attr\">branches:</span> [<span class=\"string\">master</span>]</span><br><span class=\"line\">  <span class=\"attr\">workflow_dispatch:</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">jobs:</span></span><br><span class=\"line\">  <span class=\"attr\">build:</span></span><br><span class=\"line\">    <span class=\"attr\">runs-on:</span> <span class=\"string\">ubuntu-latest</span></span><br><span class=\"line\">    <span class=\"attr\">steps:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Github</span> <span class=\"string\">Sync</span> <span class=\"string\">to</span> <span class=\"string\">Gitee</span></span><br><span class=\"line\">        <span class=\"attr\">uses:</span> <span class=\"string\">wearerequired/git-mirror-action@master</span></span><br><span class=\"line\">        <span class=\"attr\">env:</span></span><br><span class=\"line\">          <span class=\"comment\"># 注意在 Settings-&gt;Secrets 配置 GITEE_RSA_PRIVATE_KEY</span></span><br><span class=\"line\">          <span class=\"attr\">SSH_PRIVATE_KEY:</span> <span class=\"string\">$&#123;&#123;</span> <span class=\"string\">secrets.GITEE_RSA_PRIVATE_KEY</span> <span class=\"string\">&#125;&#125;</span></span><br><span class=\"line\">        <span class=\"attr\">with:</span></span><br><span class=\"line\">          <span class=\"comment\"># 注意替换为你的 GitHub 源仓库地址</span></span><br><span class=\"line\">          <span class=\"attr\">source-repo:</span> <span class=\"string\">git@github.com:cjyzwg/cjblog.git</span></span><br><span class=\"line\">          <span class=\"comment\"># 注意替换为你的 Gitee 目标仓库地址</span></span><br><span class=\"line\">          <span class=\"attr\">destination-repo:</span> <span class=\"string\">git@gitee.com:cjyzwg/cjblog.git</span></span><br><span class=\"line\">          </span><br></pre></td></tr></table></figure>\n\n<p>6.执行同步,修改代码（如修改 README），提交，成功触发同步！</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203131231561.png\"></p>\n<h4 id=\"配置gitee-webhook\"><a href=\"#配置gitee-webhook\" class=\"headerlink\" title=\"配置gitee webhook\"></a><strong>配置gitee webhook</strong></h4><p>1.在 Gitee 项目的「<strong>管理</strong> -&gt; <strong>WebHooks</strong> 」路径下配置好url和webhook密码。</p>\n<p>2.在 Github 项目的「<strong>Settings</strong> -&gt; <strong>Webhooks</strong> 」路径下删除对应的webhook。</p>\n<p><strong>如果克隆的地址是github，则要执行此步</strong></p>\n<p>3.在对应的执行的项目目录下切换成gitee：  </p>\n<blockquote>\n<p>git remote set-url origin <a href=\"https://gitee.com/cjyzwg/cjblog.git\">https://gitee.com/cjyzwg/cjblog.git</a></p>\n</blockquote>\n<h5 id=\"同步操作结束，愉快的执行go-run-main-go吧～\"><a href=\"#同步操作结束，愉快的执行go-run-main-go吧～\" class=\"headerlink\" title=\"同步操作结束，愉快的执行go run main.go吧～\"></a>同步操作结束，愉快的执行go run main.go吧～</h5>","site":{"data":{}},"length":1408,"excerpt":"","more":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>最近因为在做公众号自动同步的开发，每次一push代码，服务器的webhook就会不生效，同时会停止运行，导致博客网站停止，必须得手动取开启。</p>\n<h3 id=\"原因\"><a href=\"#原因\" class=\"headerlink\" title=\"原因\"></a>原因</h3><p>初步判断是阿里云在git pull github的代码时，一直不执行，可能是外网的问题。</p>\n<h3 id=\"解决思路\"><a href=\"#解决思路\" class=\"headerlink\" title=\"解决思路\"></a>解决思路</h3><p>想到之前国内的gitee也存在代码，考虑同步github,再通过webhook 更新</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203131218367.png\"></p>\n<h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3><h4 id=\"实时同步github到gitee\"><a href=\"#实时同步github到gitee\" class=\"headerlink\" title=\"实时同步github到gitee\"></a><strong>实时同步github到gitee</strong></h4><p>1.ssh-keygen -t rsa -C “<a href=\"mailto:&#x79;&#111;&#x75;&#114;&#101;&#109;&#x61;&#105;&#108;&#x40;&#101;&#x78;&#97;&#x6d;&#112;&#108;&#x65;&#x2e;&#x63;&#111;&#x6d;\">&#x79;&#111;&#x75;&#114;&#101;&#109;&#x61;&#105;&#108;&#x40;&#101;&#x78;&#97;&#x6d;&#112;&#108;&#x65;&#x2e;&#x63;&#111;&#x6d;</a>“<br>生成的 id_rsa 是私钥，id_rsa.pub 是公钥。(注意此处不要设置密码，生成的公私钥用于下面 GitHub &#x2F; Gitee 的配置，以保证公私钥成对，否则从 GitHub -%3E Gitee 的同步将会失败。)</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203131223319.png\"></p>\n<p>2.在 GitHub 项目的「<strong>Settings</strong>  -&gt;  <strong>Secrets</strong>  →  <strong>New repository secret</strong>」路径下配置好命名为 <strong>GITEE_RSA_PRIVATE_KEY</strong>，value值填写 <strong>id_rsa 私钥</strong>的内容。</p>\n<p>3.在 GitHub 的个人设置页面「<strong>Settings</strong> -&gt;  <strong>SSH and GPG keys</strong>」配置 SSH Keys 公钥（即：<strong>id_rsa.pub</strong>），命名随意。</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203131227576.png\"></p>\n<p>4.在 Gitee 的个人设置页面「<strong>安全设置</strong> -&gt; <strong>SSH公钥</strong>」配置 SSH 公钥（即：<strong>id_rsa.pub</strong>），命名随意。</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203131228907.png\"></p>\n<p>5.创建 workflow</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">name:</span> <span class=\"string\">SyncToGitee</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">on:</span></span><br><span class=\"line\">  <span class=\"attr\">push:</span></span><br><span class=\"line\">    <span class=\"attr\">branches:</span> [<span class=\"string\">master</span>]</span><br><span class=\"line\">  <span class=\"attr\">workflow_dispatch:</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">jobs:</span></span><br><span class=\"line\">  <span class=\"attr\">build:</span></span><br><span class=\"line\">    <span class=\"attr\">runs-on:</span> <span class=\"string\">ubuntu-latest</span></span><br><span class=\"line\">    <span class=\"attr\">steps:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Github</span> <span class=\"string\">Sync</span> <span class=\"string\">to</span> <span class=\"string\">Gitee</span></span><br><span class=\"line\">        <span class=\"attr\">uses:</span> <span class=\"string\">wearerequired/git-mirror-action@master</span></span><br><span class=\"line\">        <span class=\"attr\">env:</span></span><br><span class=\"line\">          <span class=\"comment\"># 注意在 Settings-&gt;Secrets 配置 GITEE_RSA_PRIVATE_KEY</span></span><br><span class=\"line\">          <span class=\"attr\">SSH_PRIVATE_KEY:</span> <span class=\"string\">$&#123;&#123;</span> <span class=\"string\">secrets.GITEE_RSA_PRIVATE_KEY</span> <span class=\"string\">&#125;&#125;</span></span><br><span class=\"line\">        <span class=\"attr\">with:</span></span><br><span class=\"line\">          <span class=\"comment\"># 注意替换为你的 GitHub 源仓库地址</span></span><br><span class=\"line\">          <span class=\"attr\">source-repo:</span> <span class=\"string\">git@github.com:cjyzwg/cjblog.git</span></span><br><span class=\"line\">          <span class=\"comment\"># 注意替换为你的 Gitee 目标仓库地址</span></span><br><span class=\"line\">          <span class=\"attr\">destination-repo:</span> <span class=\"string\">git@gitee.com:cjyzwg/cjblog.git</span></span><br><span class=\"line\">          </span><br></pre></td></tr></table></figure>\n\n<p>6.执行同步,修改代码（如修改 README），提交，成功触发同步！</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203131231561.png\"></p>\n<h4 id=\"配置gitee-webhook\"><a href=\"#配置gitee-webhook\" class=\"headerlink\" title=\"配置gitee webhook\"></a><strong>配置gitee webhook</strong></h4><p>1.在 Gitee 项目的「<strong>管理</strong> -&gt; <strong>WebHooks</strong> 」路径下配置好url和webhook密码。</p>\n<p>2.在 Github 项目的「<strong>Settings</strong> -&gt; <strong>Webhooks</strong> 」路径下删除对应的webhook。</p>\n<p><strong>如果克隆的地址是github，则要执行此步</strong></p>\n<p>3.在对应的执行的项目目录下切换成gitee：  </p>\n<blockquote>\n<p>git remote set-url origin <a href=\"https://gitee.com/cjyzwg/cjblog.git\">https://gitee.com/cjyzwg/cjblog.git</a></p>\n</blockquote>\n<h5 id=\"同步操作结束，愉快的执行go-run-main-go吧～\"><a href=\"#同步操作结束，愉快的执行go-run-main-go吧～\" class=\"headerlink\" title=\"同步操作结束，愉快的执行go run main.go吧～\"></a>同步操作结束，愉快的执行go run main.go吧～</h5>"},{"_content":"### 搭建OpenVPN （目的是用本地的mac连上公司的windows电脑）\n\n1.wget https://git.io/vpn -O openvpn-install.sh && bash openvpn-install.sh\n\n#### 出现的问题\n- 客户端连上 但是上不了外网  \nnano /etc/openvpn/server.conf  \n```conf\n    这部分改掉，改成下面\n    ;push \"redirect-gateway def1 bypass-dhcp\"\n    push \"dhcp-option DNS 223.5.5.5\"\n    push \"dhcp-option DNS 223.6.6.6\"\n    原因：\n    push \"redirect-gateway def1 bypass-dhcp\" 配置是下发了网关  下发了网关的话，客户端访问公网就不走公网网关了，都走VPN \n```\n\n- 客户端连上了，但是互相ping不通  \n```conf\n在server.conf 中加一个\nclient-to-client\n```\n\n- 完整的server.conf 是这样的\n```conf\nport 1194\nproto udp\ndev tun\nsndbuf 0\nrcvbuf 0\nca ca.crt\ncert server.crt\nkey server.key\ndh dh.pem\nauth SHA512\ntls-auth ta.key 0\ntopology subnet\nserver 10.8.0.0 255.255.255.0\nclient-to-client\nifconfig-pool-persist ipp.txt\n;push \"redirect-gateway def1 bypass-dhcp\"\npush \"dhcp-option DNS 223.5.5.5\"\npush \"dhcp-option DNS 223.6.6.6\"\nkeepalive 10 120\ncipher AES-256-CBC\nuser nobody\ngroup nogroup\npersist-key\npersist-tun\nstatus openvpn-status.log\nverb 3\ncrl-verify crl.pem\n```\n\n- Windows 连上上不了外网：  \nwindows:\ntracert 114.114.114.114 最后到114.114.114.114 说明可以\nmac:\ntraceroute 默认是UDP协议，traceroute -I 114.114.114.114 也是可以的\ntracert是成功连网的。系统防火墙一般都都是阻挡的入方向，对出方向默认都是放行的，除非手动配置出方向的，才会被阻断。如果不能连接的话，一般都是在自身网关这里出问题的，或者对方禁止访问的，也有可能是网段问题（比如冲突），自身的安全策略问题可能性比较小，除非自己手动配置了出方向安全策略或者默认出方向全部拒绝。\n\n问题解决：\nclient.ovpn\n```conf\nclient\ndev tun\nproto udp\nsndbuf 0\nrcvbuf 0\nremote 47.102.84.178 1194\nresolv-retry infinite\nnobind\npersist-key\npersist-tun\nremote-cert-tls server\nauth SHA512\ncipher AES-256-CBC\n;setenv opt block-outside-dns\nkey-direction 1\nverb 3\n需要将 block-outside-dns  删掉\n如果设置了 block-outside-dns  ，OpenVPN 会添加 Windows 防火墙记录，拦掉除 tap 以外的所有网络接口上的 DNS 请求。\n如果想全部走vpn 则使用这个。  \n```\n\n#### 同时修改之后 /etc/init.d/openvpn restart  \n\n- 中途卡住的问题\n1.openvpn-install.sh 中要去调用github的代码，阿里云实例竟然获取不到github上的数据，只能手动下载，再放到服务器中，用了文件挂载 sshfs排查问题。   \n2.apt-get update 一直显示 build.openvpn.net connect time out\n是因为/etc/apt/sources.list.d 中有一些缓存，需要直接删除，再处理。","source":"_posts/VPN/Openvpn.md","raw":"---\ncategories:\n  - VPN\n---\n### 搭建OpenVPN （目的是用本地的mac连上公司的windows电脑）\n\n1.wget https://git.io/vpn -O openvpn-install.sh && bash openvpn-install.sh\n\n#### 出现的问题\n- 客户端连上 但是上不了外网  \nnano /etc/openvpn/server.conf  \n```conf\n    这部分改掉，改成下面\n    ;push \"redirect-gateway def1 bypass-dhcp\"\n    push \"dhcp-option DNS 223.5.5.5\"\n    push \"dhcp-option DNS 223.6.6.6\"\n    原因：\n    push \"redirect-gateway def1 bypass-dhcp\" 配置是下发了网关  下发了网关的话，客户端访问公网就不走公网网关了，都走VPN \n```\n\n- 客户端连上了，但是互相ping不通  \n```conf\n在server.conf 中加一个\nclient-to-client\n```\n\n- 完整的server.conf 是这样的\n```conf\nport 1194\nproto udp\ndev tun\nsndbuf 0\nrcvbuf 0\nca ca.crt\ncert server.crt\nkey server.key\ndh dh.pem\nauth SHA512\ntls-auth ta.key 0\ntopology subnet\nserver 10.8.0.0 255.255.255.0\nclient-to-client\nifconfig-pool-persist ipp.txt\n;push \"redirect-gateway def1 bypass-dhcp\"\npush \"dhcp-option DNS 223.5.5.5\"\npush \"dhcp-option DNS 223.6.6.6\"\nkeepalive 10 120\ncipher AES-256-CBC\nuser nobody\ngroup nogroup\npersist-key\npersist-tun\nstatus openvpn-status.log\nverb 3\ncrl-verify crl.pem\n```\n\n- Windows 连上上不了外网：  \nwindows:\ntracert 114.114.114.114 最后到114.114.114.114 说明可以\nmac:\ntraceroute 默认是UDP协议，traceroute -I 114.114.114.114 也是可以的\ntracert是成功连网的。系统防火墙一般都都是阻挡的入方向，对出方向默认都是放行的，除非手动配置出方向的，才会被阻断。如果不能连接的话，一般都是在自身网关这里出问题的，或者对方禁止访问的，也有可能是网段问题（比如冲突），自身的安全策略问题可能性比较小，除非自己手动配置了出方向安全策略或者默认出方向全部拒绝。\n\n问题解决：\nclient.ovpn\n```conf\nclient\ndev tun\nproto udp\nsndbuf 0\nrcvbuf 0\nremote 47.102.84.178 1194\nresolv-retry infinite\nnobind\npersist-key\npersist-tun\nremote-cert-tls server\nauth SHA512\ncipher AES-256-CBC\n;setenv opt block-outside-dns\nkey-direction 1\nverb 3\n需要将 block-outside-dns  删掉\n如果设置了 block-outside-dns  ，OpenVPN 会添加 Windows 防火墙记录，拦掉除 tap 以外的所有网络接口上的 DNS 请求。\n如果想全部走vpn 则使用这个。  \n```\n\n#### 同时修改之后 /etc/init.d/openvpn restart  \n\n- 中途卡住的问题\n1.openvpn-install.sh 中要去调用github的代码，阿里云实例竟然获取不到github上的数据，只能手动下载，再放到服务器中，用了文件挂载 sshfs排查问题。   \n2.apt-get update 一直显示 build.openvpn.net connect time out\n是因为/etc/apt/sources.list.d 中有一些缓存，需要直接删除，再处理。","slug":"Openvpn","published":1,"category":"VPN","date":"2023-06-08T23:03:56.108Z","updated":"2023-06-08T23:12:13.747Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5sel001qdxjc4o1mbi8z","content":"<h3 id=\"搭建OpenVPN-（目的是用本地的mac连上公司的windows电脑）\"><a href=\"#搭建OpenVPN-（目的是用本地的mac连上公司的windows电脑）\" class=\"headerlink\" title=\"搭建OpenVPN （目的是用本地的mac连上公司的windows电脑）\"></a>搭建OpenVPN （目的是用本地的mac连上公司的windows电脑）</h3><p>1.wget <a href=\"https://git.io/vpn\">https://git.io/vpn</a> -O openvpn-install.sh &amp;&amp; bash openvpn-install.sh</p>\n<h4 id=\"出现的问题\"><a href=\"#出现的问题\" class=\"headerlink\" title=\"出现的问题\"></a>出现的问题</h4><ul>\n<li><p>客户端连上 但是上不了外网<br>nano &#x2F;etc&#x2F;openvpn&#x2F;server.conf  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">这部分改掉，改成下面</span><br><span class=\"line\">;push &quot;redirect-gateway def1 bypass-dhcp&quot;</span><br><span class=\"line\">push &quot;dhcp-option DNS 223.5.5.5&quot;</span><br><span class=\"line\">push &quot;dhcp-option DNS 223.6.6.6&quot;</span><br><span class=\"line\">原因：</span><br><span class=\"line\">push &quot;redirect-gateway def1 bypass-dhcp&quot; 配置是下发了网关  下发了网关的话，客户端访问公网就不走公网网关了，都走VPN </span><br></pre></td></tr></table></figure>\n</li>\n<li><p>客户端连上了，但是互相ping不通  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">在server.conf 中加一个</span><br><span class=\"line\">client-to-client</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>完整的server.conf 是这样的</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">port 1194</span><br><span class=\"line\">proto udp</span><br><span class=\"line\">dev tun</span><br><span class=\"line\">sndbuf 0</span><br><span class=\"line\">rcvbuf 0</span><br><span class=\"line\">ca ca.crt</span><br><span class=\"line\">cert server.crt</span><br><span class=\"line\">key server.key</span><br><span class=\"line\">dh dh.pem</span><br><span class=\"line\">auth SHA512</span><br><span class=\"line\">tls-auth ta.key 0</span><br><span class=\"line\">topology subnet</span><br><span class=\"line\">server 10.8.0.0 255.255.255.0</span><br><span class=\"line\">client-to-client</span><br><span class=\"line\">ifconfig-pool-persist ipp.txt</span><br><span class=\"line\">;push &quot;redirect-gateway def1 bypass-dhcp&quot;</span><br><span class=\"line\">push &quot;dhcp-option DNS 223.5.5.5&quot;</span><br><span class=\"line\">push &quot;dhcp-option DNS 223.6.6.6&quot;</span><br><span class=\"line\">keepalive 10 120</span><br><span class=\"line\">cipher AES-256-CBC</span><br><span class=\"line\">user nobody</span><br><span class=\"line\">group nogroup</span><br><span class=\"line\">persist-key</span><br><span class=\"line\">persist-tun</span><br><span class=\"line\">status openvpn-status.log</span><br><span class=\"line\">verb 3</span><br><span class=\"line\">crl-verify crl.pem</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Windows 连上上不了外网：<br>windows:<br>tracert 114.114.114.114 最后到114.114.114.114 说明可以<br>mac:<br>traceroute 默认是UDP协议，traceroute -I 114.114.114.114 也是可以的<br>tracert是成功连网的。系统防火墙一般都都是阻挡的入方向，对出方向默认都是放行的，除非手动配置出方向的，才会被阻断。如果不能连接的话，一般都是在自身网关这里出问题的，或者对方禁止访问的，也有可能是网段问题（比如冲突），自身的安全策略问题可能性比较小，除非自己手动配置了出方向安全策略或者默认出方向全部拒绝。</p>\n</li>\n</ul>\n<p>问题解决：<br>client.ovpn</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">client</span><br><span class=\"line\">dev tun</span><br><span class=\"line\">proto udp</span><br><span class=\"line\">sndbuf 0</span><br><span class=\"line\">rcvbuf 0</span><br><span class=\"line\">remote 47.102.84.178 1194</span><br><span class=\"line\">resolv-retry infinite</span><br><span class=\"line\">nobind</span><br><span class=\"line\">persist-key</span><br><span class=\"line\">persist-tun</span><br><span class=\"line\">remote-cert-tls server</span><br><span class=\"line\">auth SHA512</span><br><span class=\"line\">cipher AES-256-CBC</span><br><span class=\"line\">;setenv opt block-outside-dns</span><br><span class=\"line\">key-direction 1</span><br><span class=\"line\">verb 3</span><br><span class=\"line\">需要将 block-outside-dns  删掉</span><br><span class=\"line\">如果设置了 block-outside-dns  ，OpenVPN 会添加 Windows 防火墙记录，拦掉除 tap 以外的所有网络接口上的 DNS 请求。</span><br><span class=\"line\">如果想全部走vpn 则使用这个。  </span><br></pre></td></tr></table></figure>\n\n<h4 id=\"同时修改之后-x2F-etc-x2F-init-d-x2F-openvpn-restart\"><a href=\"#同时修改之后-x2F-etc-x2F-init-d-x2F-openvpn-restart\" class=\"headerlink\" title=\"同时修改之后 &#x2F;etc&#x2F;init.d&#x2F;openvpn restart\"></a>同时修改之后 &#x2F;etc&#x2F;init.d&#x2F;openvpn restart</h4><ul>\n<li>中途卡住的问题<br>1.openvpn-install.sh 中要去调用github的代码，阿里云实例竟然获取不到github上的数据，只能手动下载，再放到服务器中，用了文件挂载 sshfs排查问题。<br>2.apt-get update 一直显示 build.openvpn.net connect time out<br>是因为&#x2F;etc&#x2F;apt&#x2F;sources.list.d 中有一些缓存，需要直接删除，再处理。</li>\n</ul>\n","site":{"data":{}},"length":1828,"excerpt":"","more":"<h3 id=\"搭建OpenVPN-（目的是用本地的mac连上公司的windows电脑）\"><a href=\"#搭建OpenVPN-（目的是用本地的mac连上公司的windows电脑）\" class=\"headerlink\" title=\"搭建OpenVPN （目的是用本地的mac连上公司的windows电脑）\"></a>搭建OpenVPN （目的是用本地的mac连上公司的windows电脑）</h3><p>1.wget <a href=\"https://git.io/vpn\">https://git.io/vpn</a> -O openvpn-install.sh &amp;&amp; bash openvpn-install.sh</p>\n<h4 id=\"出现的问题\"><a href=\"#出现的问题\" class=\"headerlink\" title=\"出现的问题\"></a>出现的问题</h4><ul>\n<li><p>客户端连上 但是上不了外网<br>nano &#x2F;etc&#x2F;openvpn&#x2F;server.conf  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">这部分改掉，改成下面</span><br><span class=\"line\">;push &quot;redirect-gateway def1 bypass-dhcp&quot;</span><br><span class=\"line\">push &quot;dhcp-option DNS 223.5.5.5&quot;</span><br><span class=\"line\">push &quot;dhcp-option DNS 223.6.6.6&quot;</span><br><span class=\"line\">原因：</span><br><span class=\"line\">push &quot;redirect-gateway def1 bypass-dhcp&quot; 配置是下发了网关  下发了网关的话，客户端访问公网就不走公网网关了，都走VPN </span><br></pre></td></tr></table></figure>\n</li>\n<li><p>客户端连上了，但是互相ping不通  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">在server.conf 中加一个</span><br><span class=\"line\">client-to-client</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>完整的server.conf 是这样的</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">port 1194</span><br><span class=\"line\">proto udp</span><br><span class=\"line\">dev tun</span><br><span class=\"line\">sndbuf 0</span><br><span class=\"line\">rcvbuf 0</span><br><span class=\"line\">ca ca.crt</span><br><span class=\"line\">cert server.crt</span><br><span class=\"line\">key server.key</span><br><span class=\"line\">dh dh.pem</span><br><span class=\"line\">auth SHA512</span><br><span class=\"line\">tls-auth ta.key 0</span><br><span class=\"line\">topology subnet</span><br><span class=\"line\">server 10.8.0.0 255.255.255.0</span><br><span class=\"line\">client-to-client</span><br><span class=\"line\">ifconfig-pool-persist ipp.txt</span><br><span class=\"line\">;push &quot;redirect-gateway def1 bypass-dhcp&quot;</span><br><span class=\"line\">push &quot;dhcp-option DNS 223.5.5.5&quot;</span><br><span class=\"line\">push &quot;dhcp-option DNS 223.6.6.6&quot;</span><br><span class=\"line\">keepalive 10 120</span><br><span class=\"line\">cipher AES-256-CBC</span><br><span class=\"line\">user nobody</span><br><span class=\"line\">group nogroup</span><br><span class=\"line\">persist-key</span><br><span class=\"line\">persist-tun</span><br><span class=\"line\">status openvpn-status.log</span><br><span class=\"line\">verb 3</span><br><span class=\"line\">crl-verify crl.pem</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Windows 连上上不了外网：<br>windows:<br>tracert 114.114.114.114 最后到114.114.114.114 说明可以<br>mac:<br>traceroute 默认是UDP协议，traceroute -I 114.114.114.114 也是可以的<br>tracert是成功连网的。系统防火墙一般都都是阻挡的入方向，对出方向默认都是放行的，除非手动配置出方向的，才会被阻断。如果不能连接的话，一般都是在自身网关这里出问题的，或者对方禁止访问的，也有可能是网段问题（比如冲突），自身的安全策略问题可能性比较小，除非自己手动配置了出方向安全策略或者默认出方向全部拒绝。</p>\n</li>\n</ul>\n<p>问题解决：<br>client.ovpn</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">client</span><br><span class=\"line\">dev tun</span><br><span class=\"line\">proto udp</span><br><span class=\"line\">sndbuf 0</span><br><span class=\"line\">rcvbuf 0</span><br><span class=\"line\">remote 47.102.84.178 1194</span><br><span class=\"line\">resolv-retry infinite</span><br><span class=\"line\">nobind</span><br><span class=\"line\">persist-key</span><br><span class=\"line\">persist-tun</span><br><span class=\"line\">remote-cert-tls server</span><br><span class=\"line\">auth SHA512</span><br><span class=\"line\">cipher AES-256-CBC</span><br><span class=\"line\">;setenv opt block-outside-dns</span><br><span class=\"line\">key-direction 1</span><br><span class=\"line\">verb 3</span><br><span class=\"line\">需要将 block-outside-dns  删掉</span><br><span class=\"line\">如果设置了 block-outside-dns  ，OpenVPN 会添加 Windows 防火墙记录，拦掉除 tap 以外的所有网络接口上的 DNS 请求。</span><br><span class=\"line\">如果想全部走vpn 则使用这个。  </span><br></pre></td></tr></table></figure>\n\n<h4 id=\"同时修改之后-x2F-etc-x2F-init-d-x2F-openvpn-restart\"><a href=\"#同时修改之后-x2F-etc-x2F-init-d-x2F-openvpn-restart\" class=\"headerlink\" title=\"同时修改之后 &#x2F;etc&#x2F;init.d&#x2F;openvpn restart\"></a>同时修改之后 &#x2F;etc&#x2F;init.d&#x2F;openvpn restart</h4><ul>\n<li>中途卡住的问题<br>1.openvpn-install.sh 中要去调用github的代码，阿里云实例竟然获取不到github上的数据，只能手动下载，再放到服务器中，用了文件挂载 sshfs排查问题。<br>2.apt-get update 一直显示 build.openvpn.net connect time out<br>是因为&#x2F;etc&#x2F;apt&#x2F;sources.list.d 中有一些缓存，需要直接删除，再处理。</li>\n</ul>\n"},{"_content":"###  本篇拷贝其他文章，还是用于测试上传是否生效，如有问题，立马删除\n3月11日晚，台湾娱乐圈传来噩耗，正在拍摄的台湾电视剧《初拥》被曝突然发生意外，有两名工作人员意外坠谷身亡，令人痛心。\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203122234773.png)\n\n该剧的男主角炎亚纶在得知噩耗后，震惊又气愤，在凌晨时分连夜发长文炮轰制作方，要求对方“给出合理交代和正确态度”，在此之前，他将携该剧所有主演一同罢工，十分强势。\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203122242111.png)\n\n\n\n炎亚纶在长文中说，他为了台剧的每个细节苦恼、担心甚至愤怒，因而得罪了不少制作公司甚至电视台。  \n\n但当他被通知这次发生的憾事时，他还是正义心爆棚，不断问自己，他该坚持的底线到底在哪里？\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203122253210.png)\n\n\n\n\n在炎亚纶的心中，虽然他只是一个演员，可他每一次参与戏剧都是以制作方自居，期盼能照顾到更多的人。\n\n在他眼里，这世界确实存在着许多的不公，大小眼、辈分、番位，都是真实存在的，可工作人员却常常被大家忽略，从而造成人才出走，憾事不断发生。\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203122237869.png)\n\n所以在这次的坠亡事件发生后，他更加笃定，找到了心里的答案。炎亚纶称，“我的坚持从来不是为我一人，我不是自私的，我就是为了防止今日的憾事发生而发声，一有不合理立即发声，一有不安全立即停止，这是我不应该放过的坚持。”\n\n在制作方多曼尼没给出合理交代与正确态度前，炎亚纶将和该剧所有主演一同停止与该制作单位的合作，并且坚持以正确的安全措施合理工时与符合剧种成本付出为前提来继续下一次的合作，态度强硬。\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203122237440.png)\n\n\n炎亚纶在文末呼吁：“人命平等，一样宝贵，不分贵贱，没有高低，你我都有责任，不要心存侥幸。”\n\n“我恳求演员们、工作人员们、以及相关单位，正视问题解决问题，一同提升台剧环境，如果您们也认同我，请也别让有坚持的演员孤身奋斗。”\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203122238581.png)\n\n炎亚纶的发声情理交融，非常有感染力，让人看了感同身受。在评论下方，成千上万的网友都纷纷赶来，支持他的言论，其中就包括台湾女星吴映洁。\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203122239038.png)\n\n紧接着，《初拥》的女主角姚爱寗也公开表态：“发生这样的事情没有人能置身事外，希望借由这次的事件，让大家更正视拍片安全的问题，改善所有拍片人员的工作环境。”\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203122244210.png)\n\n多年来，影视工作者付出自己的青春与汗水，才成就了许多精彩又优质的作品，却仍不时传出令人伤心的消息。这些遗憾一遍又一遍地提醒着我们在制作影视剧时，千万不能忽略安全问题。\n\n希望逝者安息，后续事宜得到妥善处置，日后不要再有这样的憾事发生。","source":"_posts/吃瓜/炎亚纶新剧出意外！2人坠谷当场死亡，炎亚纶不满剧组强势携全体主演罢工.md","raw":"---\ncategories:\n  - 吃瓜\n---\n###  本篇拷贝其他文章，还是用于测试上传是否生效，如有问题，立马删除\n3月11日晚，台湾娱乐圈传来噩耗，正在拍摄的台湾电视剧《初拥》被曝突然发生意外，有两名工作人员意外坠谷身亡，令人痛心。\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203122234773.png)\n\n该剧的男主角炎亚纶在得知噩耗后，震惊又气愤，在凌晨时分连夜发长文炮轰制作方，要求对方“给出合理交代和正确态度”，在此之前，他将携该剧所有主演一同罢工，十分强势。\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203122242111.png)\n\n\n\n炎亚纶在长文中说，他为了台剧的每个细节苦恼、担心甚至愤怒，因而得罪了不少制作公司甚至电视台。  \n\n但当他被通知这次发生的憾事时，他还是正义心爆棚，不断问自己，他该坚持的底线到底在哪里？\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203122253210.png)\n\n\n\n\n在炎亚纶的心中，虽然他只是一个演员，可他每一次参与戏剧都是以制作方自居，期盼能照顾到更多的人。\n\n在他眼里，这世界确实存在着许多的不公，大小眼、辈分、番位，都是真实存在的，可工作人员却常常被大家忽略，从而造成人才出走，憾事不断发生。\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203122237869.png)\n\n所以在这次的坠亡事件发生后，他更加笃定，找到了心里的答案。炎亚纶称，“我的坚持从来不是为我一人，我不是自私的，我就是为了防止今日的憾事发生而发声，一有不合理立即发声，一有不安全立即停止，这是我不应该放过的坚持。”\n\n在制作方多曼尼没给出合理交代与正确态度前，炎亚纶将和该剧所有主演一同停止与该制作单位的合作，并且坚持以正确的安全措施合理工时与符合剧种成本付出为前提来继续下一次的合作，态度强硬。\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203122237440.png)\n\n\n炎亚纶在文末呼吁：“人命平等，一样宝贵，不分贵贱，没有高低，你我都有责任，不要心存侥幸。”\n\n“我恳求演员们、工作人员们、以及相关单位，正视问题解决问题，一同提升台剧环境，如果您们也认同我，请也别让有坚持的演员孤身奋斗。”\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203122238581.png)\n\n炎亚纶的发声情理交融，非常有感染力，让人看了感同身受。在评论下方，成千上万的网友都纷纷赶来，支持他的言论，其中就包括台湾女星吴映洁。\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203122239038.png)\n\n紧接着，《初拥》的女主角姚爱寗也公开表态：“发生这样的事情没有人能置身事外，希望借由这次的事件，让大家更正视拍片安全的问题，改善所有拍片人员的工作环境。”\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203122244210.png)\n\n多年来，影视工作者付出自己的青春与汗水，才成就了许多精彩又优质的作品，却仍不时传出令人伤心的消息。这些遗憾一遍又一遍地提醒着我们在制作影视剧时，千万不能忽略安全问题。\n\n希望逝者安息，后续事宜得到妥善处置，日后不要再有这样的憾事发生。","slug":"炎亚纶新剧出意外！2人坠谷当场死亡，炎亚纶不满剧组强势携全体主演罢工","published":1,"category":"吃瓜","date":"2023-06-08T23:03:56.110Z","updated":"2023-06-08T23:12:13.744Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5sem001sdxjc4jyzarqt","content":"<h3 id=\"本篇拷贝其他文章，还是用于测试上传是否生效，如有问题，立马删除\"><a href=\"#本篇拷贝其他文章，还是用于测试上传是否生效，如有问题，立马删除\" class=\"headerlink\" title=\"本篇拷贝其他文章，还是用于测试上传是否生效，如有问题，立马删除\"></a>本篇拷贝其他文章，还是用于测试上传是否生效，如有问题，立马删除</h3><p>3月11日晚，台湾娱乐圈传来噩耗，正在拍摄的台湾电视剧《初拥》被曝突然发生意外，有两名工作人员意外坠谷身亡，令人痛心。</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203122234773.png\"></p>\n<p>该剧的男主角炎亚纶在得知噩耗后，震惊又气愤，在凌晨时分连夜发长文炮轰制作方，要求对方“给出合理交代和正确态度”，在此之前，他将携该剧所有主演一同罢工，十分强势。</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203122242111.png\"></p>\n<p>炎亚纶在长文中说，他为了台剧的每个细节苦恼、担心甚至愤怒，因而得罪了不少制作公司甚至电视台。  </p>\n<p>但当他被通知这次发生的憾事时，他还是正义心爆棚，不断问自己，他该坚持的底线到底在哪里？</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203122253210.png\"></p>\n<p>在炎亚纶的心中，虽然他只是一个演员，可他每一次参与戏剧都是以制作方自居，期盼能照顾到更多的人。</p>\n<p>在他眼里，这世界确实存在着许多的不公，大小眼、辈分、番位，都是真实存在的，可工作人员却常常被大家忽略，从而造成人才出走，憾事不断发生。</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203122237869.png\"></p>\n<p>所以在这次的坠亡事件发生后，他更加笃定，找到了心里的答案。炎亚纶称，“我的坚持从来不是为我一人，我不是自私的，我就是为了防止今日的憾事发生而发声，一有不合理立即发声，一有不安全立即停止，这是我不应该放过的坚持。”</p>\n<p>在制作方多曼尼没给出合理交代与正确态度前，炎亚纶将和该剧所有主演一同停止与该制作单位的合作，并且坚持以正确的安全措施合理工时与符合剧种成本付出为前提来继续下一次的合作，态度强硬。</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203122237440.png\"></p>\n<p>炎亚纶在文末呼吁：“人命平等，一样宝贵，不分贵贱，没有高低，你我都有责任，不要心存侥幸。”</p>\n<p>“我恳求演员们、工作人员们、以及相关单位，正视问题解决问题，一同提升台剧环境，如果您们也认同我，请也别让有坚持的演员孤身奋斗。”</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203122238581.png\"></p>\n<p>炎亚纶的发声情理交融，非常有感染力，让人看了感同身受。在评论下方，成千上万的网友都纷纷赶来，支持他的言论，其中就包括台湾女星吴映洁。</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203122239038.png\"></p>\n<p>紧接着，《初拥》的女主角姚爱寗也公开表态：“发生这样的事情没有人能置身事外，希望借由这次的事件，让大家更正视拍片安全的问题，改善所有拍片人员的工作环境。”</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203122244210.png\"></p>\n<p>多年来，影视工作者付出自己的青春与汗水，才成就了许多精彩又优质的作品，却仍不时传出令人伤心的消息。这些遗憾一遍又一遍地提醒着我们在制作影视剧时，千万不能忽略安全问题。</p>\n<p>希望逝者安息，后续事宜得到妥善处置，日后不要再有这样的憾事发生。</p>\n","site":{"data":{}},"length":935,"excerpt":"","more":"<h3 id=\"本篇拷贝其他文章，还是用于测试上传是否生效，如有问题，立马删除\"><a href=\"#本篇拷贝其他文章，还是用于测试上传是否生效，如有问题，立马删除\" class=\"headerlink\" title=\"本篇拷贝其他文章，还是用于测试上传是否生效，如有问题，立马删除\"></a>本篇拷贝其他文章，还是用于测试上传是否生效，如有问题，立马删除</h3><p>3月11日晚，台湾娱乐圈传来噩耗，正在拍摄的台湾电视剧《初拥》被曝突然发生意外，有两名工作人员意外坠谷身亡，令人痛心。</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203122234773.png\"></p>\n<p>该剧的男主角炎亚纶在得知噩耗后，震惊又气愤，在凌晨时分连夜发长文炮轰制作方，要求对方“给出合理交代和正确态度”，在此之前，他将携该剧所有主演一同罢工，十分强势。</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203122242111.png\"></p>\n<p>炎亚纶在长文中说，他为了台剧的每个细节苦恼、担心甚至愤怒，因而得罪了不少制作公司甚至电视台。  </p>\n<p>但当他被通知这次发生的憾事时，他还是正义心爆棚，不断问自己，他该坚持的底线到底在哪里？</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203122253210.png\"></p>\n<p>在炎亚纶的心中，虽然他只是一个演员，可他每一次参与戏剧都是以制作方自居，期盼能照顾到更多的人。</p>\n<p>在他眼里，这世界确实存在着许多的不公，大小眼、辈分、番位，都是真实存在的，可工作人员却常常被大家忽略，从而造成人才出走，憾事不断发生。</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203122237869.png\"></p>\n<p>所以在这次的坠亡事件发生后，他更加笃定，找到了心里的答案。炎亚纶称，“我的坚持从来不是为我一人，我不是自私的，我就是为了防止今日的憾事发生而发声，一有不合理立即发声，一有不安全立即停止，这是我不应该放过的坚持。”</p>\n<p>在制作方多曼尼没给出合理交代与正确态度前，炎亚纶将和该剧所有主演一同停止与该制作单位的合作，并且坚持以正确的安全措施合理工时与符合剧种成本付出为前提来继续下一次的合作，态度强硬。</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203122237440.png\"></p>\n<p>炎亚纶在文末呼吁：“人命平等，一样宝贵，不分贵贱，没有高低，你我都有责任，不要心存侥幸。”</p>\n<p>“我恳求演员们、工作人员们、以及相关单位，正视问题解决问题，一同提升台剧环境，如果您们也认同我，请也别让有坚持的演员孤身奋斗。”</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203122238581.png\"></p>\n<p>炎亚纶的发声情理交融，非常有感染力，让人看了感同身受。在评论下方，成千上万的网友都纷纷赶来，支持他的言论，其中就包括台湾女星吴映洁。</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203122239038.png\"></p>\n<p>紧接着，《初拥》的女主角姚爱寗也公开表态：“发生这样的事情没有人能置身事外，希望借由这次的事件，让大家更正视拍片安全的问题，改善所有拍片人员的工作环境。”</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203122244210.png\"></p>\n<p>多年来，影视工作者付出自己的青春与汗水，才成就了许多精彩又优质的作品，却仍不时传出令人伤心的消息。这些遗憾一遍又一遍地提醒着我们在制作影视剧时，千万不能忽略安全问题。</p>\n<p>希望逝者安息，后续事宜得到妥善处置，日后不要再有这样的憾事发生。</p>\n"},{"_content":"### 搭建git私有服务器命令\n#### 服务器：\n1.sudo apt-get install git-core  \n2.git --bare init /home/git/rep.git (rep为仓库的名字)\n#### 本地：\n1.git clone git@10.8.0.8:/home/git/rep.git\n","source":"_posts/树莓派/搭建git服务器超简单命令.md","raw":"---\ncategories:\n  - 树莓派\n---\n### 搭建git私有服务器命令\n#### 服务器：\n1.sudo apt-get install git-core  \n2.git --bare init /home/git/rep.git (rep为仓库的名字)\n#### 本地：\n1.git clone git@10.8.0.8:/home/git/rep.git\n","slug":"搭建git服务器超简单命令","published":1,"category":"树莓派","date":"2023-06-08T23:03:56.113Z","updated":"2023-06-08T23:12:13.747Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5sen001udxjc8unt88cc","content":"<h3 id=\"搭建git私有服务器命令\"><a href=\"#搭建git私有服务器命令\" class=\"headerlink\" title=\"搭建git私有服务器命令\"></a>搭建git私有服务器命令</h3><h4 id=\"服务器：\"><a href=\"#服务器：\" class=\"headerlink\" title=\"服务器：\"></a>服务器：</h4><p>1.sudo apt-get install git-core<br>2.git –bare init &#x2F;home&#x2F;git&#x2F;rep.git (rep为仓库的名字)</p>\n<h4 id=\"本地：\"><a href=\"#本地：\" class=\"headerlink\" title=\"本地：\"></a>本地：</h4><p>1.git clone <a href=\"mailto:&#x67;&#x69;&#x74;&#x40;&#49;&#x30;&#46;&#56;&#x2e;&#48;&#x2e;&#x38;\">&#x67;&#x69;&#x74;&#x40;&#49;&#x30;&#46;&#56;&#x2e;&#48;&#x2e;&#x38;</a>:&#x2F;home&#x2F;git&#x2F;rep.git</p>\n","site":{"data":{}},"length":215,"excerpt":"","more":"<h3 id=\"搭建git私有服务器命令\"><a href=\"#搭建git私有服务器命令\" class=\"headerlink\" title=\"搭建git私有服务器命令\"></a>搭建git私有服务器命令</h3><h4 id=\"服务器：\"><a href=\"#服务器：\" class=\"headerlink\" title=\"服务器：\"></a>服务器：</h4><p>1.sudo apt-get install git-core<br>2.git –bare init &#x2F;home&#x2F;git&#x2F;rep.git (rep为仓库的名字)</p>\n<h4 id=\"本地：\"><a href=\"#本地：\" class=\"headerlink\" title=\"本地：\"></a>本地：</h4><p>1.git clone <a href=\"mailto:&#x67;&#x69;&#x74;&#x40;&#49;&#x30;&#46;&#56;&#x2e;&#48;&#x2e;&#x38;\">&#x67;&#x69;&#x74;&#x40;&#49;&#x30;&#46;&#56;&#x2e;&#48;&#x2e;&#x38;</a>:&#x2F;home&#x2F;git&#x2F;rep.git</p>\n"},{"_content":"参考链接：http://wangwei.info/mac-raspberrypi3-ubuntu-mate-vncserver-installation/\n\n\n1. 从官网下载镜像：ubuntu-mate-16.04.2-desktop-armhf-raspberry-pi.img.xz\n2. 安装解压工具：brew install xz\n3. 解压镜像：\nxz -help\nxz -d ubuntu-mate-16.04.2-desktop-armhf-raspberry-pi.img.xz\n4.格式化sd卡并安装系统\ndiskutil list # 查看磁盘列表\ndiskutil partitionDisk /dev/disk2 1 MBRFormat \"MS-DOS FAT32\" SDSys 120GB # 格式化SD卡，SDSys为磁盘名\nsudo dd bs=4m if=ubuntu-mate-16.04.2-desktop-armhf-raspberry-pi.img of=/dev/rdisk2 # 写入，若提示“dd: /dev/rdisk2: Permission denied”，则加入sudo命令。\ndiskutil unmountDisk /dev/disk2 # 弹出，若提示“dd: /dev/rdisk2: Resource busy”也需此命令\n5.将sd卡插入树莓派，上电启动即可完成安装。\n注意：diskN中的数字N对应磁盘列表中sd卡的数字，小心格式化掉自己的系统。\n\n\n### 在树莓派上安装VNC服务\n- sudo apt install vnc4server\n安装完成后，启动VNC服务：\n- vncserver :1\n首次启动会要求输入VNC服务的访问密码。如后期需要更改VNC访问密码，只需要输入 vncpassword 即可。\n结束一个VNCServer可以用以下的方法：\n- vncserver -kill :1\n- 修改配置文件\nnano ~/.vnc/xstartup\n在 x-window-manager & 的后面新增下面这 1 行：\nmate-session &\n\n完整配置文件如下：\n```shell\n#!/bin/sh\n# Uncomment the following two lines for normal desktop:\n# unset SESSION_MANAGER\n# exec /etc/X11/xinit/xinitrc\n[ -x /etc/vnc/xstartup ] && exec /etc/vnc/xstartup\n[ -r $HOME/.Xresources ] && xrdb $HOME/.Xresources\nxsetroot -solid grey \nvncconfig -iconic &\nx-terminal-emulator -geometry 80x24+10+10 -ls -title \"$VNCDESKTOP Desktop\" &\nx-window-manager &\nmate-session &\n```\n\n配置文件修改后，需要重启VNC服务。\nMac下的VNC客户端\nMac本身自带一个VNC客户端，叫做屏幕共享，但此程序隐藏的比较深，可以在搜索中搜索屏幕共享找到此程序。\n打开屏幕共享后，输入你刚才配置的VNC服务的地址，例如：192.168.1.101:5901\n5901是VNC服务的默认端口号，如果你启动了多个VNC服务（一个VNC服务对应一个用户身份），则回应多个端口号，一般来说端口号会顺延，例如: 5901 5902\n此时你就可以在Mac上直接访问你的树莓派的桌面了 :-)\n","source":"_posts/树莓派/树莓派烧录.md","raw":"---\ncategories:\n  - 树莓派\n---\n参考链接：http://wangwei.info/mac-raspberrypi3-ubuntu-mate-vncserver-installation/\n\n\n1. 从官网下载镜像：ubuntu-mate-16.04.2-desktop-armhf-raspberry-pi.img.xz\n2. 安装解压工具：brew install xz\n3. 解压镜像：\nxz -help\nxz -d ubuntu-mate-16.04.2-desktop-armhf-raspberry-pi.img.xz\n4.格式化sd卡并安装系统\ndiskutil list # 查看磁盘列表\ndiskutil partitionDisk /dev/disk2 1 MBRFormat \"MS-DOS FAT32\" SDSys 120GB # 格式化SD卡，SDSys为磁盘名\nsudo dd bs=4m if=ubuntu-mate-16.04.2-desktop-armhf-raspberry-pi.img of=/dev/rdisk2 # 写入，若提示“dd: /dev/rdisk2: Permission denied”，则加入sudo命令。\ndiskutil unmountDisk /dev/disk2 # 弹出，若提示“dd: /dev/rdisk2: Resource busy”也需此命令\n5.将sd卡插入树莓派，上电启动即可完成安装。\n注意：diskN中的数字N对应磁盘列表中sd卡的数字，小心格式化掉自己的系统。\n\n\n### 在树莓派上安装VNC服务\n- sudo apt install vnc4server\n安装完成后，启动VNC服务：\n- vncserver :1\n首次启动会要求输入VNC服务的访问密码。如后期需要更改VNC访问密码，只需要输入 vncpassword 即可。\n结束一个VNCServer可以用以下的方法：\n- vncserver -kill :1\n- 修改配置文件\nnano ~/.vnc/xstartup\n在 x-window-manager & 的后面新增下面这 1 行：\nmate-session &\n\n完整配置文件如下：\n```shell\n#!/bin/sh\n# Uncomment the following two lines for normal desktop:\n# unset SESSION_MANAGER\n# exec /etc/X11/xinit/xinitrc\n[ -x /etc/vnc/xstartup ] && exec /etc/vnc/xstartup\n[ -r $HOME/.Xresources ] && xrdb $HOME/.Xresources\nxsetroot -solid grey \nvncconfig -iconic &\nx-terminal-emulator -geometry 80x24+10+10 -ls -title \"$VNCDESKTOP Desktop\" &\nx-window-manager &\nmate-session &\n```\n\n配置文件修改后，需要重启VNC服务。\nMac下的VNC客户端\nMac本身自带一个VNC客户端，叫做屏幕共享，但此程序隐藏的比较深，可以在搜索中搜索屏幕共享找到此程序。\n打开屏幕共享后，输入你刚才配置的VNC服务的地址，例如：192.168.1.101:5901\n5901是VNC服务的默认端口号，如果你启动了多个VNC服务（一个VNC服务对应一个用户身份），则回应多个端口号，一般来说端口号会顺延，例如: 5901 5902\n此时你就可以在Mac上直接访问你的树莓派的桌面了 :-)\n","slug":"树莓派烧录","published":1,"category":"树莓派","date":"2023-06-08T23:03:56.112Z","updated":"2023-06-08T23:12:13.747Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5sen001vdxjc4rqdamff","content":"<p>参考链接：<a href=\"http://wangwei.info/mac-raspberrypi3-ubuntu-mate-vncserver-installation/\">http://wangwei.info/mac-raspberrypi3-ubuntu-mate-vncserver-installation/</a></p>\n<ol>\n<li>从官网下载镜像：ubuntu-mate-16.04.2-desktop-armhf-raspberry-pi.img.xz</li>\n<li>安装解压工具：brew install xz</li>\n<li>解压镜像：<br>xz -help<br>xz -d ubuntu-mate-16.04.2-desktop-armhf-raspberry-pi.img.xz<br>4.格式化sd卡并安装系统<br>diskutil list # 查看磁盘列表<br>diskutil partitionDisk &#x2F;dev&#x2F;disk2 1 MBRFormat “MS-DOS FAT32” SDSys 120GB # 格式化SD卡，SDSys为磁盘名<br>sudo dd bs&#x3D;4m if&#x3D;ubuntu-mate-16.04.2-desktop-armhf-raspberry-pi.img of&#x3D;&#x2F;dev&#x2F;rdisk2 # 写入，若提示“dd: &#x2F;dev&#x2F;rdisk2: Permission denied”，则加入sudo命令。<br>diskutil unmountDisk &#x2F;dev&#x2F;disk2 # 弹出，若提示“dd: &#x2F;dev&#x2F;rdisk2: Resource busy”也需此命令<br>5.将sd卡插入树莓派，上电启动即可完成安装。<br>注意：diskN中的数字N对应磁盘列表中sd卡的数字，小心格式化掉自己的系统。</li>\n</ol>\n<h3 id=\"在树莓派上安装VNC服务\"><a href=\"#在树莓派上安装VNC服务\" class=\"headerlink\" title=\"在树莓派上安装VNC服务\"></a>在树莓派上安装VNC服务</h3><ul>\n<li>sudo apt install vnc4server<br>安装完成后，启动VNC服务：</li>\n<li>vncserver :1<br>首次启动会要求输入VNC服务的访问密码。如后期需要更改VNC访问密码，只需要输入 vncpassword 即可。<br>结束一个VNCServer可以用以下的方法：</li>\n<li>vncserver -kill :1</li>\n<li>修改配置文件<br>nano ~&#x2F;.vnc&#x2F;xstartup<br>在 x-window-manager &amp; 的后面新增下面这 1 行：<br>mate-session &amp;</li>\n</ul>\n<p>完整配置文件如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">!/bin/sh</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">Uncomment the following two lines <span class=\"keyword\">for</span> normal desktop:</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">unset</span> SESSION_MANAGER</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">exec</span> /etc/X11/xinit/xinitrc</span></span><br><span class=\"line\">[ -x /etc/vnc/xstartup ] &amp;&amp; exec /etc/vnc/xstartup</span><br><span class=\"line\">[ -r $HOME/.Xresources ] &amp;&amp; xrdb $HOME/.Xresources</span><br><span class=\"line\">xsetroot -solid grey </span><br><span class=\"line\">vncconfig -iconic &amp;</span><br><span class=\"line\">x-terminal-emulator -geometry 80x24+10+10 -ls -title &quot;$VNCDESKTOP Desktop&quot; &amp;</span><br><span class=\"line\">x-window-manager &amp;</span><br><span class=\"line\">mate-session &amp;</span><br></pre></td></tr></table></figure>\n\n<p>配置文件修改后，需要重启VNC服务。<br>Mac下的VNC客户端<br>Mac本身自带一个VNC客户端，叫做屏幕共享，但此程序隐藏的比较深，可以在搜索中搜索屏幕共享找到此程序。<br>打开屏幕共享后，输入你刚才配置的VNC服务的地址，例如：192.168.1.101:5901<br>5901是VNC服务的默认端口号，如果你启动了多个VNC服务（一个VNC服务对应一个用户身份），则回应多个端口号，一般来说端口号会顺延，例如: 5901 5902<br>此时你就可以在Mac上直接访问你的树莓派的桌面了 :-)</p>\n","site":{"data":{}},"length":1527,"excerpt":"","more":"<p>参考链接：<a href=\"http://wangwei.info/mac-raspberrypi3-ubuntu-mate-vncserver-installation/\">http://wangwei.info/mac-raspberrypi3-ubuntu-mate-vncserver-installation/</a></p>\n<ol>\n<li>从官网下载镜像：ubuntu-mate-16.04.2-desktop-armhf-raspberry-pi.img.xz</li>\n<li>安装解压工具：brew install xz</li>\n<li>解压镜像：<br>xz -help<br>xz -d ubuntu-mate-16.04.2-desktop-armhf-raspberry-pi.img.xz<br>4.格式化sd卡并安装系统<br>diskutil list # 查看磁盘列表<br>diskutil partitionDisk &#x2F;dev&#x2F;disk2 1 MBRFormat “MS-DOS FAT32” SDSys 120GB # 格式化SD卡，SDSys为磁盘名<br>sudo dd bs&#x3D;4m if&#x3D;ubuntu-mate-16.04.2-desktop-armhf-raspberry-pi.img of&#x3D;&#x2F;dev&#x2F;rdisk2 # 写入，若提示“dd: &#x2F;dev&#x2F;rdisk2: Permission denied”，则加入sudo命令。<br>diskutil unmountDisk &#x2F;dev&#x2F;disk2 # 弹出，若提示“dd: &#x2F;dev&#x2F;rdisk2: Resource busy”也需此命令<br>5.将sd卡插入树莓派，上电启动即可完成安装。<br>注意：diskN中的数字N对应磁盘列表中sd卡的数字，小心格式化掉自己的系统。</li>\n</ol>\n<h3 id=\"在树莓派上安装VNC服务\"><a href=\"#在树莓派上安装VNC服务\" class=\"headerlink\" title=\"在树莓派上安装VNC服务\"></a>在树莓派上安装VNC服务</h3><ul>\n<li>sudo apt install vnc4server<br>安装完成后，启动VNC服务：</li>\n<li>vncserver :1<br>首次启动会要求输入VNC服务的访问密码。如后期需要更改VNC访问密码，只需要输入 vncpassword 即可。<br>结束一个VNCServer可以用以下的方法：</li>\n<li>vncserver -kill :1</li>\n<li>修改配置文件<br>nano ~&#x2F;.vnc&#x2F;xstartup<br>在 x-window-manager &amp; 的后面新增下面这 1 行：<br>mate-session &amp;</li>\n</ul>\n<p>完整配置文件如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">!/bin/sh</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">Uncomment the following two lines <span class=\"keyword\">for</span> normal desktop:</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">unset</span> SESSION_MANAGER</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">exec</span> /etc/X11/xinit/xinitrc</span></span><br><span class=\"line\">[ -x /etc/vnc/xstartup ] &amp;&amp; exec /etc/vnc/xstartup</span><br><span class=\"line\">[ -r $HOME/.Xresources ] &amp;&amp; xrdb $HOME/.Xresources</span><br><span class=\"line\">xsetroot -solid grey </span><br><span class=\"line\">vncconfig -iconic &amp;</span><br><span class=\"line\">x-terminal-emulator -geometry 80x24+10+10 -ls -title &quot;$VNCDESKTOP Desktop&quot; &amp;</span><br><span class=\"line\">x-window-manager &amp;</span><br><span class=\"line\">mate-session &amp;</span><br></pre></td></tr></table></figure>\n\n<p>配置文件修改后，需要重启VNC服务。<br>Mac下的VNC客户端<br>Mac本身自带一个VNC客户端，叫做屏幕共享，但此程序隐藏的比较深，可以在搜索中搜索屏幕共享找到此程序。<br>打开屏幕共享后，输入你刚才配置的VNC服务的地址，例如：192.168.1.101:5901<br>5901是VNC服务的默认端口号，如果你启动了多个VNC服务（一个VNC服务对应一个用户身份），则回应多个端口号，一般来说端口号会顺延，例如: 5901 5902<br>此时你就可以在Mac上直接访问你的树莓派的桌面了 :-)</p>\n"},{"_content":"自己的写作能力有限，为了提升自己，没办法，只能硬写了。\n\n粥左罗在他的《学习习作》中提到**一开始不知道写什么，就硬写，其实我们也都是从“硬写”过来的。**\n\n### 对这个世界保留意见\n比如，我觉得整个社会对买房这件事看得太重了，我就特别想写文章来表达我的看法；\n\n比如，疫情在家办公，工资打半折，我就想写文章吐吐牢骚；\n\n比如，之前刷到的一条抖音，女孩彩礼35w，但整个视频里都没有放男生的照片，满屏的评论都是我觉得男的是个冤种这种事情的不理解的意见；\n\n我觉得现在大家的生活都太紧张、太无趣了，我就会写一些有趣的文章，让这个世界更有趣；\n\n\n\n**对某件事保留自己的看法，学会发现平淡日子里的刺，**刺就是那些搅动你情绪的，那些让你触动的，让你感动的，让你惊讶的，让你欣喜的，让你反思的，让你困惑的，这些都是**“刺”**，都是写作的源泉。\n\n### 东航飞机坠落\n**尽管很渺茫，但还是希望这132个人都可以平安无事的归来。**         ","source":"_posts/微信公众号/如何从0-1开始写作.md","raw":"---\ncategories:\n  - 微信公众号\n---\n自己的写作能力有限，为了提升自己，没办法，只能硬写了。\n\n粥左罗在他的《学习习作》中提到**一开始不知道写什么，就硬写，其实我们也都是从“硬写”过来的。**\n\n### 对这个世界保留意见\n比如，我觉得整个社会对买房这件事看得太重了，我就特别想写文章来表达我的看法；\n\n比如，疫情在家办公，工资打半折，我就想写文章吐吐牢骚；\n\n比如，之前刷到的一条抖音，女孩彩礼35w，但整个视频里都没有放男生的照片，满屏的评论都是我觉得男的是个冤种这种事情的不理解的意见；\n\n我觉得现在大家的生活都太紧张、太无趣了，我就会写一些有趣的文章，让这个世界更有趣；\n\n\n\n**对某件事保留自己的看法，学会发现平淡日子里的刺，**刺就是那些搅动你情绪的，那些让你触动的，让你感动的，让你惊讶的，让你欣喜的，让你反思的，让你困惑的，这些都是**“刺”**，都是写作的源泉。\n\n### 东航飞机坠落\n**尽管很渺茫，但还是希望这132个人都可以平安无事的归来。**         ","slug":"如何从0-1开始写作","published":1,"category":"微信公众号","date":"2023-06-08T23:03:56.116Z","updated":"2023-06-08T23:12:13.748Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5seo001ydxjchiipezrx","content":"<p>自己的写作能力有限，为了提升自己，没办法，只能硬写了。</p>\n<p>粥左罗在他的《学习习作》中提到<strong>一开始不知道写什么，就硬写，其实我们也都是从“硬写”过来的。</strong></p>\n<h3 id=\"对这个世界保留意见\"><a href=\"#对这个世界保留意见\" class=\"headerlink\" title=\"对这个世界保留意见\"></a>对这个世界保留意见</h3><p>比如，我觉得整个社会对买房这件事看得太重了，我就特别想写文章来表达我的看法；</p>\n<p>比如，疫情在家办公，工资打半折，我就想写文章吐吐牢骚；</p>\n<p>比如，之前刷到的一条抖音，女孩彩礼35w，但整个视频里都没有放男生的照片，满屏的评论都是我觉得男的是个冤种这种事情的不理解的意见；</p>\n<p>我觉得现在大家的生活都太紧张、太无趣了，我就会写一些有趣的文章，让这个世界更有趣；</p>\n<p><strong>对某件事保留自己的看法，学会发现平淡日子里的刺，</strong>刺就是那些搅动你情绪的，那些让你触动的，让你感动的，让你惊讶的，让你欣喜的，让你反思的，让你困惑的，这些都是<strong>“刺”</strong>，都是写作的源泉。</p>\n<h3 id=\"东航飞机坠落\"><a href=\"#东航飞机坠落\" class=\"headerlink\" title=\"东航飞机坠落\"></a>东航飞机坠落</h3><p><strong>尽管很渺茫，但还是希望这132个人都可以平安无事的归来。</strong>         </p>\n","site":{"data":{}},"length":376,"excerpt":"","more":"<p>自己的写作能力有限，为了提升自己，没办法，只能硬写了。</p>\n<p>粥左罗在他的《学习习作》中提到<strong>一开始不知道写什么，就硬写，其实我们也都是从“硬写”过来的。</strong></p>\n<h3 id=\"对这个世界保留意见\"><a href=\"#对这个世界保留意见\" class=\"headerlink\" title=\"对这个世界保留意见\"></a>对这个世界保留意见</h3><p>比如，我觉得整个社会对买房这件事看得太重了，我就特别想写文章来表达我的看法；</p>\n<p>比如，疫情在家办公，工资打半折，我就想写文章吐吐牢骚；</p>\n<p>比如，之前刷到的一条抖音，女孩彩礼35w，但整个视频里都没有放男生的照片，满屏的评论都是我觉得男的是个冤种这种事情的不理解的意见；</p>\n<p>我觉得现在大家的生活都太紧张、太无趣了，我就会写一些有趣的文章，让这个世界更有趣；</p>\n<p><strong>对某件事保留自己的看法，学会发现平淡日子里的刺，</strong>刺就是那些搅动你情绪的，那些让你触动的，让你感动的，让你惊讶的，让你欣喜的，让你反思的，让你困惑的，这些都是<strong>“刺”</strong>，都是写作的源泉。</p>\n<h3 id=\"东航飞机坠落\"><a href=\"#东航飞机坠落\" class=\"headerlink\" title=\"东航飞机坠落\"></a>东航飞机坠落</h3><p><strong>尽管很渺茫，但还是希望这132个人都可以平安无事的归来。</strong>         </p>\n"},{"_content":"\n近期，华为开放了仓颉语言的部分试用报名。\n\n##### 「仓颉」是华为推出的一款编程语言，适配于鸿蒙系统和欧拉系统。\n\n#### **「仓颉」是中文编程么？**\n「仓颉」不是中文编程，大家看到的网图都是2000年易语言的编程。\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203251653722.png)\n\n\n其实「仓颉」的亮点在于我们输入一段文字，这段文字可以是中文，英文，法文等，然后仓颉的 AI 编辑器就会帮我们生成一段“计算机”可执行的代码！  \n\n中文编程只是看起来美好的噱头，也会降低编译效率，而且写代码的核心是“逻辑”，而不是语言。  \n\n\n\n\n\n#### **「仓颉」适配鸿蒙与欧拉系统**\n\n##### 鸿蒙系统\n\n**使用场景**\n\n- 运行于手机、平板、以及物联网设备面向普通消费者操作系统\n\n\n##### 欧拉系统\n\n**欧拉系统和欧拉车什么关系？**\n\n- 重名，举个例子，你叫张三，他也叫张三\n\n**使用场景**\n\n- 面向企业级服务器的操作系统，直白来说，比如运行像淘宝，拼多多，饿了么外卖订单等系统服务的服务器操作系统。\n\n#### **「仓颉」的意义**\n\n作为一名程序员，站在理性的角度来看\n\n- 当出现一种新的语言，正常情况会解决某一类问题，但具体解决什么问题，得等开源就清楚了，再耐心等等看吧。\n\n- 应该能够助力那些稍有编程思想的人，快速上手写程序，和微信小程序的初衷有点类似。\n\n\n\n\n","source":"_posts/微信公众号/华为近期祭出的仓颉是个啥？.md","raw":"---\ncategories:\n  - 微信公众号\n---\n\n近期，华为开放了仓颉语言的部分试用报名。\n\n##### 「仓颉」是华为推出的一款编程语言，适配于鸿蒙系统和欧拉系统。\n\n#### **「仓颉」是中文编程么？**\n「仓颉」不是中文编程，大家看到的网图都是2000年易语言的编程。\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203251653722.png)\n\n\n其实「仓颉」的亮点在于我们输入一段文字，这段文字可以是中文，英文，法文等，然后仓颉的 AI 编辑器就会帮我们生成一段“计算机”可执行的代码！  \n\n中文编程只是看起来美好的噱头，也会降低编译效率，而且写代码的核心是“逻辑”，而不是语言。  \n\n\n\n\n\n#### **「仓颉」适配鸿蒙与欧拉系统**\n\n##### 鸿蒙系统\n\n**使用场景**\n\n- 运行于手机、平板、以及物联网设备面向普通消费者操作系统\n\n\n##### 欧拉系统\n\n**欧拉系统和欧拉车什么关系？**\n\n- 重名，举个例子，你叫张三，他也叫张三\n\n**使用场景**\n\n- 面向企业级服务器的操作系统，直白来说，比如运行像淘宝，拼多多，饿了么外卖订单等系统服务的服务器操作系统。\n\n#### **「仓颉」的意义**\n\n作为一名程序员，站在理性的角度来看\n\n- 当出现一种新的语言，正常情况会解决某一类问题，但具体解决什么问题，得等开源就清楚了，再耐心等等看吧。\n\n- 应该能够助力那些稍有编程思想的人，快速上手写程序，和微信小程序的初衷有点类似。\n\n\n\n\n","slug":"华为近期祭出的仓颉是个啥？","published":1,"category":"微信公众号","date":"2023-06-08T23:03:56.121Z","updated":"2023-06-08T23:12:13.748Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5sep001zdxjc905naplh","content":"<p>近期，华为开放了仓颉语言的部分试用报名。</p>\n<h5 id=\"「仓颉」是华为推出的一款编程语言，适配于鸿蒙系统和欧拉系统。\"><a href=\"#「仓颉」是华为推出的一款编程语言，适配于鸿蒙系统和欧拉系统。\" class=\"headerlink\" title=\"「仓颉」是华为推出的一款编程语言，适配于鸿蒙系统和欧拉系统。\"></a>「仓颉」是华为推出的一款编程语言，适配于鸿蒙系统和欧拉系统。</h5><h4 id=\"「仓颉」是中文编程么？\"><a href=\"#「仓颉」是中文编程么？\" class=\"headerlink\" title=\"「仓颉」是中文编程么？\"></a><strong>「仓颉」是中文编程么？</strong></h4><p>「仓颉」不是中文编程，大家看到的网图都是2000年易语言的编程。</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203251653722.png\"></p>\n<p>其实「仓颉」的亮点在于我们输入一段文字，这段文字可以是中文，英文，法文等，然后仓颉的 AI 编辑器就会帮我们生成一段“计算机”可执行的代码！  </p>\n<p>中文编程只是看起来美好的噱头，也会降低编译效率，而且写代码的核心是“逻辑”，而不是语言。  </p>\n<h4 id=\"「仓颉」适配鸿蒙与欧拉系统\"><a href=\"#「仓颉」适配鸿蒙与欧拉系统\" class=\"headerlink\" title=\"「仓颉」适配鸿蒙与欧拉系统\"></a><strong>「仓颉」适配鸿蒙与欧拉系统</strong></h4><h5 id=\"鸿蒙系统\"><a href=\"#鸿蒙系统\" class=\"headerlink\" title=\"鸿蒙系统\"></a>鸿蒙系统</h5><p><strong>使用场景</strong></p>\n<ul>\n<li>运行于手机、平板、以及物联网设备面向普通消费者操作系统</li>\n</ul>\n<h5 id=\"欧拉系统\"><a href=\"#欧拉系统\" class=\"headerlink\" title=\"欧拉系统\"></a>欧拉系统</h5><p><strong>欧拉系统和欧拉车什么关系？</strong></p>\n<ul>\n<li>重名，举个例子，你叫张三，他也叫张三</li>\n</ul>\n<p><strong>使用场景</strong></p>\n<ul>\n<li>面向企业级服务器的操作系统，直白来说，比如运行像淘宝，拼多多，饿了么外卖订单等系统服务的服务器操作系统。</li>\n</ul>\n<h4 id=\"「仓颉」的意义\"><a href=\"#「仓颉」的意义\" class=\"headerlink\" title=\"「仓颉」的意义\"></a><strong>「仓颉」的意义</strong></h4><p>作为一名程序员，站在理性的角度来看</p>\n<ul>\n<li><p>当出现一种新的语言，正常情况会解决某一类问题，但具体解决什么问题，得等开源就清楚了，再耐心等等看吧。</p>\n</li>\n<li><p>应该能够助力那些稍有编程思想的人，快速上手写程序，和微信小程序的初衷有点类似。</p>\n</li>\n</ul>\n","site":{"data":{}},"length":457,"excerpt":"","more":"<p>近期，华为开放了仓颉语言的部分试用报名。</p>\n<h5 id=\"「仓颉」是华为推出的一款编程语言，适配于鸿蒙系统和欧拉系统。\"><a href=\"#「仓颉」是华为推出的一款编程语言，适配于鸿蒙系统和欧拉系统。\" class=\"headerlink\" title=\"「仓颉」是华为推出的一款编程语言，适配于鸿蒙系统和欧拉系统。\"></a>「仓颉」是华为推出的一款编程语言，适配于鸿蒙系统和欧拉系统。</h5><h4 id=\"「仓颉」是中文编程么？\"><a href=\"#「仓颉」是中文编程么？\" class=\"headerlink\" title=\"「仓颉」是中文编程么？\"></a><strong>「仓颉」是中文编程么？</strong></h4><p>「仓颉」不是中文编程，大家看到的网图都是2000年易语言的编程。</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203251653722.png\"></p>\n<p>其实「仓颉」的亮点在于我们输入一段文字，这段文字可以是中文，英文，法文等，然后仓颉的 AI 编辑器就会帮我们生成一段“计算机”可执行的代码！  </p>\n<p>中文编程只是看起来美好的噱头，也会降低编译效率，而且写代码的核心是“逻辑”，而不是语言。  </p>\n<h4 id=\"「仓颉」适配鸿蒙与欧拉系统\"><a href=\"#「仓颉」适配鸿蒙与欧拉系统\" class=\"headerlink\" title=\"「仓颉」适配鸿蒙与欧拉系统\"></a><strong>「仓颉」适配鸿蒙与欧拉系统</strong></h4><h5 id=\"鸿蒙系统\"><a href=\"#鸿蒙系统\" class=\"headerlink\" title=\"鸿蒙系统\"></a>鸿蒙系统</h5><p><strong>使用场景</strong></p>\n<ul>\n<li>运行于手机、平板、以及物联网设备面向普通消费者操作系统</li>\n</ul>\n<h5 id=\"欧拉系统\"><a href=\"#欧拉系统\" class=\"headerlink\" title=\"欧拉系统\"></a>欧拉系统</h5><p><strong>欧拉系统和欧拉车什么关系？</strong></p>\n<ul>\n<li>重名，举个例子，你叫张三，他也叫张三</li>\n</ul>\n<p><strong>使用场景</strong></p>\n<ul>\n<li>面向企业级服务器的操作系统，直白来说，比如运行像淘宝，拼多多，饿了么外卖订单等系统服务的服务器操作系统。</li>\n</ul>\n<h4 id=\"「仓颉」的意义\"><a href=\"#「仓颉」的意义\" class=\"headerlink\" title=\"「仓颉」的意义\"></a><strong>「仓颉」的意义</strong></h4><p>作为一名程序员，站在理性的角度来看</p>\n<ul>\n<li><p>当出现一种新的语言，正常情况会解决某一类问题，但具体解决什么问题，得等开源就清楚了，再耐心等等看吧。</p>\n</li>\n<li><p>应该能够助力那些稍有编程思想的人，快速上手写程序，和微信小程序的初衷有点类似。</p>\n</li>\n</ul>\n"},{"_content":"#### **背景**\n\n- 本身有自己的博客网站，以及博客小程序\n- 想更新公众号，一直没有动力去写，一个是自己的文笔实在是太弱，二个是觉得公众号的更新很麻烦，每次都需要去更新，尤其图片要重新上传，这就很麻烦，然后有些样式也不符合要求\n- 前一阵子，看了一个大佬写的无痛苦更新公众号，他写了一个python的插件，受益良多，正在向他学习，大佬的[博客](https://catcoding.me/)网址，公众号是程序员的喵，有兴趣可以关注下\n- 但是别人的东西必须得适用于自己才好，大佬的插件比较精简，但是样式不是我的风格，我想要追加css进去，这样可以随意替换css，其次本人主php，副go，博客是用go开发的，python插件有点突兀，所以这也让我重新拾起go，开发了一个类似他的那个插件的go版本\n- [python版本](https://github.com/chenyukang/markdown-to-wechat)\n- [go版本](https://github.com/cjyzwg/markdown-wechat-demo)\n\n\n#### **安装**\n\n```shell\n\ngit clone https://github.com/cjyzwg/markdown-wechat-demo\n\ngo mod tidy\n\ngo run main.go（即可添加到草稿箱)\n\n```\n\n\n#### **脚本**\n\n\n用于添加草稿箱，以及提交github仓库，shell脚本：\n\n\n```shell\n#!/bin/sh\nconfigPath=.vscode/.env\nfunction get_config() {\n    local configName=$1\n    sed -n 's/^[[:space:]]*'$configName'[[:space:]]*=[[:space:]]*\\(.*[^[:space:]]\\)\\([[:space:]]*\\)$/\\1/p' $configPath\n}\n\nfunction set_config() {\n    local configName=$1\n    local confgValue=$2\n    sed -i \"\" -e \"s:$configName=.*:$configName=$confgValue:g\" ${configPath}\n}\nfunction publish_draft(){ \n    addline=$(git status | awk '/Untracked/{print NR}')\n    mpath=\"\"\n    if [ \"$addline\" = '' ]; then\n        echo \"没有新添加的文件，更换为当前修改的最后一个文件\"\n         # 取最后一行\n        all_lines=$(git status | awk '/modified/{print $0}' | awk -F \"[:]\" 'END{print NR}' )\n        if [ $all_lines -gt 0 ]; then\n            read -p \"选取需要更新的文件的行数（从1开始）：\" line\n            mpath=$(git status | awk '/modified/{print $0}' | awk -F \"[:]\" 'NR==\"'\"$line\"'\"{print $2}' )\n        else\n            mpath=$(git status | awk '/modified/{print $0}' | awk -F \"[:]\" 'END{print $2}' )\n        fi\n        \n    \n    else\n        echo \"取新添加的文件\"\n        let line=addline+2\n        mpath=$(git status | awk 'NR==\"'\"$line\"'\"{print}')\n    fi\n    read -p \"markdown文件变动目录:[$mpath],继续执行下一步，回车键继续[y/n]\" isContinue\n    set_config MarkdownFilePath $mpath\n    \n    Digest=$(get_config Digest)\n    read -p \"是否更换二级小标题:[$Digest],是否更换,回车键不更换[y/n]\" isContinue\n    # 转成小写\n    iscontinue=$(echo $isContinue | tr '[A-Z]' '[a-z]')\n    if [ \"$iscontinue\" = 'y' ]; then\n        read -p '开始更换二级小标题:' Digest\n        set_config Digest $Digest\n    else\n        echo \"不更换二级小标题\"\n    fi\n\n\n    cpath=$(get_config CssFilePath)\n    read -p \"css文件目录:[$cpath],是否更换,回车键不更换[y/n]\" isContinue\n    # 转成小写\n    iscontinue=$(echo $isContinue | tr '[A-Z]' '[a-z]')\n    if [ \"$iscontinue\" = 'y' ]; then\n        read -p '开始更换目录:' cpath\n        set_config CssFilePath $cpath\n    else\n        echo \"不更换目录\"\n    fi\n\n\n    ipath=$(get_config ImagePath)\n    read -p \"图片标题文件目录:[$ipath],是否更换,回车键不更换[y/n]\" isContinue\n    # 转成小写\n    iscontinue=$(echo $isContinue | tr '[A-Z]' '[a-z]')\n    if [ \"$iscontinue\" = 'y' ]; then\n        read -p '开始更换目录:' ipath\n        set_config ImagePath $ipath\n    else\n        echo \"不更换目录\"\n    fi\n\n    Author=$(get_config Author)\n    read -p \"是否更换作者名称:[$Author],是否更换,回车键不更换[y/n]\" isContinue\n    # 转成小写\n    iscontinue=$(echo $isContinue | tr '[A-Z]' '[a-z]')\n    if [ \"$iscontinue\" = 'y' ]; then\n        read -p '开始更换作者名称:' Author\n        set_config Author $Author\n    else\n        echo \"不更换作者名称\"\n    fi\n    echo \"开始执行发布草稿\"\n    cd .vscode/ && go run main.go\n\n\n\n}\nfunction add_git(){\n    local msg=$1\n    git pull origin master\n    git add .\n    git commit -m $msg\n    git push origin master\n}\necho \"需要发布到草稿箱\"\n./.vscode/pushgitimg.sh\npublish_draft\n\n\n```\n\n#### **配置picgo图床**\n- 使用picgo配置gitee图床，同时obsdian安装picgo插件，即可截图自动上传到gitee中，同时main.go中会自动解析，上传到微信中获取对应的mediaid\n- 同时标题的图片配置的是每日一图的api，可以根据env文件中自行配置是否要手动更换\n\n#### **github和gitee同步**\n- 配置对应的key\n- 配置对应的workflow\n- 同时修改blog对应的hook地址，由github转成gitee，github会失败\n\n#### **html压缩**\n\n```go\nimport (\n\t\"github.com/tdewolff/minify/v2\"\n\t\"github.com/tdewolff/minify/v2/html\"\n)\nfunc HtmlMinify(htmlstring string) (string, error) {\n\tm := minify.New()\n\tm.Add(\"text/html\", &html.Minifier{\n\t\tKeepDefaultAttrVals: true,\n\t\tKeepDocumentTags:    true,\n\t\tKeepEndTags:         true,\n\t})\n\n\tmb, err := m.String(\"text/html\", htmlstring)\n\tif err != nil {\n\t\treturn \"\", err\n\t}\n\treturn mb, err\n}\n```\n\n- 使用[minify](https://github.com/tdewolff/minify)压缩工具  \n- minify的[说明文档](https://pkg.go.dev/github.com/tdewolff/minify#section-readme)   \n- [demo例子](https://go.tacodewolff.nl/minify)   \n- [viper例子](https://www.cnblogs.com/jiujuan/p/13799976.html)\n\n#### **注意事项**\n- wget -o x.gz不允许这么写，暂时不清楚原因在哪里\n- 截图的时候最好尺寸在550*550以内，否则上传图片不生效\n- 现在只能添加shell命令来配置，后面优化成go来写\n\n#### **优化**\n- 本地shell命令转成main.go","source":"_posts/微信公众号/无痛苦更新公众号.md","raw":"---\ncategories:\n  - 微信公众号\n---\n#### **背景**\n\n- 本身有自己的博客网站，以及博客小程序\n- 想更新公众号，一直没有动力去写，一个是自己的文笔实在是太弱，二个是觉得公众号的更新很麻烦，每次都需要去更新，尤其图片要重新上传，这就很麻烦，然后有些样式也不符合要求\n- 前一阵子，看了一个大佬写的无痛苦更新公众号，他写了一个python的插件，受益良多，正在向他学习，大佬的[博客](https://catcoding.me/)网址，公众号是程序员的喵，有兴趣可以关注下\n- 但是别人的东西必须得适用于自己才好，大佬的插件比较精简，但是样式不是我的风格，我想要追加css进去，这样可以随意替换css，其次本人主php，副go，博客是用go开发的，python插件有点突兀，所以这也让我重新拾起go，开发了一个类似他的那个插件的go版本\n- [python版本](https://github.com/chenyukang/markdown-to-wechat)\n- [go版本](https://github.com/cjyzwg/markdown-wechat-demo)\n\n\n#### **安装**\n\n```shell\n\ngit clone https://github.com/cjyzwg/markdown-wechat-demo\n\ngo mod tidy\n\ngo run main.go（即可添加到草稿箱)\n\n```\n\n\n#### **脚本**\n\n\n用于添加草稿箱，以及提交github仓库，shell脚本：\n\n\n```shell\n#!/bin/sh\nconfigPath=.vscode/.env\nfunction get_config() {\n    local configName=$1\n    sed -n 's/^[[:space:]]*'$configName'[[:space:]]*=[[:space:]]*\\(.*[^[:space:]]\\)\\([[:space:]]*\\)$/\\1/p' $configPath\n}\n\nfunction set_config() {\n    local configName=$1\n    local confgValue=$2\n    sed -i \"\" -e \"s:$configName=.*:$configName=$confgValue:g\" ${configPath}\n}\nfunction publish_draft(){ \n    addline=$(git status | awk '/Untracked/{print NR}')\n    mpath=\"\"\n    if [ \"$addline\" = '' ]; then\n        echo \"没有新添加的文件，更换为当前修改的最后一个文件\"\n         # 取最后一行\n        all_lines=$(git status | awk '/modified/{print $0}' | awk -F \"[:]\" 'END{print NR}' )\n        if [ $all_lines -gt 0 ]; then\n            read -p \"选取需要更新的文件的行数（从1开始）：\" line\n            mpath=$(git status | awk '/modified/{print $0}' | awk -F \"[:]\" 'NR==\"'\"$line\"'\"{print $2}' )\n        else\n            mpath=$(git status | awk '/modified/{print $0}' | awk -F \"[:]\" 'END{print $2}' )\n        fi\n        \n    \n    else\n        echo \"取新添加的文件\"\n        let line=addline+2\n        mpath=$(git status | awk 'NR==\"'\"$line\"'\"{print}')\n    fi\n    read -p \"markdown文件变动目录:[$mpath],继续执行下一步，回车键继续[y/n]\" isContinue\n    set_config MarkdownFilePath $mpath\n    \n    Digest=$(get_config Digest)\n    read -p \"是否更换二级小标题:[$Digest],是否更换,回车键不更换[y/n]\" isContinue\n    # 转成小写\n    iscontinue=$(echo $isContinue | tr '[A-Z]' '[a-z]')\n    if [ \"$iscontinue\" = 'y' ]; then\n        read -p '开始更换二级小标题:' Digest\n        set_config Digest $Digest\n    else\n        echo \"不更换二级小标题\"\n    fi\n\n\n    cpath=$(get_config CssFilePath)\n    read -p \"css文件目录:[$cpath],是否更换,回车键不更换[y/n]\" isContinue\n    # 转成小写\n    iscontinue=$(echo $isContinue | tr '[A-Z]' '[a-z]')\n    if [ \"$iscontinue\" = 'y' ]; then\n        read -p '开始更换目录:' cpath\n        set_config CssFilePath $cpath\n    else\n        echo \"不更换目录\"\n    fi\n\n\n    ipath=$(get_config ImagePath)\n    read -p \"图片标题文件目录:[$ipath],是否更换,回车键不更换[y/n]\" isContinue\n    # 转成小写\n    iscontinue=$(echo $isContinue | tr '[A-Z]' '[a-z]')\n    if [ \"$iscontinue\" = 'y' ]; then\n        read -p '开始更换目录:' ipath\n        set_config ImagePath $ipath\n    else\n        echo \"不更换目录\"\n    fi\n\n    Author=$(get_config Author)\n    read -p \"是否更换作者名称:[$Author],是否更换,回车键不更换[y/n]\" isContinue\n    # 转成小写\n    iscontinue=$(echo $isContinue | tr '[A-Z]' '[a-z]')\n    if [ \"$iscontinue\" = 'y' ]; then\n        read -p '开始更换作者名称:' Author\n        set_config Author $Author\n    else\n        echo \"不更换作者名称\"\n    fi\n    echo \"开始执行发布草稿\"\n    cd .vscode/ && go run main.go\n\n\n\n}\nfunction add_git(){\n    local msg=$1\n    git pull origin master\n    git add .\n    git commit -m $msg\n    git push origin master\n}\necho \"需要发布到草稿箱\"\n./.vscode/pushgitimg.sh\npublish_draft\n\n\n```\n\n#### **配置picgo图床**\n- 使用picgo配置gitee图床，同时obsdian安装picgo插件，即可截图自动上传到gitee中，同时main.go中会自动解析，上传到微信中获取对应的mediaid\n- 同时标题的图片配置的是每日一图的api，可以根据env文件中自行配置是否要手动更换\n\n#### **github和gitee同步**\n- 配置对应的key\n- 配置对应的workflow\n- 同时修改blog对应的hook地址，由github转成gitee，github会失败\n\n#### **html压缩**\n\n```go\nimport (\n\t\"github.com/tdewolff/minify/v2\"\n\t\"github.com/tdewolff/minify/v2/html\"\n)\nfunc HtmlMinify(htmlstring string) (string, error) {\n\tm := minify.New()\n\tm.Add(\"text/html\", &html.Minifier{\n\t\tKeepDefaultAttrVals: true,\n\t\tKeepDocumentTags:    true,\n\t\tKeepEndTags:         true,\n\t})\n\n\tmb, err := m.String(\"text/html\", htmlstring)\n\tif err != nil {\n\t\treturn \"\", err\n\t}\n\treturn mb, err\n}\n```\n\n- 使用[minify](https://github.com/tdewolff/minify)压缩工具  \n- minify的[说明文档](https://pkg.go.dev/github.com/tdewolff/minify#section-readme)   \n- [demo例子](https://go.tacodewolff.nl/minify)   \n- [viper例子](https://www.cnblogs.com/jiujuan/p/13799976.html)\n\n#### **注意事项**\n- wget -o x.gz不允许这么写，暂时不清楚原因在哪里\n- 截图的时候最好尺寸在550*550以内，否则上传图片不生效\n- 现在只能添加shell命令来配置，后面优化成go来写\n\n#### **优化**\n- 本地shell命令转成main.go","slug":"无痛苦更新公众号","published":1,"category":"微信公众号","date":"2023-06-08T23:03:56.117Z","updated":"2023-06-08T23:12:13.747Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5sep0022dxjc75q92lgk","content":"<h4 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a><strong>背景</strong></h4><ul>\n<li>本身有自己的博客网站，以及博客小程序</li>\n<li>想更新公众号，一直没有动力去写，一个是自己的文笔实在是太弱，二个是觉得公众号的更新很麻烦，每次都需要去更新，尤其图片要重新上传，这就很麻烦，然后有些样式也不符合要求</li>\n<li>前一阵子，看了一个大佬写的无痛苦更新公众号，他写了一个python的插件，受益良多，正在向他学习，大佬的<a href=\"https://catcoding.me/\">博客</a>网址，公众号是程序员的喵，有兴趣可以关注下</li>\n<li>但是别人的东西必须得适用于自己才好，大佬的插件比较精简，但是样式不是我的风格，我想要追加css进去，这样可以随意替换css，其次本人主php，副go，博客是用go开发的，python插件有点突兀，所以这也让我重新拾起go，开发了一个类似他的那个插件的go版本</li>\n<li><a href=\"https://github.com/chenyukang/markdown-to-wechat\">python版本</a></li>\n<li><a href=\"https://github.com/cjyzwg/markdown-wechat-demo\">go版本</a></li>\n</ul>\n<h4 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a><strong>安装</strong></h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">git clone https://github.com/cjyzwg/markdown-wechat-demo</span><br><span class=\"line\"></span><br><span class=\"line\">go mod tidy</span><br><span class=\"line\"></span><br><span class=\"line\">go run main.go（即可添加到草稿箱)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h4 id=\"脚本\"><a href=\"#脚本\" class=\"headerlink\" title=\"脚本\"></a><strong>脚本</strong></h4><p>用于添加草稿箱，以及提交github仓库，shell脚本：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">!/bin/sh</span></span><br><span class=\"line\">configPath=.vscode/.env</span><br><span class=\"line\">function get_config() &#123;</span><br><span class=\"line\">    local configName=$1</span><br><span class=\"line\">    sed -n &#x27;s/^[[:space:]]*&#x27;$configName&#x27;[[:space:]]*=[[:space:]]*\\(.*[^[:space:]]\\)\\([[:space:]]*\\)$/\\1/p&#x27; $configPath</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function set_config() &#123;</span><br><span class=\"line\">    local configName=$1</span><br><span class=\"line\">    local confgValue=$2</span><br><span class=\"line\">    sed -i &quot;&quot; -e &quot;s:$configName=.*:$configName=$confgValue:g&quot; $&#123;configPath&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">function publish_draft()&#123; </span><br><span class=\"line\">    addline=$(git status | awk &#x27;/Untracked/&#123;print NR&#125;&#x27;)</span><br><span class=\"line\">    mpath=&quot;&quot;</span><br><span class=\"line\">    if [ &quot;$addline&quot; = &#x27;&#x27; ]; then</span><br><span class=\"line\">        echo &quot;没有新添加的文件，更换为当前修改的最后一个文件&quot;</span><br><span class=\"line\">         # 取最后一行</span><br><span class=\"line\">        all_lines=$(git status | awk &#x27;/modified/&#123;print $0&#125;&#x27; | awk -F &quot;[:]&quot; &#x27;END&#123;print NR&#125;&#x27; )</span><br><span class=\"line\">        if [ $all_lines -gt 0 ]; then</span><br><span class=\"line\">            read -p &quot;选取需要更新的文件的行数（从1开始）：&quot; line</span><br><span class=\"line\">            mpath=$(git status | awk &#x27;/modified/&#123;print $0&#125;&#x27; | awk -F &quot;[:]&quot; &#x27;NR==&quot;&#x27;&quot;$line&quot;&#x27;&quot;&#123;print $2&#125;&#x27; )</span><br><span class=\"line\">        else</span><br><span class=\"line\">            mpath=$(git status | awk &#x27;/modified/&#123;print $0&#125;&#x27; | awk -F &quot;[:]&quot; &#x27;END&#123;print $2&#125;&#x27; )</span><br><span class=\"line\">        fi</span><br><span class=\"line\">        </span><br><span class=\"line\">    </span><br><span class=\"line\">    else</span><br><span class=\"line\">        echo &quot;取新添加的文件&quot;</span><br><span class=\"line\">        let line=addline+2</span><br><span class=\"line\">        mpath=$(git status | awk &#x27;NR==&quot;&#x27;&quot;$line&quot;&#x27;&quot;&#123;print&#125;&#x27;)</span><br><span class=\"line\">    fi</span><br><span class=\"line\">    read -p &quot;markdown文件变动目录:[$mpath],继续执行下一步，回车键继续[y/n]&quot; isContinue</span><br><span class=\"line\">    set_config MarkdownFilePath $mpath</span><br><span class=\"line\">    </span><br><span class=\"line\">    Digest=$(get_config Digest)</span><br><span class=\"line\">    read -p &quot;是否更换二级小标题:[$Digest],是否更换,回车键不更换[y/n]&quot; isContinue</span><br><span class=\"line\">    # 转成小写</span><br><span class=\"line\">    iscontinue=$(echo $isContinue | tr &#x27;[A-Z]&#x27; &#x27;[a-z]&#x27;)</span><br><span class=\"line\">    if [ &quot;$iscontinue&quot; = &#x27;y&#x27; ]; then</span><br><span class=\"line\">        read -p &#x27;开始更换二级小标题:&#x27; Digest</span><br><span class=\"line\">        set_config Digest $Digest</span><br><span class=\"line\">    else</span><br><span class=\"line\">        echo &quot;不更换二级小标题&quot;</span><br><span class=\"line\">    fi</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    cpath=$(get_config CssFilePath)</span><br><span class=\"line\">    read -p &quot;css文件目录:[$cpath],是否更换,回车键不更换[y/n]&quot; isContinue</span><br><span class=\"line\">    # 转成小写</span><br><span class=\"line\">    iscontinue=$(echo $isContinue | tr &#x27;[A-Z]&#x27; &#x27;[a-z]&#x27;)</span><br><span class=\"line\">    if [ &quot;$iscontinue&quot; = &#x27;y&#x27; ]; then</span><br><span class=\"line\">        read -p &#x27;开始更换目录:&#x27; cpath</span><br><span class=\"line\">        set_config CssFilePath $cpath</span><br><span class=\"line\">    else</span><br><span class=\"line\">        echo &quot;不更换目录&quot;</span><br><span class=\"line\">    fi</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    ipath=$(get_config ImagePath)</span><br><span class=\"line\">    read -p &quot;图片标题文件目录:[$ipath],是否更换,回车键不更换[y/n]&quot; isContinue</span><br><span class=\"line\">    # 转成小写</span><br><span class=\"line\">    iscontinue=$(echo $isContinue | tr &#x27;[A-Z]&#x27; &#x27;[a-z]&#x27;)</span><br><span class=\"line\">    if [ &quot;$iscontinue&quot; = &#x27;y&#x27; ]; then</span><br><span class=\"line\">        read -p &#x27;开始更换目录:&#x27; ipath</span><br><span class=\"line\">        set_config ImagePath $ipath</span><br><span class=\"line\">    else</span><br><span class=\"line\">        echo &quot;不更换目录&quot;</span><br><span class=\"line\">    fi</span><br><span class=\"line\"></span><br><span class=\"line\">    Author=$(get_config Author)</span><br><span class=\"line\">    read -p &quot;是否更换作者名称:[$Author],是否更换,回车键不更换[y/n]&quot; isContinue</span><br><span class=\"line\">    # 转成小写</span><br><span class=\"line\">    iscontinue=$(echo $isContinue | tr &#x27;[A-Z]&#x27; &#x27;[a-z]&#x27;)</span><br><span class=\"line\">    if [ &quot;$iscontinue&quot; = &#x27;y&#x27; ]; then</span><br><span class=\"line\">        read -p &#x27;开始更换作者名称:&#x27; Author</span><br><span class=\"line\">        set_config Author $Author</span><br><span class=\"line\">    else</span><br><span class=\"line\">        echo &quot;不更换作者名称&quot;</span><br><span class=\"line\">    fi</span><br><span class=\"line\">    echo &quot;开始执行发布草稿&quot;</span><br><span class=\"line\">    cd .vscode/ &amp;&amp; go run main.go</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">function add_git()&#123;</span><br><span class=\"line\">    local msg=$1</span><br><span class=\"line\">    git pull origin master</span><br><span class=\"line\">    git add .</span><br><span class=\"line\">    git commit -m $msg</span><br><span class=\"line\">    git push origin master</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">echo &quot;需要发布到草稿箱&quot;</span><br><span class=\"line\">./.vscode/pushgitimg.sh</span><br><span class=\"line\">publish_draft</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"配置picgo图床\"><a href=\"#配置picgo图床\" class=\"headerlink\" title=\"配置picgo图床\"></a><strong>配置picgo图床</strong></h4><ul>\n<li>使用picgo配置gitee图床，同时obsdian安装picgo插件，即可截图自动上传到gitee中，同时main.go中会自动解析，上传到微信中获取对应的mediaid</li>\n<li>同时标题的图片配置的是每日一图的api，可以根据env文件中自行配置是否要手动更换</li>\n</ul>\n<h4 id=\"github和gitee同步\"><a href=\"#github和gitee同步\" class=\"headerlink\" title=\"github和gitee同步\"></a><strong>github和gitee同步</strong></h4><ul>\n<li>配置对应的key</li>\n<li>配置对应的workflow</li>\n<li>同时修改blog对应的hook地址，由github转成gitee，github会失败</li>\n</ul>\n<h4 id=\"html压缩\"><a href=\"#html压缩\" class=\"headerlink\" title=\"html压缩\"></a><strong>html压缩</strong></h4><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/tdewolff/minify/v2&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/tdewolff/minify/v2/html&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">HtmlMinify</span><span class=\"params\">(htmlstring <span class=\"type\">string</span>)</span></span> (<span class=\"type\">string</span>, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">\tm := minify.New()</span><br><span class=\"line\">\tm.Add(<span class=\"string\">&quot;text/html&quot;</span>, &amp;html.Minifier&#123;</span><br><span class=\"line\">\t\tKeepDefaultAttrVals: <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t\tKeepDocumentTags:    <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t\tKeepEndTags:         <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\tmb, err := m.String(<span class=\"string\">&quot;text/html&quot;</span>, htmlstring)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span>, err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> mb, err</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>使用<a href=\"https://github.com/tdewolff/minify\">minify</a>压缩工具  </li>\n<li>minify的<a href=\"https://pkg.go.dev/github.com/tdewolff/minify#section-readme\">说明文档</a>   </li>\n<li><a href=\"https://go.tacodewolff.nl/minify\">demo例子</a>   </li>\n<li><a href=\"https://www.cnblogs.com/jiujuan/p/13799976.html\">viper例子</a></li>\n</ul>\n<h4 id=\"注意事项\"><a href=\"#注意事项\" class=\"headerlink\" title=\"注意事项\"></a><strong>注意事项</strong></h4><ul>\n<li>wget -o x.gz不允许这么写，暂时不清楚原因在哪里</li>\n<li>截图的时候最好尺寸在550*550以内，否则上传图片不生效</li>\n<li>现在只能添加shell命令来配置，后面优化成go来写</li>\n</ul>\n<h4 id=\"优化\"><a href=\"#优化\" class=\"headerlink\" title=\"优化\"></a><strong>优化</strong></h4><ul>\n<li>本地shell命令转成main.go</li>\n</ul>\n","site":{"data":{}},"length":4094,"excerpt":"","more":"<h4 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a><strong>背景</strong></h4><ul>\n<li>本身有自己的博客网站，以及博客小程序</li>\n<li>想更新公众号，一直没有动力去写，一个是自己的文笔实在是太弱，二个是觉得公众号的更新很麻烦，每次都需要去更新，尤其图片要重新上传，这就很麻烦，然后有些样式也不符合要求</li>\n<li>前一阵子，看了一个大佬写的无痛苦更新公众号，他写了一个python的插件，受益良多，正在向他学习，大佬的<a href=\"https://catcoding.me/\">博客</a>网址，公众号是程序员的喵，有兴趣可以关注下</li>\n<li>但是别人的东西必须得适用于自己才好，大佬的插件比较精简，但是样式不是我的风格，我想要追加css进去，这样可以随意替换css，其次本人主php，副go，博客是用go开发的，python插件有点突兀，所以这也让我重新拾起go，开发了一个类似他的那个插件的go版本</li>\n<li><a href=\"https://github.com/chenyukang/markdown-to-wechat\">python版本</a></li>\n<li><a href=\"https://github.com/cjyzwg/markdown-wechat-demo\">go版本</a></li>\n</ul>\n<h4 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a><strong>安装</strong></h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">git clone https://github.com/cjyzwg/markdown-wechat-demo</span><br><span class=\"line\"></span><br><span class=\"line\">go mod tidy</span><br><span class=\"line\"></span><br><span class=\"line\">go run main.go（即可添加到草稿箱)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h4 id=\"脚本\"><a href=\"#脚本\" class=\"headerlink\" title=\"脚本\"></a><strong>脚本</strong></h4><p>用于添加草稿箱，以及提交github仓库，shell脚本：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">!/bin/sh</span></span><br><span class=\"line\">configPath=.vscode/.env</span><br><span class=\"line\">function get_config() &#123;</span><br><span class=\"line\">    local configName=$1</span><br><span class=\"line\">    sed -n &#x27;s/^[[:space:]]*&#x27;$configName&#x27;[[:space:]]*=[[:space:]]*\\(.*[^[:space:]]\\)\\([[:space:]]*\\)$/\\1/p&#x27; $configPath</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function set_config() &#123;</span><br><span class=\"line\">    local configName=$1</span><br><span class=\"line\">    local confgValue=$2</span><br><span class=\"line\">    sed -i &quot;&quot; -e &quot;s:$configName=.*:$configName=$confgValue:g&quot; $&#123;configPath&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">function publish_draft()&#123; </span><br><span class=\"line\">    addline=$(git status | awk &#x27;/Untracked/&#123;print NR&#125;&#x27;)</span><br><span class=\"line\">    mpath=&quot;&quot;</span><br><span class=\"line\">    if [ &quot;$addline&quot; = &#x27;&#x27; ]; then</span><br><span class=\"line\">        echo &quot;没有新添加的文件，更换为当前修改的最后一个文件&quot;</span><br><span class=\"line\">         # 取最后一行</span><br><span class=\"line\">        all_lines=$(git status | awk &#x27;/modified/&#123;print $0&#125;&#x27; | awk -F &quot;[:]&quot; &#x27;END&#123;print NR&#125;&#x27; )</span><br><span class=\"line\">        if [ $all_lines -gt 0 ]; then</span><br><span class=\"line\">            read -p &quot;选取需要更新的文件的行数（从1开始）：&quot; line</span><br><span class=\"line\">            mpath=$(git status | awk &#x27;/modified/&#123;print $0&#125;&#x27; | awk -F &quot;[:]&quot; &#x27;NR==&quot;&#x27;&quot;$line&quot;&#x27;&quot;&#123;print $2&#125;&#x27; )</span><br><span class=\"line\">        else</span><br><span class=\"line\">            mpath=$(git status | awk &#x27;/modified/&#123;print $0&#125;&#x27; | awk -F &quot;[:]&quot; &#x27;END&#123;print $2&#125;&#x27; )</span><br><span class=\"line\">        fi</span><br><span class=\"line\">        </span><br><span class=\"line\">    </span><br><span class=\"line\">    else</span><br><span class=\"line\">        echo &quot;取新添加的文件&quot;</span><br><span class=\"line\">        let line=addline+2</span><br><span class=\"line\">        mpath=$(git status | awk &#x27;NR==&quot;&#x27;&quot;$line&quot;&#x27;&quot;&#123;print&#125;&#x27;)</span><br><span class=\"line\">    fi</span><br><span class=\"line\">    read -p &quot;markdown文件变动目录:[$mpath],继续执行下一步，回车键继续[y/n]&quot; isContinue</span><br><span class=\"line\">    set_config MarkdownFilePath $mpath</span><br><span class=\"line\">    </span><br><span class=\"line\">    Digest=$(get_config Digest)</span><br><span class=\"line\">    read -p &quot;是否更换二级小标题:[$Digest],是否更换,回车键不更换[y/n]&quot; isContinue</span><br><span class=\"line\">    # 转成小写</span><br><span class=\"line\">    iscontinue=$(echo $isContinue | tr &#x27;[A-Z]&#x27; &#x27;[a-z]&#x27;)</span><br><span class=\"line\">    if [ &quot;$iscontinue&quot; = &#x27;y&#x27; ]; then</span><br><span class=\"line\">        read -p &#x27;开始更换二级小标题:&#x27; Digest</span><br><span class=\"line\">        set_config Digest $Digest</span><br><span class=\"line\">    else</span><br><span class=\"line\">        echo &quot;不更换二级小标题&quot;</span><br><span class=\"line\">    fi</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    cpath=$(get_config CssFilePath)</span><br><span class=\"line\">    read -p &quot;css文件目录:[$cpath],是否更换,回车键不更换[y/n]&quot; isContinue</span><br><span class=\"line\">    # 转成小写</span><br><span class=\"line\">    iscontinue=$(echo $isContinue | tr &#x27;[A-Z]&#x27; &#x27;[a-z]&#x27;)</span><br><span class=\"line\">    if [ &quot;$iscontinue&quot; = &#x27;y&#x27; ]; then</span><br><span class=\"line\">        read -p &#x27;开始更换目录:&#x27; cpath</span><br><span class=\"line\">        set_config CssFilePath $cpath</span><br><span class=\"line\">    else</span><br><span class=\"line\">        echo &quot;不更换目录&quot;</span><br><span class=\"line\">    fi</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    ipath=$(get_config ImagePath)</span><br><span class=\"line\">    read -p &quot;图片标题文件目录:[$ipath],是否更换,回车键不更换[y/n]&quot; isContinue</span><br><span class=\"line\">    # 转成小写</span><br><span class=\"line\">    iscontinue=$(echo $isContinue | tr &#x27;[A-Z]&#x27; &#x27;[a-z]&#x27;)</span><br><span class=\"line\">    if [ &quot;$iscontinue&quot; = &#x27;y&#x27; ]; then</span><br><span class=\"line\">        read -p &#x27;开始更换目录:&#x27; ipath</span><br><span class=\"line\">        set_config ImagePath $ipath</span><br><span class=\"line\">    else</span><br><span class=\"line\">        echo &quot;不更换目录&quot;</span><br><span class=\"line\">    fi</span><br><span class=\"line\"></span><br><span class=\"line\">    Author=$(get_config Author)</span><br><span class=\"line\">    read -p &quot;是否更换作者名称:[$Author],是否更换,回车键不更换[y/n]&quot; isContinue</span><br><span class=\"line\">    # 转成小写</span><br><span class=\"line\">    iscontinue=$(echo $isContinue | tr &#x27;[A-Z]&#x27; &#x27;[a-z]&#x27;)</span><br><span class=\"line\">    if [ &quot;$iscontinue&quot; = &#x27;y&#x27; ]; then</span><br><span class=\"line\">        read -p &#x27;开始更换作者名称:&#x27; Author</span><br><span class=\"line\">        set_config Author $Author</span><br><span class=\"line\">    else</span><br><span class=\"line\">        echo &quot;不更换作者名称&quot;</span><br><span class=\"line\">    fi</span><br><span class=\"line\">    echo &quot;开始执行发布草稿&quot;</span><br><span class=\"line\">    cd .vscode/ &amp;&amp; go run main.go</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">function add_git()&#123;</span><br><span class=\"line\">    local msg=$1</span><br><span class=\"line\">    git pull origin master</span><br><span class=\"line\">    git add .</span><br><span class=\"line\">    git commit -m $msg</span><br><span class=\"line\">    git push origin master</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">echo &quot;需要发布到草稿箱&quot;</span><br><span class=\"line\">./.vscode/pushgitimg.sh</span><br><span class=\"line\">publish_draft</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"配置picgo图床\"><a href=\"#配置picgo图床\" class=\"headerlink\" title=\"配置picgo图床\"></a><strong>配置picgo图床</strong></h4><ul>\n<li>使用picgo配置gitee图床，同时obsdian安装picgo插件，即可截图自动上传到gitee中，同时main.go中会自动解析，上传到微信中获取对应的mediaid</li>\n<li>同时标题的图片配置的是每日一图的api，可以根据env文件中自行配置是否要手动更换</li>\n</ul>\n<h4 id=\"github和gitee同步\"><a href=\"#github和gitee同步\" class=\"headerlink\" title=\"github和gitee同步\"></a><strong>github和gitee同步</strong></h4><ul>\n<li>配置对应的key</li>\n<li>配置对应的workflow</li>\n<li>同时修改blog对应的hook地址，由github转成gitee，github会失败</li>\n</ul>\n<h4 id=\"html压缩\"><a href=\"#html压缩\" class=\"headerlink\" title=\"html压缩\"></a><strong>html压缩</strong></h4><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/tdewolff/minify/v2&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/tdewolff/minify/v2/html&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">HtmlMinify</span><span class=\"params\">(htmlstring <span class=\"type\">string</span>)</span></span> (<span class=\"type\">string</span>, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">\tm := minify.New()</span><br><span class=\"line\">\tm.Add(<span class=\"string\">&quot;text/html&quot;</span>, &amp;html.Minifier&#123;</span><br><span class=\"line\">\t\tKeepDefaultAttrVals: <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t\tKeepDocumentTags:    <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t\tKeepEndTags:         <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\tmb, err := m.String(<span class=\"string\">&quot;text/html&quot;</span>, htmlstring)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span>, err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> mb, err</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>使用<a href=\"https://github.com/tdewolff/minify\">minify</a>压缩工具  </li>\n<li>minify的<a href=\"https://pkg.go.dev/github.com/tdewolff/minify#section-readme\">说明文档</a>   </li>\n<li><a href=\"https://go.tacodewolff.nl/minify\">demo例子</a>   </li>\n<li><a href=\"https://www.cnblogs.com/jiujuan/p/13799976.html\">viper例子</a></li>\n</ul>\n<h4 id=\"注意事项\"><a href=\"#注意事项\" class=\"headerlink\" title=\"注意事项\"></a><strong>注意事项</strong></h4><ul>\n<li>wget -o x.gz不允许这么写，暂时不清楚原因在哪里</li>\n<li>截图的时候最好尺寸在550*550以内，否则上传图片不生效</li>\n<li>现在只能添加shell命令来配置，后面优化成go来写</li>\n</ul>\n<h4 id=\"优化\"><a href=\"#优化\" class=\"headerlink\" title=\"优化\"></a><strong>优化</strong></h4><ul>\n<li>本地shell命令转成main.go</li>\n</ul>\n"},{"_content":"### 无痛苦更新公众号（完整）\n很早以前注册了这个公众号，一直没用，一在于公众号的排版，即使是用其他排版工具，如秀米，也会耗费大量时间，还得上传图片，二在于自己的写作能力实在太差😂。\n\n**工欲善其事必先利其器**\n\n在接触公众号【程序员的喵】上有一篇无痛苦更新公众号的[python插件](https://github.com/chenyukang/markdown-to-wechat)，我的内心也蠢蠢欲动，开始了自己的[go插件](https://github.com/cjyzwg/markdown-wechat)。\n\n#### **流程**\n\n我整体想要写作的流程：\n\n**80%的时间用于写作，而不是用在排版**\n\n> obsidian写作 -> go插件 -> 更新公众号/博客网站，小程序\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203171021868.png)\n\n> 本篇只讲obsidian 写完推送到公众号中:\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203171050806.png)\n\n\n#### **步骤**\n1、obsidian开始写，安装一些必要的插件，比如excalidraw，还有最重要的[obsidian+picgo+gitee搭建图床](https://www.cnblogs.com/zd2021/p/15483878.html)，这样只用图片复制进来即可上传到gitee上了。\n\n2、使用go插件，go run main.go即能上传到微信公众号的草稿箱，这里没有做一键发布，手机上下载了订阅助手app，在草稿箱里预览下样式是否正确，然后发布。\n\n#### **优化/感悟**\n插件有些地方还不够完善，我后面会优化，覆盖面为小白，不用明白go就可以使用，会发布在github的release中。\n\n不过现在对于我本人已足够可以使用了，至少我可以在半小时内写出一篇文章，而不是再额外1个小时做排版工作。","source":"_posts/微信公众号/无痛苦更新公众号（完整）.md","raw":"---\ncategories:\n  - 微信公众号\n---\n### 无痛苦更新公众号（完整）\n很早以前注册了这个公众号，一直没用，一在于公众号的排版，即使是用其他排版工具，如秀米，也会耗费大量时间，还得上传图片，二在于自己的写作能力实在太差😂。\n\n**工欲善其事必先利其器**\n\n在接触公众号【程序员的喵】上有一篇无痛苦更新公众号的[python插件](https://github.com/chenyukang/markdown-to-wechat)，我的内心也蠢蠢欲动，开始了自己的[go插件](https://github.com/cjyzwg/markdown-wechat)。\n\n#### **流程**\n\n我整体想要写作的流程：\n\n**80%的时间用于写作，而不是用在排版**\n\n> obsidian写作 -> go插件 -> 更新公众号/博客网站，小程序\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203171021868.png)\n\n> 本篇只讲obsidian 写完推送到公众号中:\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203171050806.png)\n\n\n#### **步骤**\n1、obsidian开始写，安装一些必要的插件，比如excalidraw，还有最重要的[obsidian+picgo+gitee搭建图床](https://www.cnblogs.com/zd2021/p/15483878.html)，这样只用图片复制进来即可上传到gitee上了。\n\n2、使用go插件，go run main.go即能上传到微信公众号的草稿箱，这里没有做一键发布，手机上下载了订阅助手app，在草稿箱里预览下样式是否正确，然后发布。\n\n#### **优化/感悟**\n插件有些地方还不够完善，我后面会优化，覆盖面为小白，不用明白go就可以使用，会发布在github的release中。\n\n不过现在对于我本人已足够可以使用了，至少我可以在半小时内写出一篇文章，而不是再额外1个小时做排版工作。","slug":"无痛苦更新公众号（完整）","published":1,"category":"微信公众号","date":"2023-06-08T23:03:56.119Z","updated":"2023-06-08T23:12:13.748Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5seq0023dxjc97u933b4","content":"<h3 id=\"无痛苦更新公众号（完整）\"><a href=\"#无痛苦更新公众号（完整）\" class=\"headerlink\" title=\"无痛苦更新公众号（完整）\"></a>无痛苦更新公众号（完整）</h3><p>很早以前注册了这个公众号，一直没用，一在于公众号的排版，即使是用其他排版工具，如秀米，也会耗费大量时间，还得上传图片，二在于自己的写作能力实在太差😂。</p>\n<p><strong>工欲善其事必先利其器</strong></p>\n<p>在接触公众号【程序员的喵】上有一篇无痛苦更新公众号的<a href=\"https://github.com/chenyukang/markdown-to-wechat\">python插件</a>，我的内心也蠢蠢欲动，开始了自己的<a href=\"https://github.com/cjyzwg/markdown-wechat\">go插件</a>。</p>\n<h4 id=\"流程\"><a href=\"#流程\" class=\"headerlink\" title=\"流程\"></a><strong>流程</strong></h4><p>我整体想要写作的流程：</p>\n<p><strong>80%的时间用于写作，而不是用在排版</strong></p>\n<blockquote>\n<p>obsidian写作 -&gt; go插件 -&gt; 更新公众号&#x2F;博客网站，小程序</p>\n</blockquote>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203171021868.png\"></p>\n<blockquote>\n<p>本篇只讲obsidian 写完推送到公众号中:</p>\n</blockquote>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203171050806.png\"></p>\n<h4 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a><strong>步骤</strong></h4><p>1、obsidian开始写，安装一些必要的插件，比如excalidraw，还有最重要的<a href=\"https://www.cnblogs.com/zd2021/p/15483878.html\">obsidian+picgo+gitee搭建图床</a>，这样只用图片复制进来即可上传到gitee上了。</p>\n<p>2、使用go插件，go run main.go即能上传到微信公众号的草稿箱，这里没有做一键发布，手机上下载了订阅助手app，在草稿箱里预览下样式是否正确，然后发布。</p>\n<h4 id=\"优化-x2F-感悟\"><a href=\"#优化-x2F-感悟\" class=\"headerlink\" title=\"优化&#x2F;感悟\"></a><strong>优化&#x2F;感悟</strong></h4><p>插件有些地方还不够完善，我后面会优化，覆盖面为小白，不用明白go就可以使用，会发布在github的release中。</p>\n<p>不过现在对于我本人已足够可以使用了，至少我可以在半小时内写出一篇文章，而不是再额外1个小时做排版工作。</p>\n","site":{"data":{}},"length":542,"excerpt":"","more":"<h3 id=\"无痛苦更新公众号（完整）\"><a href=\"#无痛苦更新公众号（完整）\" class=\"headerlink\" title=\"无痛苦更新公众号（完整）\"></a>无痛苦更新公众号（完整）</h3><p>很早以前注册了这个公众号，一直没用，一在于公众号的排版，即使是用其他排版工具，如秀米，也会耗费大量时间，还得上传图片，二在于自己的写作能力实在太差😂。</p>\n<p><strong>工欲善其事必先利其器</strong></p>\n<p>在接触公众号【程序员的喵】上有一篇无痛苦更新公众号的<a href=\"https://github.com/chenyukang/markdown-to-wechat\">python插件</a>，我的内心也蠢蠢欲动，开始了自己的<a href=\"https://github.com/cjyzwg/markdown-wechat\">go插件</a>。</p>\n<h4 id=\"流程\"><a href=\"#流程\" class=\"headerlink\" title=\"流程\"></a><strong>流程</strong></h4><p>我整体想要写作的流程：</p>\n<p><strong>80%的时间用于写作，而不是用在排版</strong></p>\n<blockquote>\n<p>obsidian写作 -&gt; go插件 -&gt; 更新公众号&#x2F;博客网站，小程序</p>\n</blockquote>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203171021868.png\"></p>\n<blockquote>\n<p>本篇只讲obsidian 写完推送到公众号中:</p>\n</blockquote>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203171050806.png\"></p>\n<h4 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a><strong>步骤</strong></h4><p>1、obsidian开始写，安装一些必要的插件，比如excalidraw，还有最重要的<a href=\"https://www.cnblogs.com/zd2021/p/15483878.html\">obsidian+picgo+gitee搭建图床</a>，这样只用图片复制进来即可上传到gitee上了。</p>\n<p>2、使用go插件，go run main.go即能上传到微信公众号的草稿箱，这里没有做一键发布，手机上下载了订阅助手app，在草稿箱里预览下样式是否正确，然后发布。</p>\n<h4 id=\"优化-x2F-感悟\"><a href=\"#优化-x2F-感悟\" class=\"headerlink\" title=\"优化&#x2F;感悟\"></a><strong>优化&#x2F;感悟</strong></h4><p>插件有些地方还不够完善，我后面会优化，覆盖面为小白，不用明白go就可以使用，会发布在github的release中。</p>\n<p>不过现在对于我本人已足够可以使用了，至少我可以在半小时内写出一篇文章，而不是再额外1个小时做排版工作。</p>\n"},{"_content":"#### **01**\n***转自：桌子生活观，测试s***\n\n被人无故殴打，你的第一反应是什么？\n\n我想，大部分人在反应过来后，会奋起反抗。\n\n但是，这两天的一个事件，却看得我鼻头发酸。\n\n事情发生在益阳桃江ssss\n\n\n7月29日晚，谢某酒后到某快递站买槟榔。\n\n  \n\n据店主说，谢某给了5元，非要说给了50，还让店主找钱。\n\n  \n\n被拒绝后，谢某恼羞成怒，开始暴打店主。\n\n  \n\n曝光的视频里，他狠狠薅住店主的头发往后扯。\n\n  \n\n然后，用力甩了店主两巴掌。\n\n  \n\n看对方没还手，谢某的气焰更加嚣张。\n\n  \n\n连续掌掴了好几次，拳头打在肚子上，再猛地抡起拳头往太阳穴招呼。\n\n![](https://weimgpub.oss-cn-hangzhou.aliyuncs.com/img/202208021316759.png)\n\n拳拳到肉，隔着屏幕，都觉得疼痛无比。\n\n  \n\n谢某下手有多重？\n\n  \n\n店主的伤，基本集中在头部。\n\n  \n\n太阳穴挨了两圈，脑子晕晕乎乎。\n\n  \n\n他被打出脑震荡，加上鼻梁骨折。\n\n  \n\n**可整个过程，店主一次都没有还手。**\n\n  \n\n被打得好几个趔趄，被扯着头发往前拖，被狠狠甩耳光，手机摔在地上，他始终没有反抗。\n\n  \n\n这一幕，让人无比心疼又令人疑惑。\n\n  \n\n面对如此蛮横的醉汉，他为什么不还手？\n\n  \n\n知道真相后，我感到特别心酸。\n\n  \n\n店主说：**我不敢还手，还手的话就变成了互殴。我老婆刚生完孩子，出院才三天。为了家庭，为了生活，我不能还手.....**\n\n一边是嗷嗷待哺的孩子，一边是产后需要呵护的妻子。\n\n  \n\n如果他还手也被抓进去，那么谁来照顾他们？\n\n  \n\n所以，当雨点般的拳头落在头上的一瞬，他控制住了反抗的本能，所想所念，都是家庭和孩子。\n\n  \n\n**这是一个做丈夫的责任，也是一个做父亲的担当。**\n\n  \n\n目前，这个打人的男子因为寻衅滋事，已经被警方抓获，等待他的，将会是法律的严惩。\n\n  \n\n自从这个事情在网上发酵曝光后，一下子就火了，视频播放量有几千万，点赞量有几百万。\n\n  \n\n这件事情引发了巨大的讨论度，许多网友都在评论区说：**这个男人不还手的理由，太让人心酸了。**\n\n![](https://weimgpub.oss-cn-hangzhou.aliyuncs.com/img/202208021317035.png)\n\n**是啊，“哪有什么岁月静好，不过是有人在替你忍辱负重”。**\n\n  \n\n说实话，看完这个新闻，对我的触动很大。\n\n  \n\n这个父亲，他就是如你我的父辈一样，是一个再普通不过的中年人。\n\n  \n\n他们会为了生活而奔波，会为了工作受委屈，会遭遇被骂被辱的场景。\n\n  \n\n委屈，劳碌，艰辛，是他们生活的常态。\n\n  \n\n但只要一想到自己保护的人，他们就会选择默默吞下。\n\n  \n\n背上重重的担子，是父亲两个字的全部分量。\n\n  \n\n也许，他们拼尽全力，也给不了你大富大贵，但他们一直在想尽办法去给你的人生托底。\n\n  \n\n**毫无保留，奋力托举，竭尽全力，这就是一个父亲带给我们的热泪盈眶。**\n\n#### **02**\n益阳的这个父亲，我想起之前看过的一则抖音。\n\n  \n\n一个二手车的买主，发现原车主行车记录仪里一段视频。\n\n  \n\n里面记录了，一位父亲隐忍而伟大的瞬间。\n\n  \n\n在卖车前，视频里的原车主接了两个电话。\n\n  \n\n第一个，是妻子打过来的，孩子要交培训班的费用了。\n\n  \n\n男人说：\n\n  \n\n“小孩的培训费用我已经凑到了。”\n\n  \n\n“我手上有钱，你放心。”\n\n  \n\n应该是家里遇到什么难关，妻子电话那头也在担心他。\n\n  \n\n但他语气柔和，不断安抚着妻子，一连说了几个“放心”，让妻子不要担心。\n\n  \n\n刚挂完电话，债主也联系他了。\n\n  \n\n他说，已经把车卖给了二手车行，明天款打过来，第一时间送过去。钱拖了这么久，真的不好意思。\n\n  \n\n**可是，电话刚挂断，男人隐忍压抑的哭声传了出来。**\n\n**从啜泣，到痛哭，他一边哭一边说“太难了”。**\n\n这一幕，让人无比心酸。\n\n  \n\n卖掉车，他只能坐公交车去上班，可是这些钱却可以还债和给孩子交学费。\n\n  \n\n他没有向妻子抱怨，更没有卖惨哭穷，只说了“放心”。\n\n  \n\n山穷水尽之际，他惦念的，还是自己身上的担子。\n\n  \n\n我完全可以想象，这段崩溃痛哭的背后，他到底经历了怎么的煎熬和磨难。\n\n  \n\n**他们不是生来就是无比强大的爸爸，可父亲这个身份，是软肋，也是铠甲。**\n\n  \n\n想起电视剧《归去来》中，王志文饰演的父亲对儿子说：\n\n  \n\n“每一位受过挫折，吃过苦挨过累的父亲，都会想尽办法让他的孩子，能够免于生活的困苦，无忧无虑地度过一生。\n\n  \n\n不为斗米折腰，不为金钱媚骨，我的辛苦，是想能够让你轻松一点。”\n\n  \n\n少时不懂其中意，长大方知父母恩。\n\n  \n\n**比起母爱的细腻柔软，父爱，显得粗放而不善言辞。**\n\n**但每次有什么困难，都是这样的爱，如山一般挡在我们面前，蕴藏巨大的能量。**\n\n#### **03**\n\n在抖音上，一个父亲问北京中医药医院的张主任：晚期癌症，还有希望吗？\n\n  \n\n张主任回复说：对不起，这个可能没有办法。\n\n  \n\n然后他回复张主任说：我想问一下，我这种情况还需要治疗吗？我想把钱留给孩子。\n\n![](https://weimgpub.oss-cn-hangzhou.aliyuncs.com/img/202208021318493.png)\n\n\n**“我想把钱留给孩子”，这简单的几个字却饱含沉甸甸的眼泪，让人一下子破防。**\n\n  \n\n后来，有网友一直盯着这个父亲的抖音。\n\n  \n\n可是，这个父亲的抖音，再也没有更新了，但是他的头像，依旧是他和两个孩子的幸福记忆。\n\n**我还想起了自己的父亲。**\n\n  \n\n年少敏感，物资匮乏，我也曾抱怨，为什么我的父亲给不了我优渥的生活。\n\n  \n\n后来我才知道，高三那年，他曾在学校不远处的工地打短工。\n\n  \n\n中午吃过饭，他走路到学校，在校门口站了很久，就想看能不能在操场上找到我的身影。\n\n  \n\n他没有让保安通知我，就那样孤独地站着。\n\n  \n\n这些，我也是很久之后，从母亲口中得知。\n\n  \n\n我能想象，瘦弱的他，站在校门口，一根接一根抽烟的样子。\n\n  \n\n他当时在想些什么呢？\n\n  \n\n朝校门内张望时，他是否在想象，孩子正踩在他的肩膀上眺望未来？\n\n  \n\n那一刻，我释怀了。\n\n  \n\n作为一个父亲，也许他没有那么大的能力。\n\n  \n\n但养育我，教育我，支持我，他已经拼尽了全力。\n\n  \n\n**我的父亲没有“散文诗”，他只有厚厚的老茧和密密麻麻干活工期。**\n\n**生活从未容易，如果你觉得容易，那么一定是有人在替你承担不易。**\n\n  \n\n很喜欢作家耳根说的一段话：\n\n  \n\n“父爱，你幼年去看，他是你的保护神；\n\n  \n\n少年去看，他似乎变成了阻挡你眼睛的障碍；\n\n  \n\n青年时，或许你会觉得，他变矮了，你认为你已比他高；\n\n  \n\n可中年时，当你再次去看那座山，你会忽然发现，他一直都在那里，一直都在默默的看着自己的骄傲，狂妄，自私，以及狭隘，他都在包容，无声无息的包容……”\n\n  \n\n**像山一样沉稳，像水一样无言。**\n\n**无论你走到何方，回头看，那殷切期盼的人群里，总有他的身影。**","source":"_posts/微信公众号/破防了.md","raw":"---\ncategories:\n  - 微信公众号\n---\n#### **01**\n***转自：桌子生活观，测试s***\n\n被人无故殴打，你的第一反应是什么？\n\n我想，大部分人在反应过来后，会奋起反抗。\n\n但是，这两天的一个事件，却看得我鼻头发酸。\n\n事情发生在益阳桃江ssss\n\n\n7月29日晚，谢某酒后到某快递站买槟榔。\n\n  \n\n据店主说，谢某给了5元，非要说给了50，还让店主找钱。\n\n  \n\n被拒绝后，谢某恼羞成怒，开始暴打店主。\n\n  \n\n曝光的视频里，他狠狠薅住店主的头发往后扯。\n\n  \n\n然后，用力甩了店主两巴掌。\n\n  \n\n看对方没还手，谢某的气焰更加嚣张。\n\n  \n\n连续掌掴了好几次，拳头打在肚子上，再猛地抡起拳头往太阳穴招呼。\n\n![](https://weimgpub.oss-cn-hangzhou.aliyuncs.com/img/202208021316759.png)\n\n拳拳到肉，隔着屏幕，都觉得疼痛无比。\n\n  \n\n谢某下手有多重？\n\n  \n\n店主的伤，基本集中在头部。\n\n  \n\n太阳穴挨了两圈，脑子晕晕乎乎。\n\n  \n\n他被打出脑震荡，加上鼻梁骨折。\n\n  \n\n**可整个过程，店主一次都没有还手。**\n\n  \n\n被打得好几个趔趄，被扯着头发往前拖，被狠狠甩耳光，手机摔在地上，他始终没有反抗。\n\n  \n\n这一幕，让人无比心疼又令人疑惑。\n\n  \n\n面对如此蛮横的醉汉，他为什么不还手？\n\n  \n\n知道真相后，我感到特别心酸。\n\n  \n\n店主说：**我不敢还手，还手的话就变成了互殴。我老婆刚生完孩子，出院才三天。为了家庭，为了生活，我不能还手.....**\n\n一边是嗷嗷待哺的孩子，一边是产后需要呵护的妻子。\n\n  \n\n如果他还手也被抓进去，那么谁来照顾他们？\n\n  \n\n所以，当雨点般的拳头落在头上的一瞬，他控制住了反抗的本能，所想所念，都是家庭和孩子。\n\n  \n\n**这是一个做丈夫的责任，也是一个做父亲的担当。**\n\n  \n\n目前，这个打人的男子因为寻衅滋事，已经被警方抓获，等待他的，将会是法律的严惩。\n\n  \n\n自从这个事情在网上发酵曝光后，一下子就火了，视频播放量有几千万，点赞量有几百万。\n\n  \n\n这件事情引发了巨大的讨论度，许多网友都在评论区说：**这个男人不还手的理由，太让人心酸了。**\n\n![](https://weimgpub.oss-cn-hangzhou.aliyuncs.com/img/202208021317035.png)\n\n**是啊，“哪有什么岁月静好，不过是有人在替你忍辱负重”。**\n\n  \n\n说实话，看完这个新闻，对我的触动很大。\n\n  \n\n这个父亲，他就是如你我的父辈一样，是一个再普通不过的中年人。\n\n  \n\n他们会为了生活而奔波，会为了工作受委屈，会遭遇被骂被辱的场景。\n\n  \n\n委屈，劳碌，艰辛，是他们生活的常态。\n\n  \n\n但只要一想到自己保护的人，他们就会选择默默吞下。\n\n  \n\n背上重重的担子，是父亲两个字的全部分量。\n\n  \n\n也许，他们拼尽全力，也给不了你大富大贵，但他们一直在想尽办法去给你的人生托底。\n\n  \n\n**毫无保留，奋力托举，竭尽全力，这就是一个父亲带给我们的热泪盈眶。**\n\n#### **02**\n益阳的这个父亲，我想起之前看过的一则抖音。\n\n  \n\n一个二手车的买主，发现原车主行车记录仪里一段视频。\n\n  \n\n里面记录了，一位父亲隐忍而伟大的瞬间。\n\n  \n\n在卖车前，视频里的原车主接了两个电话。\n\n  \n\n第一个，是妻子打过来的，孩子要交培训班的费用了。\n\n  \n\n男人说：\n\n  \n\n“小孩的培训费用我已经凑到了。”\n\n  \n\n“我手上有钱，你放心。”\n\n  \n\n应该是家里遇到什么难关，妻子电话那头也在担心他。\n\n  \n\n但他语气柔和，不断安抚着妻子，一连说了几个“放心”，让妻子不要担心。\n\n  \n\n刚挂完电话，债主也联系他了。\n\n  \n\n他说，已经把车卖给了二手车行，明天款打过来，第一时间送过去。钱拖了这么久，真的不好意思。\n\n  \n\n**可是，电话刚挂断，男人隐忍压抑的哭声传了出来。**\n\n**从啜泣，到痛哭，他一边哭一边说“太难了”。**\n\n这一幕，让人无比心酸。\n\n  \n\n卖掉车，他只能坐公交车去上班，可是这些钱却可以还债和给孩子交学费。\n\n  \n\n他没有向妻子抱怨，更没有卖惨哭穷，只说了“放心”。\n\n  \n\n山穷水尽之际，他惦念的，还是自己身上的担子。\n\n  \n\n我完全可以想象，这段崩溃痛哭的背后，他到底经历了怎么的煎熬和磨难。\n\n  \n\n**他们不是生来就是无比强大的爸爸，可父亲这个身份，是软肋，也是铠甲。**\n\n  \n\n想起电视剧《归去来》中，王志文饰演的父亲对儿子说：\n\n  \n\n“每一位受过挫折，吃过苦挨过累的父亲，都会想尽办法让他的孩子，能够免于生活的困苦，无忧无虑地度过一生。\n\n  \n\n不为斗米折腰，不为金钱媚骨，我的辛苦，是想能够让你轻松一点。”\n\n  \n\n少时不懂其中意，长大方知父母恩。\n\n  \n\n**比起母爱的细腻柔软，父爱，显得粗放而不善言辞。**\n\n**但每次有什么困难，都是这样的爱，如山一般挡在我们面前，蕴藏巨大的能量。**\n\n#### **03**\n\n在抖音上，一个父亲问北京中医药医院的张主任：晚期癌症，还有希望吗？\n\n  \n\n张主任回复说：对不起，这个可能没有办法。\n\n  \n\n然后他回复张主任说：我想问一下，我这种情况还需要治疗吗？我想把钱留给孩子。\n\n![](https://weimgpub.oss-cn-hangzhou.aliyuncs.com/img/202208021318493.png)\n\n\n**“我想把钱留给孩子”，这简单的几个字却饱含沉甸甸的眼泪，让人一下子破防。**\n\n  \n\n后来，有网友一直盯着这个父亲的抖音。\n\n  \n\n可是，这个父亲的抖音，再也没有更新了，但是他的头像，依旧是他和两个孩子的幸福记忆。\n\n**我还想起了自己的父亲。**\n\n  \n\n年少敏感，物资匮乏，我也曾抱怨，为什么我的父亲给不了我优渥的生活。\n\n  \n\n后来我才知道，高三那年，他曾在学校不远处的工地打短工。\n\n  \n\n中午吃过饭，他走路到学校，在校门口站了很久，就想看能不能在操场上找到我的身影。\n\n  \n\n他没有让保安通知我，就那样孤独地站着。\n\n  \n\n这些，我也是很久之后，从母亲口中得知。\n\n  \n\n我能想象，瘦弱的他，站在校门口，一根接一根抽烟的样子。\n\n  \n\n他当时在想些什么呢？\n\n  \n\n朝校门内张望时，他是否在想象，孩子正踩在他的肩膀上眺望未来？\n\n  \n\n那一刻，我释怀了。\n\n  \n\n作为一个父亲，也许他没有那么大的能力。\n\n  \n\n但养育我，教育我，支持我，他已经拼尽了全力。\n\n  \n\n**我的父亲没有“散文诗”，他只有厚厚的老茧和密密麻麻干活工期。**\n\n**生活从未容易，如果你觉得容易，那么一定是有人在替你承担不易。**\n\n  \n\n很喜欢作家耳根说的一段话：\n\n  \n\n“父爱，你幼年去看，他是你的保护神；\n\n  \n\n少年去看，他似乎变成了阻挡你眼睛的障碍；\n\n  \n\n青年时，或许你会觉得，他变矮了，你认为你已比他高；\n\n  \n\n可中年时，当你再次去看那座山，你会忽然发现，他一直都在那里，一直都在默默的看着自己的骄傲，狂妄，自私，以及狭隘，他都在包容，无声无息的包容……”\n\n  \n\n**像山一样沉稳，像水一样无言。**\n\n**无论你走到何方，回头看，那殷切期盼的人群里，总有他的身影。**","slug":"破防了","published":1,"category":"微信公众号","date":"2023-06-08T23:03:56.118Z","updated":"2023-06-08T23:12:13.748Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5ser0026dxjc50mdbj0y","content":"<h4 id=\"01\"><a href=\"#01\" class=\"headerlink\" title=\"01\"></a><strong>01</strong></h4><p><em><strong>转自：桌子生活观，测试s</strong></em></p>\n<p>被人无故殴打，你的第一反应是什么？</p>\n<p>我想，大部分人在反应过来后，会奋起反抗。</p>\n<p>但是，这两天的一个事件，却看得我鼻头发酸。</p>\n<p>事情发生在益阳桃江ssss</p>\n<p>7月29日晚，谢某酒后到某快递站买槟榔。</p>\n<p>据店主说，谢某给了5元，非要说给了50，还让店主找钱。</p>\n<p>被拒绝后，谢某恼羞成怒，开始暴打店主。</p>\n<p>曝光的视频里，他狠狠薅住店主的头发往后扯。</p>\n<p>然后，用力甩了店主两巴掌。</p>\n<p>看对方没还手，谢某的气焰更加嚣张。</p>\n<p>连续掌掴了好几次，拳头打在肚子上，再猛地抡起拳头往太阳穴招呼。</p>\n<p><img src=\"https://weimgpub.oss-cn-hangzhou.aliyuncs.com/img/202208021316759.png\"></p>\n<p>拳拳到肉，隔着屏幕，都觉得疼痛无比。</p>\n<p>谢某下手有多重？</p>\n<p>店主的伤，基本集中在头部。</p>\n<p>太阳穴挨了两圈，脑子晕晕乎乎。</p>\n<p>他被打出脑震荡，加上鼻梁骨折。</p>\n<p><strong>可整个过程，店主一次都没有还手。</strong></p>\n<p>被打得好几个趔趄，被扯着头发往前拖，被狠狠甩耳光，手机摔在地上，他始终没有反抗。</p>\n<p>这一幕，让人无比心疼又令人疑惑。</p>\n<p>面对如此蛮横的醉汉，他为什么不还手？</p>\n<p>知道真相后，我感到特别心酸。</p>\n<p>店主说：<strong>我不敢还手，还手的话就变成了互殴。我老婆刚生完孩子，出院才三天。为了家庭，为了生活，我不能还手…..</strong></p>\n<p>一边是嗷嗷待哺的孩子，一边是产后需要呵护的妻子。</p>\n<p>如果他还手也被抓进去，那么谁来照顾他们？</p>\n<p>所以，当雨点般的拳头落在头上的一瞬，他控制住了反抗的本能，所想所念，都是家庭和孩子。</p>\n<p><strong>这是一个做丈夫的责任，也是一个做父亲的担当。</strong></p>\n<p>目前，这个打人的男子因为寻衅滋事，已经被警方抓获，等待他的，将会是法律的严惩。</p>\n<p>自从这个事情在网上发酵曝光后，一下子就火了，视频播放量有几千万，点赞量有几百万。</p>\n<p>这件事情引发了巨大的讨论度，许多网友都在评论区说：<strong>这个男人不还手的理由，太让人心酸了。</strong></p>\n<p><img src=\"https://weimgpub.oss-cn-hangzhou.aliyuncs.com/img/202208021317035.png\"></p>\n<p><strong>是啊，“哪有什么岁月静好，不过是有人在替你忍辱负重”。</strong></p>\n<p>说实话，看完这个新闻，对我的触动很大。</p>\n<p>这个父亲，他就是如你我的父辈一样，是一个再普通不过的中年人。</p>\n<p>他们会为了生活而奔波，会为了工作受委屈，会遭遇被骂被辱的场景。</p>\n<p>委屈，劳碌，艰辛，是他们生活的常态。</p>\n<p>但只要一想到自己保护的人，他们就会选择默默吞下。</p>\n<p>背上重重的担子，是父亲两个字的全部分量。</p>\n<p>也许，他们拼尽全力，也给不了你大富大贵，但他们一直在想尽办法去给你的人生托底。</p>\n<p><strong>毫无保留，奋力托举，竭尽全力，这就是一个父亲带给我们的热泪盈眶。</strong></p>\n<h4 id=\"02\"><a href=\"#02\" class=\"headerlink\" title=\"02\"></a><strong>02</strong></h4><p>益阳的这个父亲，我想起之前看过的一则抖音。</p>\n<p>一个二手车的买主，发现原车主行车记录仪里一段视频。</p>\n<p>里面记录了，一位父亲隐忍而伟大的瞬间。</p>\n<p>在卖车前，视频里的原车主接了两个电话。</p>\n<p>第一个，是妻子打过来的，孩子要交培训班的费用了。</p>\n<p>男人说：</p>\n<p>“小孩的培训费用我已经凑到了。”</p>\n<p>“我手上有钱，你放心。”</p>\n<p>应该是家里遇到什么难关，妻子电话那头也在担心他。</p>\n<p>但他语气柔和，不断安抚着妻子，一连说了几个“放心”，让妻子不要担心。</p>\n<p>刚挂完电话，债主也联系他了。</p>\n<p>他说，已经把车卖给了二手车行，明天款打过来，第一时间送过去。钱拖了这么久，真的不好意思。</p>\n<p><strong>可是，电话刚挂断，男人隐忍压抑的哭声传了出来。</strong></p>\n<p><strong>从啜泣，到痛哭，他一边哭一边说“太难了”。</strong></p>\n<p>这一幕，让人无比心酸。</p>\n<p>卖掉车，他只能坐公交车去上班，可是这些钱却可以还债和给孩子交学费。</p>\n<p>他没有向妻子抱怨，更没有卖惨哭穷，只说了“放心”。</p>\n<p>山穷水尽之际，他惦念的，还是自己身上的担子。</p>\n<p>我完全可以想象，这段崩溃痛哭的背后，他到底经历了怎么的煎熬和磨难。</p>\n<p><strong>他们不是生来就是无比强大的爸爸，可父亲这个身份，是软肋，也是铠甲。</strong></p>\n<p>想起电视剧《归去来》中，王志文饰演的父亲对儿子说：</p>\n<p>“每一位受过挫折，吃过苦挨过累的父亲，都会想尽办法让他的孩子，能够免于生活的困苦，无忧无虑地度过一生。</p>\n<p>不为斗米折腰，不为金钱媚骨，我的辛苦，是想能够让你轻松一点。”</p>\n<p>少时不懂其中意，长大方知父母恩。</p>\n<p><strong>比起母爱的细腻柔软，父爱，显得粗放而不善言辞。</strong></p>\n<p><strong>但每次有什么困难，都是这样的爱，如山一般挡在我们面前，蕴藏巨大的能量。</strong></p>\n<h4 id=\"03\"><a href=\"#03\" class=\"headerlink\" title=\"03\"></a><strong>03</strong></h4><p>在抖音上，一个父亲问北京中医药医院的张主任：晚期癌症，还有希望吗？</p>\n<p>张主任回复说：对不起，这个可能没有办法。</p>\n<p>然后他回复张主任说：我想问一下，我这种情况还需要治疗吗？我想把钱留给孩子。</p>\n<p><img src=\"https://weimgpub.oss-cn-hangzhou.aliyuncs.com/img/202208021318493.png\"></p>\n<p><strong>“我想把钱留给孩子”，这简单的几个字却饱含沉甸甸的眼泪，让人一下子破防。</strong></p>\n<p>后来，有网友一直盯着这个父亲的抖音。</p>\n<p>可是，这个父亲的抖音，再也没有更新了，但是他的头像，依旧是他和两个孩子的幸福记忆。</p>\n<p><strong>我还想起了自己的父亲。</strong></p>\n<p>年少敏感，物资匮乏，我也曾抱怨，为什么我的父亲给不了我优渥的生活。</p>\n<p>后来我才知道，高三那年，他曾在学校不远处的工地打短工。</p>\n<p>中午吃过饭，他走路到学校，在校门口站了很久，就想看能不能在操场上找到我的身影。</p>\n<p>他没有让保安通知我，就那样孤独地站着。</p>\n<p>这些，我也是很久之后，从母亲口中得知。</p>\n<p>我能想象，瘦弱的他，站在校门口，一根接一根抽烟的样子。</p>\n<p>他当时在想些什么呢？</p>\n<p>朝校门内张望时，他是否在想象，孩子正踩在他的肩膀上眺望未来？</p>\n<p>那一刻，我释怀了。</p>\n<p>作为一个父亲，也许他没有那么大的能力。</p>\n<p>但养育我，教育我，支持我，他已经拼尽了全力。</p>\n<p><strong>我的父亲没有“散文诗”，他只有厚厚的老茧和密密麻麻干活工期。</strong></p>\n<p><strong>生活从未容易，如果你觉得容易，那么一定是有人在替你承担不易。</strong></p>\n<p>很喜欢作家耳根说的一段话：</p>\n<p>“父爱，你幼年去看，他是你的保护神；</p>\n<p>少年去看，他似乎变成了阻挡你眼睛的障碍；</p>\n<p>青年时，或许你会觉得，他变矮了，你认为你已比他高；</p>\n<p>可中年时，当你再次去看那座山，你会忽然发现，他一直都在那里，一直都在默默的看着自己的骄傲，狂妄，自私，以及狭隘，他都在包容，无声无息的包容……”</p>\n<p><strong>像山一样沉稳，像水一样无言。</strong></p>\n<p><strong>无论你走到何方，回头看，那殷切期盼的人群里，总有他的身影。</strong></p>\n","site":{"data":{}},"length":2273,"excerpt":"","more":"<h4 id=\"01\"><a href=\"#01\" class=\"headerlink\" title=\"01\"></a><strong>01</strong></h4><p><em><strong>转自：桌子生活观，测试s</strong></em></p>\n<p>被人无故殴打，你的第一反应是什么？</p>\n<p>我想，大部分人在反应过来后，会奋起反抗。</p>\n<p>但是，这两天的一个事件，却看得我鼻头发酸。</p>\n<p>事情发生在益阳桃江ssss</p>\n<p>7月29日晚，谢某酒后到某快递站买槟榔。</p>\n<p>据店主说，谢某给了5元，非要说给了50，还让店主找钱。</p>\n<p>被拒绝后，谢某恼羞成怒，开始暴打店主。</p>\n<p>曝光的视频里，他狠狠薅住店主的头发往后扯。</p>\n<p>然后，用力甩了店主两巴掌。</p>\n<p>看对方没还手，谢某的气焰更加嚣张。</p>\n<p>连续掌掴了好几次，拳头打在肚子上，再猛地抡起拳头往太阳穴招呼。</p>\n<p><img src=\"https://weimgpub.oss-cn-hangzhou.aliyuncs.com/img/202208021316759.png\"></p>\n<p>拳拳到肉，隔着屏幕，都觉得疼痛无比。</p>\n<p>谢某下手有多重？</p>\n<p>店主的伤，基本集中在头部。</p>\n<p>太阳穴挨了两圈，脑子晕晕乎乎。</p>\n<p>他被打出脑震荡，加上鼻梁骨折。</p>\n<p><strong>可整个过程，店主一次都没有还手。</strong></p>\n<p>被打得好几个趔趄，被扯着头发往前拖，被狠狠甩耳光，手机摔在地上，他始终没有反抗。</p>\n<p>这一幕，让人无比心疼又令人疑惑。</p>\n<p>面对如此蛮横的醉汉，他为什么不还手？</p>\n<p>知道真相后，我感到特别心酸。</p>\n<p>店主说：<strong>我不敢还手，还手的话就变成了互殴。我老婆刚生完孩子，出院才三天。为了家庭，为了生活，我不能还手…..</strong></p>\n<p>一边是嗷嗷待哺的孩子，一边是产后需要呵护的妻子。</p>\n<p>如果他还手也被抓进去，那么谁来照顾他们？</p>\n<p>所以，当雨点般的拳头落在头上的一瞬，他控制住了反抗的本能，所想所念，都是家庭和孩子。</p>\n<p><strong>这是一个做丈夫的责任，也是一个做父亲的担当。</strong></p>\n<p>目前，这个打人的男子因为寻衅滋事，已经被警方抓获，等待他的，将会是法律的严惩。</p>\n<p>自从这个事情在网上发酵曝光后，一下子就火了，视频播放量有几千万，点赞量有几百万。</p>\n<p>这件事情引发了巨大的讨论度，许多网友都在评论区说：<strong>这个男人不还手的理由，太让人心酸了。</strong></p>\n<p><img src=\"https://weimgpub.oss-cn-hangzhou.aliyuncs.com/img/202208021317035.png\"></p>\n<p><strong>是啊，“哪有什么岁月静好，不过是有人在替你忍辱负重”。</strong></p>\n<p>说实话，看完这个新闻，对我的触动很大。</p>\n<p>这个父亲，他就是如你我的父辈一样，是一个再普通不过的中年人。</p>\n<p>他们会为了生活而奔波，会为了工作受委屈，会遭遇被骂被辱的场景。</p>\n<p>委屈，劳碌，艰辛，是他们生活的常态。</p>\n<p>但只要一想到自己保护的人，他们就会选择默默吞下。</p>\n<p>背上重重的担子，是父亲两个字的全部分量。</p>\n<p>也许，他们拼尽全力，也给不了你大富大贵，但他们一直在想尽办法去给你的人生托底。</p>\n<p><strong>毫无保留，奋力托举，竭尽全力，这就是一个父亲带给我们的热泪盈眶。</strong></p>\n<h4 id=\"02\"><a href=\"#02\" class=\"headerlink\" title=\"02\"></a><strong>02</strong></h4><p>益阳的这个父亲，我想起之前看过的一则抖音。</p>\n<p>一个二手车的买主，发现原车主行车记录仪里一段视频。</p>\n<p>里面记录了，一位父亲隐忍而伟大的瞬间。</p>\n<p>在卖车前，视频里的原车主接了两个电话。</p>\n<p>第一个，是妻子打过来的，孩子要交培训班的费用了。</p>\n<p>男人说：</p>\n<p>“小孩的培训费用我已经凑到了。”</p>\n<p>“我手上有钱，你放心。”</p>\n<p>应该是家里遇到什么难关，妻子电话那头也在担心他。</p>\n<p>但他语气柔和，不断安抚着妻子，一连说了几个“放心”，让妻子不要担心。</p>\n<p>刚挂完电话，债主也联系他了。</p>\n<p>他说，已经把车卖给了二手车行，明天款打过来，第一时间送过去。钱拖了这么久，真的不好意思。</p>\n<p><strong>可是，电话刚挂断，男人隐忍压抑的哭声传了出来。</strong></p>\n<p><strong>从啜泣，到痛哭，他一边哭一边说“太难了”。</strong></p>\n<p>这一幕，让人无比心酸。</p>\n<p>卖掉车，他只能坐公交车去上班，可是这些钱却可以还债和给孩子交学费。</p>\n<p>他没有向妻子抱怨，更没有卖惨哭穷，只说了“放心”。</p>\n<p>山穷水尽之际，他惦念的，还是自己身上的担子。</p>\n<p>我完全可以想象，这段崩溃痛哭的背后，他到底经历了怎么的煎熬和磨难。</p>\n<p><strong>他们不是生来就是无比强大的爸爸，可父亲这个身份，是软肋，也是铠甲。</strong></p>\n<p>想起电视剧《归去来》中，王志文饰演的父亲对儿子说：</p>\n<p>“每一位受过挫折，吃过苦挨过累的父亲，都会想尽办法让他的孩子，能够免于生活的困苦，无忧无虑地度过一生。</p>\n<p>不为斗米折腰，不为金钱媚骨，我的辛苦，是想能够让你轻松一点。”</p>\n<p>少时不懂其中意，长大方知父母恩。</p>\n<p><strong>比起母爱的细腻柔软，父爱，显得粗放而不善言辞。</strong></p>\n<p><strong>但每次有什么困难，都是这样的爱，如山一般挡在我们面前，蕴藏巨大的能量。</strong></p>\n<h4 id=\"03\"><a href=\"#03\" class=\"headerlink\" title=\"03\"></a><strong>03</strong></h4><p>在抖音上，一个父亲问北京中医药医院的张主任：晚期癌症，还有希望吗？</p>\n<p>张主任回复说：对不起，这个可能没有办法。</p>\n<p>然后他回复张主任说：我想问一下，我这种情况还需要治疗吗？我想把钱留给孩子。</p>\n<p><img src=\"https://weimgpub.oss-cn-hangzhou.aliyuncs.com/img/202208021318493.png\"></p>\n<p><strong>“我想把钱留给孩子”，这简单的几个字却饱含沉甸甸的眼泪，让人一下子破防。</strong></p>\n<p>后来，有网友一直盯着这个父亲的抖音。</p>\n<p>可是，这个父亲的抖音，再也没有更新了，但是他的头像，依旧是他和两个孩子的幸福记忆。</p>\n<p><strong>我还想起了自己的父亲。</strong></p>\n<p>年少敏感，物资匮乏，我也曾抱怨，为什么我的父亲给不了我优渥的生活。</p>\n<p>后来我才知道，高三那年，他曾在学校不远处的工地打短工。</p>\n<p>中午吃过饭，他走路到学校，在校门口站了很久，就想看能不能在操场上找到我的身影。</p>\n<p>他没有让保安通知我，就那样孤独地站着。</p>\n<p>这些，我也是很久之后，从母亲口中得知。</p>\n<p>我能想象，瘦弱的他，站在校门口，一根接一根抽烟的样子。</p>\n<p>他当时在想些什么呢？</p>\n<p>朝校门内张望时，他是否在想象，孩子正踩在他的肩膀上眺望未来？</p>\n<p>那一刻，我释怀了。</p>\n<p>作为一个父亲，也许他没有那么大的能力。</p>\n<p>但养育我，教育我，支持我，他已经拼尽了全力。</p>\n<p><strong>我的父亲没有“散文诗”，他只有厚厚的老茧和密密麻麻干活工期。</strong></p>\n<p><strong>生活从未容易，如果你觉得容易，那么一定是有人在替你承担不易。</strong></p>\n<p>很喜欢作家耳根说的一段话：</p>\n<p>“父爱，你幼年去看，他是你的保护神；</p>\n<p>少年去看，他似乎变成了阻挡你眼睛的障碍；</p>\n<p>青年时，或许你会觉得，他变矮了，你认为你已比他高；</p>\n<p>可中年时，当你再次去看那座山，你会忽然发现，他一直都在那里，一直都在默默的看着自己的骄傲，狂妄，自私，以及狭隘，他都在包容，无声无息的包容……”</p>\n<p><strong>像山一样沉稳，像水一样无言。</strong></p>\n<p><strong>无论你走到何方，回头看，那殷切期盼的人群里，总有他的身影。</strong></p>\n"},{"_content":"#### **MU5735号航班**\n\n3.21的MU5735空难，那几天罕见的失眠了，几乎每隔一个小时都在刷着抖音、微博，获取132名乘客是否还活着的消息，搜寻黑匣子的消息，疯狂的刷着历史上的空难，来对比这次空难，甚至还有想去梧州的想法，直到官方宣布遇难我才相信。\n\n昨天刷到叫「**红豆和树**」的公众号，每篇文章看完都会莫名的戳中泪点。\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203281442530.png)\n\n\n红豆先生是空难的一名乘客，他在公众号里记录了和树子小姐从相识到布置新房，准备结婚的感悟，最后一篇永远的定格在2021的12月份。红豆先生本来工作在北京，为了树子小姐到广州工作，工作来返昆明与广州，文字都透着真诚，无数次描绘他们未来生活的模样。\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203281442214.png)\n\n#### **公众号更名**\n\n我把其中的一篇文章分享给了喵姑娘，然后我说要不你也起个名吧，我也想写一个关于你的公众号，喵姑娘说那你觉得我像什么，我一时之间不知道怎么形容她，直到今天早上起来，才觉得她像一只猫，时而琢磨不透，时而懒散，时而傲娇，时而粘人，常常会因为抖音的一条短视频感动的流泪，就直直的让眼泪流到嘴角，也不知道擦掉。\n\n至此，我的公众号名称也将改名叫「**阿三与喵姑娘**」，不过这个公众号我什么都会写，编程，吃瓜，感悟，与喵姑娘的点点滴滴，分享我的价值观等等。\n\n#### **写作太难了？**\n\n\n当然写作不是一件容易的事情，对于我这个理科生来说，写作文简直是要了我的命，粥左罗在《学习写作》中提到怎么写：\n\n**一开始都是从硬写过来的**\n\n只不过后来慢慢总结成框架了，框架对于新手其实不太合适，对于已经入门的写者适合，能提高效率，对于我这个菜鸟来说还是老老实实的硬写吧。\n\n突然想到我自己的两个经历，分享下：\n\n- ***代码维护***\n\n之前我写代码都是面向过程的写法，写起来很快，但是对代码后期的维护很友好，我领导耐心地告诉我做法：\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203281214057.png)\n![](https://gitee.com/cjyzwg/img/raw/master/202203281214187.png)\n\n这也就是我说的类似写作的框架，如果再把领域范围扩大，扩大到销售，自媒体推广，电商等等方面，都是一样的。\n\n- ***与人沟通***\n\n我的前任老板，一名深耕于健身行业二十年有余的商业女性，对于她的教诲我至今还没学到皮毛，她说过程序员的思想和销售说话很类似，比如顾客问你一句话，你需要去思考A/B/C三种说法，就像我们写代码的逻辑一样。\n\n所以她之前一直想培养我成销售，可能是我的能力不足，也有可能是她填鸭式的方法不太适合我，我现在在通过写作去学习与人沟通。\n\n#### **多读好书**\n\n前一阵子，看了王牌对王牌的一期节目，节目嘉宾是作者麦家，不同于以前的嘉宾，他很温文尔雅，说话波澜不惊，最后给每个人的寄语也都戳中他们内心，他是真正有大智慧的人，他做了一个读书计划，「用20年时间，陪读者读完1000本名著」。\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203281410148.png)\n\n\n他在最新的一篇文章写道：\n\n**因为疫情，读书，写作，健身，现在已经不大会激动，愤怒的火山也少见喷薄，仿佛喜怒都相似，都在重复，喜的不值喜，怒的不值得怒，一切归于平坦。**\n\n读万卷书，行外里路，在写作中思考人生，思考人性，这也就是为什么麦家老师在回答沈腾贾玲问题的时候没有太多的喜怒无常，而且直戳重点。\n\n\n查理芒格在穷查理宝典中写道：\n\n**通过广泛的阅读把自己培养成一个终生自学者。**\n\n多读书，读好书，读广泛的书，通过写作总结框架，整理思维模型，形成自己新的世界观。\n","source":"_posts/微信公众号/阿三与喵姑娘.md","raw":"---\ncategories:\n  - 微信公众号\n---\n#### **MU5735号航班**\n\n3.21的MU5735空难，那几天罕见的失眠了，几乎每隔一个小时都在刷着抖音、微博，获取132名乘客是否还活着的消息，搜寻黑匣子的消息，疯狂的刷着历史上的空难，来对比这次空难，甚至还有想去梧州的想法，直到官方宣布遇难我才相信。\n\n昨天刷到叫「**红豆和树**」的公众号，每篇文章看完都会莫名的戳中泪点。\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203281442530.png)\n\n\n红豆先生是空难的一名乘客，他在公众号里记录了和树子小姐从相识到布置新房，准备结婚的感悟，最后一篇永远的定格在2021的12月份。红豆先生本来工作在北京，为了树子小姐到广州工作，工作来返昆明与广州，文字都透着真诚，无数次描绘他们未来生活的模样。\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203281442214.png)\n\n#### **公众号更名**\n\n我把其中的一篇文章分享给了喵姑娘，然后我说要不你也起个名吧，我也想写一个关于你的公众号，喵姑娘说那你觉得我像什么，我一时之间不知道怎么形容她，直到今天早上起来，才觉得她像一只猫，时而琢磨不透，时而懒散，时而傲娇，时而粘人，常常会因为抖音的一条短视频感动的流泪，就直直的让眼泪流到嘴角，也不知道擦掉。\n\n至此，我的公众号名称也将改名叫「**阿三与喵姑娘**」，不过这个公众号我什么都会写，编程，吃瓜，感悟，与喵姑娘的点点滴滴，分享我的价值观等等。\n\n#### **写作太难了？**\n\n\n当然写作不是一件容易的事情，对于我这个理科生来说，写作文简直是要了我的命，粥左罗在《学习写作》中提到怎么写：\n\n**一开始都是从硬写过来的**\n\n只不过后来慢慢总结成框架了，框架对于新手其实不太合适，对于已经入门的写者适合，能提高效率，对于我这个菜鸟来说还是老老实实的硬写吧。\n\n突然想到我自己的两个经历，分享下：\n\n- ***代码维护***\n\n之前我写代码都是面向过程的写法，写起来很快，但是对代码后期的维护很友好，我领导耐心地告诉我做法：\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203281214057.png)\n![](https://gitee.com/cjyzwg/img/raw/master/202203281214187.png)\n\n这也就是我说的类似写作的框架，如果再把领域范围扩大，扩大到销售，自媒体推广，电商等等方面，都是一样的。\n\n- ***与人沟通***\n\n我的前任老板，一名深耕于健身行业二十年有余的商业女性，对于她的教诲我至今还没学到皮毛，她说过程序员的思想和销售说话很类似，比如顾客问你一句话，你需要去思考A/B/C三种说法，就像我们写代码的逻辑一样。\n\n所以她之前一直想培养我成销售，可能是我的能力不足，也有可能是她填鸭式的方法不太适合我，我现在在通过写作去学习与人沟通。\n\n#### **多读好书**\n\n前一阵子，看了王牌对王牌的一期节目，节目嘉宾是作者麦家，不同于以前的嘉宾，他很温文尔雅，说话波澜不惊，最后给每个人的寄语也都戳中他们内心，他是真正有大智慧的人，他做了一个读书计划，「用20年时间，陪读者读完1000本名著」。\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203281410148.png)\n\n\n他在最新的一篇文章写道：\n\n**因为疫情，读书，写作，健身，现在已经不大会激动，愤怒的火山也少见喷薄，仿佛喜怒都相似，都在重复，喜的不值喜，怒的不值得怒，一切归于平坦。**\n\n读万卷书，行外里路，在写作中思考人生，思考人性，这也就是为什么麦家老师在回答沈腾贾玲问题的时候没有太多的喜怒无常，而且直戳重点。\n\n\n查理芒格在穷查理宝典中写道：\n\n**通过广泛的阅读把自己培养成一个终生自学者。**\n\n多读书，读好书，读广泛的书，通过写作总结框架，整理思维模型，形成自己新的世界观。\n","slug":"阿三与喵姑娘","published":1,"category":"微信公众号","date":"2023-06-08T23:03:56.120Z","updated":"2023-06-08T23:12:13.748Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5ser0027dxjcaa4ofm77","content":"<h4 id=\"MU5735号航班\"><a href=\"#MU5735号航班\" class=\"headerlink\" title=\"MU5735号航班\"></a><strong>MU5735号航班</strong></h4><p>3.21的MU5735空难，那几天罕见的失眠了，几乎每隔一个小时都在刷着抖音、微博，获取132名乘客是否还活着的消息，搜寻黑匣子的消息，疯狂的刷着历史上的空难，来对比这次空难，甚至还有想去梧州的想法，直到官方宣布遇难我才相信。</p>\n<p>昨天刷到叫「<strong>红豆和树</strong>」的公众号，每篇文章看完都会莫名的戳中泪点。</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203281442530.png\"></p>\n<p>红豆先生是空难的一名乘客，他在公众号里记录了和树子小姐从相识到布置新房，准备结婚的感悟，最后一篇永远的定格在2021的12月份。红豆先生本来工作在北京，为了树子小姐到广州工作，工作来返昆明与广州，文字都透着真诚，无数次描绘他们未来生活的模样。</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203281442214.png\"></p>\n<h4 id=\"公众号更名\"><a href=\"#公众号更名\" class=\"headerlink\" title=\"公众号更名\"></a><strong>公众号更名</strong></h4><p>我把其中的一篇文章分享给了喵姑娘，然后我说要不你也起个名吧，我也想写一个关于你的公众号，喵姑娘说那你觉得我像什么，我一时之间不知道怎么形容她，直到今天早上起来，才觉得她像一只猫，时而琢磨不透，时而懒散，时而傲娇，时而粘人，常常会因为抖音的一条短视频感动的流泪，就直直的让眼泪流到嘴角，也不知道擦掉。</p>\n<p>至此，我的公众号名称也将改名叫「<strong>阿三与喵姑娘</strong>」，不过这个公众号我什么都会写，编程，吃瓜，感悟，与喵姑娘的点点滴滴，分享我的价值观等等。</p>\n<h4 id=\"写作太难了？\"><a href=\"#写作太难了？\" class=\"headerlink\" title=\"写作太难了？\"></a><strong>写作太难了？</strong></h4><p>当然写作不是一件容易的事情，对于我这个理科生来说，写作文简直是要了我的命，粥左罗在《学习写作》中提到怎么写：</p>\n<p><strong>一开始都是从硬写过来的</strong></p>\n<p>只不过后来慢慢总结成框架了，框架对于新手其实不太合适，对于已经入门的写者适合，能提高效率，对于我这个菜鸟来说还是老老实实的硬写吧。</p>\n<p>突然想到我自己的两个经历，分享下：</p>\n<ul>\n<li><em><strong>代码维护</strong></em></li>\n</ul>\n<p>之前我写代码都是面向过程的写法，写起来很快，但是对代码后期的维护很友好，我领导耐心地告诉我做法：</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203281214057.png\"><br><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203281214187.png\"></p>\n<p>这也就是我说的类似写作的框架，如果再把领域范围扩大，扩大到销售，自媒体推广，电商等等方面，都是一样的。</p>\n<ul>\n<li><em><strong>与人沟通</strong></em></li>\n</ul>\n<p>我的前任老板，一名深耕于健身行业二十年有余的商业女性，对于她的教诲我至今还没学到皮毛，她说过程序员的思想和销售说话很类似，比如顾客问你一句话，你需要去思考A&#x2F;B&#x2F;C三种说法，就像我们写代码的逻辑一样。</p>\n<p>所以她之前一直想培养我成销售，可能是我的能力不足，也有可能是她填鸭式的方法不太适合我，我现在在通过写作去学习与人沟通。</p>\n<h4 id=\"多读好书\"><a href=\"#多读好书\" class=\"headerlink\" title=\"多读好书\"></a><strong>多读好书</strong></h4><p>前一阵子，看了王牌对王牌的一期节目，节目嘉宾是作者麦家，不同于以前的嘉宾，他很温文尔雅，说话波澜不惊，最后给每个人的寄语也都戳中他们内心，他是真正有大智慧的人，他做了一个读书计划，「用20年时间，陪读者读完1000本名著」。</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203281410148.png\"></p>\n<p>他在最新的一篇文章写道：</p>\n<p><strong>因为疫情，读书，写作，健身，现在已经不大会激动，愤怒的火山也少见喷薄，仿佛喜怒都相似，都在重复，喜的不值喜，怒的不值得怒，一切归于平坦。</strong></p>\n<p>读万卷书，行外里路，在写作中思考人生，思考人性，这也就是为什么麦家老师在回答沈腾贾玲问题的时候没有太多的喜怒无常，而且直戳重点。</p>\n<p>查理芒格在穷查理宝典中写道：</p>\n<p><strong>通过广泛的阅读把自己培养成一个终生自学者。</strong></p>\n<p>多读书，读好书，读广泛的书，通过写作总结框架，整理思维模型，形成自己新的世界观。</p>\n","site":{"data":{}},"length":1260,"excerpt":"","more":"<h4 id=\"MU5735号航班\"><a href=\"#MU5735号航班\" class=\"headerlink\" title=\"MU5735号航班\"></a><strong>MU5735号航班</strong></h4><p>3.21的MU5735空难，那几天罕见的失眠了，几乎每隔一个小时都在刷着抖音、微博，获取132名乘客是否还活着的消息，搜寻黑匣子的消息，疯狂的刷着历史上的空难，来对比这次空难，甚至还有想去梧州的想法，直到官方宣布遇难我才相信。</p>\n<p>昨天刷到叫「<strong>红豆和树</strong>」的公众号，每篇文章看完都会莫名的戳中泪点。</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203281442530.png\"></p>\n<p>红豆先生是空难的一名乘客，他在公众号里记录了和树子小姐从相识到布置新房，准备结婚的感悟，最后一篇永远的定格在2021的12月份。红豆先生本来工作在北京，为了树子小姐到广州工作，工作来返昆明与广州，文字都透着真诚，无数次描绘他们未来生活的模样。</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203281442214.png\"></p>\n<h4 id=\"公众号更名\"><a href=\"#公众号更名\" class=\"headerlink\" title=\"公众号更名\"></a><strong>公众号更名</strong></h4><p>我把其中的一篇文章分享给了喵姑娘，然后我说要不你也起个名吧，我也想写一个关于你的公众号，喵姑娘说那你觉得我像什么，我一时之间不知道怎么形容她，直到今天早上起来，才觉得她像一只猫，时而琢磨不透，时而懒散，时而傲娇，时而粘人，常常会因为抖音的一条短视频感动的流泪，就直直的让眼泪流到嘴角，也不知道擦掉。</p>\n<p>至此，我的公众号名称也将改名叫「<strong>阿三与喵姑娘</strong>」，不过这个公众号我什么都会写，编程，吃瓜，感悟，与喵姑娘的点点滴滴，分享我的价值观等等。</p>\n<h4 id=\"写作太难了？\"><a href=\"#写作太难了？\" class=\"headerlink\" title=\"写作太难了？\"></a><strong>写作太难了？</strong></h4><p>当然写作不是一件容易的事情，对于我这个理科生来说，写作文简直是要了我的命，粥左罗在《学习写作》中提到怎么写：</p>\n<p><strong>一开始都是从硬写过来的</strong></p>\n<p>只不过后来慢慢总结成框架了，框架对于新手其实不太合适，对于已经入门的写者适合，能提高效率，对于我这个菜鸟来说还是老老实实的硬写吧。</p>\n<p>突然想到我自己的两个经历，分享下：</p>\n<ul>\n<li><em><strong>代码维护</strong></em></li>\n</ul>\n<p>之前我写代码都是面向过程的写法，写起来很快，但是对代码后期的维护很友好，我领导耐心地告诉我做法：</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203281214057.png\"><br><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203281214187.png\"></p>\n<p>这也就是我说的类似写作的框架，如果再把领域范围扩大，扩大到销售，自媒体推广，电商等等方面，都是一样的。</p>\n<ul>\n<li><em><strong>与人沟通</strong></em></li>\n</ul>\n<p>我的前任老板，一名深耕于健身行业二十年有余的商业女性，对于她的教诲我至今还没学到皮毛，她说过程序员的思想和销售说话很类似，比如顾客问你一句话，你需要去思考A&#x2F;B&#x2F;C三种说法，就像我们写代码的逻辑一样。</p>\n<p>所以她之前一直想培养我成销售，可能是我的能力不足，也有可能是她填鸭式的方法不太适合我，我现在在通过写作去学习与人沟通。</p>\n<h4 id=\"多读好书\"><a href=\"#多读好书\" class=\"headerlink\" title=\"多读好书\"></a><strong>多读好书</strong></h4><p>前一阵子，看了王牌对王牌的一期节目，节目嘉宾是作者麦家，不同于以前的嘉宾，他很温文尔雅，说话波澜不惊，最后给每个人的寄语也都戳中他们内心，他是真正有大智慧的人，他做了一个读书计划，「用20年时间，陪读者读完1000本名著」。</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203281410148.png\"></p>\n<p>他在最新的一篇文章写道：</p>\n<p><strong>因为疫情，读书，写作，健身，现在已经不大会激动，愤怒的火山也少见喷薄，仿佛喜怒都相似，都在重复，喜的不值喜，怒的不值得怒，一切归于平坦。</strong></p>\n<p>读万卷书，行外里路，在写作中思考人生，思考人性，这也就是为什么麦家老师在回答沈腾贾玲问题的时候没有太多的喜怒无常，而且直戳重点。</p>\n<p>查理芒格在穷查理宝典中写道：</p>\n<p><strong>通过广泛的阅读把自己培养成一个终生自学者。</strong></p>\n<p>多读书，读好书，读广泛的书，通过写作总结框架，整理思维模型，形成自己新的世界观。</p>\n"},{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","source":"_posts/测试/hello-world.md","raw":"---\ntitle: Hello World\ncategories:\n  - 测试\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","slug":"hello-world","published":1,"category":"测试","date":"2023-06-08T18:40:22.340Z","updated":"2023-06-09T00:35:09.284Z","_id":"clinu5ses002adxjc1s5o973b","comments":1,"layout":"post","photos":[],"link":"","content":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n","site":{"data":{}},"length":367,"excerpt":"","more":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n"},{"title":"Documentation","description":"NexT User Docs","date":"2018-02-09T16:00:00.000Z","_content":"\n### Elegant and Powerful Theme for Hexo\n\nTheme NexT has the following features:\n\n* Vanilla JavaScript.\n* Support [native dark mode](https://caniuse.com/prefers-color-scheme).\n* Support [Pjax](https://github.com/MoOx/pjax) to deliver a fast browsing experience.\n* Integrated [MathJax](https://www.mathjax.org) and [KaTeX](https://katex.org) mathematical formula rendering.\n* Integrated [PDF.js](https://mozilla.github.io/pdf.js/) and [mermaid diagram](https://mermaid-js.github.io/mermaid/).\n* Support [Disqus](https://disqus.com), [Changyan](https://changyan.kuaizhan.com), [LiveRe](https://livere.com), [Gitalk](https://gitalk.github.io), [Utterances](https://utteranc.es) and [Isso](https://isso-comments.de) comment systems.\n* Support a large number of third-party statistics services.\n* Easy to switch CDN provider.\n* Easy to customize content or modify style.\n\n### Four Schemes in One\n\nBy using different Schemes in NexT, you can simply change the style of your blog, and nearly all options can be used in all schemes.\n\n### Multilingual Support\n\nThanks to the contribution of our users and developers, [NexT now supports over 20 languages](/docs/theme-settings/internationalization.html#Choosing-Language).\n\n{% gp 3-1 %}\n![English translation](/images/en.png)\n![Chinese translation](/images/cn.png)\n![Russian translation](/images/ru.png)\n{% endgp %}\n\n### Code Highlighting Themes\n\nNexT uses code highlighting themes from the [Highlight.js](https://highlightjs.org) and [Prism](https://prismjs.com) package, and makes [more than 300 themes](/docs/theme-settings/miscellaneous.html#Codeblock-Style) available to you.\n\n<!-- Inspired by https://github.com/sindresorhus/css-in-readme-like-wat -->\n| Tomorrow                  | Tomorrow Night                  | Tomorrow Night Eighties                             |\n| :-----------------------: | :-----------------------------: | :-------------------------------------------------: |\n| ![Tomorrow][Tomorrow]     | ![Tomorrow Night][]             | ![Tomorrow Night Eighties][Tomorrow Night Eighties] |\n\n| Tomorrow Night Blue                         | Tomorrow Night Bright                           | Default                  |\n| :-----------------------------------------: | :---------------------------------------------: | :----------------------: |\n| ![Tomorrow Night Blue][Tomorrow Night Blue] | ![Tomorrow Night Bright][Tomorrow Night Bright] | ![Default][Default]      |\n\n### Supported Browsers\n\nWe design NexT to support the latest web browsers. We support the current versions of Chrome, Firefox, Safari, and Microsoft Edge. Many CSS3 and ES6 features are used in theme NexT, including CSS Variables, Destructuring assignment, Arrow functions and Spread operator.\n\n| Browser | Supported versions | Release date |\n| - | - | - |\n<i class=\"fab fa-internet-explorer fa-2x\"></i> IE | N/A | Oct 17, 2013 |\n<i class=\"fab fa-chrome fa-2x\"></i> Chrome | 60+ | Jul 25, 2017 |\n<i class=\"fab fa-firefox-browser fa-2x\"></i> Firefox | 55+ | Aug 8, 2017 |\n<i class=\"fab fa-opera fa-2x\"></i> Opera | 47+ | Aug 9, 2017 |\n<i class=\"fab fa-safari fa-2x\"></i> Safari | 11+ | Sep 19, 2017 |\n<i class=\"fab fa-edge fa-2x\"></i> Edge | 80+ | Feb 7, 2020 |\n\nSome other new Web APIs, such as [IntersectionObserver](https://caniuse.com/intersectionobserver) and [Fetch API](https://caniuse.com/fetch), are used by NexT plugins. They are not core functions of NexT, so we have no plans to make them compatible with legacy browsers.\n\nIn addition, [CSS position: sticky](https://caniuse.com/css-sticky) is used for sidebar positioning. On browsers that do not support this property, its fallback style `position: static` will be used.\n\n### Customize Your NexT\n\nNexT have flexible but simple options, and you can make your own blog with built-in third-party support. Now let's [get started](/docs/getting-started/).\n\n[Tomorrow]: /images/tomorrow.svg\n[Tomorrow Night]: /images/tomorrow-night.svg\n[Tomorrow Night Eighties]: /images/tomorrow-night-eighties.svg\n[Tomorrow Night Blue]: /images/tomorrow-night-blue.svg\n[Tomorrow Night Bright]: /images/tomorrow-night-bright.svg\n[Default]: /images/default.svg\n","source":"_posts/测试/doc.md","raw":"---\ntitle: Documentation\ndescription: NexT User Docs\ncategories:\n  - 测试\ndate: 2018-02-10 00:00:00\n---\n\n### Elegant and Powerful Theme for Hexo\n\nTheme NexT has the following features:\n\n* Vanilla JavaScript.\n* Support [native dark mode](https://caniuse.com/prefers-color-scheme).\n* Support [Pjax](https://github.com/MoOx/pjax) to deliver a fast browsing experience.\n* Integrated [MathJax](https://www.mathjax.org) and [KaTeX](https://katex.org) mathematical formula rendering.\n* Integrated [PDF.js](https://mozilla.github.io/pdf.js/) and [mermaid diagram](https://mermaid-js.github.io/mermaid/).\n* Support [Disqus](https://disqus.com), [Changyan](https://changyan.kuaizhan.com), [LiveRe](https://livere.com), [Gitalk](https://gitalk.github.io), [Utterances](https://utteranc.es) and [Isso](https://isso-comments.de) comment systems.\n* Support a large number of third-party statistics services.\n* Easy to switch CDN provider.\n* Easy to customize content or modify style.\n\n### Four Schemes in One\n\nBy using different Schemes in NexT, you can simply change the style of your blog, and nearly all options can be used in all schemes.\n\n### Multilingual Support\n\nThanks to the contribution of our users and developers, [NexT now supports over 20 languages](/docs/theme-settings/internationalization.html#Choosing-Language).\n\n{% gp 3-1 %}\n![English translation](/images/en.png)\n![Chinese translation](/images/cn.png)\n![Russian translation](/images/ru.png)\n{% endgp %}\n\n### Code Highlighting Themes\n\nNexT uses code highlighting themes from the [Highlight.js](https://highlightjs.org) and [Prism](https://prismjs.com) package, and makes [more than 300 themes](/docs/theme-settings/miscellaneous.html#Codeblock-Style) available to you.\n\n<!-- Inspired by https://github.com/sindresorhus/css-in-readme-like-wat -->\n| Tomorrow                  | Tomorrow Night                  | Tomorrow Night Eighties                             |\n| :-----------------------: | :-----------------------------: | :-------------------------------------------------: |\n| ![Tomorrow][Tomorrow]     | ![Tomorrow Night][]             | ![Tomorrow Night Eighties][Tomorrow Night Eighties] |\n\n| Tomorrow Night Blue                         | Tomorrow Night Bright                           | Default                  |\n| :-----------------------------------------: | :---------------------------------------------: | :----------------------: |\n| ![Tomorrow Night Blue][Tomorrow Night Blue] | ![Tomorrow Night Bright][Tomorrow Night Bright] | ![Default][Default]      |\n\n### Supported Browsers\n\nWe design NexT to support the latest web browsers. We support the current versions of Chrome, Firefox, Safari, and Microsoft Edge. Many CSS3 and ES6 features are used in theme NexT, including CSS Variables, Destructuring assignment, Arrow functions and Spread operator.\n\n| Browser | Supported versions | Release date |\n| - | - | - |\n<i class=\"fab fa-internet-explorer fa-2x\"></i> IE | N/A | Oct 17, 2013 |\n<i class=\"fab fa-chrome fa-2x\"></i> Chrome | 60+ | Jul 25, 2017 |\n<i class=\"fab fa-firefox-browser fa-2x\"></i> Firefox | 55+ | Aug 8, 2017 |\n<i class=\"fab fa-opera fa-2x\"></i> Opera | 47+ | Aug 9, 2017 |\n<i class=\"fab fa-safari fa-2x\"></i> Safari | 11+ | Sep 19, 2017 |\n<i class=\"fab fa-edge fa-2x\"></i> Edge | 80+ | Feb 7, 2020 |\n\nSome other new Web APIs, such as [IntersectionObserver](https://caniuse.com/intersectionobserver) and [Fetch API](https://caniuse.com/fetch), are used by NexT plugins. They are not core functions of NexT, so we have no plans to make them compatible with legacy browsers.\n\nIn addition, [CSS position: sticky](https://caniuse.com/css-sticky) is used for sidebar positioning. On browsers that do not support this property, its fallback style `position: static` will be used.\n\n### Customize Your NexT\n\nNexT have flexible but simple options, and you can make your own blog with built-in third-party support. Now let's [get started](/docs/getting-started/).\n\n[Tomorrow]: /images/tomorrow.svg\n[Tomorrow Night]: /images/tomorrow-night.svg\n[Tomorrow Night Eighties]: /images/tomorrow-night-eighties.svg\n[Tomorrow Night Blue]: /images/tomorrow-night-blue.svg\n[Tomorrow Night Bright]: /images/tomorrow-night-bright.svg\n[Default]: /images/default.svg\n","slug":"doc","published":1,"category":"测试","updated":"2023-06-09T00:35:09.286Z","_id":"clinu5set002bdxjceu0ybnk1","comments":1,"layout":"post","photos":[],"link":"","content":"<h3 id=\"Elegant-and-Powerful-Theme-for-Hexo\"><a href=\"#Elegant-and-Powerful-Theme-for-Hexo\" class=\"headerlink\" title=\"Elegant and Powerful Theme for Hexo\"></a>Elegant and Powerful Theme for Hexo</h3><p>Theme NexT has the following features:</p>\n<ul>\n<li>Vanilla JavaScript.</li>\n<li>Support <a href=\"https://caniuse.com/prefers-color-scheme\">native dark mode</a>.</li>\n<li>Support <a href=\"https://github.com/MoOx/pjax\">Pjax</a> to deliver a fast browsing experience.</li>\n<li>Integrated <a href=\"https://www.mathjax.org/\">MathJax</a> and <a href=\"https://katex.org/\">KaTeX</a> mathematical formula rendering.</li>\n<li>Integrated <a href=\"https://mozilla.github.io/pdf.js/\">PDF.js</a> and <a href=\"https://mermaid-js.github.io/mermaid/\">mermaid diagram</a>.</li>\n<li>Support <a href=\"https://disqus.com/\">Disqus</a>, <a href=\"https://changyan.kuaizhan.com/\">Changyan</a>, <a href=\"https://livere.com/\">LiveRe</a>, <a href=\"https://gitalk.github.io/\">Gitalk</a>, <a href=\"https://utteranc.es/\">Utterances</a> and <a href=\"https://isso-comments.de/\">Isso</a> comment systems.</li>\n<li>Support a large number of third-party statistics services.</li>\n<li>Easy to switch CDN provider.</li>\n<li>Easy to customize content or modify style.</li>\n</ul>\n<h3 id=\"Four-Schemes-in-One\"><a href=\"#Four-Schemes-in-One\" class=\"headerlink\" title=\"Four Schemes in One\"></a>Four Schemes in One</h3><p>By using different Schemes in NexT, you can simply change the style of your blog, and nearly all options can be used in all schemes.</p>\n<h3 id=\"Multilingual-Support\"><a href=\"#Multilingual-Support\" class=\"headerlink\" title=\"Multilingual Support\"></a>Multilingual Support</h3><p>Thanks to the contribution of our users and developers, <a href=\"/docs/theme-settings/internationalization.html#Choosing-Language\">NexT now supports over 20 languages</a>.</p>\n<div class=\"group-picture\"><div class=\"group-picture-row\"><div class=\"group-picture-column\"><img src=\"/images/en.png\" alt=\"English translation\"></div></div><div class=\"group-picture-row\"><div class=\"group-picture-column\"><img src=\"/images/cn.png\" alt=\"Chinese translation\"></div><div class=\"group-picture-column\"><img src=\"/images/ru.png\" alt=\"Russian translation\"></div></div></div>\n\n<h3 id=\"Code-Highlighting-Themes\"><a href=\"#Code-Highlighting-Themes\" class=\"headerlink\" title=\"Code Highlighting Themes\"></a>Code Highlighting Themes</h3><p>NexT uses code highlighting themes from the <a href=\"https://highlightjs.org/\">Highlight.js</a> and <a href=\"https://prismjs.com/\">Prism</a> package, and makes <a href=\"/docs/theme-settings/miscellaneous.html#Codeblock-Style\">more than 300 themes</a> available to you.</p>\n<!-- Inspired by https://github.com/sindresorhus/css-in-readme-like-wat -->\n<table>\n<thead>\n<tr>\n<th align=\"center\">Tomorrow</th>\n<th align=\"center\">Tomorrow Night</th>\n<th align=\"center\">Tomorrow Night Eighties</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><img src=\"/images/tomorrow.svg\" alt=\"Tomorrow\"></td>\n<td align=\"center\"><img src=\"/images/tomorrow-night.svg\" alt=\"Tomorrow Night\"></td>\n<td align=\"center\"><img src=\"/images/tomorrow-night-eighties.svg\" alt=\"Tomorrow Night Eighties\"></td>\n</tr>\n</tbody></table>\n<table>\n<thead>\n<tr>\n<th align=\"center\">Tomorrow Night Blue</th>\n<th align=\"center\">Tomorrow Night Bright</th>\n<th align=\"center\">Default</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><img src=\"/images/tomorrow-night-blue.svg\" alt=\"Tomorrow Night Blue\"></td>\n<td align=\"center\"><img src=\"/images/tomorrow-night-bright.svg\" alt=\"Tomorrow Night Bright\"></td>\n<td align=\"center\"><img src=\"/images/default.svg\" alt=\"Default\"></td>\n</tr>\n</tbody></table>\n<h3 id=\"Supported-Browsers\"><a href=\"#Supported-Browsers\" class=\"headerlink\" title=\"Supported Browsers\"></a>Supported Browsers</h3><p>We design NexT to support the latest web browsers. We support the current versions of Chrome, Firefox, Safari, and Microsoft Edge. Many CSS3 and ES6 features are used in theme NexT, including CSS Variables, Destructuring assignment, Arrow functions and Spread operator.</p>\n<table>\n<thead>\n<tr>\n<th>Browser</th>\n<th>Supported versions</th>\n<th>Release date</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><i class=\"fab fa-internet-explorer fa-2x\"></i> IE</td>\n<td>N&#x2F;A</td>\n<td>Oct 17, 2013</td>\n</tr>\n<tr>\n<td><i class=\"fab fa-chrome fa-2x\"></i> Chrome</td>\n<td>60+</td>\n<td>Jul 25, 2017</td>\n</tr>\n<tr>\n<td><i class=\"fab fa-firefox-browser fa-2x\"></i> Firefox</td>\n<td>55+</td>\n<td>Aug 8, 2017</td>\n</tr>\n<tr>\n<td><i class=\"fab fa-opera fa-2x\"></i> Opera</td>\n<td>47+</td>\n<td>Aug 9, 2017</td>\n</tr>\n<tr>\n<td><i class=\"fab fa-safari fa-2x\"></i> Safari</td>\n<td>11+</td>\n<td>Sep 19, 2017</td>\n</tr>\n<tr>\n<td><i class=\"fab fa-edge fa-2x\"></i> Edge</td>\n<td>80+</td>\n<td>Feb 7, 2020</td>\n</tr>\n</tbody></table>\n<p>Some other new Web APIs, such as <a href=\"https://caniuse.com/intersectionobserver\">IntersectionObserver</a> and <a href=\"https://caniuse.com/fetch\">Fetch API</a>, are used by NexT plugins. They are not core functions of NexT, so we have no plans to make them compatible with legacy browsers.</p>\n<p>In addition, <a href=\"https://caniuse.com/css-sticky\">CSS position: sticky</a> is used for sidebar positioning. On browsers that do not support this property, its fallback style <code>position: static</code> will be used.</p>\n<h3 id=\"Customize-Your-NexT\"><a href=\"#Customize-Your-NexT\" class=\"headerlink\" title=\"Customize Your NexT\"></a>Customize Your NexT</h3><p>NexT have flexible but simple options, and you can make your own blog with built-in third-party support. Now let’s <a href=\"/docs/getting-started/\">get started</a>.</p>\n","site":{"data":{}},"length":1664,"excerpt":"","more":"<h3 id=\"Elegant-and-Powerful-Theme-for-Hexo\"><a href=\"#Elegant-and-Powerful-Theme-for-Hexo\" class=\"headerlink\" title=\"Elegant and Powerful Theme for Hexo\"></a>Elegant and Powerful Theme for Hexo</h3><p>Theme NexT has the following features:</p>\n<ul>\n<li>Vanilla JavaScript.</li>\n<li>Support <a href=\"https://caniuse.com/prefers-color-scheme\">native dark mode</a>.</li>\n<li>Support <a href=\"https://github.com/MoOx/pjax\">Pjax</a> to deliver a fast browsing experience.</li>\n<li>Integrated <a href=\"https://www.mathjax.org/\">MathJax</a> and <a href=\"https://katex.org/\">KaTeX</a> mathematical formula rendering.</li>\n<li>Integrated <a href=\"https://mozilla.github.io/pdf.js/\">PDF.js</a> and <a href=\"https://mermaid-js.github.io/mermaid/\">mermaid diagram</a>.</li>\n<li>Support <a href=\"https://disqus.com/\">Disqus</a>, <a href=\"https://changyan.kuaizhan.com/\">Changyan</a>, <a href=\"https://livere.com/\">LiveRe</a>, <a href=\"https://gitalk.github.io/\">Gitalk</a>, <a href=\"https://utteranc.es/\">Utterances</a> and <a href=\"https://isso-comments.de/\">Isso</a> comment systems.</li>\n<li>Support a large number of third-party statistics services.</li>\n<li>Easy to switch CDN provider.</li>\n<li>Easy to customize content or modify style.</li>\n</ul>\n<h3 id=\"Four-Schemes-in-One\"><a href=\"#Four-Schemes-in-One\" class=\"headerlink\" title=\"Four Schemes in One\"></a>Four Schemes in One</h3><p>By using different Schemes in NexT, you can simply change the style of your blog, and nearly all options can be used in all schemes.</p>\n<h3 id=\"Multilingual-Support\"><a href=\"#Multilingual-Support\" class=\"headerlink\" title=\"Multilingual Support\"></a>Multilingual Support</h3><p>Thanks to the contribution of our users and developers, <a href=\"/docs/theme-settings/internationalization.html#Choosing-Language\">NexT now supports over 20 languages</a>.</p>\n<div class=\"group-picture\"><div class=\"group-picture-row\"><div class=\"group-picture-column\"><img src=\"/images/en.png\" alt=\"English translation\"></div></div><div class=\"group-picture-row\"><div class=\"group-picture-column\"><img src=\"/images/cn.png\" alt=\"Chinese translation\"></div><div class=\"group-picture-column\"><img src=\"/images/ru.png\" alt=\"Russian translation\"></div></div></div>\n\n<h3 id=\"Code-Highlighting-Themes\"><a href=\"#Code-Highlighting-Themes\" class=\"headerlink\" title=\"Code Highlighting Themes\"></a>Code Highlighting Themes</h3><p>NexT uses code highlighting themes from the <a href=\"https://highlightjs.org/\">Highlight.js</a> and <a href=\"https://prismjs.com/\">Prism</a> package, and makes <a href=\"/docs/theme-settings/miscellaneous.html#Codeblock-Style\">more than 300 themes</a> available to you.</p>\n<!-- Inspired by https://github.com/sindresorhus/css-in-readme-like-wat -->\n<table>\n<thead>\n<tr>\n<th align=\"center\">Tomorrow</th>\n<th align=\"center\">Tomorrow Night</th>\n<th align=\"center\">Tomorrow Night Eighties</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><img src=\"/images/tomorrow.svg\" alt=\"Tomorrow\"></td>\n<td align=\"center\"><img src=\"/images/tomorrow-night.svg\" alt=\"Tomorrow Night\"></td>\n<td align=\"center\"><img src=\"/images/tomorrow-night-eighties.svg\" alt=\"Tomorrow Night Eighties\"></td>\n</tr>\n</tbody></table>\n<table>\n<thead>\n<tr>\n<th align=\"center\">Tomorrow Night Blue</th>\n<th align=\"center\">Tomorrow Night Bright</th>\n<th align=\"center\">Default</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><img src=\"/images/tomorrow-night-blue.svg\" alt=\"Tomorrow Night Blue\"></td>\n<td align=\"center\"><img src=\"/images/tomorrow-night-bright.svg\" alt=\"Tomorrow Night Bright\"></td>\n<td align=\"center\"><img src=\"/images/default.svg\" alt=\"Default\"></td>\n</tr>\n</tbody></table>\n<h3 id=\"Supported-Browsers\"><a href=\"#Supported-Browsers\" class=\"headerlink\" title=\"Supported Browsers\"></a>Supported Browsers</h3><p>We design NexT to support the latest web browsers. We support the current versions of Chrome, Firefox, Safari, and Microsoft Edge. Many CSS3 and ES6 features are used in theme NexT, including CSS Variables, Destructuring assignment, Arrow functions and Spread operator.</p>\n<table>\n<thead>\n<tr>\n<th>Browser</th>\n<th>Supported versions</th>\n<th>Release date</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><i class=\"fab fa-internet-explorer fa-2x\"></i> IE</td>\n<td>N&#x2F;A</td>\n<td>Oct 17, 2013</td>\n</tr>\n<tr>\n<td><i class=\"fab fa-chrome fa-2x\"></i> Chrome</td>\n<td>60+</td>\n<td>Jul 25, 2017</td>\n</tr>\n<tr>\n<td><i class=\"fab fa-firefox-browser fa-2x\"></i> Firefox</td>\n<td>55+</td>\n<td>Aug 8, 2017</td>\n</tr>\n<tr>\n<td><i class=\"fab fa-opera fa-2x\"></i> Opera</td>\n<td>47+</td>\n<td>Aug 9, 2017</td>\n</tr>\n<tr>\n<td><i class=\"fab fa-safari fa-2x\"></i> Safari</td>\n<td>11+</td>\n<td>Sep 19, 2017</td>\n</tr>\n<tr>\n<td><i class=\"fab fa-edge fa-2x\"></i> Edge</td>\n<td>80+</td>\n<td>Feb 7, 2020</td>\n</tr>\n</tbody></table>\n<p>Some other new Web APIs, such as <a href=\"https://caniuse.com/intersectionobserver\">IntersectionObserver</a> and <a href=\"https://caniuse.com/fetch\">Fetch API</a>, are used by NexT plugins. They are not core functions of NexT, so we have no plans to make them compatible with legacy browsers.</p>\n<p>In addition, <a href=\"https://caniuse.com/css-sticky\">CSS position: sticky</a> is used for sidebar positioning. On browsers that do not support this property, its fallback style <code>position: static</code> will be used.</p>\n<h3 id=\"Customize-Your-NexT\"><a href=\"#Customize-Your-NexT\" class=\"headerlink\" title=\"Customize Your NexT\"></a>Customize Your NexT</h3><p>NexT have flexible but simple options, and you can make your own blog with built-in third-party support. Now let’s <a href=\"/docs/getting-started/\">get started</a>.</p>\n"},{"title":"get startted","description":"NexT User Docs – Starting to Use","date":"2023-06-08T19:01:28.000Z","_content":"\n\n### Hexo Installation\n\nIf this is your first time using Hexo, you can take some time to review the Hexo Docs to see [how to install Hexo](https://hexo.io/docs/) and [initialize a site](https://hexo.io/docs/setup). After the installation is successful, you should be able to execute `hexo` (or `npx hexo`) on the command line, and there must be `package.json`, `source`, `themes` and other directories in your {% label info@site root directory %}:\n\n```bash\n$ cd hexo-site\n$ ls\n_config.yml  node_modules  package-lock.json  package.json  scaffolds  source  themes\n```\n\n{% note info %}\nIf you are new to Node.js or Hexo, you can also modify the source code of an existing Hexo website instead of creating a new one, to help you understand how Hexo works. In fact, the document you are reading is generated by Hexo with NexT, and you can install it with the following command:\n\n```bash\n$ git clone https://github.com/next-theme/theme-next-docs\n$ cd theme-next-docs\n$ npm install\n```\n\n{% endnote %}\n\nMake sure that you have installed Hexo and created a site with it successfully, because the following documents require you to operate in the {% label info@site root directory %}.\n\n### NexT Installation\n\nThe detailed steps to install or upgrade the theme are as follows.\n\n#### Downloading NexT\n\nIt's easy to install Hexo theme: you can choose to install the theme through npm, or download the source code of the theme in the `themes` directory under {% label info@site root directory %}.\n\n{% tabs downloading-next %}\n<!-- tab Using <code>npm</code> -->\nIf you're using Hexo 5.0 or later, the simplest way to install is through npm.\n\nOpen your Terminal, change to Hexo {% label info@site root directory %} and install NexT theme:\n\n```bash\n$ cd hexo-site\n$ npm install hexo-theme-next\n```\n<!-- endtab -->\n\n<!-- tab Using <code>git</code> -->\nIf you know about [Git](https://git-scm.com), you can clone the whole repository and update it in any time with `git pull` command instead of downloading archive manually.\n\nOpen your terminal, change to Hexo {% label info@site root directory %} and clone the latest master branch of NexT theme:\n\n```bash\n$ cd hexo-site\n$ git clone https://github.com/next-theme/hexo-theme-next themes/next\n```\n<!-- endtab -->\n{% endtabs %}\n\n{% note primary %}\nYou can also read [detailed installation instructions](/docs/getting-started/installation.html) if you want any other installation variant.\n{% endnote %}\n\n#### Upgrading NexT\n\nA new version of NexT will be released every month. Please read the [release notes](https://github.com/next-theme/hexo-theme-next/releases) before updating the theme. You can update NexT by the following command.\n\n{% tabs upgrading-next %}\n<!-- tab Using <code>npm</code> -->\nInstall the latest version through npm:\n\n```bash\n$ cd hexo-site\n$ npm install hexo-theme-next@latest\n```\n<!-- endtab -->\n\n<!-- tab Using <code>git</code> -->\nOr update to the latest master branch:\n\n```sh\n$ cd hexo-site\n$ cd themes/next\n$ git pull origin master\n```\n\nWhen running `git pull`, you can bypass merge conflicts (error message like **«Commit your changes or stash them before you can merge»**) by using the `Commit`, `Stash` or `Reset` commands for local changes. See [here](https://stackoverflow.com/a/15745424/5861495) how to do it.\n<!-- endtab -->\n{% endtabs %}\n\n{% note warning %}\nIf you are still using NexT version 5 or 7, you can read [instructions for upgrading from legacy version](/docs/getting-started/upgrade.html).\n{% endnote %}\n\n### Configuration Files\n\nAfter the installation of Hexo and NexT, you may found that there are two configuration files using by Hexo and both called `_config.yml`:\n\n1. The first one is under {% label info@site root directory %}, which contains Hexo's config.\n2. The second one is under {% label primary@theme root directory %} (e.g. `themes/next/_config.yml` or `node_modules/hexo-theme-next/_config.yml`), which is provided by NexT and contains theme's config.\n\nLet's call the first one – {% label info@Hexo config file %}, and the second one – {% label primary@NexT config file %}.\n\n{% note warning %}\nHowever, we do not recommend directly modifying the {% label primary@NexT config file %}. It is quite often running into conflict status when updating NexT theme via `git pull`, or need to merge configurations manually when upgrading to new releases. For the theme installed through npm, it is also difficult to modify the {% label primary@NexT config file %} in `node_modules`.\n\nIn order to resolve this issue, we recommend using the [Alternate Theme Config](/docs/getting-started/configuration.html) feature to configure theme NexT.\n{% endnote %}\n\n### Hexo Configuration\n\nThe following settings in {% label info@Hexo config file %} are very helpful for optimizing your website.\n\n#### Configuring Author\n\nEdit {% label info@Hexo config file %} and set the value of `author` to your nickname.\n\n```yml Hexo config file\n# Site\nauthor:\n```\n\n#### Configuring Description\n\nEdit {% label info@Hexo config file %} and set the value of `description` to your description, which can be a sentence you like.\n\n```yml Hexo config file\n# Site\ndescription:\n```\n\n#### Enabling NexT\n\nLike all Hexo themes, after you download it, open {% label info@Hexo config file %}, find `theme` option, and change its value to `next` (or another theme directory name).\n\n```yml Hexo config file\ntheme: next\n```\n\nNow you have installed NexT theme and enabled it. The following steps will help you verify whether NexT is enabled correctly.\n\n### Checking NexT\n\nIt's recommended to use `hexo clean` to clean Hexo's cache first.\nThen start Hexo local server with debug parameter (by adding `--debug`), the whole command is `hexo s --debug`. You can see the output while running, and if you find problem, you can use the output to help others locate error better. When it prints:\n\n```\nINFO  Hexo is running at http://localhost:4000/. Press Ctrl+C to stop.\n```\n\nNow you can open `http://localhost:4000` in your browser, and check whether the site works correctly.\n\n{% note success %}\nIf you find your site looks like this picture, you have installed it correctly. That's default NexT scheme – Muse.\n![Default Scheme – Muse](/images/next-default-scheme.png)\n{% endnote %}\n\nAfter that we can [configure deployment](/docs/getting-started/deployment.html).\n\nIf everything is OK, in next steps we will change some settings including [personalization](/docs/theme-settings/) and [third-party services integration](/docs/third-party-services/).\n","source":"_posts/测试/index.md","raw":"---\ntitle: get startted\ndescription: NexT User Docs – Starting to Use\ncategories:\n  - 测试\ntags:\n  - hexo\n  - 博客\ndate: 2023-06-09 03:01:28\n---\n\n\n### Hexo Installation\n\nIf this is your first time using Hexo, you can take some time to review the Hexo Docs to see [how to install Hexo](https://hexo.io/docs/) and [initialize a site](https://hexo.io/docs/setup). After the installation is successful, you should be able to execute `hexo` (or `npx hexo`) on the command line, and there must be `package.json`, `source`, `themes` and other directories in your {% label info@site root directory %}:\n\n```bash\n$ cd hexo-site\n$ ls\n_config.yml  node_modules  package-lock.json  package.json  scaffolds  source  themes\n```\n\n{% note info %}\nIf you are new to Node.js or Hexo, you can also modify the source code of an existing Hexo website instead of creating a new one, to help you understand how Hexo works. In fact, the document you are reading is generated by Hexo with NexT, and you can install it with the following command:\n\n```bash\n$ git clone https://github.com/next-theme/theme-next-docs\n$ cd theme-next-docs\n$ npm install\n```\n\n{% endnote %}\n\nMake sure that you have installed Hexo and created a site with it successfully, because the following documents require you to operate in the {% label info@site root directory %}.\n\n### NexT Installation\n\nThe detailed steps to install or upgrade the theme are as follows.\n\n#### Downloading NexT\n\nIt's easy to install Hexo theme: you can choose to install the theme through npm, or download the source code of the theme in the `themes` directory under {% label info@site root directory %}.\n\n{% tabs downloading-next %}\n<!-- tab Using <code>npm</code> -->\nIf you're using Hexo 5.0 or later, the simplest way to install is through npm.\n\nOpen your Terminal, change to Hexo {% label info@site root directory %} and install NexT theme:\n\n```bash\n$ cd hexo-site\n$ npm install hexo-theme-next\n```\n<!-- endtab -->\n\n<!-- tab Using <code>git</code> -->\nIf you know about [Git](https://git-scm.com), you can clone the whole repository and update it in any time with `git pull` command instead of downloading archive manually.\n\nOpen your terminal, change to Hexo {% label info@site root directory %} and clone the latest master branch of NexT theme:\n\n```bash\n$ cd hexo-site\n$ git clone https://github.com/next-theme/hexo-theme-next themes/next\n```\n<!-- endtab -->\n{% endtabs %}\n\n{% note primary %}\nYou can also read [detailed installation instructions](/docs/getting-started/installation.html) if you want any other installation variant.\n{% endnote %}\n\n#### Upgrading NexT\n\nA new version of NexT will be released every month. Please read the [release notes](https://github.com/next-theme/hexo-theme-next/releases) before updating the theme. You can update NexT by the following command.\n\n{% tabs upgrading-next %}\n<!-- tab Using <code>npm</code> -->\nInstall the latest version through npm:\n\n```bash\n$ cd hexo-site\n$ npm install hexo-theme-next@latest\n```\n<!-- endtab -->\n\n<!-- tab Using <code>git</code> -->\nOr update to the latest master branch:\n\n```sh\n$ cd hexo-site\n$ cd themes/next\n$ git pull origin master\n```\n\nWhen running `git pull`, you can bypass merge conflicts (error message like **«Commit your changes or stash them before you can merge»**) by using the `Commit`, `Stash` or `Reset` commands for local changes. See [here](https://stackoverflow.com/a/15745424/5861495) how to do it.\n<!-- endtab -->\n{% endtabs %}\n\n{% note warning %}\nIf you are still using NexT version 5 or 7, you can read [instructions for upgrading from legacy version](/docs/getting-started/upgrade.html).\n{% endnote %}\n\n### Configuration Files\n\nAfter the installation of Hexo and NexT, you may found that there are two configuration files using by Hexo and both called `_config.yml`:\n\n1. The first one is under {% label info@site root directory %}, which contains Hexo's config.\n2. The second one is under {% label primary@theme root directory %} (e.g. `themes/next/_config.yml` or `node_modules/hexo-theme-next/_config.yml`), which is provided by NexT and contains theme's config.\n\nLet's call the first one – {% label info@Hexo config file %}, and the second one – {% label primary@NexT config file %}.\n\n{% note warning %}\nHowever, we do not recommend directly modifying the {% label primary@NexT config file %}. It is quite often running into conflict status when updating NexT theme via `git pull`, or need to merge configurations manually when upgrading to new releases. For the theme installed through npm, it is also difficult to modify the {% label primary@NexT config file %} in `node_modules`.\n\nIn order to resolve this issue, we recommend using the [Alternate Theme Config](/docs/getting-started/configuration.html) feature to configure theme NexT.\n{% endnote %}\n\n### Hexo Configuration\n\nThe following settings in {% label info@Hexo config file %} are very helpful for optimizing your website.\n\n#### Configuring Author\n\nEdit {% label info@Hexo config file %} and set the value of `author` to your nickname.\n\n```yml Hexo config file\n# Site\nauthor:\n```\n\n#### Configuring Description\n\nEdit {% label info@Hexo config file %} and set the value of `description` to your description, which can be a sentence you like.\n\n```yml Hexo config file\n# Site\ndescription:\n```\n\n#### Enabling NexT\n\nLike all Hexo themes, after you download it, open {% label info@Hexo config file %}, find `theme` option, and change its value to `next` (or another theme directory name).\n\n```yml Hexo config file\ntheme: next\n```\n\nNow you have installed NexT theme and enabled it. The following steps will help you verify whether NexT is enabled correctly.\n\n### Checking NexT\n\nIt's recommended to use `hexo clean` to clean Hexo's cache first.\nThen start Hexo local server with debug parameter (by adding `--debug`), the whole command is `hexo s --debug`. You can see the output while running, and if you find problem, you can use the output to help others locate error better. When it prints:\n\n```\nINFO  Hexo is running at http://localhost:4000/. Press Ctrl+C to stop.\n```\n\nNow you can open `http://localhost:4000` in your browser, and check whether the site works correctly.\n\n{% note success %}\nIf you find your site looks like this picture, you have installed it correctly. That's default NexT scheme – Muse.\n![Default Scheme – Muse](/images/next-default-scheme.png)\n{% endnote %}\n\nAfter that we can [configure deployment](/docs/getting-started/deployment.html).\n\nIf everything is OK, in next steps we will change some settings including [personalization](/docs/theme-settings/) and [third-party services integration](/docs/third-party-services/).\n","slug":"index","published":1,"category":"测试","updated":"2023-06-09T00:35:09.284Z","_id":"clinu5seu002edxjccoptdin2","comments":1,"layout":"post","photos":[],"link":"","content":"<h3 id=\"Hexo-Installation\"><a href=\"#Hexo-Installation\" class=\"headerlink\" title=\"Hexo Installation\"></a>Hexo Installation</h3><p>If this is your first time using Hexo, you can take some time to review the Hexo Docs to see <a href=\"https://hexo.io/docs/\">how to install Hexo</a> and <a href=\"https://hexo.io/docs/setup\">initialize a site</a>. After the installation is successful, you should be able to execute <code>hexo</code> (or <code>npx hexo</code>) on the command line, and there must be <code>package.json</code>, <code>source</code>, <code>themes</code> and other directories in your <mark class=\"label info\">site root directory</mark>:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> hexo-site</span><br><span class=\"line\">$ <span class=\"built_in\">ls</span></span><br><span class=\"line\">_config.yml  node_modules  package-lock.json  package.json  scaffolds  <span class=\"built_in\">source</span>  themes</span><br></pre></td></tr></table></figure>\n\n<div class=\"note info\"><p>If you are new to Node.js or Hexo, you can also modify the source code of an existing Hexo website instead of creating a new one, to help you understand how Hexo works. In fact, the document you are reading is generated by Hexo with NexT, and you can install it with the following command:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git <span class=\"built_in\">clone</span> https://github.com/next-theme/theme-next-docs</span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> theme-next-docs</span><br><span class=\"line\">$ npm install</span><br></pre></td></tr></table></figure>\n</div>\n\n<p>Make sure that you have installed Hexo and created a site with it successfully, because the following documents require you to operate in the <mark class=\"label info\">site root directory</mark>.</p>\n<h3 id=\"NexT-Installation\"><a href=\"#NexT-Installation\" class=\"headerlink\" title=\"NexT Installation\"></a>NexT Installation</h3><p>The detailed steps to install or upgrade the theme are as follows.</p>\n<h4 id=\"Downloading-NexT\"><a href=\"#Downloading-NexT\" class=\"headerlink\" title=\"Downloading NexT\"></a>Downloading NexT</h4><p>It’s easy to install Hexo theme: you can choose to install the theme through npm, or download the source code of the theme in the <code>themes</code> directory under <mark class=\"label info\">site root directory</mark>.</p>\n<div class=\"tabs\" id=\"downloading-next\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#downloading-next-1\">Using <code>npm</code></a></li><li class=\"tab\"><a href=\"#downloading-next-2\">Using <code>git</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"downloading-next-1\"><p>If you’re using Hexo 5.0 or later, the simplest way to install is through npm.</p>\n<p>Open your Terminal, change to Hexo <mark class=\"label info\">site root directory</mark> and install NexT theme:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> hexo-site</span><br><span class=\"line\">$ npm install hexo-theme-next</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"downloading-next-2\"><p>If you know about <a href=\"https://git-scm.com/\">Git</a>, you can clone the whole repository and update it in any time with <code>git pull</code> command instead of downloading archive manually.</p>\n<p>Open your terminal, change to Hexo <mark class=\"label info\">site root directory</mark> and clone the latest master branch of NexT theme:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> hexo-site</span><br><span class=\"line\">$ git <span class=\"built_in\">clone</span> https://github.com/next-theme/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure></div></div></div>\n\n<div class=\"note primary\"><p>You can also read <a href=\"/docs/getting-started/installation.html\">detailed installation instructions</a> if you want any other installation variant.</p>\n</div>\n\n<h4 id=\"Upgrading-NexT\"><a href=\"#Upgrading-NexT\" class=\"headerlink\" title=\"Upgrading NexT\"></a>Upgrading NexT</h4><p>A new version of NexT will be released every month. Please read the <a href=\"https://github.com/next-theme/hexo-theme-next/releases\">release notes</a> before updating the theme. You can update NexT by the following command.</p>\n<div class=\"tabs\" id=\"upgrading-next\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#upgrading-next-1\">Using <code>npm</code></a></li><li class=\"tab\"><a href=\"#upgrading-next-2\">Using <code>git</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"upgrading-next-1\"><p>Install the latest version through npm:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> hexo-site</span><br><span class=\"line\">$ npm install hexo-theme-next@latest</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"upgrading-next-2\"><p>Or update to the latest master branch:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> hexo-site</span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> themes/next</span><br><span class=\"line\">$ git pull origin master</span><br></pre></td></tr></table></figure>\n\n<p>When running <code>git pull</code>, you can bypass merge conflicts (error message like <strong>«Commit your changes or stash them before you can merge»</strong>) by using the <code>Commit</code>, <code>Stash</code> or <code>Reset</code> commands for local changes. See <a href=\"https://stackoverflow.com/a/15745424/5861495\">here</a> how to do it.</p></div></div></div>\n\n<div class=\"note warning\"><p>If you are still using NexT version 5 or 7, you can read <a href=\"/docs/getting-started/upgrade.html\">instructions for upgrading from legacy version</a>.</p>\n</div>\n\n<h3 id=\"Configuration-Files\"><a href=\"#Configuration-Files\" class=\"headerlink\" title=\"Configuration Files\"></a>Configuration Files</h3><p>After the installation of Hexo and NexT, you may found that there are two configuration files using by Hexo and both called <code>_config.yml</code>:</p>\n<ol>\n<li>The first one is under <mark class=\"label info\">site root directory</mark>, which contains Hexo’s config.</li>\n<li>The second one is under <mark class=\"label primary\">theme root directory</mark> (e.g. <code>themes/next/_config.yml</code> or <code>node_modules/hexo-theme-next/_config.yml</code>), which is provided by NexT and contains theme’s config.</li>\n</ol>\n<p>Let’s call the first one – <mark class=\"label info\">Hexo config file</mark>, and the second one – <mark class=\"label primary\">NexT config file</mark>.</p>\n<div class=\"note warning\"><p>However, we do not recommend directly modifying the <mark class=\"label primary\">NexT config file</mark>. It is quite often running into conflict status when updating NexT theme via <code>git pull</code>, or need to merge configurations manually when upgrading to new releases. For the theme installed through npm, it is also difficult to modify the <mark class=\"label primary\">NexT config file</mark> in <code>node_modules</code>.</p>\n<p>In order to resolve this issue, we recommend using the <a href=\"/docs/getting-started/configuration.html\">Alternate Theme Config</a> feature to configure theme NexT.</p>\n</div>\n\n<h3 id=\"Hexo-Configuration\"><a href=\"#Hexo-Configuration\" class=\"headerlink\" title=\"Hexo Configuration\"></a>Hexo Configuration</h3><p>The following settings in <mark class=\"label info\">Hexo config file</mark> are very helpful for optimizing your website.</p>\n<h4 id=\"Configuring-Author\"><a href=\"#Configuring-Author\" class=\"headerlink\" title=\"Configuring Author\"></a>Configuring Author</h4><p>Edit <mark class=\"label info\">Hexo config file</mark> and set the value of <code>author</code> to your nickname.</p>\n<figure class=\"highlight yml\"><figcaption><span>Hexo config file</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Site</span></span><br><span class=\"line\"><span class=\"attr\">author:</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Configuring-Description\"><a href=\"#Configuring-Description\" class=\"headerlink\" title=\"Configuring Description\"></a>Configuring Description</h4><p>Edit <mark class=\"label info\">Hexo config file</mark> and set the value of <code>description</code> to your description, which can be a sentence you like.</p>\n<figure class=\"highlight yml\"><figcaption><span>Hexo config file</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Site</span></span><br><span class=\"line\"><span class=\"attr\">description:</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Enabling-NexT\"><a href=\"#Enabling-NexT\" class=\"headerlink\" title=\"Enabling NexT\"></a>Enabling NexT</h4><p>Like all Hexo themes, after you download it, open <mark class=\"label info\">Hexo config file</mark>, find <code>theme</code> option, and change its value to <code>next</code> (or another theme directory name).</p>\n<figure class=\"highlight yml\"><figcaption><span>Hexo config file</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">theme:</span> <span class=\"string\">next</span></span><br></pre></td></tr></table></figure>\n\n<p>Now you have installed NexT theme and enabled it. The following steps will help you verify whether NexT is enabled correctly.</p>\n<h3 id=\"Checking-NexT\"><a href=\"#Checking-NexT\" class=\"headerlink\" title=\"Checking NexT\"></a>Checking NexT</h3><p>It’s recommended to use <code>hexo clean</code> to clean Hexo’s cache first.<br>Then start Hexo local server with debug parameter (by adding <code>--debug</code>), the whole command is <code>hexo s --debug</code>. You can see the output while running, and if you find problem, you can use the output to help others locate error better. When it prints:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INFO  Hexo is running at http://localhost:4000/. Press Ctrl+C to stop.</span><br></pre></td></tr></table></figure>\n\n<p>Now you can open <code>http://localhost:4000</code> in your browser, and check whether the site works correctly.</p>\n<div class=\"note success\"><p>If you find your site looks like this picture, you have installed it correctly. That’s default NexT scheme – Muse.<br><img src=\"/images/next-default-scheme.png\" alt=\"Default Scheme – Muse\"></p>\n</div>\n\n<p>After that we can <a href=\"/docs/getting-started/deployment.html\">configure deployment</a>.</p>\n<p>If everything is OK, in next steps we will change some settings including <a href=\"/docs/theme-settings/\">personalization</a> and <a href=\"/docs/third-party-services/\">third-party services integration</a>.</p>\n","site":{"data":{}},"length":4259,"excerpt":"","more":"<h3 id=\"Hexo-Installation\"><a href=\"#Hexo-Installation\" class=\"headerlink\" title=\"Hexo Installation\"></a>Hexo Installation</h3><p>If this is your first time using Hexo, you can take some time to review the Hexo Docs to see <a href=\"https://hexo.io/docs/\">how to install Hexo</a> and <a href=\"https://hexo.io/docs/setup\">initialize a site</a>. After the installation is successful, you should be able to execute <code>hexo</code> (or <code>npx hexo</code>) on the command line, and there must be <code>package.json</code>, <code>source</code>, <code>themes</code> and other directories in your <mark class=\"label info\">site root directory</mark>:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> hexo-site</span><br><span class=\"line\">$ <span class=\"built_in\">ls</span></span><br><span class=\"line\">_config.yml  node_modules  package-lock.json  package.json  scaffolds  <span class=\"built_in\">source</span>  themes</span><br></pre></td></tr></table></figure>\n\n<div class=\"note info\"><p>If you are new to Node.js or Hexo, you can also modify the source code of an existing Hexo website instead of creating a new one, to help you understand how Hexo works. In fact, the document you are reading is generated by Hexo with NexT, and you can install it with the following command:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git <span class=\"built_in\">clone</span> https://github.com/next-theme/theme-next-docs</span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> theme-next-docs</span><br><span class=\"line\">$ npm install</span><br></pre></td></tr></table></figure>\n</div>\n\n<p>Make sure that you have installed Hexo and created a site with it successfully, because the following documents require you to operate in the <mark class=\"label info\">site root directory</mark>.</p>\n<h3 id=\"NexT-Installation\"><a href=\"#NexT-Installation\" class=\"headerlink\" title=\"NexT Installation\"></a>NexT Installation</h3><p>The detailed steps to install or upgrade the theme are as follows.</p>\n<h4 id=\"Downloading-NexT\"><a href=\"#Downloading-NexT\" class=\"headerlink\" title=\"Downloading NexT\"></a>Downloading NexT</h4><p>It’s easy to install Hexo theme: you can choose to install the theme through npm, or download the source code of the theme in the <code>themes</code> directory under <mark class=\"label info\">site root directory</mark>.</p>\n<div class=\"tabs\" id=\"downloading-next\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#downloading-next-1\">Using <code>npm</code></a></li><li class=\"tab\"><a href=\"#downloading-next-2\">Using <code>git</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"downloading-next-1\"><p>If you’re using Hexo 5.0 or later, the simplest way to install is through npm.</p>\n<p>Open your Terminal, change to Hexo <mark class=\"label info\">site root directory</mark> and install NexT theme:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> hexo-site</span><br><span class=\"line\">$ npm install hexo-theme-next</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"downloading-next-2\"><p>If you know about <a href=\"https://git-scm.com/\">Git</a>, you can clone the whole repository and update it in any time with <code>git pull</code> command instead of downloading archive manually.</p>\n<p>Open your terminal, change to Hexo <mark class=\"label info\">site root directory</mark> and clone the latest master branch of NexT theme:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> hexo-site</span><br><span class=\"line\">$ git <span class=\"built_in\">clone</span> https://github.com/next-theme/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure></div></div></div>\n\n<div class=\"note primary\"><p>You can also read <a href=\"/docs/getting-started/installation.html\">detailed installation instructions</a> if you want any other installation variant.</p>\n</div>\n\n<h4 id=\"Upgrading-NexT\"><a href=\"#Upgrading-NexT\" class=\"headerlink\" title=\"Upgrading NexT\"></a>Upgrading NexT</h4><p>A new version of NexT will be released every month. Please read the <a href=\"https://github.com/next-theme/hexo-theme-next/releases\">release notes</a> before updating the theme. You can update NexT by the following command.</p>\n<div class=\"tabs\" id=\"upgrading-next\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#upgrading-next-1\">Using <code>npm</code></a></li><li class=\"tab\"><a href=\"#upgrading-next-2\">Using <code>git</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"upgrading-next-1\"><p>Install the latest version through npm:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> hexo-site</span><br><span class=\"line\">$ npm install hexo-theme-next@latest</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"upgrading-next-2\"><p>Or update to the latest master branch:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> hexo-site</span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> themes/next</span><br><span class=\"line\">$ git pull origin master</span><br></pre></td></tr></table></figure>\n\n<p>When running <code>git pull</code>, you can bypass merge conflicts (error message like <strong>«Commit your changes or stash them before you can merge»</strong>) by using the <code>Commit</code>, <code>Stash</code> or <code>Reset</code> commands for local changes. See <a href=\"https://stackoverflow.com/a/15745424/5861495\">here</a> how to do it.</p></div></div></div>\n\n<div class=\"note warning\"><p>If you are still using NexT version 5 or 7, you can read <a href=\"/docs/getting-started/upgrade.html\">instructions for upgrading from legacy version</a>.</p>\n</div>\n\n<h3 id=\"Configuration-Files\"><a href=\"#Configuration-Files\" class=\"headerlink\" title=\"Configuration Files\"></a>Configuration Files</h3><p>After the installation of Hexo and NexT, you may found that there are two configuration files using by Hexo and both called <code>_config.yml</code>:</p>\n<ol>\n<li>The first one is under <mark class=\"label info\">site root directory</mark>, which contains Hexo’s config.</li>\n<li>The second one is under <mark class=\"label primary\">theme root directory</mark> (e.g. <code>themes/next/_config.yml</code> or <code>node_modules/hexo-theme-next/_config.yml</code>), which is provided by NexT and contains theme’s config.</li>\n</ol>\n<p>Let’s call the first one – <mark class=\"label info\">Hexo config file</mark>, and the second one – <mark class=\"label primary\">NexT config file</mark>.</p>\n<div class=\"note warning\"><p>However, we do not recommend directly modifying the <mark class=\"label primary\">NexT config file</mark>. It is quite often running into conflict status when updating NexT theme via <code>git pull</code>, or need to merge configurations manually when upgrading to new releases. For the theme installed through npm, it is also difficult to modify the <mark class=\"label primary\">NexT config file</mark> in <code>node_modules</code>.</p>\n<p>In order to resolve this issue, we recommend using the <a href=\"/docs/getting-started/configuration.html\">Alternate Theme Config</a> feature to configure theme NexT.</p>\n</div>\n\n<h3 id=\"Hexo-Configuration\"><a href=\"#Hexo-Configuration\" class=\"headerlink\" title=\"Hexo Configuration\"></a>Hexo Configuration</h3><p>The following settings in <mark class=\"label info\">Hexo config file</mark> are very helpful for optimizing your website.</p>\n<h4 id=\"Configuring-Author\"><a href=\"#Configuring-Author\" class=\"headerlink\" title=\"Configuring Author\"></a>Configuring Author</h4><p>Edit <mark class=\"label info\">Hexo config file</mark> and set the value of <code>author</code> to your nickname.</p>\n<figure class=\"highlight yml\"><figcaption><span>Hexo config file</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Site</span></span><br><span class=\"line\"><span class=\"attr\">author:</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Configuring-Description\"><a href=\"#Configuring-Description\" class=\"headerlink\" title=\"Configuring Description\"></a>Configuring Description</h4><p>Edit <mark class=\"label info\">Hexo config file</mark> and set the value of <code>description</code> to your description, which can be a sentence you like.</p>\n<figure class=\"highlight yml\"><figcaption><span>Hexo config file</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Site</span></span><br><span class=\"line\"><span class=\"attr\">description:</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Enabling-NexT\"><a href=\"#Enabling-NexT\" class=\"headerlink\" title=\"Enabling NexT\"></a>Enabling NexT</h4><p>Like all Hexo themes, after you download it, open <mark class=\"label info\">Hexo config file</mark>, find <code>theme</code> option, and change its value to <code>next</code> (or another theme directory name).</p>\n<figure class=\"highlight yml\"><figcaption><span>Hexo config file</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">theme:</span> <span class=\"string\">next</span></span><br></pre></td></tr></table></figure>\n\n<p>Now you have installed NexT theme and enabled it. The following steps will help you verify whether NexT is enabled correctly.</p>\n<h3 id=\"Checking-NexT\"><a href=\"#Checking-NexT\" class=\"headerlink\" title=\"Checking NexT\"></a>Checking NexT</h3><p>It’s recommended to use <code>hexo clean</code> to clean Hexo’s cache first.<br>Then start Hexo local server with debug parameter (by adding <code>--debug</code>), the whole command is <code>hexo s --debug</code>. You can see the output while running, and if you find problem, you can use the output to help others locate error better. When it prints:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INFO  Hexo is running at http://localhost:4000/. Press Ctrl+C to stop.</span><br></pre></td></tr></table></figure>\n\n<p>Now you can open <code>http://localhost:4000</code> in your browser, and check whether the site works correctly.</p>\n<div class=\"note success\"><p>If you find your site looks like this picture, you have installed it correctly. That’s default NexT scheme – Muse.<br><img src=\"/images/next-default-scheme.png\" alt=\"Default Scheme – Muse\"></p>\n</div>\n\n<p>After that we can <a href=\"/docs/getting-started/deployment.html\">configure deployment</a>.</p>\n<p>If everything is OK, in next steps we will change some settings including <a href=\"/docs/theme-settings/\">personalization</a> and <a href=\"/docs/third-party-services/\">third-party services integration</a>.</p>\n"},{"title":"Hello World1","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","source":"_posts/测试/hello-world1.md","raw":"---\ntitle: Hello World1\ncategories:\n  - 测试\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","slug":"hello-world1","published":1,"category":"测试","date":"2023-06-08T22:25:35.160Z","updated":"2023-06-09T00:35:09.284Z","_id":"clinu5sev002fdxjcgqra1vme","comments":1,"layout":"post","photos":[],"link":"","content":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n","site":{"data":{}},"length":367,"excerpt":"","more":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n"},{"title":"测试","date":"2023-06-09T00:33:17.000Z","_content":"","source":"_posts/测试/测试.md","raw":"---\ntitle: 测试\ntags: []\ncategories:\n  - 测试\ndate: 2023-06-09 08:33:17\n---\n","slug":"测试","published":1,"category":"测试","updated":"2023-06-09T00:35:09.285Z","_id":"clinu5sew002jdxjchb9s4uhd","comments":1,"layout":"post","photos":[],"link":"","content":"","site":{"data":{}},"length":0,"excerpt":"","more":""},{"_content":"### 摘自程序员的喵公众号文章\n\n当我开始练习写作时，他人的故事、技巧分享激励了我。希望我的经历也会帮助到其他人，这篇案例分享的文章是我 2020 写的，原文是 How I Wrote a $500 Article in My First 3 Months on Medium ，我改过来加上一些后续。\n\n一万元并不是一笔巨款，但是算是我赚的时薪很高的一笔收入，因为我写当时那篇文章只花了 30 分钟。\n\n#### **如何写出来的**\n我作为一名软件工程师已经工作了近十年。我喜欢阅读，但没有写过太多文章。2019 年我开始练习英语写作，我在网上看到东西都会想想这篇文章怎么样，哪些地方值得学习。\n\n某天，我看到了一篇关于 Linux 好玩的命令的中文文章，觉得这有点意思，我们在日常工作中并不使用这些命令，但它们是程序员和 Linux 系统里的一种小幽默。我想可以写一篇 Medium 风格的文章，我在学习这种风格，反正也需要练习。\n\n我之前看过一些营销类的资料，诡异的心理学说标题中的奇数会吸引更多注意力，所以我得凑够 7 个命令，这感觉是在配制神秘药水。我读的那篇文章是针对极客的，我想把受众扩大到新手或非技术领域的读者，所以加入了一些如何安装这些命令的详细说明。\n\n我在 Mac 上尝试了每个命令，如果在 Mac 上没有我就在 Linux 虚拟机上试试，然后给每个命令都配了一张截图。\n\n我大概用了 30 分钟完成了，然后就提交到专栏 [Better Programming](https://medium.com/better-programming) 。这是一个面向 IT 专业人士的专栏，我之前在这里已经投递成功过一些技术文，但这篇不是硬核技术文，所以有可能不会被接收。我当时想，如果没有被接受我就发布在个人页面好了，反正也没没付出太多时间，随手一试吧。\n\n幸好 Better Programming 的编辑 [Zack Shapiro](https://zackshapiro.medium.com/)很快接收并发表了这篇文章：7 [Terminal Commands That Will Just Make You Smile](https://betterprogramming.pub/7-terminal-commands-that-will-just-make-you-smile-3f5bc8778080) 。\n\n他们还配了一张可爱的图片和带点幽默感的副标题：\n\n> These tutorials don’t always have to be practical\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203162034682.png)\n\n我估计是 Medium 在一些相关主题中推荐了这篇文章，阅读和点赞数开始滚雪球地增加，这算是我学习写作 3 个月里写出的表现最好的文章了。\n\n#### **如何继续完善**\n\n大约两天后，我看到数据不错就开始思考如何改进这篇文章。\n\n文章本身不长，只有 300 字。Medium 是看吸引了多少付费用户的阅读时间来计算稿费的，那如何提高平均阅读时间？\n\n我的想法是让它更有吸引力😏\n\n首先想到的是光有截图不够，应该为这些命令制作 GIF，因为 GIF 能更好地展示这些命令的有趣性。我以前没有在 Mac 上制作过 GIF，我在 Google 上搜索发现一个叫 LICEcap 的小工具，用这个工具很快就完成了 GIF。我甚至在页面上内嵌了一个 Youtube 视频，我要做的就是使这篇文章活泼生动，让读者很快得到乐趣并盯着文章看。\n\n最终这篇文章虽然很短，平均阅读时间为 2 分半钟，阅读量是 10 w，挣了 1300 多美金：\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203162035494.png)\n\n疫情的那段时间，我每天看着这篇文章赚上几百元的被动收入，感觉很好。\n\n#### **我学到了什么**\n这篇文章的想法并非原创，也很简单。我所做的是分享点趣味，并且扩大受众面，为目标受众做出一篇完美的文章。\n\n我在很短的时间内完成了初稿，发布之后如果数据好就继续雕琢到完美，这是一个可行的节省时间的策略。\n\n那如何重现这一切呢？说实话，我不知道，谁也不能保证根据这个策略就能再写出一篇。我还写了一些其他文章，所花费的时间比这篇更多却没得到这么多阅读量。写作中就会出现这样一些惊喜，那些不经意间写出来的反而火了。我想这篇能很快传播开来，一个原因是**优秀的配图和幽默感容易引起病毒式传播**。\n\n这篇文章确实是一个好的开始，因为我感觉这个经历有点靠边 Marketing，所以我又能写下这篇案例分享的文章。初稿我写得并不好，Better Marketing 的编辑 Niklas Göke 回复说噪音太多，能不能专注于写出来的过程，你当时的想法和思考等，写得越详细越好。我按照他的思路重写了这篇文章，最后也获得不错的结果：\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203162036730.png)\n\n给靠谱的 Meidum 专栏投稿的好处在于，作者提交后他们的编辑还会继续修改，我估计是因为编辑看我是非英语母语写作，所以会帮忙润色。我则可以看他们的修改来学习英语和写作。\n\n对于写作赚钱这件事来说，**没有一个必定成功的公式，我们需要做的就是写得更多、更好，写完给行家看，根据反馈修改，这就是最好的提高途径**。对于新手来说，投稿是个不错的办法，这样即能赚钱又能锻炼自己。\n\n最后提一下，我知道一些人也想参与 Medium 的合作伙伴项目 (因为只有参加了这个才能通收稿费)，一个门槛是 Medium 现在还不支持中国的银行卡，所以就比较麻烦。我的解决办法就是找了个朋友，用他的卡帮我收😂。\n\n我还是很推荐想学习英语或者写作的朋友多去 Medium 写写，不止有靠谱的编辑，也有很认真阅读的读者，即使不是为了赚钱也值得一试。\n","source":"_posts/认知与成长/我如何写出一万元的文章.md","raw":"---\ncategories:\n  - 认知与成长\n---\n### 摘自程序员的喵公众号文章\n\n当我开始练习写作时，他人的故事、技巧分享激励了我。希望我的经历也会帮助到其他人，这篇案例分享的文章是我 2020 写的，原文是 How I Wrote a $500 Article in My First 3 Months on Medium ，我改过来加上一些后续。\n\n一万元并不是一笔巨款，但是算是我赚的时薪很高的一笔收入，因为我写当时那篇文章只花了 30 分钟。\n\n#### **如何写出来的**\n我作为一名软件工程师已经工作了近十年。我喜欢阅读，但没有写过太多文章。2019 年我开始练习英语写作，我在网上看到东西都会想想这篇文章怎么样，哪些地方值得学习。\n\n某天，我看到了一篇关于 Linux 好玩的命令的中文文章，觉得这有点意思，我们在日常工作中并不使用这些命令，但它们是程序员和 Linux 系统里的一种小幽默。我想可以写一篇 Medium 风格的文章，我在学习这种风格，反正也需要练习。\n\n我之前看过一些营销类的资料，诡异的心理学说标题中的奇数会吸引更多注意力，所以我得凑够 7 个命令，这感觉是在配制神秘药水。我读的那篇文章是针对极客的，我想把受众扩大到新手或非技术领域的读者，所以加入了一些如何安装这些命令的详细说明。\n\n我在 Mac 上尝试了每个命令，如果在 Mac 上没有我就在 Linux 虚拟机上试试，然后给每个命令都配了一张截图。\n\n我大概用了 30 分钟完成了，然后就提交到专栏 [Better Programming](https://medium.com/better-programming) 。这是一个面向 IT 专业人士的专栏，我之前在这里已经投递成功过一些技术文，但这篇不是硬核技术文，所以有可能不会被接收。我当时想，如果没有被接受我就发布在个人页面好了，反正也没没付出太多时间，随手一试吧。\n\n幸好 Better Programming 的编辑 [Zack Shapiro](https://zackshapiro.medium.com/)很快接收并发表了这篇文章：7 [Terminal Commands That Will Just Make You Smile](https://betterprogramming.pub/7-terminal-commands-that-will-just-make-you-smile-3f5bc8778080) 。\n\n他们还配了一张可爱的图片和带点幽默感的副标题：\n\n> These tutorials don’t always have to be practical\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203162034682.png)\n\n我估计是 Medium 在一些相关主题中推荐了这篇文章，阅读和点赞数开始滚雪球地增加，这算是我学习写作 3 个月里写出的表现最好的文章了。\n\n#### **如何继续完善**\n\n大约两天后，我看到数据不错就开始思考如何改进这篇文章。\n\n文章本身不长，只有 300 字。Medium 是看吸引了多少付费用户的阅读时间来计算稿费的，那如何提高平均阅读时间？\n\n我的想法是让它更有吸引力😏\n\n首先想到的是光有截图不够，应该为这些命令制作 GIF，因为 GIF 能更好地展示这些命令的有趣性。我以前没有在 Mac 上制作过 GIF，我在 Google 上搜索发现一个叫 LICEcap 的小工具，用这个工具很快就完成了 GIF。我甚至在页面上内嵌了一个 Youtube 视频，我要做的就是使这篇文章活泼生动，让读者很快得到乐趣并盯着文章看。\n\n最终这篇文章虽然很短，平均阅读时间为 2 分半钟，阅读量是 10 w，挣了 1300 多美金：\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203162035494.png)\n\n疫情的那段时间，我每天看着这篇文章赚上几百元的被动收入，感觉很好。\n\n#### **我学到了什么**\n这篇文章的想法并非原创，也很简单。我所做的是分享点趣味，并且扩大受众面，为目标受众做出一篇完美的文章。\n\n我在很短的时间内完成了初稿，发布之后如果数据好就继续雕琢到完美，这是一个可行的节省时间的策略。\n\n那如何重现这一切呢？说实话，我不知道，谁也不能保证根据这个策略就能再写出一篇。我还写了一些其他文章，所花费的时间比这篇更多却没得到这么多阅读量。写作中就会出现这样一些惊喜，那些不经意间写出来的反而火了。我想这篇能很快传播开来，一个原因是**优秀的配图和幽默感容易引起病毒式传播**。\n\n这篇文章确实是一个好的开始，因为我感觉这个经历有点靠边 Marketing，所以我又能写下这篇案例分享的文章。初稿我写得并不好，Better Marketing 的编辑 Niklas Göke 回复说噪音太多，能不能专注于写出来的过程，你当时的想法和思考等，写得越详细越好。我按照他的思路重写了这篇文章，最后也获得不错的结果：\n\n![](https://gitee.com/cjyzwg/img/raw/master/202203162036730.png)\n\n给靠谱的 Meidum 专栏投稿的好处在于，作者提交后他们的编辑还会继续修改，我估计是因为编辑看我是非英语母语写作，所以会帮忙润色。我则可以看他们的修改来学习英语和写作。\n\n对于写作赚钱这件事来说，**没有一个必定成功的公式，我们需要做的就是写得更多、更好，写完给行家看，根据反馈修改，这就是最好的提高途径**。对于新手来说，投稿是个不错的办法，这样即能赚钱又能锻炼自己。\n\n最后提一下，我知道一些人也想参与 Medium 的合作伙伴项目 (因为只有参加了这个才能通收稿费)，一个门槛是 Medium 现在还不支持中国的银行卡，所以就比较麻烦。我的解决办法就是找了个朋友，用他的卡帮我收😂。\n\n我还是很推荐想学习英语或者写作的朋友多去 Medium 写写，不止有靠谱的编辑，也有很认真阅读的读者，即使不是为了赚钱也值得一试。\n","slug":"我如何写出一万元的文章","published":1,"category":"认知与成长","date":"2023-06-08T23:03:56.124Z","updated":"2023-06-08T23:12:13.747Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"clinu5sex002kdxjch0jra45f","content":"<h3 id=\"摘自程序员的喵公众号文章\"><a href=\"#摘自程序员的喵公众号文章\" class=\"headerlink\" title=\"摘自程序员的喵公众号文章\"></a>摘自程序员的喵公众号文章</h3><p>当我开始练习写作时，他人的故事、技巧分享激励了我。希望我的经历也会帮助到其他人，这篇案例分享的文章是我 2020 写的，原文是 How I Wrote a $500 Article in My First 3 Months on Medium ，我改过来加上一些后续。</p>\n<p>一万元并不是一笔巨款，但是算是我赚的时薪很高的一笔收入，因为我写当时那篇文章只花了 30 分钟。</p>\n<h4 id=\"如何写出来的\"><a href=\"#如何写出来的\" class=\"headerlink\" title=\"如何写出来的\"></a><strong>如何写出来的</strong></h4><p>我作为一名软件工程师已经工作了近十年。我喜欢阅读，但没有写过太多文章。2019 年我开始练习英语写作，我在网上看到东西都会想想这篇文章怎么样，哪些地方值得学习。</p>\n<p>某天，我看到了一篇关于 Linux 好玩的命令的中文文章，觉得这有点意思，我们在日常工作中并不使用这些命令，但它们是程序员和 Linux 系统里的一种小幽默。我想可以写一篇 Medium 风格的文章，我在学习这种风格，反正也需要练习。</p>\n<p>我之前看过一些营销类的资料，诡异的心理学说标题中的奇数会吸引更多注意力，所以我得凑够 7 个命令，这感觉是在配制神秘药水。我读的那篇文章是针对极客的，我想把受众扩大到新手或非技术领域的读者，所以加入了一些如何安装这些命令的详细说明。</p>\n<p>我在 Mac 上尝试了每个命令，如果在 Mac 上没有我就在 Linux 虚拟机上试试，然后给每个命令都配了一张截图。</p>\n<p>我大概用了 30 分钟完成了，然后就提交到专栏 <a href=\"https://medium.com/better-programming\">Better Programming</a> 。这是一个面向 IT 专业人士的专栏，我之前在这里已经投递成功过一些技术文，但这篇不是硬核技术文，所以有可能不会被接收。我当时想，如果没有被接受我就发布在个人页面好了，反正也没没付出太多时间，随手一试吧。</p>\n<p>幸好 Better Programming 的编辑 <a href=\"https://zackshapiro.medium.com/\">Zack Shapiro</a>很快接收并发表了这篇文章：7 <a href=\"https://betterprogramming.pub/7-terminal-commands-that-will-just-make-you-smile-3f5bc8778080\">Terminal Commands That Will Just Make You Smile</a> 。</p>\n<p>他们还配了一张可爱的图片和带点幽默感的副标题：</p>\n<blockquote>\n<p>These tutorials don’t always have to be practical</p>\n</blockquote>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203162034682.png\"></p>\n<p>我估计是 Medium 在一些相关主题中推荐了这篇文章，阅读和点赞数开始滚雪球地增加，这算是我学习写作 3 个月里写出的表现最好的文章了。</p>\n<h4 id=\"如何继续完善\"><a href=\"#如何继续完善\" class=\"headerlink\" title=\"如何继续完善\"></a><strong>如何继续完善</strong></h4><p>大约两天后，我看到数据不错就开始思考如何改进这篇文章。</p>\n<p>文章本身不长，只有 300 字。Medium 是看吸引了多少付费用户的阅读时间来计算稿费的，那如何提高平均阅读时间？</p>\n<p>我的想法是让它更有吸引力😏</p>\n<p>首先想到的是光有截图不够，应该为这些命令制作 GIF，因为 GIF 能更好地展示这些命令的有趣性。我以前没有在 Mac 上制作过 GIF，我在 Google 上搜索发现一个叫 LICEcap 的小工具，用这个工具很快就完成了 GIF。我甚至在页面上内嵌了一个 Youtube 视频，我要做的就是使这篇文章活泼生动，让读者很快得到乐趣并盯着文章看。</p>\n<p>最终这篇文章虽然很短，平均阅读时间为 2 分半钟，阅读量是 10 w，挣了 1300 多美金：</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203162035494.png\"></p>\n<p>疫情的那段时间，我每天看着这篇文章赚上几百元的被动收入，感觉很好。</p>\n<h4 id=\"我学到了什么\"><a href=\"#我学到了什么\" class=\"headerlink\" title=\"我学到了什么\"></a><strong>我学到了什么</strong></h4><p>这篇文章的想法并非原创，也很简单。我所做的是分享点趣味，并且扩大受众面，为目标受众做出一篇完美的文章。</p>\n<p>我在很短的时间内完成了初稿，发布之后如果数据好就继续雕琢到完美，这是一个可行的节省时间的策略。</p>\n<p>那如何重现这一切呢？说实话，我不知道，谁也不能保证根据这个策略就能再写出一篇。我还写了一些其他文章，所花费的时间比这篇更多却没得到这么多阅读量。写作中就会出现这样一些惊喜，那些不经意间写出来的反而火了。我想这篇能很快传播开来，一个原因是<strong>优秀的配图和幽默感容易引起病毒式传播</strong>。</p>\n<p>这篇文章确实是一个好的开始，因为我感觉这个经历有点靠边 Marketing，所以我又能写下这篇案例分享的文章。初稿我写得并不好，Better Marketing 的编辑 Niklas Göke 回复说噪音太多，能不能专注于写出来的过程，你当时的想法和思考等，写得越详细越好。我按照他的思路重写了这篇文章，最后也获得不错的结果：</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203162036730.png\"></p>\n<p>给靠谱的 Meidum 专栏投稿的好处在于，作者提交后他们的编辑还会继续修改，我估计是因为编辑看我是非英语母语写作，所以会帮忙润色。我则可以看他们的修改来学习英语和写作。</p>\n<p>对于写作赚钱这件事来说，<strong>没有一个必定成功的公式，我们需要做的就是写得更多、更好，写完给行家看，根据反馈修改，这就是最好的提高途径</strong>。对于新手来说，投稿是个不错的办法，这样即能赚钱又能锻炼自己。</p>\n<p>最后提一下，我知道一些人也想参与 Medium 的合作伙伴项目 (因为只有参加了这个才能通收稿费)，一个门槛是 Medium 现在还不支持中国的银行卡，所以就比较麻烦。我的解决办法就是找了个朋友，用他的卡帮我收😂。</p>\n<p>我还是很推荐想学习英语或者写作的朋友多去 Medium 写写，不止有靠谱的编辑，也有很认真阅读的读者，即使不是为了赚钱也值得一试。</p>\n","site":{"data":{}},"length":1973,"excerpt":"","more":"<h3 id=\"摘自程序员的喵公众号文章\"><a href=\"#摘自程序员的喵公众号文章\" class=\"headerlink\" title=\"摘自程序员的喵公众号文章\"></a>摘自程序员的喵公众号文章</h3><p>当我开始练习写作时，他人的故事、技巧分享激励了我。希望我的经历也会帮助到其他人，这篇案例分享的文章是我 2020 写的，原文是 How I Wrote a $500 Article in My First 3 Months on Medium ，我改过来加上一些后续。</p>\n<p>一万元并不是一笔巨款，但是算是我赚的时薪很高的一笔收入，因为我写当时那篇文章只花了 30 分钟。</p>\n<h4 id=\"如何写出来的\"><a href=\"#如何写出来的\" class=\"headerlink\" title=\"如何写出来的\"></a><strong>如何写出来的</strong></h4><p>我作为一名软件工程师已经工作了近十年。我喜欢阅读，但没有写过太多文章。2019 年我开始练习英语写作，我在网上看到东西都会想想这篇文章怎么样，哪些地方值得学习。</p>\n<p>某天，我看到了一篇关于 Linux 好玩的命令的中文文章，觉得这有点意思，我们在日常工作中并不使用这些命令，但它们是程序员和 Linux 系统里的一种小幽默。我想可以写一篇 Medium 风格的文章，我在学习这种风格，反正也需要练习。</p>\n<p>我之前看过一些营销类的资料，诡异的心理学说标题中的奇数会吸引更多注意力，所以我得凑够 7 个命令，这感觉是在配制神秘药水。我读的那篇文章是针对极客的，我想把受众扩大到新手或非技术领域的读者，所以加入了一些如何安装这些命令的详细说明。</p>\n<p>我在 Mac 上尝试了每个命令，如果在 Mac 上没有我就在 Linux 虚拟机上试试，然后给每个命令都配了一张截图。</p>\n<p>我大概用了 30 分钟完成了，然后就提交到专栏 <a href=\"https://medium.com/better-programming\">Better Programming</a> 。这是一个面向 IT 专业人士的专栏，我之前在这里已经投递成功过一些技术文，但这篇不是硬核技术文，所以有可能不会被接收。我当时想，如果没有被接受我就发布在个人页面好了，反正也没没付出太多时间，随手一试吧。</p>\n<p>幸好 Better Programming 的编辑 <a href=\"https://zackshapiro.medium.com/\">Zack Shapiro</a>很快接收并发表了这篇文章：7 <a href=\"https://betterprogramming.pub/7-terminal-commands-that-will-just-make-you-smile-3f5bc8778080\">Terminal Commands That Will Just Make You Smile</a> 。</p>\n<p>他们还配了一张可爱的图片和带点幽默感的副标题：</p>\n<blockquote>\n<p>These tutorials don’t always have to be practical</p>\n</blockquote>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203162034682.png\"></p>\n<p>我估计是 Medium 在一些相关主题中推荐了这篇文章，阅读和点赞数开始滚雪球地增加，这算是我学习写作 3 个月里写出的表现最好的文章了。</p>\n<h4 id=\"如何继续完善\"><a href=\"#如何继续完善\" class=\"headerlink\" title=\"如何继续完善\"></a><strong>如何继续完善</strong></h4><p>大约两天后，我看到数据不错就开始思考如何改进这篇文章。</p>\n<p>文章本身不长，只有 300 字。Medium 是看吸引了多少付费用户的阅读时间来计算稿费的，那如何提高平均阅读时间？</p>\n<p>我的想法是让它更有吸引力😏</p>\n<p>首先想到的是光有截图不够，应该为这些命令制作 GIF，因为 GIF 能更好地展示这些命令的有趣性。我以前没有在 Mac 上制作过 GIF，我在 Google 上搜索发现一个叫 LICEcap 的小工具，用这个工具很快就完成了 GIF。我甚至在页面上内嵌了一个 Youtube 视频，我要做的就是使这篇文章活泼生动，让读者很快得到乐趣并盯着文章看。</p>\n<p>最终这篇文章虽然很短，平均阅读时间为 2 分半钟，阅读量是 10 w，挣了 1300 多美金：</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203162035494.png\"></p>\n<p>疫情的那段时间，我每天看着这篇文章赚上几百元的被动收入，感觉很好。</p>\n<h4 id=\"我学到了什么\"><a href=\"#我学到了什么\" class=\"headerlink\" title=\"我学到了什么\"></a><strong>我学到了什么</strong></h4><p>这篇文章的想法并非原创，也很简单。我所做的是分享点趣味，并且扩大受众面，为目标受众做出一篇完美的文章。</p>\n<p>我在很短的时间内完成了初稿，发布之后如果数据好就继续雕琢到完美，这是一个可行的节省时间的策略。</p>\n<p>那如何重现这一切呢？说实话，我不知道，谁也不能保证根据这个策略就能再写出一篇。我还写了一些其他文章，所花费的时间比这篇更多却没得到这么多阅读量。写作中就会出现这样一些惊喜，那些不经意间写出来的反而火了。我想这篇能很快传播开来，一个原因是<strong>优秀的配图和幽默感容易引起病毒式传播</strong>。</p>\n<p>这篇文章确实是一个好的开始，因为我感觉这个经历有点靠边 Marketing，所以我又能写下这篇案例分享的文章。初稿我写得并不好，Better Marketing 的编辑 Niklas Göke 回复说噪音太多，能不能专注于写出来的过程，你当时的想法和思考等，写得越详细越好。我按照他的思路重写了这篇文章，最后也获得不错的结果：</p>\n<p><img src=\"https://gitee.com/cjyzwg/img/raw/master/202203162036730.png\"></p>\n<p>给靠谱的 Meidum 专栏投稿的好处在于，作者提交后他们的编辑还会继续修改，我估计是因为编辑看我是非英语母语写作，所以会帮忙润色。我则可以看他们的修改来学习英语和写作。</p>\n<p>对于写作赚钱这件事来说，<strong>没有一个必定成功的公式，我们需要做的就是写得更多、更好，写完给行家看，根据反馈修改，这就是最好的提高途径</strong>。对于新手来说，投稿是个不错的办法，这样即能赚钱又能锻炼自己。</p>\n<p>最后提一下，我知道一些人也想参与 Medium 的合作伙伴项目 (因为只有参加了这个才能通收稿费)，一个门槛是 Medium 现在还不支持中国的银行卡，所以就比较麻烦。我的解决办法就是找了个朋友，用他的卡帮我收😂。</p>\n<p>我还是很推荐想学习英语或者写作的朋友多去 Medium 写写，不止有靠谱的编辑，也有很认真阅读的读者，即使不是为了赚钱也值得一试。</p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"clinu5sdn0001dxjc5rpse25r","category_id":"clinu5sds0004dxjc22pd67vl","_id":"clinu5sdz000cdxjc6tgkbdop"},{"post_id":"clinu5sdr0003dxjc9x7l7oln","category_id":"clinu5sdx0009dxjcfrwpfz0s","_id":"clinu5se1000gdxjcds4defkf"},{"post_id":"clinu5sdv0006dxjc9aj89qth","category_id":"clinu5sdz000ddxjc5af80x35","_id":"clinu5se4000ldxjc7a001eqd"},{"post_id":"clinu5sdw0007dxjc1a7eghkp","category_id":"clinu5sdz000ddxjc5af80x35","_id":"clinu5se6000pdxjcbabudqiq"},{"post_id":"clinu5sdw0008dxjcbu1p6v5b","category_id":"clinu5sdz000ddxjc5af80x35","_id":"clinu5se8000sdxjcb0w50038"},{"post_id":"clinu5se7000qdxjc7hlncvok","category_id":"clinu5se6000odxjc4yo6huga","_id":"clinu5se9000wdxjcetsu5ap2"},{"post_id":"clinu5sdy000adxjcfmr99v38","category_id":"clinu5se6000odxjc4yo6huga","_id":"clinu5seb000zdxjcbz9n4wyc"},{"post_id":"clinu5se7000rdxjcc2vbcjry","category_id":"clinu5se6000odxjc4yo6huga","_id":"clinu5sec0011dxjc0ruq05iq"},{"post_id":"clinu5se8000udxjccw8x7jm7","category_id":"clinu5se6000odxjc4yo6huga","_id":"clinu5sed0014dxjc1u0udnxe"},{"post_id":"clinu5sdy000bdxjc0457h6nn","category_id":"clinu5se6000odxjc4yo6huga","_id":"clinu5see0016dxjc4st1hs5n"},{"post_id":"clinu5sdz000edxjc9caedjkh","category_id":"clinu5se6000odxjc4yo6huga","_id":"clinu5sef0019dxjc069t506e"},{"post_id":"clinu5se0000fdxjcacvtc5za","category_id":"clinu5se6000odxjc4yo6huga","_id":"clinu5seg001cdxjc2o0xa0e3"},{"post_id":"clinu5se2000idxjcdj755m4l","category_id":"clinu5se6000odxjc4yo6huga","_id":"clinu5seh001gdxjcfw8fha35"},{"post_id":"clinu5se3000jdxjc2wv317z0","category_id":"clinu5se6000odxjc4yo6huga","_id":"clinu5sej001kdxjcfmpvajjt"},{"post_id":"clinu5se5000mdxjc3pv2cl2k","category_id":"clinu5se6000odxjc4yo6huga","_id":"clinu5sek001odxjc8vhv4aea"},{"post_id":"clinu5se6000ndxjcb6yuh7e9","category_id":"clinu5se6000odxjc4yo6huga","_id":"clinu5sem001rdxjc5o2c103u"},{"post_id":"clinu5se9000vdxjc6s6w1zad","category_id":"clinu5sek001ndxjch6tzakj9","_id":"clinu5seo001xdxjcdg0x1h9i"},{"post_id":"clinu5sea000ydxjc5vpx1ffj","category_id":"clinu5sek001ndxjch6tzakj9","_id":"clinu5sep0020dxjchd8g6gqc"},{"post_id":"clinu5seb0010dxjch0n9715l","category_id":"clinu5seo001wdxjc71t0ajy2","_id":"clinu5ser0024dxjcbghf4dv7"},{"post_id":"clinu5sec0013dxjch6jt2zhy","category_id":"clinu5sep0021dxjc16oq0jhw","_id":"clinu5ses0029dxjc63o3dbgj"},{"post_id":"clinu5sed0015dxjc5nj48ssf","category_id":"clinu5seo001wdxjc71t0ajy2","_id":"clinu5seu002ddxjc0heqdq57"},{"post_id":"clinu5see0018dxjc21ka8slk","category_id":"clinu5seo001wdxjc71t0ajy2","_id":"clinu5sew002hdxjc83rb2upd"},{"post_id":"clinu5sef001adxjc5ekkgfxk","category_id":"clinu5seo001wdxjc71t0ajy2","_id":"clinu5sey002mdxjc0z8v758i"},{"post_id":"clinu5seg001ddxjcbxcs8t6u","category_id":"clinu5seo001wdxjc71t0ajy2","_id":"clinu5sez002pdxjc58z7fzmc"},{"post_id":"clinu5seh001edxjccj379u6n","category_id":"clinu5sey002ldxjc89n9g0ua","_id":"clinu5sf0002tdxjc1y9a4957"},{"post_id":"clinu5seh001hdxjc4pdyg6oj","category_id":"clinu5sey002ldxjc89n9g0ua","_id":"clinu5sf0002vdxjc4nclcg73"},{"post_id":"clinu5sei001idxjc1wqsg9pp","category_id":"clinu5sf0002sdxjchpo3cb1k","_id":"clinu5sf1002ydxjc7ecv2bwm"},{"post_id":"clinu5sej001ldxjcha5qhiox","category_id":"clinu5sf0002sdxjchpo3cb1k","_id":"clinu5sf20030dxjc7o7kd24f"},{"post_id":"clinu5sek001mdxjc38ar7rr4","category_id":"clinu5sf0002sdxjchpo3cb1k","_id":"clinu5sf20032dxjcey9wdvlh"},{"post_id":"clinu5sel001pdxjc1ryqg281","category_id":"clinu5sf0002sdxjchpo3cb1k","_id":"clinu5sf20033dxjc1m508fvc"},{"post_id":"clinu5sel001qdxjc4o1mbi8z","category_id":"clinu5sf20031dxjcd2qf0pul","_id":"clinu5sf30035dxjc9cctdkth"},{"post_id":"clinu5sem001sdxjc4jyzarqt","category_id":"clinu5sf20034dxjcc2le0oas","_id":"clinu5sf30037dxjc906baqm6"},{"post_id":"clinu5sen001udxjc8unt88cc","category_id":"clinu5sf30036dxjc4iby8kkm","_id":"clinu5sf3003adxjc727t0pq0"},{"post_id":"clinu5sen001vdxjc4rqdamff","category_id":"clinu5sf30036dxjc4iby8kkm","_id":"clinu5sf4003bdxjc2xghdkb0"},{"post_id":"clinu5seo001ydxjchiipezrx","category_id":"clinu5sf30039dxjc5vf7cdcp","_id":"clinu5sf4003edxjcazbkef55"},{"post_id":"clinu5sep001zdxjc905naplh","category_id":"clinu5sf30039dxjc5vf7cdcp","_id":"clinu5sf5003gdxjcc8z9cp2y"},{"post_id":"clinu5sep0022dxjc75q92lgk","category_id":"clinu5sf30039dxjc5vf7cdcp","_id":"clinu5sf5003idxjcgw0gdepl"},{"post_id":"clinu5seq0023dxjc97u933b4","category_id":"clinu5sf30039dxjc5vf7cdcp","_id":"clinu5sf5003kdxjc426qbp9q"},{"post_id":"clinu5ser0026dxjc50mdbj0y","category_id":"clinu5sf30039dxjc5vf7cdcp","_id":"clinu5sf6003mdxjc3r696l5o"},{"post_id":"clinu5ser0027dxjcaa4ofm77","category_id":"clinu5sf30039dxjc5vf7cdcp","_id":"clinu5sf6003ndxjcg4fi7x4r"},{"post_id":"clinu5sew002jdxjchb9s4uhd","category_id":"clinu5sf7003tdxjc96r08qef","_id":"clinu5sf8003xdxjc99gef8qo"},{"post_id":"clinu5sex002kdxjch0jra45f","category_id":"clinu5sf7003wdxjcc22z9ygp","_id":"clinu5sf8003zdxjccehy94zl"},{"post_id":"clinu5set002bdxjceu0ybnk1","category_id":"clinu5sf7003tdxjc96r08qef","_id":"clinu5yc90000eljc7u2z54j9"},{"post_id":"clinu5ses002adxjc1s5o973b","category_id":"clinu5sf7003tdxjc96r08qef","_id":"clinu5ycb0001eljc36c64h7h"},{"post_id":"clinu5sev002fdxjcgqra1vme","category_id":"clinu5sf7003tdxjc96r08qef","_id":"clinu5ycc0002eljcba532d9l"},{"post_id":"clinu5seu002edxjccoptdin2","category_id":"clinu5sf7003tdxjc96r08qef","_id":"clinu5ycc0003eljc8uosdp31"}],"PostTag":[{"post_id":"clinu5seu002edxjccoptdin2","tag_id":"clinu5sew002idxjca1gl8vhk","_id":"clinu5sf0002rdxjc9g4z0na8"},{"post_id":"clinu5seu002edxjccoptdin2","tag_id":"clinu5sez002odxjc8yvw9dsb","_id":"clinu5sf0002udxjcdcpzc53q"}],"Tag":[{"name":"hexo","_id":"clinu5sew002idxjca1gl8vhk"},{"name":"博客","_id":"clinu5sez002odxjc8yvw9dsb"}]}}